import{ay as W,di as Z,e as C,ck as K,bU as q,bK as H,N as D,aa as tt,bQ as $,cA as R,ak as et,cf as it,j as at,bS as nt,aZ as ot,a_ as st,cn as rt,y as z,aS as Q,aT as j,K as lt,bJ as pt}from"./index-B3HKDY-B.js";var X=W.prototype,w=Z.prototype,J=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1};function O(n){return isNaN(+n.cpx1)||isNaN(+n.cpy1)}(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}C(e,n)})(J);var ct=function(n){function e(t){var i=n.call(this,t)||this;return i.type="ec-line",i}return C(e,n),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new J},e.prototype.buildPath=function(t,i){O(i)?X.buildPath.call(this,t,i):w.buildPath.call(this,t,i)},e.prototype.pointAt=function(t){return O(this.shape)?X.pointAt.call(this,t):w.pointAt.call(this,t)},e.prototype.tangentAt=function(t){var i=this.shape,o=O(i)?[i.x2-i.x1,i.y2-i.y1]:w.tangentAt.call(this,t);return K(o,o)},e}(q),P=["fromSymbol","toSymbol"];function B(n){return"_"+n+"Type"}function G(n,e,t){var i=e.getItemVisual(t,n);if(!i||i==="none")return i;var o=e.getItemVisual(t,n+"Size"),a=e.getItemVisual(t,n+"Rotate"),s=e.getItemVisual(t,n+"Offset"),r=e.getItemVisual(t,n+"KeepAspect"),l=Q(o);return i+l+j(s||0,l)+(a||"")+(r||"")}function Y(n,e,t){var i=e.getItemVisual(t,n);if(i&&i!=="none"){var o=e.getItemVisual(t,n+"Size"),a=e.getItemVisual(t,n+"Rotate"),s=e.getItemVisual(t,n+"Offset"),r=e.getItemVisual(t,n+"KeepAspect"),l=Q(o),u=j(s||0,l),c=lt(i,-l[0]/2+u[0],-l[1]/2+u[1],l[0],l[1],null,r);return c.__specifiedRotation=a==null||isNaN(a)?void 0:+a*Math.PI/180||0,c.name=n,c}}function T(n,e){n.x1=e[0][0],n.y1=e[0][1],n.x2=e[1][0],n.y2=e[1][1],n.percent=1;var t=e[2];t?(n.cpx1=t[0],n.cpy1=t[1]):(n.cpx1=NaN,n.cpy1=NaN)}var ut=function(n){function e(t,i,o){var a=n.call(this)||this;return a._createLine(t,i,o),a}return C(e,n),e.prototype._createLine=function(t,i,o){var a=t.hostModel,s=function(r){var l=new ct({name:"line",subPixelOptimize:!0});return T(l.shape,r),l}(t.getItemLayout(i));s.shape.percent=0,H(s,{shape:{percent:1}},a,i),this.add(s),D(P,function(r){var l=Y(r,t,i);this.add(l),this[B(r)]=G(r,t,i)},this),this._updateCommonStl(t,i,o)},e.prototype.updateData=function(t,i,o){var a=t.hostModel,s=this.childOfName("line"),r=t.getItemLayout(i),l={shape:{}};T(l.shape,r),tt(s,l,a,i),D(P,function(u){var c=G(u,t,i),h=B(u);if(this[h]!==c){this.remove(this.childOfName(u));var p=Y(u,t,i);this.add(p)}this[h]=c},this),this._updateCommonStl(t,i,o)},e.prototype.getLinePath=function(){return this.childAt(0)},e.prototype._updateCommonStl=function(t,i,o){var a=t.hostModel,s=this.childOfName("line"),r=o&&o.emphasisLineStyle,l=o&&o.blurLineStyle,u=o&&o.selectLineStyle,c=o&&o.labelStatesModels,h=o&&o.emphasisDisabled,p=o&&o.focus,v=o&&o.blurScope;if(!o||t.hasItemOption){var g=t.getItemModel(i),L=g.getModel("emphasis");r=L.getModel("lineStyle").getLineStyle(),l=g.getModel(["blur","lineStyle"]).getLineStyle(),u=g.getModel(["select","lineStyle"]).getLineStyle(),h=L.get("disabled"),p=L.get("focus"),v=L.get("blurScope"),c=$(g)}var m=t.getItemVisual(i,"style"),I=m.stroke;s.useStyle(m),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=r,s.ensureState("blur").style=l,s.ensureState("select").style=u,D(P,function(b){var f=this.childOfName(b);if(f){f.setColor(I),f.style.opacity=m.opacity;for(var y=0;y<R.length;y++){var M=R[y],N=s.getState(M);if(N){var A=N.style||{},k=f.ensureState(M),E=k.style||(k.style={});A.stroke!=null&&(E[f.__isEmptyBrush?"stroke":"fill"]=A.stroke),A.opacity!=null&&(E.opacity=A.opacity)}}f.markRedraw()}},this);var x=a.getRawValue(i);et(this,c,{labelDataIndex:i,labelFetcher:{getFormattedLabel:function(b,f){return a.getFormattedLabel(b,f,t.dataType)}},inheritColor:I||"#000",defaultOpacity:m.opacity,defaultText:(x==null?t.getName(i):isFinite(x)?it(x):x)+""});var d=this.getTextContent();if(d){var S=c.normal;d.__align=d.style.align,d.__verticalAlign=d.style.verticalAlign,d.__position=S.get("position")||"middle";var _=S.get("distance");at(_)||(_=[_,_]),d.__labelDistance=_}this.setTextConfig({position:null,local:!0,inside:!1}),nt(this,p,v,h)},e.prototype.highlight=function(){ot(this)},e.prototype.downplay=function(){st(this)},e.prototype.updateLayout=function(t,i){this.setLinePoints(t.getItemLayout(i))},e.prototype.setLinePoints=function(t){var i=this.childOfName("line");T(i.shape,t),i.dirty()},e.prototype.beforeUpdate=function(){var t=this,i=t.childOfName("fromSymbol"),o=t.childOfName("toSymbol"),a=t.getTextContent();if(i||o||a&&!a.ignore){for(var s=1,r=this.parent;r;)r.scaleX&&(s/=r.scaleX),r=r.parent;var l=t.childOfName("line");if(this.__dirty||l.__dirty){var u=l.shape.percent,c=l.pointAt(0),h=l.pointAt(u),p=rt([],h,c);if(K(p,p),i&&(i.setPosition(c),M(i,0),i.scaleX=i.scaleY=s*u,i.markRedraw()),o&&(o.setPosition(h),M(o,1),o.scaleX=o.scaleY=s*u,o.markRedraw()),a&&!a.ignore){a.x=a.y=0,a.originX=a.originY=0;var v=void 0,g=void 0,L=a.__labelDistance,m=L[0]*s,I=L[1]*s,x=u/2,d=l.tangentAt(x),S=[d[1],-d[0]],_=l.pointAt(x);S[1]>0&&(S[0]=-S[0],S[1]=-S[1]);var b=d[0]<0?-1:1;if(a.__position!=="start"&&a.__position!=="end"){var f=-Math.atan2(d[1],d[0]);h[0]<c[0]&&(f=Math.PI+f),a.rotation=f}var y=void 0;switch(a.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":y=-I,g="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":y=I,g="top";break;default:y=0,g="middle"}switch(a.__position){case"end":a.x=p[0]*m+h[0],a.y=p[1]*I+h[1],v=p[0]>.8?"left":p[0]<-.8?"right":"center",g=p[1]>.8?"top":p[1]<-.8?"bottom":"middle";break;case"start":a.x=-p[0]*m+c[0],a.y=-p[1]*I+c[1],v=p[0]>.8?"right":p[0]<-.8?"left":"center",g=p[1]>.8?"bottom":p[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":a.x=m*b+c[0],a.y=c[1]+y,v=d[0]<0?"right":"left",a.originX=-m*b,a.originY=-y;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":a.x=_[0],a.y=_[1]+y,v="center",a.originY=-y;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":a.x=-m*b+h[0],a.y=h[1]+y,v=d[0]>=0?"right":"left",a.originX=m*b,a.originY=-y}a.scaleX=a.scaleY=s,a.setStyle({verticalAlign:a.__verticalAlign||g,align:a.__align||v})}}}function M(N,A){var k=N.__specifiedRotation;if(k==null){var E=l.tangentAt(A);N.attr("rotation",(A===1?-1:1)*Math.PI/2-Math.atan2(E[1],E[0]))}else N.attr("rotation",k)}},e}(z),ht=function(){function n(e){this.group=new z,this._LineCtor=e||ut}return n.prototype.updateData=function(e){var t=this;this._progressiveEls=null;var i=this,o=i.group,a=i._lineData;i._lineData=e,a||o.removeAll();var s=U(e);e.diff(a).add(function(r){t._doAdd(e,r,s)}).update(function(r,l){t._doUpdate(a,e,l,r,s)}).remove(function(r){o.remove(a.getItemGraphicEl(r))}).execute()},n.prototype.updateLayout=function(){var e=this._lineData;e&&e.eachItemGraphicEl(function(t,i){t.updateLayout(e,i)},this)},n.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=U(e),this._lineData=null,this.group.removeAll()},n.prototype.incrementalUpdate=function(e,t){function i(s){s.isGroup||function(r){return r.animators&&r.animators.length>0}(s)||(s.incremental=!0,s.ensureState("emphasis").hoverLayer=!0)}this._progressiveEls=[];for(var o=e.start;o<e.end;o++)if(V(t.getItemLayout(o))){var a=new this._LineCtor(t,o,this._seriesScope);a.traverse(i),this.group.add(a),t.setItemGraphicEl(o,a),this._progressiveEls.push(a)}},n.prototype.remove=function(){this.group.removeAll()},n.prototype.eachRendered=function(e){pt(this._progressiveEls||this.group,e)},n.prototype._doAdd=function(e,t,i){if(V(e.getItemLayout(t))){var o=new this._LineCtor(e,t,i);e.setItemGraphicEl(t,o),this.group.add(o)}},n.prototype._doUpdate=function(e,t,i,o,a){var s=e.getItemGraphicEl(i);V(t.getItemLayout(o))?(s?s.updateData(t,o,a):s=new this._LineCtor(t,o,a),t.setItemGraphicEl(o,s),this.group.add(s)):this.group.remove(s)},n}();function U(n){var e=n.hostModel,t=e.getModel("emphasis");return{lineStyle:e.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:e.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:e.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:t.get("disabled"),blurScope:t.get("blurScope"),focus:t.get("focus"),labelStatesModels:$(e)}}function F(n){return isNaN(n[0])||isNaN(n[1])}function V(n){return n&&!F(n[0])&&!F(n[1])}export{ht as O,ut as w};
