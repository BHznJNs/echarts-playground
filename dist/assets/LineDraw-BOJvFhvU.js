import{az as q,de as H,e as C,cl as $,bV as J,bL as Z,N as D,ab as tt,bR as z,db as R,al as et,cg as it,j as at,bT as nt,a_ as ot,a$ as st,co as rt,A as K,aT as j,aU as Q,L as lt,bK as pt}from"./index-B7CpzWKR.js";var X=q.prototype,T=H.prototype,W=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1};function V(n){return isNaN(+n.cpx1)||isNaN(+n.cpy1)}(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}C(e,n)})(W);var ct=function(n){function e(t){var i=n.call(this,t)||this;return i.type="ec-line",i}return C(e,n),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new W},e.prototype.buildPath=function(t,i){V(i)?X.buildPath.call(this,t,i):T.buildPath.call(this,t,i)},e.prototype.pointAt=function(t){return V(this.shape)?X.pointAt.call(this,t):T.pointAt.call(this,t)},e.prototype.tangentAt=function(t){var i=this.shape,o=V(i)?[i.x2-i.x1,i.y2-i.y1]:T.tangentAt.call(this,t);return $(o,o)},e}(J),w=["fromSymbol","toSymbol"];function B(n){return"_"+n+"Type"}function G(n,e,t){var i=e.getItemVisual(t,n);if(!i||i==="none")return i;var o=e.getItemVisual(t,n+"Size"),a=e.getItemVisual(t,n+"Rotate"),s=e.getItemVisual(t,n+"Offset"),r=e.getItemVisual(t,n+"KeepAspect"),l=j(o);return i+l+Q(s||0,l)+(a||"")+(r||"")}function Y(n,e,t){var i=e.getItemVisual(t,n);if(i&&i!=="none"){var o=e.getItemVisual(t,n+"Size"),a=e.getItemVisual(t,n+"Rotate"),s=e.getItemVisual(t,n+"Offset"),r=e.getItemVisual(t,n+"KeepAspect"),l=j(o),u=Q(s||0,l),c=lt(i,-l[0]/2+u[0],-l[1]/2+u[1],l[0],l[1],null,r);return c.__specifiedRotation=a==null||isNaN(a)?void 0:+a*Math.PI/180||0,c.name=n,c}}function O(n,e){n.x1=e[0][0],n.y1=e[0][1],n.x2=e[1][0],n.y2=e[1][1],n.percent=1;var t=e[2];t?(n.cpx1=t[0],n.cpy1=t[1]):(n.cpx1=NaN,n.cpy1=NaN)}var ut=function(n){function e(t,i,o){var a=n.call(this)||this;return a._createLine(t,i,o),a}return C(e,n),e.prototype._createLine=function(t,i,o){var a=t.hostModel,s=function(r){var l=new ct({name:"line",subPixelOptimize:!0});return O(l.shape,r),l}(t.getItemLayout(i));s.shape.percent=0,Z(s,{shape:{percent:1}},a,i),this.add(s),D(w,function(r){var l=Y(r,t,i);this.add(l),this[B(r)]=G(r,t,i)},this),this._updateCommonStl(t,i,o)},e.prototype.updateData=function(t,i,o){var a=t.hostModel,s=this.childOfName("line"),r=t.getItemLayout(i),l={shape:{}};O(l.shape,r),tt(s,l,a,i),D(w,function(u){var c=G(u,t,i),h=B(u);if(this[h]!==c){this.remove(this.childOfName(u));var p=Y(u,t,i);this.add(p)}this[h]=c},this),this._updateCommonStl(t,i,o)},e.prototype.getLinePath=function(){return this.childAt(0)},e.prototype._updateCommonStl=function(t,i,o){var a=t.hostModel,s=this.childOfName("line"),r=o&&o.emphasisLineStyle,l=o&&o.blurLineStyle,u=o&&o.selectLineStyle,c=o&&o.labelStatesModels,h=o&&o.emphasisDisabled,p=o&&o.focus,v=o&&o.blurScope;if(!o||t.hasItemOption){var g=t.getItemModel(i),L=g.getModel("emphasis");r=L.getModel("lineStyle").getLineStyle(),l=g.getModel(["blur","lineStyle"]).getLineStyle(),u=g.getModel(["select","lineStyle"]).getLineStyle(),h=L.get("disabled"),p=L.get("focus"),v=L.get("blurScope"),c=z(g)}var m=t.getItemVisual(i,"style"),I=m.stroke;s.useStyle(m),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=r,s.ensureState("blur").style=l,s.ensureState("select").style=u,D(w,function(b){var y=this.childOfName(b);if(y){y.setColor(I),y.style.opacity=m.opacity;for(var f=0;f<R.length;f++){var M=R[f],N=s.getState(M);if(N){var A=N.style||{},E=y.ensureState(M),k=E.style||(E.style={});A.stroke!=null&&(k[y.__isEmptyBrush?"stroke":"fill"]=A.stroke),A.opacity!=null&&(k.opacity=A.opacity)}}y.markRedraw()}},this);var x=a.getRawValue(i);et(this,c,{labelDataIndex:i,labelFetcher:{getFormattedLabel:function(b,y){return a.getFormattedLabel(b,y,t.dataType)}},inheritColor:I||"#000",defaultOpacity:m.opacity,defaultText:(x==null?t.getName(i):isFinite(x)?it(x):x)+""});var d=this.getTextContent();if(d){var _=c.normal;d.__align=d.style.align,d.__verticalAlign=d.style.verticalAlign,d.__position=_.get("position")||"middle";var S=_.get("distance");at(S)||(S=[S,S]),d.__labelDistance=S}this.setTextConfig({position:null,local:!0,inside:!1}),nt(this,p,v,h)},e.prototype.highlight=function(){ot(this)},e.prototype.downplay=function(){st(this)},e.prototype.updateLayout=function(t,i){this.setLinePoints(t.getItemLayout(i))},e.prototype.setLinePoints=function(t){var i=this.childOfName("line");O(i.shape,t),i.dirty()},e.prototype.beforeUpdate=function(){var t=this,i=t.childOfName("fromSymbol"),o=t.childOfName("toSymbol"),a=t.getTextContent();if(i||o||a&&!a.ignore){for(var s=1,r=this.parent;r;)r.scaleX&&(s/=r.scaleX),r=r.parent;var l=t.childOfName("line");if(this.__dirty||l.__dirty){var u=l.shape.percent,c=l.pointAt(0),h=l.pointAt(u),p=rt([],h,c);if($(p,p),i&&(i.setPosition(c),M(i,0),i.scaleX=i.scaleY=s*u,i.markRedraw()),o&&(o.setPosition(h),M(o,1),o.scaleX=o.scaleY=s*u,o.markRedraw()),a&&!a.ignore){a.x=a.y=0,a.originX=a.originY=0;var v=void 0,g=void 0,L=a.__labelDistance,m=L[0]*s,I=L[1]*s,x=u/2,d=l.tangentAt(x),_=[d[1],-d[0]],S=l.pointAt(x);_[1]>0&&(_[0]=-_[0],_[1]=-_[1]);var b=d[0]<0?-1:1;if(a.__position!=="start"&&a.__position!=="end"){var y=-Math.atan2(d[1],d[0]);h[0]<c[0]&&(y=Math.PI+y),a.rotation=y}var f=void 0;switch(a.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":f=-I,g="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":f=I,g="top";break;default:f=0,g="middle"}switch(a.__position){case"end":a.x=p[0]*m+h[0],a.y=p[1]*I+h[1],v=p[0]>.8?"left":p[0]<-.8?"right":"center",g=p[1]>.8?"top":p[1]<-.8?"bottom":"middle";break;case"start":a.x=-p[0]*m+c[0],a.y=-p[1]*I+c[1],v=p[0]>.8?"right":p[0]<-.8?"left":"center",g=p[1]>.8?"bottom":p[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":a.x=m*b+c[0],a.y=c[1]+f,v=d[0]<0?"right":"left",a.originX=-m*b,a.originY=-f;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":a.x=S[0],a.y=S[1]+f,v="center",a.originY=-f;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":a.x=-m*b+h[0],a.y=h[1]+f,v=d[0]>=0?"right":"left",a.originX=m*b,a.originY=-f}a.scaleX=a.scaleY=s,a.setStyle({verticalAlign:a.__verticalAlign||g,align:a.__align||v})}}}function M(N,A){var E=N.__specifiedRotation;if(E==null){var k=l.tangentAt(A);N.attr("rotation",(A===1?-1:1)*Math.PI/2-Math.atan2(k[1],k[0]))}else N.attr("rotation",E)}},e}(K),ht=function(){function n(e){this.group=new K,this._LineCtor=e||ut}return n.prototype.updateData=function(e){var t=this;this._progressiveEls=null;var i=this,o=i.group,a=i._lineData;i._lineData=e,a||o.removeAll();var s=U(e);e.diff(a).add(function(r){t._doAdd(e,r,s)}).update(function(r,l){t._doUpdate(a,e,l,r,s)}).remove(function(r){o.remove(a.getItemGraphicEl(r))}).execute()},n.prototype.updateLayout=function(){var e=this._lineData;e&&e.eachItemGraphicEl(function(t,i){t.updateLayout(e,i)},this)},n.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=U(e),this._lineData=null,this.group.removeAll()},n.prototype.incrementalUpdate=function(e,t){function i(s){s.isGroup||function(r){return r.animators&&r.animators.length>0}(s)||(s.incremental=!0,s.ensureState("emphasis").hoverLayer=!0)}this._progressiveEls=[];for(var o=e.start;o<e.end;o++)if(P(t.getItemLayout(o))){var a=new this._LineCtor(t,o,this._seriesScope);a.traverse(i),this.group.add(a),t.setItemGraphicEl(o,a),this._progressiveEls.push(a)}},n.prototype.remove=function(){this.group.removeAll()},n.prototype.eachRendered=function(e){pt(this._progressiveEls||this.group,e)},n.prototype._doAdd=function(e,t,i){if(P(e.getItemLayout(t))){var o=new this._LineCtor(e,t,i);e.setItemGraphicEl(t,o),this.group.add(o)}},n.prototype._doUpdate=function(e,t,i,o,a){var s=e.getItemGraphicEl(i);P(t.getItemLayout(o))?(s?s.updateData(t,o,a):s=new this._LineCtor(t,o,a),t.setItemGraphicEl(o,s),this.group.add(s)):this.group.remove(s)},n}();function U(n){var e=n.hostModel,t=e.getModel("emphasis");return{lineStyle:e.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:e.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:e.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:t.get("disabled"),blurScope:t.get("blurScope"),focus:t.get("focus"),labelStatesModels:z(e)}}function F(n){return isNaN(n[0])||isNaN(n[1])}function P(n){return n&&!F(n[0])&&!F(n[1])}export{ht as O,ut as w};
