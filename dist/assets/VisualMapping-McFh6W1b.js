import{T as G,N as P,j as w,aB as g,cG as J,H as C,ag as N,G as Z,cH as M,ak as b,V as m,E as $,aj as k,x as A,cI as H,cJ as B}from"./index-CfHuJ7al.js";var V=P,Y=g,_=-1,I=function(){function t(n){var a=n.mappingMethod,i=n.type,r=this.option=G(n);this.type=i,this.mappingMethod=a,this._normalizeData=q[a];var e=t.visualHandlers[i];this.applyVisual=e.applyVisual,this.getColorMapper=e.getColorMapper,this._normalizedToVisual=e._normalizedToVisual[a],a==="piecewise"?(O(r),function(l){var u=l.pieceList;l.hasSpecialVisual=!1,P(u,function(o,c){o.originIndex=c,o.visual!=null&&(l.hasSpecialVisual=!0)})}(r)):a==="category"?r.categories?function(l){var u=l.categories,o=l.categoryMap={},c=l.visual;if(V(u,function(f,v){o[f]=v}),!w(c)){var s=[];g(c)?V(c,function(f,v){var T=o[v];s[T??_]=f}):s[_]=c,c=j(l,s)}for(var p=u.length-1;p>=0;p--)c[p]==null&&(delete o[u[p]],u.pop())}(r):O(r,!0):(J(a!=="linear"||r.dataExtent),O(r))}return t.prototype.mapValueToVisual=function(n){var a=this._normalizeData(n);return this._normalizedToVisual(a,n)},t.prototype.getNormalizer=function(){return C(this._normalizeData,this)},t.listVisualTypes=function(){return N(t.visualHandlers)},t.isValidType=function(n){return t.visualHandlers.hasOwnProperty(n)},t.eachVisual=function(n,a,i){g(n)?P(n,a,i):a.call(i,n)},t.mapVisual=function(n,a,i){var r,e=w(n)?[]:g(n)?{}:(r=!0,null);return t.eachVisual(n,function(l,u){var o=a.call(i,l,u);r?e=o:e[u]=o}),e},t.retrieveVisuals=function(n){var a,i={};return n&&V(t.visualHandlers,function(r,e){n.hasOwnProperty(e)&&(i[e]=n[e],a=!0)}),a?i:null},t.prepareVisualTypes=function(n){if(w(n))n=n.slice();else{if(!Y(n))return[];var a=[];V(n,function(i,r){a.push(r)}),n=a}return n.sort(function(i,r){return r==="color"&&i!=="color"&&i.indexOf("color")===0?1:-1}),n},t.dependsOn=function(n,a){return a==="color"?!(!n||n.indexOf(a)!==0):n===a},t.findPieceIndex=function(n,a,i){for(var r,e=1/0,l=0,u=a.length;l<u;l++){var o=a[l].value;if(o!=null){if(o===n||Z(o)&&o===n+"")return l;i&&f(o,l)}}for(l=0,u=a.length;l<u;l++){var c=a[l],s=c.interval,p=c.close;if(s){if(s[0]===-1/0){if(x(p[1],n,s[1]))return l}else if(s[1]===1/0){if(x(p[0],s[0],n))return l}else if(x(p[0],s[0],n)&&x(p[1],n,s[1]))return l;i&&f(s[0],l),i&&f(s[1],l)}}if(i)return n===1/0?a.length-1:n===-1/0?0:r;function f(v,T){var L=Math.abs(v-n);L<e&&(e=L,r=T)}},t.visualHandlers={color:{applyVisual:d("color"),getColorMapper:function(){var n=this.option;return C(n.mappingMethod==="category"?function(a,i){return!i&&(a=this._normalizeData(a)),y.call(this,a)}:function(a,i,r){var e=!!r;return!i&&(a=this._normalizeData(a)),r=M(a,n.parsedVisual,r),e?r:b(r,"rgba")},this)},_normalizedToVisual:{linear:function(n){return b(M(n,this.option.parsedVisual),"rgba")},category:y,piecewise:function(n,a){var i=D.call(this,a);return i==null&&(i=b(M(n,this.option.parsedVisual),"rgba")),i},fixed:h}},colorHue:z(function(n,a){return H(n,a)}),colorSaturation:z(function(n,a){return H(n,null,a)}),colorLightness:z(function(n,a){return H(n,null,null,a)}),colorAlpha:z(function(n,a){return B(n,a)}),decal:{applyVisual:d("decal"),_normalizedToVisual:{linear:null,category:y,piecewise:null,fixed:null}},opacity:{applyVisual:d("opacity"),_normalizedToVisual:S([0,1])},liftZ:{applyVisual:d("liftZ"),_normalizedToVisual:{linear:h,category:h,piecewise:h,fixed:h}},symbol:{applyVisual:function(n,a,i){i("symbol",this.mapValueToVisual(n))},_normalizedToVisual:{linear:E,category:y,piecewise:function(n,a){var i=D.call(this,a);return i==null&&(i=E.call(this,n)),i},fixed:h}},symbolSize:{applyVisual:d("symbolSize"),_normalizedToVisual:S([0,1])}},t}();function O(t,n){var a=t.visual,i=[];g(a)?V(a,function(r){i.push(r)}):a!=null&&i.push(a),n||i.length!==1||{color:1,symbol:1}.hasOwnProperty(t.type)||(i[1]=i[0]),j(t,i)}function z(t){return{applyVisual:function(n,a,i){var r=this.mapValueToVisual(n);i("color",t(a("color"),r))},_normalizedToVisual:S([0,1])}}function E(t){var n=this.option.visual;return n[Math.round(m(t,[0,1],[0,n.length-1],!0))]||{}}function d(t){return function(n,a,i){i(t,this.mapValueToVisual(n))}}function y(t){var n=this.option.visual;return n[this.option.loop&&t!==_?t%n.length:t]}function h(){return this.option.visual[0]}function S(t){return{linear:function(n){return m(n,t,this.option.visual,!0)},category:y,piecewise:function(n,a){var i=D.call(this,a);return i==null&&(i=m(n,t,this.option.visual,!0)),i},fixed:h}}function D(t){var n=this.option,a=n.pieceList;if(n.hasSpecialVisual){var i=a[I.findPieceIndex(t,a)];if(i&&i.visual)return i.visual[this.type]}}function j(t,n){return t.visual=n,t.type==="color"&&(t.parsedVisual=$(n,function(a){var i=k(a);return i||[0,0,0,1]})),n}var q={linear:function(t){return m(t,this.option.dataExtent,[0,1],!0)},piecewise:function(t){var n=this.option.pieceList,a=I.findPieceIndex(t,n,!0);if(a!=null)return m(a,[0,n.length-1],[0,1],!0)},category:function(t){var n=this.option.categories?this.option.categoryMap[t]:t;return n??_},fixed:A};function x(t,n,a){return t?n<=a:n<a}var K=I;export{K as D};
