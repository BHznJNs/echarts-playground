import{e as oe,N as p,C as M,T as y,E as U,aX as ae,cE as se,A as x,r as ue,B as ce,a2 as C,H as he,d as N,I as fe,a1 as le,a0 as ge,cF as pe,z as de}from"./index-B7p1rSoh.js";import{r as ve,e as _e}from"./interactionMutex-BZTRNC-D.js";import{e as me}from"./cursorHelper-IgNoiH07.js";var m=!0,T=Math.min,w=Math.max,be=Math.pow,Ce=1e4,ye=6,we=6,W="globalPan",Oe={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},Te={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},A={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},Ee=0,Re=function(e){function t(r){var n=e.call(this)||this;return n._track=[],n._covers=[],n._handlers={},n._zr=r,n.group=new x,n._uid="brushController_"+Ee++,p(ke,function(o,i){this._handlers[i]=he(o,this)},n),n}return oe(t,e),t.prototype.enableBrush=function(r){return this._brushType&&this._doDisableBrush(),r.brushType&&this._doEnableBrush(r),this},t.prototype._doEnableBrush=function(r){var n=this._zr;this._enableGlobalPan||ve(n,W,this._uid),p(this._handlers,function(o,i){n.on(i,o)}),this._brushType=r.brushType,this._brushOption=M(y(A),r,!0)},t.prototype._doDisableBrush=function(){var r=this._zr;_e(r,W,this._uid),p(this._handlers,function(n,o){r.off(o,n)}),this._brushType=this._brushOption=null},t.prototype.setPanels=function(r){if(r&&r.length){var n=this._panels={};p(r,function(o){n[o.panelId]=y(o)})}else this._panels=null;return this},t.prototype.mount=function(r){r=r||{},this._enableGlobalPan=r.enableGlobalPan;var n=this.group;return this._zr.add(n),n.attr({x:r.x||0,y:r.y||0,rotation:r.rotation||0,scaleX:r.scaleX||1,scaleY:r.scaleY||1}),this._transform=n.getLocalTransform(),this},t.prototype.updateCovers=function(r){r=U(r,function(u){return M(y(A),u,!0)});var n="\0-brush-index-",o=this._covers,i=this._covers=[],a=this,s=this._creatingCover;return new ae(o,r,function(u,h){return c(u.__brushOption,h)},c).add(f).update(f).remove(function(u){o[u]!==s&&a.group.remove(o[u])}).execute(),this;function c(u,h){return(u.id!=null?u.id:n+h)+"-"+u.brushType}function f(u,h){var l=r[u];if(h!=null&&o[h]===s)i[u]=o[h];else{var g=i[u]=h!=null?(o[h].__brushOption=l,o[h]):J(a,q(a,l));$(a,g)}}},t.prototype.unmount=function(){return this.enableBrush(!1),k(this),this._zr.remove(this.group),this},t.prototype.dispose=function(){this.unmount(),this.off()},t}(se);function q(e,t){var r=E[t.brushType].createCover(e,t);return r.__brushOption=t,Q(r,t),e.group.add(r),r}function J(e,t){var r=X(t);return r.endCreating&&(r.endCreating(e,t),Q(t,t.__brushOption)),t}function K(e,t){var r=t.__brushOption;X(t).updateCoverShape(e,t,r.range,r)}function Q(e,t){var r=t.z;r==null&&(r=Ce),e.traverse(function(n){n.z=r,n.z2=r})}function $(e,t){X(t).updateCommon(e,t),K(e,t)}function X(e){return E[e.__brushOption.brushType]}function z(e,t,r){var n,o=e._panels;if(!o)return m;var i=e._transform;return p(o,function(a){a.isTargetByCursor(t,r,i)&&(n=a)}),n}function V(e,t){var r=e._panels;if(!r)return m;var n=t.__brushOption.panelId;return n!=null?r[n]:m}function k(e){var t=e._covers,r=t.length;return p(t,function(n){e.group.remove(n)},e),t.length=0,!!r}function b(e,t){var r=U(e._covers,function(n){var o=n.__brushOption,i=y(o.range);return{brushType:o.brushType,panelId:o.panelId,range:i}});e.trigger("brush",{areas:r,isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function Z(e){var t=e.length-1;return t<0&&(t=0),[e[0],e[t]]}function ee(e,t,r,n){var o=new x;return o.add(new N({name:"main",style:L(r),silent:!0,draggable:!0,cursor:"move",drift:C(H,e,t,o,["n","s","w","e"]),ondragend:C(b,t,{isEnd:!0})})),p(n,function(i){o.add(new N({name:i.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:C(H,e,t,o,i),ondragend:C(b,t,{isEnd:!0})}))}),o}function te(e,t,r,n){var o=n.brushStyle.lineWidth||0,i=w(o,we),a=r[0][0],s=r[1][0],c=a-o/2,f=s-o/2,u=r[0][1],h=r[1][1],l=u-i+o/2,g=h-i+o/2,v=u-a,_=h-s,O=v+o,D=_+o;d(e,t,"main",a,s,v,_),n.transformable&&(d(e,t,"w",c,f,i,D),d(e,t,"e",l,f,i,D),d(e,t,"n",c,f,O,i),d(e,t,"s",c,g,O,i),d(e,t,"nw",c,f,i,i),d(e,t,"ne",l,f,i,i),d(e,t,"sw",c,g,i,i),d(e,t,"se",l,g,i,i))}function B(e,t){var r=t.__brushOption,n=r.transformable,o=t.childAt(0);o.useStyle(L(r)),o.attr({silent:!n,cursor:n?"move":"default"}),p([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(i){var a=t.childOfName(i.join("")),s=i.length===1?R(e,i[0]):function(c,f){var u=[R(c,f[0]),R(c,f[1])];return(u[0]==="e"||u[0]==="w")&&u.reverse(),u.join("")}(e,i);a&&a.attr({silent:!n,invisible:!n,cursor:n?Te[s]+"-resize":null})})}function d(e,t,r,n,o,i,a){var s,c,f,u,h,l=t.childOfName(r);l&&l.setShape((s=P(e,t,[[n,o],[n+i,o+a]]),c=T(s[0][0],s[1][0]),f=T(s[0][1],s[1][1]),u=w(s[0][0],s[1][0]),h=w(s[0][1],s[1][1]),{x:c,y:f,width:u-c,height:h-f}))}function L(e){return fe({strokeNoScale:!0},e.brushStyle)}function re(e,t,r,n){var o=[T(e,r),T(t,n)],i=[w(e,r),w(t,n)];return[[o[0],i[0]],[o[1],i[1]]]}function R(e,t){var r=le({w:"left",e:"right",n:"top",s:"bottom"}[t],function(n){return ge(n.group)}(e));return{left:"w",right:"e",top:"n",bottom:"s"}[r]}function H(e,t,r,n,o,i){var a=r.__brushOption,s=e.toRectRange(a.range),c=ne(t,o,i);p(n,function(f){var u=Oe[f];s[u[0]][u[1]]+=c[u[0]]}),a.range=e.fromRectRange(re(s[0][0],s[1][0],s[0][1],s[1][1])),$(t,r),b(t,{isEnd:!1})}function ze(e,t,r,n){var o=t.__brushOption.range,i=ne(e,r,n);p(o,function(a){a[0]+=i[0],a[1]+=i[1]}),$(e,t),b(e,{isEnd:!1})}function ne(e,t,r){var n=e.group,o=n.transformCoordToLocal(t,r),i=n.transformCoordToLocal(0,0);return[o[0]-i[0],o[1]-i[1]]}function P(e,t,r){var n=V(e,t);return n&&n!==m?n.clipPath(r,e._transform):y(r)}function S(e){var t=e.event;t.preventDefault&&t.preventDefault()}function I(e,t,r){return e.childOfName("main").contain(t,r)}function ie(e,t,r,n){var o,i=e._creatingCover,a=e._creatingPanel,s=e._brushOption;if(e._track.push(r.slice()),function(u){var h=u._track;if(!h.length)return!1;var l=h[h.length-1],g=h[0],v=l[0]-g[0],_=l[1]-g[1];return be(v*v+_*_,.5)>ye}(e)||i){if(a&&!i){s.brushMode==="single"&&k(e);var c=y(s);c.brushType=j(c.brushType,a),c.panelId=a===m?null:a.panelId,i=e._creatingCover=q(e,c),e._covers.push(i)}if(i){var f=E[j(e._brushType,a)];i.__brushOption.range=f.getCreatingRange(P(e,i,e._track)),n&&(J(e,i),f.updateCommon(e,i)),K(e,i),o={isEnd:n}}}else n&&s.brushMode==="single"&&s.removeOnClick&&z(e,t,r)&&k(e)&&(o={isEnd:n,removeOnClick:!0});return o}function j(e,t){return e==="auto"?t.defaultBrushType:e}var ke={mousedown:function(e){if(this._dragging)G(this,e);else if(!e.target||!e.target.draggable){S(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);this._creatingCover=null,(this._creatingPanel=z(this,e,t))&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(e){var t=e.offsetX,r=e.offsetY,n=this.group.transformCoordToLocal(t,r);if(function(i,a,s){if(i._brushType&&!function(g,v,_){var O=g._zr;return v<0||v>O.getWidth()||_<0||_>O.getHeight()}(i,a.offsetX,a.offsetY)){var c=i._zr,f=i._covers,u=z(i,a,s);if(!i._dragging)for(var h=0;h<f.length;h++){var l=f[h].__brushOption;if(u&&(u===m||l.panelId===u.panelId)&&E[l.brushType].contain(f[h],s[0],s[1]))return}u&&c.setCursorStyle("crosshair")}}(this,e,n),this._dragging){S(e);var o=ie(this,e,n,!1);o&&b(this,o)}},mouseup:function(e){G(this,e)}};function G(e,t){if(e._dragging){S(t);var r=t.offsetX,n=t.offsetY,o=e.group.transformCoordToLocal(r,n),i=ie(e,t,o,!0);e._dragging=!1,e._track=[],e._creatingCover=null,i&&b(e,i)}}var E={lineX:F(0),lineY:F(1),rect:{createCover:function(e,t){function r(n){return n}return ee({toRectRange:r,fromRectRange:r},e,t,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(e){var t=Z(e);return re(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(e,t,r,n){te(e,t,r,n)},updateCommon:B,contain:I},polygon:{createCover:function(e,t){var r=new x;return r.add(new ue({name:"main",style:L(t),silent:!0})),r},getCreatingRange:function(e){return e},endCreating:function(e,t){t.remove(t.childAt(0)),t.add(new ce({name:"main",draggable:!0,drift:C(ze,e,t),ondragend:C(b,e,{isEnd:!0})}))},updateCoverShape:function(e,t,r,n){t.childAt(0).setShape({points:P(e,t,r)})},updateCommon:B,contain:I}};function F(e){return{createCover:function(t,r){return ee({toRectRange:function(n){var o=[n,[0,100]];return e&&o.reverse(),o},fromRectRange:function(n){return n[e]}},t,r,[[["w"],["e"]],[["n"],["s"]]][e])},getCreatingRange:function(t){var r=Z(t);return[T(r[0][e],r[1][e]),w(r[0][e],r[1][e])]},updateCoverShape:function(t,r,n,o){var i,a=V(t,r);if(a!==m&&a.getLinearBrushOtherExtent)i=a.getLinearBrushOtherExtent(e);else{var s=t._zr;i=[0,[s.getWidth(),s.getHeight()][1-e]]}var c=[n,i];e&&c.reverse(),te(t,r,c,o)},updateCommon:B,contain:I}}var xe=Re;function $e(e){return e=Y(e),function(t){return pe(t,e)}}function Xe(e,t){return e=Y(e),function(r){var n=t??r,o=n?e.width:e.height,i=n?e.x:e.y;return[i,i+(o||0)]}}function Le(e,t,r){var n=Y(e);return function(o,i){return n.contain(i[0],i[1])&&!me(o,t,r)}}function Y(e){return de.create(e)}export{Xe as g,xe as h,$e as l,Le as p};
