import{e as _,j as M,L as x,aL as O,U as F,dc as m,A as w,r as V,ab as z,bT as E,dn as L,dp as R,z as k,bV as N,b_ as U,bP as Z,dq as A,ap as B,aN as Y,aP as j,bJ as Q,cv as q,dr as X,E as H,cQ as J,a8 as K}from"./index-B7CpzWKR.js";import{w as b,O as W}from"./LineDraw-BOJvFhvU.js";import{h as G}from"./createClipPathFromCoordSys-CD8CKvfL.js";var D=function(p){function a(t,e,r){var o=p.call(this)||this;return o.add(o.createLine(t,e,r)),o._updateEffectSymbol(t,e),o}return _(a,p),a.prototype.createLine=function(t,e,r){return new b(t,e,r)},a.prototype._updateEffectSymbol=function(t,e){var r=t.getItemModel(e).getModel("effect"),o=r.get("symbolSize"),s=r.get("symbol");M(o)||(o=[o,o]);var n=t.getItemVisual(e,"style"),i=r.get("color")||n&&n.stroke,l=this.childAt(1);this._symbolType!==s&&(this.remove(l),(l=x(s,-.5,-.5,1,1,i)).z2=100,l.culling=!0,this.add(l)),l&&(l.setStyle("shadowColor",i),l.setStyle(r.getItemStyle(["color"])),l.scaleX=o[0],l.scaleY=o[1],l.setColor(i),this._symbolType=s,this._symbolScale=o,this._updateEffectAnimation(t,r,e))},a.prototype._updateEffectAnimation=function(t,e,r){var o=this.childAt(1);if(o){var s=t.getItemLayout(r),n=1e3*e.get("period"),i=e.get("loop"),l=e.get("roundTrip"),f=e.get("constantSpeed"),u=O(e.get("delay"),function(d){return d/t.count()*n/3});if(o.ignore=!0,this._updateAnimationPoints(o,s),f>0&&(n=this._getLineLength(o)/f*1e3),n!==this._period||i!==this._loop||l!==this._roundTrip){o.stopAnimation();var h=void 0;h=F(u)?u(r):u,o.__t>0&&(h=-n*o.__t),this._animateSymbol(o,n,h,i,l)}this._period=n,this._loop=i,this._roundTrip=l}},a.prototype._animateSymbol=function(t,e,r,o,s){if(e>0){t.__t=0;var n=this,i=t.animate("",o).when(s?2*e:e,{__t:s?2:1}).delay(r).during(function(){n._updateSymbolPosition(t)});o||i.done(function(){n.remove(t)}),i.start()}},a.prototype._getLineLength=function(t){return m(t.__p1,t.__cp1)+m(t.__cp1,t.__p2)},a.prototype._updateAnimationPoints=function(t,e){t.__p1=e[0],t.__p2=e[1],t.__cp1=e[2]||[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]},a.prototype.updateData=function(t,e,r){this.childAt(0).updateData(t,e,r),this._updateEffectSymbol(t,e)},a.prototype._updateSymbolPosition=function(t){var e=t.__p1,r=t.__p2,o=t.__cp1,s=t.__t<1?t.__t:2-t.__t,n=[t.x,t.y],i=n.slice(),l=q,f=X;n[0]=l(e[0],o[0],r[0],s),n[1]=l(e[1],o[1],r[1],s);var u=t.__t<1?f(e[0],o[0],r[0],s):f(r[0],o[0],e[0],1-s),h=t.__t<1?f(e[1],o[1],r[1],s):f(r[1],o[1],e[1],1-s);t.rotation=-Math.atan2(h,u)-Math.PI/2,this._symbolType!=="line"&&this._symbolType!=="rect"&&this._symbolType!=="roundRect"||(t.__lastT!==void 0&&t.__lastT<t.__t?(t.scaleY=1.05*m(i,n),s===1&&(n[0]=i[0]+(n[0]-i[0])/2,n[1]=i[1]+(n[1]-i[1])/2)):t.__lastT===1?t.scaleY=2*m(e,n):t.scaleY=this._symbolScale[1]),t.__lastT=t.__t,t.ignore=!1,t.x=n[0],t.y=n[1]},a.prototype.updateLayout=function(t,e){this.childAt(0).updateLayout(t,e);var r=t.getItemModel(e).getModel("effect");this._updateEffectAnimation(t,r,e)},a}(w),P=function(p){function a(t,e,r){var o=p.call(this)||this;return o._createPolyline(t,e,r),o}return _(a,p),a.prototype._createPolyline=function(t,e,r){var o=t.getItemLayout(e),s=new V({shape:{points:o}});this.add(s),this._updateCommonStl(t,e,r)},a.prototype.updateData=function(t,e,r){var o=t.hostModel,s=this.childAt(0),n={shape:{points:t.getItemLayout(e)}};z(s,n,o,e),this._updateCommonStl(t,e,r)},a.prototype._updateCommonStl=function(t,e,r){var o=this.childAt(0),s=t.getItemModel(e),n=r&&r.emphasisLineStyle,i=r&&r.focus,l=r&&r.blurScope,f=r&&r.emphasisDisabled;if(!r||t.hasItemOption){var u=s.getModel("emphasis");n=u.getModel("lineStyle").getLineStyle(),f=u.get("disabled"),i=u.get("focus"),l=u.get("blurScope")}o.useStyle(t.getItemVisual(e,"style")),o.style.fill=null,o.style.strokeNoScale=!0,o.ensureState("emphasis").style=n,E(this,i,l,f)},a.prototype.updateLayout=function(t,e){this.childAt(0).setShape("points",t.getItemLayout(e))},a}(w),$=function(p){function a(){var t=p!==null&&p.apply(this,arguments)||this;return t._lastFrame=0,t._lastFramePercent=0,t}return _(a,p),a.prototype.createLine=function(t,e,r){return new P(t,e,r)},a.prototype._updateAnimationPoints=function(t,e){this._points=e;for(var r=[0],o=0,s=1;s<e.length;s++){var n=e[s-1],i=e[s];o+=m(n,i),r.push(o)}if(o!==0){for(s=0;s<r.length;s++)r[s]/=o;this._offsets=r,this._length=o}else this._length=0},a.prototype._getLineLength=function(){return this._length},a.prototype._updateSymbolPosition=function(t){var e=t.__t<1?t.__t:2-t.__t,r=this._points,o=this._offsets,s=r.length;if(o){var n,i=this._lastFrame;if(e<this._lastFramePercent){for(n=Math.min(i+1,s-1);n>=0&&!(o[n]<=e);n--);n=Math.min(n,s-2)}else{for(n=i;n<s&&!(o[n]>e);n++);n=Math.min(n-1,s-2)}var l=(e-o[n])/(o[n+1]-o[n]),f=r[n],u=r[n+1];t.x=f[0]*(1-l)+l*u[0],t.y=f[1]*(1-l)+l*u[1];var h=t.__t<1?u[0]-f[0]:f[0]-u[0],d=t.__t<1?u[1]-f[1]:f[1]-u[1];t.rotation=-Math.atan2(d,h)-Math.PI/2,this._lastFrame=n,this._lastFramePercent=e,t.ignore=!1}},a}(D),tt=function(){this.polyline=!1,this.curveness=0,this.segs=[]},et=function(p){function a(t){var e=p.call(this,t)||this;return e._off=0,e.hoverDataIdx=-1,e}return _(a,p),a.prototype.reset=function(){this.notClear=!1,this._off=0},a.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},a.prototype.getDefaultShape=function(){return new tt},a.prototype.buildPath=function(t,e){var r,o=e.segs,s=e.curveness;if(e.polyline)for(r=this._off;r<o.length;){var n=o[r++];if(n>0){t.moveTo(o[r++],o[r++]);for(var i=1;i<n;i++)t.lineTo(o[r++],o[r++])}}else for(r=this._off;r<o.length;){var l=o[r++],f=o[r++],u=o[r++],h=o[r++];if(t.moveTo(l,f),s>0){var d=(l+u)/2-(f-h)*s,c=(f+h)/2-(u-l)*s;t.quadraticCurveTo(d,c,u,h)}else t.lineTo(u,h)}this.incremental&&(this._off=r,this.notClear=!0)},a.prototype.findDataIndex=function(t,e){var r=this.shape,o=r.segs,s=r.curveness,n=this.style.lineWidth;if(r.polyline)for(var i=0,l=0;l<o.length;){var f=o[l++];if(f>0)for(var u=o[l++],h=o[l++],d=1;d<f;d++){var c=o[l++],g=o[l++];if(L(u,h,c,g,n,t,e))return i}i++}else for(i=0,l=0;l<o.length;){if(u=o[l++],h=o[l++],c=o[l++],g=o[l++],s>0){if(R(u,h,(u+c)/2-(h-g)*s,(h+g)/2-(c-u)*s,c,g,n,t,e))return i}else if(L(u,h,c,g,n,t,e))return i;i++}return-1},a.prototype.contain=function(t,e){var r=this.transformCoordToLocal(t,e),o=this.getBoundingRect();return t=r[0],e=r[1],o.contain(t,e)?(this.hoverDataIdx=this.findDataIndex(t,e))>=0:(this.hoverDataIdx=-1,!1)},a.prototype.getBoundingRect=function(){var t=this._rect;if(!t){for(var e=this.shape.segs,r=1/0,o=1/0,s=-1/0,n=-1/0,i=0;i<e.length;){var l=e[i++],f=e[i++];r=Math.min(l,r),s=Math.max(l,s),o=Math.min(f,o),n=Math.max(f,n)}t=this._rect=new k(r,o,s,n)}return t},a}(N),ot=function(){function p(){this.group=new w}return p.prototype.updateData=function(a){this._clear();var t=this._create();t.setShape({segs:a.getLayout("linesPoints")}),this._setCommon(t,a)},p.prototype.incrementalPrepareUpdate=function(a){this.group.removeAll(),this._clear()},p.prototype.incrementalUpdate=function(a,t){var e=this._newAdded[0],r=t.getLayout("linesPoints"),o=e&&e.shape.segs;if(o&&o.length<2e4){var s=o.length,n=new Float32Array(s+r.length);n.set(o),n.set(r,s),e.setShape({segs:n})}else{this._newAdded=[];var i=this._create();i.incremental=!0,i.setShape({segs:r}),this._setCommon(i,t),i.__startIndex=a.start}},p.prototype.remove=function(){this._clear()},p.prototype.eachRendered=function(a){this._newAdded[0]&&a(this._newAdded[0])},p.prototype._create=function(){var a=new et({cursor:"default",ignoreCoarsePointer:!0});return this._newAdded.push(a),this.group.add(a),a},p.prototype._setCommon=function(a,t,e){var r=t.hostModel;a.setShape({polyline:r.get("polyline"),curveness:r.get(["lineStyle","curveness"])}),a.useStyle(r.getModel("lineStyle").getLineStyle()),a.style.strokeNoScale=!0;var o=t.getVisual("style");o&&o.stroke&&a.setStyle("stroke",o.stroke),a.setStyle("fill",null);var s=K(a);s.seriesIndex=r.seriesIndex,a.on("mousemove",function(n){s.dataIndex=null;var i=a.hoverDataIdx;i>0&&(s.dataIndex=i+a.__startIndex)})},p.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},p}(),T={seriesType:"lines",plan:U(),reset:function(p){var a=p.coordinateSystem;if(a){var t=p.get("polyline"),e=p.pipelineContext.large;return{progress:function(r,o){var s=[];if(e){var n=void 0,i=r.end-r.start;if(t){for(var l=0,f=r.start;f<r.end;f++)l+=p.getLineCoordsCount(f);n=new Float32Array(i+2*l)}else n=new Float32Array(4*i);var u=0,h=[];for(f=r.start;f<r.end;f++){var d=p.getLineCoords(f,s);t&&(n[u++]=d);for(var c=0;c<d;c++)h=a.dataToPoint(s[c],!1,h),n[u++]=h[0],n[u++]=h[1]}o.setLayout("linesPoints",n)}else for(f=r.start;f<r.end;f++){var g=o.getItemModel(f),y=(d=p.getLineCoords(f,s),[]);if(t)for(var C=0;C<d;C++)y.push(a.dataToPoint(s[C]));else{y[0]=a.dataToPoint(s[0]),y[1]=a.dataToPoint(s[1]);var S=g.get(["lineStyle","curveness"]);+S&&(y[2]=[(y[0][0]+y[1][0])/2-(y[0][1]-y[1][1])*S,(y[0][1]+y[1][1])/2-(y[1][0]-y[0][0])*S])}o.setItemLayout(f,y)}}}}}},rt=function(p){function a(){var t=p!==null&&p.apply(this,arguments)||this;return t.type=a.type,t}return _(a,p),a.prototype.render=function(t,e,r){var o=t.getData(),s=this._updateLineDraw(o,t),n=t.get("zlevel"),i=t.get(["effect","trailLength"]),l=r.getZr(),f=l.painter.getType()==="svg";f||l.painter.getLayer(n).clear(!0),this._lastZlevel==null||f||l.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(t)&&i>0&&(f||l.configLayer(n,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(i/10+.9,1),0)})),s.updateData(o);var u=t.get("clip",!0)&&G(t.coordinateSystem,!1,t);u?this.group.setClipPath(u):this.group.removeClipPath(),this._lastZlevel=n,this._finished=!0},a.prototype.incrementalPrepareRender=function(t,e,r){var o=t.getData();this._updateLineDraw(o,t).incrementalPrepareUpdate(o),this._clearLayer(r),this._finished=!1},a.prototype.incrementalRender=function(t,e,r){this._lineDraw.incrementalUpdate(t,e.getData()),this._finished=t.end===e.getData().count()},a.prototype.eachRendered=function(t){this._lineDraw&&this._lineDraw.eachRendered(t)},a.prototype.updateTransform=function(t,e,r){var o=t.getData(),s=t.pipelineContext;if(!this._finished||s.large||s.progressiveRender)return{update:!0};var n=T.reset(t,e,r);n.progress&&n.progress({start:0,end:o.count(),count:o.count()},o),this._lineDraw.updateLayout(),this._clearLayer(r)},a.prototype._updateLineDraw=function(t,e){var r=this._lineDraw,o=this._showEffect(e),s=!!e.get("polyline"),n=e.pipelineContext.large;return r&&o===this._hasEffet&&s===this._isPolyline&&n===this._isLargeDraw||(r&&r.remove(),r=this._lineDraw=n?new ot:new W(s?o?$:P:o?D:b),this._hasEffet=o,this._isPolyline=s,this._isLargeDraw=n),this.group.add(r.group),r},a.prototype._showEffect=function(t){return!!t.get(["effect","show"])},a.prototype._clearLayer=function(t){var e=t.getZr();e.painter.getType()==="svg"||this._lastZlevel==null||e.painter.getLayer(this._lastZlevel).clear(!0)},a.prototype.remove=function(t,e){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(e)},a.prototype.dispose=function(t,e){this.remove(t,e)},a.type="lines",a}(Z),at=typeof Uint32Array>"u"?Array:Uint32Array,nt=typeof Float64Array>"u"?Array:Float64Array;function I(p){var a=p.data;a&&a[0]&&a[0][0]&&a[0][0].coord&&(p.data=H(a,function(t){var e={coords:[t[0].coord,t[1].coord]};return t[0].name&&(e.fromName=t[0].name),t[1].name&&(e.toName=t[1].name),J([e,t[0],t[1]])}))}var st=function(p){function a(){var t=p!==null&&p.apply(this,arguments)||this;return t.type=a.type,t.visualStyleAccessPath="lineStyle",t.visualDrawType="stroke",t}return _(a,p),a.prototype.init=function(t){t.data=t.data||[],I(t);var e=this._processFlatCoordsArray(t.data);this._flatCoords=e.flatCoords,this._flatCoordsOffset=e.flatCoordsOffset,e.flatCoords&&(t.data=new Float32Array(e.count)),p.prototype.init.apply(this,arguments)},a.prototype.mergeOption=function(t){if(I(t),t.data){var e=this._processFlatCoordsArray(t.data);this._flatCoords=e.flatCoords,this._flatCoordsOffset=e.flatCoordsOffset,e.flatCoords&&(t.data=new Float32Array(e.count))}p.prototype.mergeOption.apply(this,arguments)},a.prototype.appendData=function(t){var e=this._processFlatCoordsArray(t.data);e.flatCoords&&(this._flatCoords?(this._flatCoords=A(this._flatCoords,e.flatCoords),this._flatCoordsOffset=A(this._flatCoordsOffset,e.flatCoordsOffset)):(this._flatCoords=e.flatCoords,this._flatCoordsOffset=e.flatCoordsOffset),t.data=new Float32Array(e.count)),this.getRawData().appendData(t.data)},a.prototype._getCoordsFromItemModel=function(t){var e=this.getData().getItemModel(t);return e.option instanceof Array?e.option:e.getShallow("coords")},a.prototype.getLineCoordsCount=function(t){return this._flatCoordsOffset?this._flatCoordsOffset[2*t+1]:this._getCoordsFromItemModel(t).length},a.prototype.getLineCoords=function(t,e){if(this._flatCoordsOffset){for(var r=this._flatCoordsOffset[2*t],o=this._flatCoordsOffset[2*t+1],s=0;s<o;s++)e[s]=e[s]||[],e[s][0]=this._flatCoords[r+2*s],e[s][1]=this._flatCoords[r+2*s+1];return o}var n=this._getCoordsFromItemModel(t);for(s=0;s<n.length;s++)e[s]=e[s]||[],e[s][0]=n[s][0],e[s][1]=n[s][1];return n.length},a.prototype._processFlatCoordsArray=function(t){var e=0;if(this._flatCoords&&(e=this._flatCoords.length),B(t[0])){for(var r=t.length,o=new at(r),s=new nt(r),n=0,i=0,l=0,f=0;f<r;){l++;var u=t[f++];o[i++]=n+e,o[i++]=u;for(var h=0;h<u;h++){var d=t[f++],c=t[f++];s[n++]=d,s[n++]=c}}return{flatCoordsOffset:new Uint32Array(o.buffer,0,i),flatCoords:s,count:l}}return{flatCoordsOffset:null,flatCoords:null,count:t.length}},a.prototype.getInitialData=function(t,e){var r=new Y(["value"],this);return r.hasItemOption=!1,r.initData(t.data,[],function(o,s,n,i){if(o instanceof Array)return NaN;r.hasItemOption=!0;var l=o.value;return l!=null?l instanceof Array?l[i]:l:void 0}),r},a.prototype.formatTooltip=function(t,e,r){var o=this.getData().getItemModel(t),s=o.get("name");if(s)return s;var n=o.get("fromName"),i=o.get("toName"),l=[];return n!=null&&l.push(n),i!=null&&l.push(i),j("nameValue",{name:l.join(" > ")})},a.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},a.prototype.getProgressive=function(){var t=this.option.progressive;return t??(this.option.large?1e4:this.get("progressive"))},a.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return t??(this.option.large?2e4:this.get("progressiveThreshold"))},a.prototype.getZLevelKey=function(){var t=this.getModel("effect"),e=t.get("trailLength");return this.getData().count()>this.getProgressiveThreshold()?this.id:t.get("show")&&e>0?e+"":""},a.type="series.lines",a.dependencies=["grid","polar","geo","calendar"],a.defaultOption={coordinateSystem:"geo",z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},a}(Q);function v(p){return p instanceof Array||(p=[p,p]),p}var it={seriesType:"lines",reset:function(p){var a=v(p.get("symbol")),t=v(p.get("symbolSize")),e=p.getData();return e.setVisual("fromSymbol",a&&a[0]),e.setVisual("toSymbol",a&&a[1]),e.setVisual("fromSymbolSize",t&&t[0]),e.setVisual("toSymbolSize",t&&t[1]),{dataEach:e.hasItemOption?function(r,o){var s=r.getItemModel(o),n=v(s.getShallow("symbol",!0)),i=v(s.getShallow("symbolSize",!0));n[0]&&r.setItemVisual(o,"fromSymbol",n[0]),n[1]&&r.setItemVisual(o,"toSymbol",n[1]),i[0]&&r.setItemVisual(o,"fromSymbolSize",i[0]),i[1]&&r.setItemVisual(o,"toSymbolSize",i[1])}:null}}};function ut(p){p.registerChartView(rt),p.registerSeriesModel(st),p.registerLayout(T),p.registerVisual(it)}export{ut as install};
