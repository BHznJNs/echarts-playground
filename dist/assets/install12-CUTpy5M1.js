import{e as w,aD as N,dr as C,ak as T,bQ as L,cy as _,bO as I,a1 as x,cc as R,g as G,N as y,aO as D,K as H,bI as O,W as P,ds as V,E as A}from"./index-B3HKDY-B.js";import{M as W,g as k,i as z}from"./install28-DJY3JKOQ.js";import{s as F}from"./createSeriesDataSimply-BtvIqVi0.js";import"./roamHelper-DN6TLDPQ.js";import"./RoamController-rbEyhm6E.js";import"./interactionMutex-Bs7cRZ9p.js";import"./cursorHelper-IgNoiH07.js";var E=function(s){function o(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=o.type,e}return w(o,s),o.prototype.render=function(e,n,i,t){if(!t||t.type!=="mapToggleSelect"||t.from!==this.uid){var r=this.group;if(r.removeAll(),!e.getHostGeoModel()){if(this._mapDraw&&t&&t.type==="geoRoam"&&this._mapDraw.resetForLabelLayout(),t&&t.type==="geoRoam"&&t.componentType==="series"&&t.seriesId===e.id)(l=this._mapDraw)&&r.add(l.group);else if(e.needsDrawMap){var l=this._mapDraw||new W(i);r.add(l.group),l.draw(e,n,i,this,t),this._mapDraw=l}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;e.get("showLegendSymbol")&&n.getComponent("legend")&&this._renderSymbols(e,n,i)}}},o.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},o.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},o.prototype._renderSymbols=function(e,n,i){var t=e.originalData,r=this.group;t.each(t.mapDimension("value"),function(l,a){if(!isNaN(l)){var p=t.getItemLayout(a);if(p&&p.point){var g=p.point,m=p.offset,u=new N({style:{fill:e.getData().getVisual("style").fill},shape:{cx:g[0]+9*m,cy:g[1],r:3},silent:!0,z2:8+(m?0:C+1)});if(!m){var c=e.mainSeries.getData(),f=t.getName(a),d=c.indexOfName(f),h=t.getItemModel(a),b=h.getModel("label"),S=c.getItemGraphicEl(d);T(u,L(h),{labelFetcher:{getFormattedLabel:function(v,M){return e.getFormattedLabel(d,M)}},defaultText:f}),u.disableLabelAnimation=!0,b.get("position")||u.setTextConfig({position:"bottom"}),S.onHoverStateChange=function(v){_(u,v)}}r.add(u)}}})},o.type="map",o}(I),B=function(s){function o(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=o.type,e.needsDrawMap=!1,e.seriesGroup=[],e.getTooltipPosition=function(n){if(n!=null){var i=this.getData().getName(n),t=this.coordinateSystem,r=t.getRegion(i);return r&&t.dataToPoint(r.getCenter())}},e}return w(o,s),o.prototype.getInitialData=function(e){for(var n=F(this,{coordDimensions:["value"],encodeDefaulter:x(R,this)}),i=G(),t=[],r=0,l=n.count();r<l;r++){var a=n.getName(r);i.set(a,!0)}var p=k.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return y(p.regions,function(g){var m=g.name;i.get(m)||t.push(m)}),n.appendValues([],t),n},o.prototype.getHostGeoModel=function(){var e=this.option.geoIndex;return e!=null?this.ecModel.getComponent("geo",e):null},o.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},o.prototype.getRawValue=function(e){var n=this.getData();return n.get(n.mapDimension("value"),e)},o.prototype.getRegionModel=function(e){var n=this.getData();return n.getItemModel(n.indexOfName(e))},o.prototype.formatTooltip=function(e,n,i){for(var t=this.getData(),r=this.getRawValue(e),l=t.getName(e),a=this.seriesGroup,p=[],g=0;g<a.length;g++){var m=a[g].originalData.indexOfName(l),u=t.mapDimension("value");isNaN(a[g].originalData.get(u,m))||p.push(a[g].name)}return D("section",{header:p.join(", "),noHeader:!p.length,blocks:[D("nameValue",{name:l,value:r})]})},o.prototype.setZoom=function(e){this.option.zoom=e},o.prototype.setCenter=function(e){this.option.center=e},o.prototype.getLegendIcon=function(e){var n=e.icon||"roundRect",i=H(n,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return i.setStyle(e.itemStyle),i.style.stroke="none",n.indexOf("empty")>-1&&(i.style.stroke=i.style.fill,i.style.fill="#fff",i.style.lineWidth=2),i},o.type="series.map",o.dependencies=["geo"],o.layoutMode="box",o.defaultOption={z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},o}(O);function Z(s){var o={};s.eachSeriesByType("map",function(e){var n=e.getHostGeoModel(),i=n?"o"+n.id:"i"+e.getMapType();(o[i]=o[i]||[]).push(e)}),y(o,function(e,n){for(var i,t,r,l=(i=A(e,function(p){return p.getData()}),t=e[0].get("mapValueCalculation"),r={},y(i,function(p){p.each(p.mapDimension("value"),function(g,m){var u="ec-"+p.getName(m);r[u]=r[u]||[],isNaN(g)||r[u].push(g)})}),i[0].map(i[0].mapDimension("value"),function(p,g){for(var m="ec-"+i[0].getName(g),u=0,c=1/0,f=-1/0,d=r[m].length,h=0;h<d;h++)c=Math.min(c,r[m][h]),f=Math.max(f,r[m][h]),u+=r[m][h];return d===0?NaN:t==="min"?c:t==="max"?f:t==="average"?u/d:u})),a=0;a<e.length;a++)e[a].originalData=e[a].getData();for(a=0;a<e.length;a++)e[a].seriesGroup=e,e[a].needsDrawMap=a===0&&!e[a].getHostGeoModel(),e[a].setData(l.cloneShallow()),e[a].mainSeries=e[0]})}function j(s){var o={};s.eachSeriesByType("map",function(e){var n=e.getMapType();if(!e.getHostGeoModel()&&!o[n]){var i={};y(e.seriesGroup,function(r){var l=r.coordinateSystem,a=r.originalData;r.get("showLegendSymbol")&&s.getComponent("legend")&&a.each(a.mapDimension("value"),function(p,g){var m=a.getName(g),u=l.getRegion(m);if(u&&!isNaN(p)){var c=i[m]||0,f=l.dataToPoint(u.getCenter());i[m]=c+1,a.setItemLayout(g,{point:f,offset:c})}})});var t=e.getData();t.each(function(r){var l=t.getName(r),a=t.getItemLayout(r)||{};a.showLabel=!i[l],t.setItemLayout(r,a)}),o[n]=!0}})}function X(s){P(z),s.registerChartView(E),s.registerSeriesModel(B),s.registerLayout(j),s.registerProcessor(s.PRIORITY.PROCESSOR.STATISTIC,Z),V("map",s.registerAction)}export{X as install};
