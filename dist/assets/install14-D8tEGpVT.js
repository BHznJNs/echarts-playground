import{e as se,D as J,bL as le,ab as he,bM as Me,bU as we,bT as Te,al as De,bR as Ne,r as Ie,c4 as Ce,aC as ve,bO as Pe,bP as _e,R as We,H as ue,a2 as be,cd as ke,dw as Ue,ce as Be,bJ as Oe,dt as Ve,ap as me,j as de,i as Z,cf as Re,V as Ze,N as K,W as pe,f as Ge,Z as Xe}from"./index-DqzYUymv.js";import{e as qe}from"./dataFilter-_M4AusE-.js";import{A as Fe,b as He,c as Je,g as Ye}from"./labelGuideHelper-BNIvVvaY.js";import{a as ze}from"./labelLayoutHelper-C9kjGaZq.js";import{u as j}from"./sectorHelper-CetS_CSv.js";import{s as Qe}from"./createSeriesDataSimply-Dbw0MyfP.js";import{t as Ee}from"./LegendVisualProvider-B8AjwPa5.js";var fe=2*Math.PI,$=Math.PI/180;function xe(n,r){return Xe(n.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()})}function Ae(n,r){var a=xe(n,r),e=n.get("center"),t=n.get("radius");de(t)||(t=[0,t]);var s,i,l=Z(a.width,r.getWidth()),c=Z(a.height,r.getHeight()),f=Math.min(l,c),o=Z(t[0],f/2),v=Z(t[1],f/2),x=n.coordinateSystem;if(x){var g=x.dataToPoint(e);s=g[0]||0,i=g[1]||0}else de(e)||(e=[e,e]),s=Z(e[0],l)+a.x,i=Z(e[1],c)+a.y;return{cx:s,cy:i,r0:o,r:v}}function Ke(n,r,a){r.eachSeriesByType(n,function(e){var t=e.getData(),s=t.mapDimension("value"),i=xe(e,a),l=Ae(e,a),c=l.cx,f=l.cy,o=l.r,v=l.r0,x=-e.get("startAngle")*$,g=e.get("endAngle"),m=e.get("padAngle")*$;g=g==="auto"?x-fe:-g*$;var y=e.get("minAngle")*$+m,A=0;t.each(s,function(D){!isNaN(D)&&A++});var N=t.getSum(s),S=Math.PI/(N||A)*2,I=e.get("clockwise"),C=e.get("roseType"),w=e.get("stillShowZeroSum"),M=t.getDataExtent(s);M[0]=0;var u=I?1:-1,L=[x,g],P=u*m/2;Re(L,!I),x=L[0],g=L[1];var V=Math.abs(g-x),T=V,B=0,_=x;if(t.setLayout({viewRect:i,r:o}),t.each(s,function(D,W){var d;if(isNaN(D))t.setItemLayout(W,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:I,cx:c,cy:f,r0:v,r:C?NaN:o});else{(d=C!=="area"?N===0&&w?S:D*S:V/A)<y?(d=y,T-=y):B+=D;var h=_+u*d,b=0,k=0;m>d?k=b=_+u*d/2:(b=_+P,k=h-P),t.setItemLayout(W,{angle:d,startAngle:b,endAngle:k,clockwise:I,cx:c,cy:f,r0:v,r:C?Ze(D,M,[v,o]):o}),_=h}}),T<fe&&A)if(T<=.001){var O=V/A;t.each(s,function(D,W){if(!isNaN(D)){var d=t.getItemLayout(W);d.angle=O;var h=0,b=0;O<m?b=h=x+u*(W+.5)*O:(h=x+u*W*O+P,b=x+u*(W+1)*O-P),d.startAngle=h,d.endAngle=b}})}else S=T/B,_=x,t.each(s,function(D,W){if(!isNaN(D)){var d=t.getItemLayout(W),h=d.angle===y?y:D*S,b=0,k=0;h<m?k=b=_+u*h/2:(b=_+P,k=_+u*h-P),d.startAngle=b,d.endAngle=k,_+=u*h}})})}var je=Math.PI/180;function ye(n,r,a,e,t,s,i,l,c,f){if(!(n.length<2)){for(var o=n.length,v=0;v<o;v++)if(n[v].position==="outer"&&n[v].labelAlignTo==="labelLine"){var x=n[v].label.x-f;n[v].linePoints[1][0]+=x,n[v].label.x=f}ze(n,c,c+i)&&function(m){for(var y={list:[],maxY:0},A={list:[],maxY:0},N=0;N<m.length;N++)if(m[N].labelAlignTo==="none"){var S=m[N],I=S.label.y>a?A:y,C=Math.abs(S.label.y-a);if(C>=I.maxY){var w=S.label.x-r-S.len2*t,M=e+S.len,u=Math.abs(w)<M?Math.sqrt(C*C/(1-w*w/M/M)):M;I.rB=u,I.maxY=C}I.list.push(S)}g(y),g(A)}(n)}function g(m){for(var y=m.rB,A=y*y,N=0;N<m.list.length;N++){var S=m.list[N],I=Math.abs(S.label.y-a),C=e+S.len,w=C*C,M=Math.sqrt((1-Math.abs(I*I/A))*w),u=r+(M+S.len2)*t,L=u-S.label.x;Se(S,S.targetTextWidth-L*t,!0),S.label.x=u}}}function Se(n,r,a){if(a===void 0&&(a=!1),n.labelStyleWidth==null){var e=n.label,t=e.style,s=n.rect,i=t.backgroundColor,l=t.padding,c=l?l[1]+l[3]:0,f=t.overflow,o=s.width+(i?0:c);if(r<o||a){var v=s.height;if(f&&f.match("break")){e.setStyle("backgroundColor",null),e.setStyle("width",r-c);var x=e.getBoundingRect();e.setStyle("width",Math.ceil(x.width)),e.setStyle("backgroundColor",i)}else{var g=r-c,m=r<o?g:a?g>n.unconstrainedWidth?null:g:null;e.setStyle("width",m)}var y=e.getBoundingRect();s.width=y.width;var A=(e.style.margin||0)+2.1;s.height=y.height+A,s.y-=(s.height-v)/2}}}function re(n){return n.position==="center"}function $e(n){var r,a,e=n.getData(),t=[],s=!1,i=(n.get("minShowLabelAngle")||0)*je,l=e.getLayout("viewRect"),c=e.getLayout("r"),f=l.width,o=l.x,v=l.y,x=l.height;function g(w){w.ignore=!0}e.each(function(w){var M=e.getItemGraphicEl(w),u=M.shape,L=M.getTextContent(),P=M.getTextGuideLine(),V=e.getItemModel(w),T=V.getModel("label"),B=T.get("position")||V.get(["emphasis","label","position"]),_=T.get("distanceToLabelLine"),O=T.get("alignTo"),D=Z(T.get("edgeDistance"),f),W=T.get("bleedMargin"),d=V.getModel("labelLine"),h=d.get("length");h=Z(h,f);var b=d.get("length2");if(b=Z(b,f),Math.abs(u.endAngle-u.startAngle)<i)return K(L.states,g),L.ignore=!0,void(P&&(K(P.states,g),P.ignore=!0));if(function(ne){if(!ne.ignore)return!0;for(var Le in ne.states)if(ne.states[Le].ignore===!1)return!0;return!1}(L)){var k,p,E,G,q=(u.startAngle+u.endAngle)/2,U=Math.cos(q),R=Math.sin(q);r=u.cx,a=u.cy;var X=B==="inside"||B==="inner";if(B==="center")k=u.cx,p=u.cy,G="center";else{var ee=(X?(u.r+u.r0)/2*U:u.r*U)+r,te=(X?(u.r+u.r0)/2*R:u.r*R)+a;if(k=ee+3*U,p=te+3*R,!X){var oe=ee+U*(h+c-u.r),ae=te+R*(h+c-u.r),ge=oe+(U<0?-1:1)*b;k=O==="edge"?U<0?o+D:o+f-D:ge+(U<0?-_:_),p=ae,E=[[ee,te],[oe,ae],[ge,ae]]}G=X?"center":O==="edge"?U>0?"right":"left":U>0?"left":"right"}var Y=Math.PI,F=0,z=T.get("rotate");if(me(z))F=z*(Y/180);else if(B==="center")F=0;else if(z==="radial"||z===!0)F=U<0?-q+Y:-q;else if(z==="tangential"&&B!=="outside"&&B!=="outer"){var H=Math.atan2(U,R);H<0&&(H=2*Y+H),R>0&&(H=Y+H),F=H-Y}if(s=!!F,L.x=k,L.y=p,L.rotation=F,L.setStyle({verticalAlign:"middle"}),X){L.setStyle({align:G});var ie=L.states.select;ie&&(ie.x+=L.x,ie.y+=L.y)}else{var Q=L.getBoundingRect().clone();Q.applyTransform(L.getComputedTransform());var ce=(L.style.margin||0)+2.1;Q.y-=ce/2,Q.height+=ce,t.push({label:L,labelLine:P,position:B,len:h,len2:b,minTurnAngle:d.get("minTurnAngle"),maxSurfaceAngle:d.get("maxSurfaceAngle"),surfaceNormal:new pe(U,R),linePoints:E,textAlign:G,labelDistance:_,labelAlignTo:O,edgeDistance:D,bleedMargin:W,rect:Q,unconstrainedWidth:Q.width,labelStyleWidth:L.style.width})}M.setTextConfig({inside:X})}}),!s&&n.get("avoidLabelOverlap")&&function(w,M,u,L,P,V,T,B){for(var _=[],O=[],D=Number.MAX_VALUE,W=-Number.MAX_VALUE,d=0;d<w.length;d++){var h=w[d].label;re(w[d])||(h.x<M?(D=Math.min(D,h.x),_.push(w[d])):(W=Math.max(W,h.x),O.push(w[d])))}for(d=0;d<w.length;d++)if(!re(p=w[d])&&p.linePoints){if(p.labelStyleWidth!=null)continue;h=p.label;var b=p.linePoints,k=void 0;k=p.labelAlignTo==="edge"?h.x<M?b[2][0]-p.labelDistance-T-p.edgeDistance:T+P-p.edgeDistance-b[2][0]-p.labelDistance:p.labelAlignTo==="labelLine"?h.x<M?D-T-p.bleedMargin:T+P-W-p.bleedMargin:h.x<M?h.x-T-p.bleedMargin:T+P-h.x-p.bleedMargin,p.targetTextWidth=k,Se(p,k)}for(ye(O,M,u,L,1,0,V,0,B,W),ye(_,M,u,L,-1,0,V,0,B,D),d=0;d<w.length;d++){var p;if(!re(p=w[d])&&p.linePoints){h=p.label,b=p.linePoints;var E=p.labelAlignTo==="edge",G=h.style.padding,q=G?G[1]+G[3]:0,U=h.style.backgroundColor?0:q,R=p.rect.width+U,X=b[1][0]-b[2][0];E?h.x<M?b[2][0]=T+p.edgeDistance+R+p.labelDistance:b[2][0]=T+P-p.edgeDistance-R-p.labelDistance:(h.x<M?b[2][0]=h.x+p.labelDistance:b[2][0]=h.x-p.labelDistance,b[1][0]=b[2][0]+X),b[1][1]=b[2][1]=h.y}}}(t,r,a,c,f,x,o,v);for(var m=0;m<t.length;m++){var y=t[m],A=y.label,N=y.labelLine,S=isNaN(A.x)||isNaN(A.y);if(A){A.setStyle({align:y.textAlign}),S&&(K(A.states,g),A.ignore=!0);var I=A.states.select;I&&(I.x+=A.x,I.y+=A.y)}if(N){var C=y.linePoints;S||!C?(K(N.states,g),N.ignore=!0):(Je(C,y.minTurnAngle),Ye(C,y.surfaceNormal,y.maxSurfaceAngle),N.setShape({points:C}),A.__hostTarget.textGuideLineConfig={anchor:new pe(C[0][0],C[0][1])})}}}var et=function(n){function r(a,e,t){var s=n.call(this)||this;s.z2=2;var i=new Ge;return s.setTextContent(i),s.updateData(a,e,t,!0),s}return se(r,n),r.prototype.updateData=function(a,e,t,s){var i=this,l=a.hostModel,c=a.getItemModel(e),f=c.getModel("emphasis"),o=a.getItemLayout(e),v=J(j(c.getModel("itemStyle"),o,!0),o);if(isNaN(v.startAngle))i.setShape(v);else{if(s){i.setShape(v);var x=l.getShallow("animationType");l.ecModel.ssr?(le(i,{scaleX:0,scaleY:0},l,{dataIndex:e,isFrom:!0}),i.originX=v.cx,i.originY=v.cy):x==="scale"?(i.shape.r=o.r0,le(i,{shape:{r:o.r}},l,e)):t!=null?(i.setShape({startAngle:t,endAngle:t}),le(i,{shape:{startAngle:o.startAngle,endAngle:o.endAngle}},l,e)):(i.shape.endAngle=o.startAngle,he(i,{shape:{endAngle:o.endAngle}},l,e))}else Me(i),he(i,{shape:v},l,e);i.useStyle(a.getItemVisual(e,"style")),we(i,c);var g=(o.startAngle+o.endAngle)/2,m=l.get("selectedOffset"),y=Math.cos(g)*m,A=Math.sin(g)*m,N=c.getShallow("cursor");N&&i.attr("cursor",N),this._updateLabel(l,a,e),i.ensureState("emphasis").shape=J({r:o.r+(f.get("scale")&&f.get("scaleSize")||0)},j(f.getModel("itemStyle"),o)),J(i.ensureState("select"),{x:y,y:A,shape:j(c.getModel(["select","itemStyle"]),o)}),J(i.ensureState("blur"),{shape:j(c.getModel(["blur","itemStyle"]),o)});var S=i.getTextGuideLine(),I=i.getTextContent();S&&J(S.ensureState("select"),{x:y,y:A}),J(I.ensureState("select"),{x:y,y:A}),Te(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))}},r.prototype._updateLabel=function(a,e,t){var s=this,i=e.getItemModel(t),l=i.getModel("labelLine"),c=e.getItemVisual(t,"style"),f=c&&c.fill,o=c&&c.opacity;De(s,Ne(i),{labelFetcher:e.hostModel,labelDataIndex:t,inheritColor:f,defaultOpacity:o,defaultText:a.getFormattedLabel(t,"normal")||e.getName(t)});var v=s.getTextContent();s.setTextConfig({position:null,rotation:null}),v.attr({z2:10});var x=a.get(["label","position"]);if(x!=="outside"&&x!=="outer")s.removeTextGuideLine();else{var g=this.getTextGuideLine();g||(g=new Ie,this.setTextGuideLine(g)),Fe(this,He(i),{stroke:f,opacity:Ce(l.get(["lineStyle","opacity"]),o,1)})}},r}(ve),tt=function(n){function r(){var a=n!==null&&n.apply(this,arguments)||this;return a.ignoreLabelLineUpdate=!0,a}return se(r,n),r.prototype.render=function(a,e,t,s){var i,l=a.getData(),c=this._data,f=this.group;if(!c&&l.count()>0){for(var o=l.getItemLayout(0),v=1;isNaN(o&&o.startAngle)&&v<l.count();++v)o=l.getItemLayout(v);o&&(i=o.startAngle)}if(this._emptyCircleSector&&f.remove(this._emptyCircleSector),l.count()===0&&a.get("showEmptyCircle")){var x=new ve({shape:Ae(a,t)});x.useStyle(a.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=x,f.add(x)}l.diff(c).add(function(g){var m=new et(l,g,i);l.setItemGraphicEl(g,m),f.add(m)}).update(function(g,m){var y=c.getItemGraphicEl(m);y.updateData(l,g,i),y.off("click"),f.add(y),l.setItemGraphicEl(g,y)}).remove(function(g){var m=c.getItemGraphicEl(g);Pe(m,a,g)}).execute(),$e(a),a.get("animationTypeUpdate")!=="expansion"&&(this._data=l)},r.prototype.dispose=function(){},r.prototype.containPoint=function(a,e){var t=e.getData().getItemLayout(0);if(t){var s=a[0]-t.cx,i=a[1]-t.cy,l=Math.sqrt(s*s+i*i);return l<=t.r&&l>=t.r0}},r.type="pie",r}(_e),at=We(),it=function(n){function r(){return n!==null&&n.apply(this,arguments)||this}return se(r,n),r.prototype.init=function(a){n.prototype.init.apply(this,arguments),this.legendVisualProvider=new Ee(ue(this.getData,this),ue(this.getRawData,this)),this._defaultLabelLine(a)},r.prototype.mergeOption=function(){n.prototype.mergeOption.apply(this,arguments)},r.prototype.getInitialData=function(){return Qe(this,{coordDimensions:["value"],encodeDefaulter:be(ke,this)})},r.prototype.getDataParams=function(a){var e=this.getData(),t=at(e),s=t.seats;if(!s){var i=[];e.each(e.mapDimension("value"),function(c){i.push(c)}),s=t.seats=Ue(i,e.hostModel.get("percentPrecision"))}var l=n.prototype.getDataParams.call(this,a);return l.percent=s[a]||0,l.$vars.push("percent"),l},r.prototype._defaultLabelLine=function(a){Be(a,"labelLine",["show"]);var e=a.labelLine,t=a.emphasis.labelLine;e.show=e.show&&a.label.show,t.show=t.show&&a.emphasis.label.show},r.type="series.pie",r.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},r}(Oe);function ht(n){n.registerChartView(tt),n.registerSeriesModel(it),Ve("pie",n.registerAction),n.registerLayout(be(Ke,"pie")),n.registerProcessor(qe("pie")),n.registerProcessor({seriesType:"pie",reset:function(r,a){var e=r.getData();e.filterSelf(function(t){var s=e.mapDimension("value"),i=e.get(s,t);return!(me(i)&&!isNaN(i)&&i<0)})}})}export{ht as install};
