import{e as se,D as Q,bK as le,aa as he,bL as Me,bT as we,bS as Te,ak as De,bQ as Ne,r as Ie,c3 as Ce,aB as ve,bN as Pe,bO as _e,R as ke,H as ue,a1 as be,cc as We,dv as Be,cd as Oe,bI as Ue,ds as Ve,ao as me,j as de,h as G,ce as Ze,V as Ge,N as E,S as pe,d as Re,Z as Xe}from"./index-B3HKDY-B.js";import{e as qe}from"./dataFilter-_M4AusE-.js";import{A as Fe,b as He,c as Qe,g as Ye}from"./labelGuideHelper-GZXSKxXE.js";import{a as ze}from"./labelLayoutHelper-ChlMZ_0e.js";import{u as j}from"./sectorHelper-CHDjzrIC.js";import{s as Je}from"./createSeriesDataSimply-BtvIqVi0.js";import{t as Ke}from"./LegendVisualProvider-B8AjwPa5.js";var fe=2*Math.PI,$=Math.PI/180;function xe(n,r){return Xe(n.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()})}function Ae(n,r){var a=xe(n,r),e=n.get("center"),t=n.get("radius");de(t)||(t=[0,t]);var s,i,l=G(a.width,r.getWidth()),c=G(a.height,r.getHeight()),f=Math.min(l,c),o=G(t[0],f/2),v=G(t[1],f/2),x=n.coordinateSystem;if(x){var g=x.dataToPoint(e);s=g[0]||0,i=g[1]||0}else de(e)||(e=[e,e]),s=G(e[0],l)+a.x,i=G(e[1],c)+a.y;return{cx:s,cy:i,r0:o,r:v}}function Ee(n,r,a){r.eachSeriesByType(n,function(e){var t=e.getData(),s=t.mapDimension("value"),i=xe(e,a),l=Ae(e,a),c=l.cx,f=l.cy,o=l.r,v=l.r0,x=-e.get("startAngle")*$,g=e.get("endAngle"),m=e.get("padAngle")*$;g=g==="auto"?x-fe:-g*$;var y=e.get("minAngle")*$+m,A=0;t.each(s,function(D){!isNaN(D)&&A++});var N=t.getSum(s),S=Math.PI/(N||A)*2,I=e.get("clockwise"),C=e.get("roseType"),w=e.get("stillShowZeroSum"),M=t.getDataExtent(s);M[0]=0;var u=I?1:-1,L=[x,g],P=u*m/2;Ze(L,!I),x=L[0],g=L[1];var V=Math.abs(g-x),T=V,O=0,_=x;if(t.setLayout({viewRect:i,r:o}),t.each(s,function(D,k){var d;if(isNaN(D))t.setItemLayout(k,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:I,cx:c,cy:f,r0:v,r:C?NaN:o});else{(d=C!=="area"?N===0&&w?S:D*S:V/A)<y?(d=y,T-=y):O+=D;var h=_+u*d,b=0,W=0;m>d?W=b=_+u*d/2:(b=_+P,W=h-P),t.setItemLayout(k,{angle:d,startAngle:b,endAngle:W,clockwise:I,cx:c,cy:f,r0:v,r:C?Ge(D,M,[v,o]):o}),_=h}}),T<fe&&A)if(T<=.001){var U=V/A;t.each(s,function(D,k){if(!isNaN(D)){var d=t.getItemLayout(k);d.angle=U;var h=0,b=0;U<m?b=h=x+u*(k+.5)*U:(h=x+u*k*U+P,b=x+u*(k+1)*U-P),d.startAngle=h,d.endAngle=b}})}else S=T/O,_=x,t.each(s,function(D,k){if(!isNaN(D)){var d=t.getItemLayout(k),h=d.angle===y?y:D*S,b=0,W=0;h<m?W=b=_+u*h/2:(b=_+P,W=_+u*h-P),d.startAngle=b,d.endAngle=W,_+=u*h}})})}var je=Math.PI/180;function ye(n,r,a,e,t,s,i,l,c,f){if(!(n.length<2)){for(var o=n.length,v=0;v<o;v++)if(n[v].position==="outer"&&n[v].labelAlignTo==="labelLine"){var x=n[v].label.x-f;n[v].linePoints[1][0]+=x,n[v].label.x=f}ze(n,c,c+i)&&function(m){for(var y={list:[],maxY:0},A={list:[],maxY:0},N=0;N<m.length;N++)if(m[N].labelAlignTo==="none"){var S=m[N],I=S.label.y>a?A:y,C=Math.abs(S.label.y-a);if(C>=I.maxY){var w=S.label.x-r-S.len2*t,M=e+S.len,u=Math.abs(w)<M?Math.sqrt(C*C/(1-w*w/M/M)):M;I.rB=u,I.maxY=C}I.list.push(S)}g(y),g(A)}(n)}function g(m){for(var y=m.rB,A=y*y,N=0;N<m.list.length;N++){var S=m.list[N],I=Math.abs(S.label.y-a),C=e+S.len,w=C*C,M=Math.sqrt((1-Math.abs(I*I/A))*w),u=r+(M+S.len2)*t,L=u-S.label.x;Se(S,S.targetTextWidth-L*t,!0),S.label.x=u}}}function Se(n,r,a){if(a===void 0&&(a=!1),n.labelStyleWidth==null){var e=n.label,t=e.style,s=n.rect,i=t.backgroundColor,l=t.padding,c=l?l[1]+l[3]:0,f=t.overflow,o=s.width+(i?0:c);if(r<o||a){var v=s.height;if(f&&f.match("break")){e.setStyle("backgroundColor",null),e.setStyle("width",r-c);var x=e.getBoundingRect();e.setStyle("width",Math.ceil(x.width)),e.setStyle("backgroundColor",i)}else{var g=r-c,m=r<o?g:a?g>n.unconstrainedWidth?null:g:null;e.setStyle("width",m)}var y=e.getBoundingRect();s.width=y.width;var A=(e.style.margin||0)+2.1;s.height=y.height+A,s.y-=(s.height-v)/2}}}function re(n){return n.position==="center"}function $e(n){var r,a,e=n.getData(),t=[],s=!1,i=(n.get("minShowLabelAngle")||0)*je,l=e.getLayout("viewRect"),c=e.getLayout("r"),f=l.width,o=l.x,v=l.y,x=l.height;function g(w){w.ignore=!0}e.each(function(w){var M=e.getItemGraphicEl(w),u=M.shape,L=M.getTextContent(),P=M.getTextGuideLine(),V=e.getItemModel(w),T=V.getModel("label"),O=T.get("position")||V.get(["emphasis","label","position"]),_=T.get("distanceToLabelLine"),U=T.get("alignTo"),D=G(T.get("edgeDistance"),f),k=T.get("bleedMargin"),d=V.getModel("labelLine"),h=d.get("length");h=G(h,f);var b=d.get("length2");if(b=G(b,f),Math.abs(u.endAngle-u.startAngle)<i)return E(L.states,g),L.ignore=!0,void(P&&(E(P.states,g),P.ignore=!0));if(function(ne){if(!ne.ignore)return!0;for(var Le in ne.states)if(ne.states[Le].ignore===!1)return!0;return!1}(L)){var W,p,K,R,q=(u.startAngle+u.endAngle)/2,B=Math.cos(q),Z=Math.sin(q);r=u.cx,a=u.cy;var X=O==="inside"||O==="inner";if(O==="center")W=u.cx,p=u.cy,R="center";else{var ee=(X?(u.r+u.r0)/2*B:u.r*B)+r,te=(X?(u.r+u.r0)/2*Z:u.r*Z)+a;if(W=ee+3*B,p=te+3*Z,!X){var oe=ee+B*(h+c-u.r),ae=te+Z*(h+c-u.r),ge=oe+(B<0?-1:1)*b;W=U==="edge"?B<0?o+D:o+f-D:ge+(B<0?-_:_),p=ae,K=[[ee,te],[oe,ae],[ge,ae]]}R=X?"center":U==="edge"?B>0?"right":"left":B>0?"left":"right"}var Y=Math.PI,F=0,z=T.get("rotate");if(me(z))F=z*(Y/180);else if(O==="center")F=0;else if(z==="radial"||z===!0)F=B<0?-q+Y:-q;else if(z==="tangential"&&O!=="outside"&&O!=="outer"){var H=Math.atan2(B,Z);H<0&&(H=2*Y+H),Z>0&&(H=Y+H),F=H-Y}if(s=!!F,L.x=W,L.y=p,L.rotation=F,L.setStyle({verticalAlign:"middle"}),X){L.setStyle({align:R});var ie=L.states.select;ie&&(ie.x+=L.x,ie.y+=L.y)}else{var J=L.getBoundingRect().clone();J.applyTransform(L.getComputedTransform());var ce=(L.style.margin||0)+2.1;J.y-=ce/2,J.height+=ce,t.push({label:L,labelLine:P,position:O,len:h,len2:b,minTurnAngle:d.get("minTurnAngle"),maxSurfaceAngle:d.get("maxSurfaceAngle"),surfaceNormal:new pe(B,Z),linePoints:K,textAlign:R,labelDistance:_,labelAlignTo:U,edgeDistance:D,bleedMargin:k,rect:J,unconstrainedWidth:J.width,labelStyleWidth:L.style.width})}M.setTextConfig({inside:X})}}),!s&&n.get("avoidLabelOverlap")&&function(w,M,u,L,P,V,T,O){for(var _=[],U=[],D=Number.MAX_VALUE,k=-Number.MAX_VALUE,d=0;d<w.length;d++){var h=w[d].label;re(w[d])||(h.x<M?(D=Math.min(D,h.x),_.push(w[d])):(k=Math.max(k,h.x),U.push(w[d])))}for(d=0;d<w.length;d++)if(!re(p=w[d])&&p.linePoints){if(p.labelStyleWidth!=null)continue;h=p.label;var b=p.linePoints,W=void 0;W=p.labelAlignTo==="edge"?h.x<M?b[2][0]-p.labelDistance-T-p.edgeDistance:T+P-p.edgeDistance-b[2][0]-p.labelDistance:p.labelAlignTo==="labelLine"?h.x<M?D-T-p.bleedMargin:T+P-k-p.bleedMargin:h.x<M?h.x-T-p.bleedMargin:T+P-h.x-p.bleedMargin,p.targetTextWidth=W,Se(p,W)}for(ye(U,M,u,L,1,0,V,0,O,k),ye(_,M,u,L,-1,0,V,0,O,D),d=0;d<w.length;d++){var p;if(!re(p=w[d])&&p.linePoints){h=p.label,b=p.linePoints;var K=p.labelAlignTo==="edge",R=h.style.padding,q=R?R[1]+R[3]:0,B=h.style.backgroundColor?0:q,Z=p.rect.width+B,X=b[1][0]-b[2][0];K?h.x<M?b[2][0]=T+p.edgeDistance+Z+p.labelDistance:b[2][0]=T+P-p.edgeDistance-Z-p.labelDistance:(h.x<M?b[2][0]=h.x+p.labelDistance:b[2][0]=h.x-p.labelDistance,b[1][0]=b[2][0]+X),b[1][1]=b[2][1]=h.y}}}(t,r,a,c,f,x,o,v);for(var m=0;m<t.length;m++){var y=t[m],A=y.label,N=y.labelLine,S=isNaN(A.x)||isNaN(A.y);if(A){A.setStyle({align:y.textAlign}),S&&(E(A.states,g),A.ignore=!0);var I=A.states.select;I&&(I.x+=A.x,I.y+=A.y)}if(N){var C=y.linePoints;S||!C?(E(N.states,g),N.ignore=!0):(Qe(C,y.minTurnAngle),Ye(C,y.surfaceNormal,y.maxSurfaceAngle),N.setShape({points:C}),A.__hostTarget.textGuideLineConfig={anchor:new pe(C[0][0],C[0][1])})}}}var et=function(n){function r(a,e,t){var s=n.call(this)||this;s.z2=2;var i=new Re;return s.setTextContent(i),s.updateData(a,e,t,!0),s}return se(r,n),r.prototype.updateData=function(a,e,t,s){var i=this,l=a.hostModel,c=a.getItemModel(e),f=c.getModel("emphasis"),o=a.getItemLayout(e),v=Q(j(c.getModel("itemStyle"),o,!0),o);if(isNaN(v.startAngle))i.setShape(v);else{if(s){i.setShape(v);var x=l.getShallow("animationType");l.ecModel.ssr?(le(i,{scaleX:0,scaleY:0},l,{dataIndex:e,isFrom:!0}),i.originX=v.cx,i.originY=v.cy):x==="scale"?(i.shape.r=o.r0,le(i,{shape:{r:o.r}},l,e)):t!=null?(i.setShape({startAngle:t,endAngle:t}),le(i,{shape:{startAngle:o.startAngle,endAngle:o.endAngle}},l,e)):(i.shape.endAngle=o.startAngle,he(i,{shape:{endAngle:o.endAngle}},l,e))}else Me(i),he(i,{shape:v},l,e);i.useStyle(a.getItemVisual(e,"style")),we(i,c);var g=(o.startAngle+o.endAngle)/2,m=l.get("selectedOffset"),y=Math.cos(g)*m,A=Math.sin(g)*m,N=c.getShallow("cursor");N&&i.attr("cursor",N),this._updateLabel(l,a,e),i.ensureState("emphasis").shape=Q({r:o.r+(f.get("scale")&&f.get("scaleSize")||0)},j(f.getModel("itemStyle"),o)),Q(i.ensureState("select"),{x:y,y:A,shape:j(c.getModel(["select","itemStyle"]),o)}),Q(i.ensureState("blur"),{shape:j(c.getModel(["blur","itemStyle"]),o)});var S=i.getTextGuideLine(),I=i.getTextContent();S&&Q(S.ensureState("select"),{x:y,y:A}),Q(I.ensureState("select"),{x:y,y:A}),Te(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))}},r.prototype._updateLabel=function(a,e,t){var s=this,i=e.getItemModel(t),l=i.getModel("labelLine"),c=e.getItemVisual(t,"style"),f=c&&c.fill,o=c&&c.opacity;De(s,Ne(i),{labelFetcher:e.hostModel,labelDataIndex:t,inheritColor:f,defaultOpacity:o,defaultText:a.getFormattedLabel(t,"normal")||e.getName(t)});var v=s.getTextContent();s.setTextConfig({position:null,rotation:null}),v.attr({z2:10});var x=a.get(["label","position"]);if(x!=="outside"&&x!=="outer")s.removeTextGuideLine();else{var g=this.getTextGuideLine();g||(g=new Ie,this.setTextGuideLine(g)),Fe(this,He(i),{stroke:f,opacity:Ce(l.get(["lineStyle","opacity"]),o,1)})}},r}(ve),tt=function(n){function r(){var a=n!==null&&n.apply(this,arguments)||this;return a.ignoreLabelLineUpdate=!0,a}return se(r,n),r.prototype.render=function(a,e,t,s){var i,l=a.getData(),c=this._data,f=this.group;if(!c&&l.count()>0){for(var o=l.getItemLayout(0),v=1;isNaN(o&&o.startAngle)&&v<l.count();++v)o=l.getItemLayout(v);o&&(i=o.startAngle)}if(this._emptyCircleSector&&f.remove(this._emptyCircleSector),l.count()===0&&a.get("showEmptyCircle")){var x=new ve({shape:Ae(a,t)});x.useStyle(a.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=x,f.add(x)}l.diff(c).add(function(g){var m=new et(l,g,i);l.setItemGraphicEl(g,m),f.add(m)}).update(function(g,m){var y=c.getItemGraphicEl(m);y.updateData(l,g,i),y.off("click"),f.add(y),l.setItemGraphicEl(g,y)}).remove(function(g){var m=c.getItemGraphicEl(g);Pe(m,a,g)}).execute(),$e(a),a.get("animationTypeUpdate")!=="expansion"&&(this._data=l)},r.prototype.dispose=function(){},r.prototype.containPoint=function(a,e){var t=e.getData().getItemLayout(0);if(t){var s=a[0]-t.cx,i=a[1]-t.cy,l=Math.sqrt(s*s+i*i);return l<=t.r&&l>=t.r0}},r.type="pie",r}(_e),at=ke(),it=function(n){function r(){return n!==null&&n.apply(this,arguments)||this}return se(r,n),r.prototype.init=function(a){n.prototype.init.apply(this,arguments),this.legendVisualProvider=new Ke(ue(this.getData,this),ue(this.getRawData,this)),this._defaultLabelLine(a)},r.prototype.mergeOption=function(){n.prototype.mergeOption.apply(this,arguments)},r.prototype.getInitialData=function(){return Je(this,{coordDimensions:["value"],encodeDefaulter:be(We,this)})},r.prototype.getDataParams=function(a){var e=this.getData(),t=at(e),s=t.seats;if(!s){var i=[];e.each(e.mapDimension("value"),function(c){i.push(c)}),s=t.seats=Be(i,e.hostModel.get("percentPrecision"))}var l=n.prototype.getDataParams.call(this,a);return l.percent=s[a]||0,l.$vars.push("percent"),l},r.prototype._defaultLabelLine=function(a){Oe(a,"labelLine",["show"]);var e=a.labelLine,t=a.emphasis.labelLine;e.show=e.show&&a.label.show,t.show=t.show&&a.emphasis.label.show},r.type="series.pie",r.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},r}(Ue);function ht(n){n.registerChartView(tt),n.registerSeriesModel(it),Ve("pie",n.registerAction),n.registerLayout(be(Ee,"pie")),n.registerProcessor(qe("pie")),n.registerProcessor({seriesType:"pie",reset:function(r,a){var e=r.getData();e.filterSelf(function(t){var s=e.mapDimension("value"),i=e.get(s,t);return!(me(i)&&!isNaN(i)&&i<0)})}})}export{ht as install};
