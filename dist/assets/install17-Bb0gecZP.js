import{e as f,bI as m,bJ as v,z as _,bV as x,bP as w,Y as D,A as S,L as b,a8 as C}from"./index-B7p1rSoh.js";import{u as I}from"./SymbolDraw-BhXfzXL3.js";import{i as g}from"./points-tUDfq5sT.js";import{r as A}from"./installSimple-Cs6EeXG2.js";import"./Symbol-BJr7B5u5.js";import"./axisDefault-BWHnNG-T.js";import"./AxisView-DFBExtUn.js";import"./AxisBuilder-DO5pSo3v.js";import"./axisSplitHelper-2EcEBYfU.js";import"./axisModelCreator-DdkQJWJC.js";import"./axisAlignTicks-Ajoy2c09.js";import"./labelHelper-CNBk1q-x.js";import"./labelLayoutHelper-BB_RXLLn.js";var L=function(s){function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return f(e,s),e.prototype.getInitialData=function(t,r){return m(null,this,{useEncodeDefaulter:!0})},e.prototype.getProgressive=function(){var t=this.option.progressive;return t??(this.option.large?5e3:this.get("progressive"))},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return t??(this.option.large?1e4:this.get("progressiveThreshold"))},e.prototype.brushSelector=function(t,r,i){return i.point(r.getItemLayout(t))},e.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},e.type="series.scatter",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:"#212121"}},universalTransition:{divideShape:"clone"}},e}(v),P=function(){},z=function(s){function e(t){var r=s.call(this,t)||this;return r._off=0,r.hoverDataIdx=-1,r}return f(e,s),e.prototype.getDefaultShape=function(){return new P},e.prototype.reset=function(){this.notClear=!1,this._off=0},e.prototype.buildPath=function(t,r){var i,o=r.points,a=r.size,h=this.symbolProxy,p=h.shape,n=t.getContext?t.getContext():t,d=n&&a[0]<4,l=this.softClipShape;if(d)this._ctx=n;else{for(this._ctx=null,i=this._off;i<o.length;){var u=o[i++],c=o[i++];isNaN(u)||isNaN(c)||l&&!l.contain(u,c)||(p.x=u-a[0]/2,p.y=c-a[1]/2,p.width=a[0],p.height=a[1],h.buildPath(t,p,!0))}this.incremental&&(this._off=i,this.notClear=!0)}},e.prototype.afterBrush=function(){var t,r=this.shape,i=r.points,o=r.size,a=this._ctx,h=this.softClipShape;if(a){for(t=this._off;t<i.length;){var p=i[t++],n=i[t++];isNaN(p)||isNaN(n)||h&&!h.contain(p,n)||a.fillRect(p-o[0]/2,n-o[1]/2,o[0],o[1])}this.incremental&&(this._off=t,this.notClear=!0)}},e.prototype.findDataIndex=function(t,r){for(var i=this.shape,o=i.points,a=i.size,h=Math.max(a[0],4),p=Math.max(a[1],4),n=o.length/2-1;n>=0;n--){var d=2*n,l=o[d]-h/2,u=o[d+1]-p/2;if(t>=l&&r>=u&&t<=l+h&&r<=u+p)return n}return-1},e.prototype.contain=function(t,r){var i=this.transformCoordToLocal(t,r),o=this.getBoundingRect();return t=i[0],r=i[1],o.contain(t,r)?(this.hoverDataIdx=this.findDataIndex(t,r))>=0:(this.hoverDataIdx=-1,!1)},e.prototype.getBoundingRect=function(){var t=this._rect;if(!t){for(var r=this.shape,i=r.points,o=r.size,a=o[0],h=o[1],p=1/0,n=1/0,d=-1/0,l=-1/0,u=0;u<i.length;){var c=i[u++],y=i[u++];p=Math.min(c,p),d=Math.max(c,d),n=Math.min(y,n),l=Math.max(y,l)}t=this._rect=new _(p-a/2,n-h/2,d-p+a,l-n+h)}return t},e}(x),M=function(){function s(){this.group=new S}return s.prototype.updateData=function(e,t){this._clear();var r=this._create();r.setShape({points:e.getLayout("points")}),this._setCommon(r,e,t)},s.prototype.updateLayout=function(e){var t=e.getLayout("points");this.group.eachChild(function(r){if(r.startIndex!=null){var i=2*(r.endIndex-r.startIndex),o=4*r.startIndex*2;t=new Float32Array(t.buffer,o,i)}r.setShape("points",t),r.reset()})},s.prototype.incrementalPrepareUpdate=function(e){this._clear()},s.prototype.incrementalUpdate=function(e,t,r){var i=this._newAdded[0],o=t.getLayout("points"),a=i&&i.shape.points;if(a&&a.length<2e4){var h=a.length,p=new Float32Array(h+o.length);p.set(a),p.set(o,h),i.endIndex=e.end,i.setShape({points:p})}else{this._newAdded=[];var n=this._create();n.startIndex=e.start,n.endIndex=e.end,n.incremental=!0,n.setShape({points:o}),this._setCommon(n,t,r)}},s.prototype.eachRendered=function(e){this._newAdded[0]&&e(this._newAdded[0])},s.prototype._create=function(){var e=new z({cursor:"default"});return e.ignoreCoarsePointer=!0,this.group.add(e),this._newAdded.push(e),e},s.prototype._setCommon=function(e,t,r){var i=t.hostModel;r=r||{};var o=t.getVisual("symbolSize");e.setShape("size",o instanceof Array?o:[o,o]),e.softClipShape=r.clipShape||null,e.symbolProxy=b(t.getVisual("symbol"),0,0,0,0),e.setColor=e.symbolProxy.setColor;var a=e.shape.size[0]<4;e.useStyle(i.getModel("itemStyle").getItemStyle(a?["color","shadowBlur","shadowColor"]:["color"]));var h=t.getVisual("style"),p=h&&h.fill;p&&e.setColor(p);var n=C(e);n.seriesIndex=i.seriesIndex,e.on("mousemove",function(d){n.dataIndex=null;var l=e.hoverDataIdx;l>=0&&(n.dataIndex=l+(e.startIndex||0))})},s.prototype.remove=function(){this._clear()},s.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},s}(),N=function(s){function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.type=e.type,t}return f(e,s),e.prototype.render=function(t,r,i){var o=t.getData();this._updateSymbolDraw(o,t).updateData(o,{clipShape:this._getClipShape(t)}),this._finished=!0},e.prototype.incrementalPrepareRender=function(t,r,i){var o=t.getData();this._updateSymbolDraw(o,t).incrementalPrepareUpdate(o),this._finished=!1},e.prototype.incrementalRender=function(t,r,i){this._symbolDraw.incrementalUpdate(t,r.getData(),{clipShape:this._getClipShape(r)}),this._finished=t.end===r.getData().count()},e.prototype.updateTransform=function(t,r,i){var o=t.getData();if(this.group.dirty(),!this._finished||o.count()>1e4)return{update:!0};var a=g("").reset(t,r,i);a.progress&&a.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout(o)},e.prototype.eachRendered=function(t){this._symbolDraw&&this._symbolDraw.eachRendered(t)},e.prototype._getClipShape=function(t){if(t.get("clip",!0)){var r=t.coordinateSystem;return r&&r.getArea&&r.getArea(.1)}},e.prototype._updateSymbolDraw=function(t,r){var i=this._symbolDraw,o=r.pipelineContext.large;return i&&o===this._isLargeDraw||(i&&i.remove(),i=this._symbolDraw=o?new M:new I,this._isLargeDraw=o,this.group.removeAll()),this.group.add(i.group),i},e.prototype.remove=function(t,r){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},e.prototype.dispose=function(){},e.type="scatter",e}(w);function O(s){D(A),s.registerSeriesModel(L),s.registerChartView(N),s.registerLayout(g("scatter"))}export{O as install};
