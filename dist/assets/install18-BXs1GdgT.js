import{e as j,a7 as Y,D,al as ue,N as C,cA as de,bK as ce,aa as he,bL as ge,bS as pe,w as fe,dz as F,ao as ve,df as ye,aB as me,aW as Me,a1 as z,aV as Ie,bO as be,E as G,b as we,bI as xe,d as Ae,cH as Pe,j as k,h as R,U as Ve,G as _e,dA as Se}from"./index-B3HKDY-B.js";import{u as ee}from"./sectorHelper-CHDjzrIC.js";import{f as De,p as Ne,d as te,u as Te}from"./Tree-HKvtTjAA.js";import{a as Re}from"./enableAriaDecalForTree-D7WJkrgz.js";import{e as Ce}from"./dataFilter-_M4AusE-.js";import"./linkSeriesData-CBqbv7hX.js";var ae=function(s){function i(e,t,a,o){var n=s.call(this)||this;n.z2=2,n.textConfig={inside:!0},Y(n).seriesIndex=t.seriesIndex;var r=new Ae({z2:4,silent:e.getModel().get(["label","silent"])});return n.setTextContent(r),n.updateData(!0,e,t,a,o),n}return j(i,s),i.prototype.updateData=function(e,t,a,o,n){this.node=t,t.piece=this,a=a||this._seriesModel,o=o||this._ecModel;var r=this;Y(r).dataIndex=t.dataIndex;var l=t.getModel(),c=l.getModel("emphasis"),f=t.getLayout(),u=D({},f);u.label=null;var p=t.getVisual("style");p.lineJoin="bevel";var P=t.getVisual("decal");P&&(p.decal=ue(P,n));var m=ee(l.getModel("itemStyle"),u,!0);D(u,m),C(de,function(h){var M=r.ensureState(h),d=l.getModel([h,"itemStyle"]);M.style=d.getItemStyle();var y=ee(d,u);y&&(M.shape=y)}),e?(r.setShape(u),r.shape.r=f.r0,ce(r,{shape:{r:f.r}},a,t.dataIndex)):(he(r,{shape:u},a),ge(r)),r.useStyle(p),this._updateLabel(a);var I=l.getShallow("cursor");I&&r.attr("cursor",I),this._seriesModel=a||this._seriesModel,this._ecModel=o||this._ecModel;var g=c.get("focus"),v=g==="ancestor"?t.getAncestorsIndices():g==="descendant"?t.getDescendantIndices():g;pe(this,v,c.get("blurScope"),c.get("disabled"))},i.prototype._updateLabel=function(e){var t=this,a=this.node.getModel(),o=a.getModel("label"),n=this.node.getLayout(),r=n.endAngle-n.startAngle,l=(n.startAngle+n.endAngle)/2,c=Math.cos(l),f=Math.sin(l),u=this,p=u.getTextContent(),P=this.node.dataIndex,m=o.get("minAngle")/180*Math.PI,I=o.get("show")&&!(m!=null&&Math.abs(r)<m);function g(v,h){var M=v.get(h);return M??o.get(h)}p.ignore=!I,C(ye,function(v){var h=v==="normal"?a.getModel("label"):a.getModel([v,"label"]),M=v==="normal",d=M?p:p.ensureState(v),y=e.getFormattedLabel(P,v);M&&(y=y||t.node.name),d.style=fe(h,{},null,v!=="normal",!0),y&&(d.style.text=y);var V=h.get("show");V==null||M||(d.ignore=!V);var w,N=g(h,"position"),T=M?u:u.states[v],q=T.style.fill;T.textConfig={outsideFill:h.get("color")==="inherit"?q:null,inside:N!=="outside"};var L=g(h,"distance")||0,x=g(h,"align"),S=g(h,"rotate"),$=.5*Math.PI,U=1.5*Math.PI,b=F(S==="tangential"?Math.PI/2-l:l),A=b>$&&!Pe(b-$)&&b<U;N==="outside"?(w=n.r+L,x=A?"right":"left"):x&&x!=="center"?x==="left"?(w=n.r0+L,x=A?"right":"left"):x==="right"&&(w=n.r-L,x=A?"left":"right"):(w=r===2*Math.PI&&n.r0===0?0:(n.r+n.r0)/2,x="center"),d.style.align=x,d.style.verticalAlign=g(h,"verticalAlign")||"middle",d.x=w*c+n.cx,d.y=w*f+n.cy;var _=0;S==="radial"?_=F(-l)+(A?Math.PI:0):S==="tangential"?_=F(Math.PI/2-l)+(A?Math.PI:0):ve(S)&&(_=S*Math.PI/180),d.rotation=F(_)}),p.dirtyStyle()},i}(me),H="sunburstRootToNode",ne="sunburstHighlight",Le="sunburstUnhighlight",ke=function(s){function i(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=i.type,e}return j(i,s),i.prototype.render=function(e,t,a,o){var n=this;this.seriesModel=e,this.api=a,this.ecModel=t;var r=e.getData(),l=r.tree.root,c=e.getViewRoot(),f=this.group,u=e.get("renderLabelForZeroData"),p=[];c.eachNode(function(m){p.push(m)});var P=this._oldChildren||[];(function(m,I){if(m.length===0&&I.length===0)return;function g(h){return h.getId()}function v(h,M){(function(d,y){if(u||!d||d.getValue()||(d=null),d!==l&&y!==l){if(y&&y.piece)d?(y.piece.updateData(!1,d,e,t,a),r.setItemGraphicEl(d.dataIndex,y.piece)):function(w){w&&w.piece&&(f.remove(w.piece),w.piece=null)}(y);else if(d){var V=new ae(d,e,t,a);f.add(V),r.setItemGraphicEl(d.dataIndex,V)}}})(h==null?null:m[h],M==null?null:I[M])}new Me(I,m,g,g).add(v).update(v).remove(z(v,null)).execute()})(p,P),function(m,I){I.depth>0?(n.virtualPiece?n.virtualPiece.updateData(!1,m,e,t,a):(n.virtualPiece=new ae(m,e,t,a),f.add(n.virtualPiece)),I.piece.off("click"),n.virtualPiece.on("click",function(g){n._rootToNode(I.parentNode)})):n.virtualPiece&&(f.remove(n.virtualPiece),n.virtualPiece=null)}(l,c),this._initEvents(),this._oldChildren=p},i.prototype._initEvents=function(){var e=this;this.group.off("click"),this.group.on("click",function(t){var a=!1;e.seriesModel.getViewRoot().eachNode(function(o){if(!a&&o.piece&&o.piece===t.target){var n=o.getModel().get("nodeClick");if(n==="rootToNode")e._rootToNode(o);else if(n==="link"){var r=o.getModel(),l=r.get("link");if(l){var c=r.get("target",!0)||"_blank";Ie(l,c)}}a=!0}})})},i.prototype._rootToNode=function(e){e!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:H,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})},i.prototype.containPoint=function(e,t){var a=t.getData().getItemLayout(0);if(a){var o=e[0]-a.cx,n=e[1]-a.cy,r=Math.sqrt(o*o+n*n);return r<=a.r&&r>=a.r0}},i.type="sunburst",i}(be);function ie(s){var i=0;C(s.children,function(t){ie(t);var a=t.value;k(a)&&(a=a[0]),i+=a});var e=s.value;k(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=i),e<0&&(e=0),k(s.value)?s.value[0]=e:s.value=e}var $e=function(s){function i(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=i.type,e.ignoreStyleOnData=!0,e}return j(i,s),i.prototype.getInitialData=function(e,t){var a={name:e.name,children:e.data};ie(a);var o=this._levelModels=G(e.levels||[],function(r){return new we(r,this,t)},this),n=De.createTree(a,this,function(r){r.wrapMethod("getItemModel",function(l,c){var f=n.getNodeByDataIndex(c),u=o[f.depth];return u&&(l.parentModel=u),l})});return n.data},i.prototype.optionUpdated=function(){this.resetViewRoot()},i.prototype.getDataParams=function(e){var t=s.prototype.getDataParams.apply(this,arguments),a=this.getData().tree.getNodeByDataIndex(e);return t.treePathInfo=Ne(a,this),t},i.prototype.getLevelModel=function(e){return this._levelModels&&this._levelModels[e.depth]},i.prototype.getViewRoot=function(){return this._viewRoot},i.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var t=this.getRawData().tree.root;e&&(e===t||t.contains(e))||(this._viewRoot=t)},i.prototype.enableAriaDecal=function(){Re(this)},i.type="series.sunburst",i.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},i}(xe),re=Math.PI/180;function Ue(s,i,e){i.eachSeriesByType(s,function(t){var a=t.get("center"),o=t.get("radius");k(o)||(o=[0,o]),k(a)||(a=[a,a]);var n=e.getWidth(),r=e.getHeight(),l=Math.min(n,r),c=R(a[0],n),f=R(a[1],r),u=R(o[0],l/2),p=R(o[1],l/2),P=-t.get("startAngle")*re,m=t.get("minAngle")*re,I=t.getData().tree.root,g=t.getViewRoot(),v=g.depth,h=t.get("sort");h!=null&&oe(g,h);var M=0;C(g.children,function(b){!isNaN(b.getValue())&&M++});var d=g.getValue(),y=Math.PI/(d||M)*2,V=g.depth>0,w=g.height-(V?-1:1),N=(p-u)/(w||1),T=t.get("clockwise"),q=t.get("stillShowZeroSum"),L=T?1:-1,x=function(b,A){if(b){var _=A;if(b!==I){var le=b.getValue(),B=d===0&&q?y:le*y;B<m&&(B=m),_=A+L*B;var X=b.depth-v-(V?-1:1),J=u+N*X,K=u+N*(X+1),E=t.getLevelModel(b);if(E){var O=E.get("r0",!0),W=E.get("r",!0),Z=E.get("radius",!0);Z!=null&&(O=Z[0],W=Z[1]),O!=null&&(J=R(O,l/2)),W!=null&&(K=R(W,l/2))}b.setLayout({angle:B,startAngle:A,endAngle:_,clockwise:T,cx:c,cy:f,r0:J,r:K})}if(b.children&&b.children.length){var Q=0;C(b.children,function(se){Q+=x(se,A+Q)})}return _-A}};if(V){var S=u,$=u+N,U=2*Math.PI;I.setLayout({angle:U,startAngle:P,endAngle:P+U,clockwise:T,cx:c,cy:f,r0:S,r:$})}x(g,P)})}function oe(s,i){var e=s.children||[];s.children=function(t,a){if(Ve(a)){var o=G(t,function(r,l){var c=r.getValue();return{params:{depth:r.depth,height:r.height,dataIndex:r.dataIndex,getValue:function(){return c}},index:l}});return o.sort(function(r,l){return a(r.params,l.params)}),G(o,function(r){return t[r.index]})}var n=a==="asc";return t.sort(function(r,l){var c=(r.getValue()-l.getValue())*(n?1:-1);return c===0?(r.dataIndex-l.dataIndex)*(n?-1:1):c})}(e,i),e.length&&C(s.children,function(t){oe(t,i)})}function Be(s){var i={};s.eachSeriesByType("sunburst",function(e){var t=e.getData(),a=t.tree;a.eachNode(function(o){var n=o.getModel().getModel("itemStyle").getItemStyle();n.fill||(n.fill=function(l,c,f){for(var u=l;u&&u.depth>1;)u=u.parentNode;var p=c.getColorFromPalette(u.name||u.dataIndex+"",i);return l.depth>1&&_e(p)&&(p=Se(p,(l.depth-1)/(f-1)*.5)),p}(o,e,a.root.height));var r=t.ensureUniqueItemVisual(o.dataIndex,"style");D(r,n)})})}function ze(s){s.registerChartView(ke),s.registerSeriesModel($e),s.registerLayout(z(Ue,"sunburst")),s.registerProcessor(z(Ce,"sunburst")),s.registerVisual(Be),function(i){i.registerAction({type:H,update:"updateView"},function(e,t){t.eachComponent({mainType:"series",subType:"sunburst",query:e},function(a,o){var n=te(e,[H],a);if(n){var r=a.getViewRoot();r&&(e.direction=Te(r,n.node)?"rollUp":"drillDown"),a.resetViewRoot(n.node)}})}),i.registerAction({type:ne,update:"none"},function(e,t,a){e=D({},e),t.eachComponent({mainType:"series",subType:"sunburst",query:e},function(o){var n=te(e,[ne],o);n&&(e.dataIndex=n.node.dataIndex)}),a.dispatchAction(D(e,{type:"highlight"}))}),i.registerAction({type:Le,update:"updateView"},function(e,t,a){e=D({},e),a.dispatchAction(D(e,{type:"downplay"}))})}(s)}export{ze as install};
