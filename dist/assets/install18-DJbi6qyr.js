import{e as X,a8 as K,D as S,am as ue,N as R,db as de,bL as ce,ab as he,bM as ge,bT as pe,w as fe,dA as F,ap as ve,da as ye,aC as me,aX as Me,a2 as O,aW as be,bP as Ie,E as z,b as we,bJ as xe,f as Pe,cC as Ae,j as k,i as C,U as Ve,G as _e,dB as De}from"./index-B7p1rSoh.js";import{u as ee}from"./sectorHelper-CBz9677j.js";import{f as Se,p as Ne,d as te,u as Te}from"./Tree-DTynipKO.js";import{a as Ce}from"./enableAriaDecalForTree-DRKFzjDS.js";import{e as Re}from"./dataFilter-_M4AusE-.js";import"./linkSeriesData-DMzrFD1S.js";var ae=function(s){function i(e,t,a,o){var n=s.call(this)||this;n.z2=2,n.textConfig={inside:!0},K(n).seriesIndex=t.seriesIndex;var r=new Pe({z2:4,silent:e.getModel().get(["label","silent"])});return n.setTextContent(r),n.updateData(!0,e,t,a,o),n}return X(i,s),i.prototype.updateData=function(e,t,a,o,n){this.node=t,t.piece=this,a=a||this._seriesModel,o=o||this._ecModel;var r=this;K(r).dataIndex=t.dataIndex;var l=t.getModel(),c=l.getModel("emphasis"),f=t.getLayout(),u=S({},f);u.label=null;var p=t.getVisual("style");p.lineJoin="bevel";var A=t.getVisual("decal");A&&(p.decal=ue(A,n));var m=ee(l.getModel("itemStyle"),u,!0);S(u,m),R(de,function(h){var M=r.ensureState(h),d=l.getModel([h,"itemStyle"]);M.style=d.getItemStyle();var y=ee(d,u);y&&(M.shape=y)}),e?(r.setShape(u),r.shape.r=f.r0,ce(r,{shape:{r:f.r}},a,t.dataIndex)):(he(r,{shape:u},a),ge(r)),r.useStyle(p),this._updateLabel(a);var b=l.getShallow("cursor");b&&r.attr("cursor",b),this._seriesModel=a||this._seriesModel,this._ecModel=o||this._ecModel;var g=c.get("focus"),v=g==="ancestor"?t.getAncestorsIndices():g==="descendant"?t.getDescendantIndices():g;pe(this,v,c.get("blurScope"),c.get("disabled"))},i.prototype._updateLabel=function(e){var t=this,a=this.node.getModel(),o=a.getModel("label"),n=this.node.getLayout(),r=n.endAngle-n.startAngle,l=(n.startAngle+n.endAngle)/2,c=Math.cos(l),f=Math.sin(l),u=this,p=u.getTextContent(),A=this.node.dataIndex,m=o.get("minAngle")/180*Math.PI,b=o.get("show")&&!(m!=null&&Math.abs(r)<m);function g(v,h){var M=v.get(h);return M??o.get(h)}p.ignore=!b,R(ye,function(v){var h=v==="normal"?a.getModel("label"):a.getModel([v,"label"]),M=v==="normal",d=M?p:p.ensureState(v),y=e.getFormattedLabel(A,v);M&&(y=y||t.node.name),d.style=fe(h,{},null,v!=="normal",!0),y&&(d.style.text=y);var V=h.get("show");V==null||M||(d.ignore=!V);var w,N=g(h,"position"),T=M?u:u.states[v],q=T.style.fill;T.textConfig={outsideFill:h.get("color")==="inherit"?q:null,inside:N!=="outside"};var L=g(h,"distance")||0,x=g(h,"align"),D=g(h,"rotate"),$=.5*Math.PI,U=1.5*Math.PI,I=F(D==="tangential"?Math.PI/2-l:l),P=I>$&&!Ae(I-$)&&I<U;N==="outside"?(w=n.r+L,x=P?"right":"left"):x&&x!=="center"?x==="left"?(w=n.r0+L,x=P?"right":"left"):x==="right"&&(w=n.r-L,x=P?"left":"right"):(w=r===2*Math.PI&&n.r0===0?0:(n.r+n.r0)/2,x="center"),d.style.align=x,d.style.verticalAlign=g(h,"verticalAlign")||"middle",d.x=w*c+n.cx,d.y=w*f+n.cy;var _=0;D==="radial"?_=F(-l)+(P?Math.PI:0):D==="tangential"?_=F(Math.PI/2-l)+(P?Math.PI:0):ve(D)&&(_=D*Math.PI/180),d.rotation=F(_)}),p.dirtyStyle()},i}(me),H="sunburstRootToNode",ne="sunburstHighlight",Le="sunburstUnhighlight",ke=function(s){function i(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=i.type,e}return X(i,s),i.prototype.render=function(e,t,a,o){var n=this;this.seriesModel=e,this.api=a,this.ecModel=t;var r=e.getData(),l=r.tree.root,c=e.getViewRoot(),f=this.group,u=e.get("renderLabelForZeroData"),p=[];c.eachNode(function(m){p.push(m)});var A=this._oldChildren||[];(function(m,b){if(m.length===0&&b.length===0)return;function g(h){return h.getId()}function v(h,M){(function(d,y){if(u||!d||d.getValue()||(d=null),d!==l&&y!==l){if(y&&y.piece)d?(y.piece.updateData(!1,d,e,t,a),r.setItemGraphicEl(d.dataIndex,y.piece)):function(w){w&&w.piece&&(f.remove(w.piece),w.piece=null)}(y);else if(d){var V=new ae(d,e,t,a);f.add(V),r.setItemGraphicEl(d.dataIndex,V)}}})(h==null?null:m[h],M==null?null:b[M])}new Me(b,m,g,g).add(v).update(v).remove(O(v,null)).execute()})(p,A),function(m,b){b.depth>0?(n.virtualPiece?n.virtualPiece.updateData(!1,m,e,t,a):(n.virtualPiece=new ae(m,e,t,a),f.add(n.virtualPiece)),b.piece.off("click"),n.virtualPiece.on("click",function(g){n._rootToNode(b.parentNode)})):n.virtualPiece&&(f.remove(n.virtualPiece),n.virtualPiece=null)}(l,c),this._initEvents(),this._oldChildren=p},i.prototype._initEvents=function(){var e=this;this.group.off("click"),this.group.on("click",function(t){var a=!1;e.seriesModel.getViewRoot().eachNode(function(o){if(!a&&o.piece&&o.piece===t.target){var n=o.getModel().get("nodeClick");if(n==="rootToNode")e._rootToNode(o);else if(n==="link"){var r=o.getModel(),l=r.get("link");if(l){var c=r.get("target",!0)||"_blank";be(l,c)}}a=!0}})})},i.prototype._rootToNode=function(e){e!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:H,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})},i.prototype.containPoint=function(e,t){var a=t.getData().getItemLayout(0);if(a){var o=e[0]-a.cx,n=e[1]-a.cy,r=Math.sqrt(o*o+n*n);return r<=a.r&&r>=a.r0}},i.type="sunburst",i}(Ie);function ie(s){var i=0;R(s.children,function(t){ie(t);var a=t.value;k(a)&&(a=a[0]),i+=a});var e=s.value;k(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=i),e<0&&(e=0),k(s.value)?s.value[0]=e:s.value=e}var $e=function(s){function i(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=i.type,e.ignoreStyleOnData=!0,e}return X(i,s),i.prototype.getInitialData=function(e,t){var a={name:e.name,children:e.data};ie(a);var o=this._levelModels=z(e.levels||[],function(r){return new we(r,this,t)},this),n=Se.createTree(a,this,function(r){r.wrapMethod("getItemModel",function(l,c){var f=n.getNodeByDataIndex(c),u=o[f.depth];return u&&(l.parentModel=u),l})});return n.data},i.prototype.optionUpdated=function(){this.resetViewRoot()},i.prototype.getDataParams=function(e){var t=s.prototype.getDataParams.apply(this,arguments),a=this.getData().tree.getNodeByDataIndex(e);return t.treePathInfo=Ne(a,this),t},i.prototype.getLevelModel=function(e){return this._levelModels&&this._levelModels[e.depth]},i.prototype.getViewRoot=function(){return this._viewRoot},i.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var t=this.getRawData().tree.root;e&&(e===t||t.contains(e))||(this._viewRoot=t)},i.prototype.enableAriaDecal=function(){Ce(this)},i.type="series.sunburst",i.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},i}(xe),re=Math.PI/180;function Ue(s,i,e){i.eachSeriesByType(s,function(t){var a=t.get("center"),o=t.get("radius");k(o)||(o=[0,o]),k(a)||(a=[a,a]);var n=e.getWidth(),r=e.getHeight(),l=Math.min(n,r),c=C(a[0],n),f=C(a[1],r),u=C(o[0],l/2),p=C(o[1],l/2),A=-t.get("startAngle")*re,m=t.get("minAngle")*re,b=t.getData().tree.root,g=t.getViewRoot(),v=g.depth,h=t.get("sort");h!=null&&oe(g,h);var M=0;R(g.children,function(I){!isNaN(I.getValue())&&M++});var d=g.getValue(),y=Math.PI/(d||M)*2,V=g.depth>0,w=g.height-(V?-1:1),N=(p-u)/(w||1),T=t.get("clockwise"),q=t.get("stillShowZeroSum"),L=T?1:-1,x=function(I,P){if(I){var _=P;if(I!==b){var le=I.getValue(),B=d===0&&q?y:le*y;B<m&&(B=m),_=P+L*B;var j=I.depth-v-(V?-1:1),J=u+N*j,Q=u+N*(j+1),E=t.getLevelModel(I);if(E){var W=E.get("r0",!0),Z=E.get("r",!0),G=E.get("radius",!0);G!=null&&(W=G[0],Z=G[1]),W!=null&&(J=C(W,l/2)),Z!=null&&(Q=C(Z,l/2))}I.setLayout({angle:B,startAngle:P,endAngle:_,clockwise:T,cx:c,cy:f,r0:J,r:Q})}if(I.children&&I.children.length){var Y=0;R(I.children,function(se){Y+=x(se,P+Y)})}return _-P}};if(V){var D=u,$=u+N,U=2*Math.PI;b.setLayout({angle:U,startAngle:A,endAngle:A+U,clockwise:T,cx:c,cy:f,r0:D,r:$})}x(g,A)})}function oe(s,i){var e=s.children||[];s.children=function(t,a){if(Ve(a)){var o=z(t,function(r,l){var c=r.getValue();return{params:{depth:r.depth,height:r.height,dataIndex:r.dataIndex,getValue:function(){return c}},index:l}});return o.sort(function(r,l){return a(r.params,l.params)}),z(o,function(r){return t[r.index]})}var n=a==="asc";return t.sort(function(r,l){var c=(r.getValue()-l.getValue())*(n?1:-1);return c===0?(r.dataIndex-l.dataIndex)*(n?-1:1):c})}(e,i),e.length&&R(s.children,function(t){oe(t,i)})}function Be(s){var i={};s.eachSeriesByType("sunburst",function(e){var t=e.getData(),a=t.tree;a.eachNode(function(o){var n=o.getModel().getModel("itemStyle").getItemStyle();n.fill||(n.fill=function(l,c,f){for(var u=l;u&&u.depth>1;)u=u.parentNode;var p=c.getColorFromPalette(u.name||u.dataIndex+"",i);return l.depth>1&&_e(p)&&(p=De(p,(l.depth-1)/(f-1)*.5)),p}(o,e,a.root.height));var r=t.ensureUniqueItemVisual(o.dataIndex,"style");S(r,n)})})}function Oe(s){s.registerChartView(ke),s.registerSeriesModel($e),s.registerLayout(O(Ue,"sunburst")),s.registerProcessor(O(Re,"sunburst")),s.registerVisual(Be),function(i){i.registerAction({type:H,update:"updateView"},function(e,t){t.eachComponent({mainType:"series",subType:"sunburst",query:e},function(a,o){var n=te(e,[H],a);if(n){var r=a.getViewRoot();r&&(e.direction=Te(r,n.node)?"rollUp":"drillDown"),a.resetViewRoot(n.node)}})}),i.registerAction({type:ne,update:"none"},function(e,t,a){e=S({},e),t.eachComponent({mainType:"series",subType:"sunburst",query:e},function(o){var n=te(e,[ne],o);n&&(e.dataIndex=n.node.dataIndex)}),a.dispatchAction(S(e,{type:"highlight"}))}),i.registerAction({type:Le,update:"updateView"},function(e,t,a){e=S({},e),a.dispatchAction(S(e,{type:"downplay"}))})}(s)}export{Oe as install};
