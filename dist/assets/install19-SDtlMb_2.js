import{e as U,aX as J,H as C,bP as Q,dz as E,as as W,a5 as Z,g as k,d8 as q,aN as K,j as Y,aP as $,bJ as tt,A as et,d as at,bL as it,ab as nt,bM as rt,al as st,bR as ot,bU as ht,bT as lt,c1 as gt,i as z,E as N}from"./index-CfHuJ7al.js";import{c as pt}from"./poly-BgswhOxL.js";import{t as ut}from"./LegendVisualProvider-B8AjwPa5.js";import{e as dt}from"./dataFilter-_M4AusE-.js";var ct=function(r){function o(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=o.type,t._layers=[],t}return U(o,r),o.prototype.render=function(t,u,l){var a=t.getData(),i=this,e=this.group,n=t.getLayerSeries(),c=a.getLayout("layoutInfo"),h=c.rect,g=c.boundaryGap;function d(m){return m.name}e.x=0,e.y=h.y+g[0];var D=new J(this._layersSeries||[],n,d,d),p=[];function f(m,v,L){var S=i._layers;if(m!=="remove"){for(var w,s,R=[],x=[],b=n[v].indices,y=0;y<b.length;y++){var I=a.getItemLayout(b[y]),_=I.x,O=I.y0,H=I.y;R.push(_,O),x.push(_,O+H),w=a.getItemVisual(b[y],"style")}var M=a.getItemLayout(b[0]),X=t.getModel("label").get("margin"),T=t.getModel("emphasis");if(m==="add"){var A=p[v]=new et;s=new pt({shape:{points:R,stackedOnPoints:x,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),A.add(s),e.add(A),t.isAnimationEnabled()&&s.setClipPath(function(P,j,F){var B=new at({shape:{x:P.x-10,y:P.y-10,width:0,height:P.height+20}});return it(B,{shape:{x:P.x-50,width:P.width+100,height:P.height+20}},j,F),B}(s.getBoundingRect(),t,function(){s.removeClipPath()}))}else A=S[L],s=A.childAt(0),e.add(A),p[v]=A,nt(s,{shape:{points:R,stackedOnPoints:x}},t),rt(s);st(s,ot(t),{labelDataIndex:b[y-1],defaultText:a.getName(b[y-1]),inheritColor:w.fill},{normal:{verticalAlign:"middle"}}),s.setTextConfig({position:null,local:!0});var V=s.getTextContent();V&&(V.x=M.x-X,V.y=M.y0+M.y/2),s.useStyle(w),a.setItemGraphicEl(v,s),ht(s,t),lt(s,T.get("focus"),T.get("blurScope"),T.get("disabled"))}else e.remove(S[v])}D.add(C(f,this,"add")).update(C(f,this,"update")).remove(C(f,this,"remove")).execute(),this._layersSeries=n,this._layers=p},o.type="themeRiver",o}(Q),ft=function(r){function o(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=o.type,t}return U(o,r),o.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new ut(C(this.getData,this),C(this.getRawData,this))},o.prototype.fixData=function(t){var u=t.length,l={},a=E(t,function(d){return l.hasOwnProperty(d[0]+"")||(l[d[0]+""]=-1),d[2]}),i=[];a.buckets.each(function(d,D){i.push({name:D,dataList:d})});for(var e=i.length,n=0;n<e;++n){for(var c=i[n].name,h=0;h<i[n].dataList.length;++h){var g=i[n].dataList[h][0]+"";l[g]=n}for(var g in l)l.hasOwnProperty(g)&&l[g]!==n&&(l[g]=n,t[u]=[g,0,c],u++)}return t},o.prototype.getInitialData=function(t,u){for(var l=this.getReferringComponents("singleAxis",W).models[0].get("type"),a=Z(t.data,function(D){return D[2]!==void 0}),i=this.fixData(a||[]),e=[],n=this.nameMap=k(),c=0,h=0;h<i.length;++h)e.push(i[h][2]),n.get(i[h][2])||(n.set(i[h][2],c),c++);var g=q(i,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:gt(l)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,d=new K(g,this);return d.initData(i),d},o.prototype.getLayerSeries=function(){for(var t=this.getData(),u=t.count(),l=[],a=0;a<u;++a)l[a]=a;var i=t.mapDimension("single"),e=E(l,function(c){return t.get("name",c)}),n=[];return e.buckets.each(function(c,h){c.sort(function(g,d){return t.get(i,g)-t.get(i,d)}),n.push({name:h,indices:c})}),n},o.prototype.getAxisTooltipData=function(t,u,l){Y(t)||(t=t?[t]:[]);for(var a,i=this.getData(),e=this.getLayerSeries(),n=[],c=e.length,h=0;h<c;++h){for(var g=Number.MAX_VALUE,d=-1,D=e[h].indices.length,p=0;p<D;++p){var f=i.get(t[0],e[h].indices[p]),m=Math.abs(f-u);m<=g&&(a=f,g=m,d=e[h].indices[p])}n.push(d)}return{dataIndices:n,nestestValue:a}},o.prototype.formatTooltip=function(t,u,l){var a=this.getData(),i=a.getName(t),e=a.get(a.mapDimension("value"),t);return $("nameValue",{name:i,value:e})},o.type="series.themeRiver",o.dependencies=["singleAxis"],o.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},o}(tt);function mt(r,o){r.eachSeriesByType("themeRiver",function(t){var u=t.getData(),l=t.coordinateSystem,a={},i=l.getRect();a.rect=i;var e=t.get("boundaryGap"),n=l.getAxis();a.boundaryGap=e,n.orient==="horizontal"?(e[0]=z(e[0],i.height),e[1]=z(e[1],i.height),G(u,t,i.height-e[0]-e[1])):(e[0]=z(e[0],i.width),e[1]=z(e[1],i.width),G(u,t,i.width-e[0]-e[1])),u.setLayout("layoutInfo",a)})}function G(r,o,t){if(r.count())for(var u,l=o.coordinateSystem,a=o.getLayerSeries(),i=r.mapDimension("single"),e=r.mapDimension("value"),n=N(a,function(m){return N(m.indices,function(v){var L=l.dataToPoint(r.get(i,v));return L[1]=r.get(e,v),L})}),c=function(m){for(var v=m.length,L=m[0].length,S=[],w=[],s=0,R=0;R<L;++R){for(var x=0,b=0;b<v;++b)x+=m[b][R][1];x>s&&(s=x),S.push(x)}for(var y=0;y<L;++y)w[y]=(s-S[y])/2;s=0;for(var I=0;I<L;++I){var _=S[I]+w[I];_>s&&(s=_)}return{y0:w,max:s}}(n),h=c.y0,g=t/c.max,d=a.length,D=a[0].indices.length,p=0;p<D;++p){u=h[p]*g,r.setItemLayout(a[0].indices[p],{layerIndex:0,x:n[0][p][0],y0:u,y:n[0][p][1]*g});for(var f=1;f<d;++f)u+=n[f-1][p][1]*g,r.setItemLayout(a[f].indices[p],{layerIndex:f,x:n[f][p][0],y0:u,y:n[f][p][1]*g})}}function Lt(r){r.registerChartView(ct),r.registerSeriesModel(ft),r.registerLayout(mt),r.registerProcessor(dt("themeRiver"))}export{Lt as install};
