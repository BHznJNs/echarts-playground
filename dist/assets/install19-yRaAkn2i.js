import{e as H,aW as k,H as O,bO as F,dy as E,ar as K,a4 as X,g as Z,dd as q,c0 as J,aM as Y,j as $,aO as tt,bI as et,y as at,c as nt,bK as it,aa as rt,bL as st,ak as ot,bQ as ht,bT as lt,bS as gt,h as P,E as N}from"./index-B3HKDY-B.js";import{c as pt}from"./poly-Dm-C3L66.js";import{t as ut}from"./LegendVisualProvider-B8AjwPa5.js";import{e as dt}from"./dataFilter-_M4AusE-.js";var ct=function(r){function o(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=o.type,t._layers=[],t}return H(o,r),o.prototype.render=function(t,u,l){var a=t.getData(),n=this,e=this.group,i=t.getLayerSeries(),c=a.getLayout("layoutInfo"),h=c.rect,g=c.boundaryGap;function d(f){return f.name}e.x=0,e.y=h.y+g[0];var D=new k(this._layersSeries||[],i,d,d),p=[];function y(f,v,L){var R=n._layers;if(f!=="remove"){for(var w,s,S=[],x=[],b=i[v].indices,m=0;m<b.length;m++){var I=a.getItemLayout(b[m]),C=I.x,z=I.y0,Q=I.y;S.push(C,z),x.push(C,z+Q),w=a.getItemVisual(b[m],"style")}var M=a.getItemLayout(b[0]),U=t.getModel("label").get("margin"),T=t.getModel("emphasis");if(f==="add"){var _=p[v]=new at;s=new pt({shape:{points:S,stackedOnPoints:x,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),_.add(s),e.add(_),t.isAnimationEnabled()&&s.setClipPath(function(A,W,j){var B=new nt({shape:{x:A.x-10,y:A.y-10,width:0,height:A.height+20}});return it(B,{shape:{x:A.x-50,width:A.width+100,height:A.height+20}},W,j),B}(s.getBoundingRect(),t,function(){s.removeClipPath()}))}else _=R[L],s=_.childAt(0),e.add(_),p[v]=_,rt(s,{shape:{points:S,stackedOnPoints:x}},t),st(s);ot(s,ht(t),{labelDataIndex:b[m-1],defaultText:a.getName(b[m-1]),inheritColor:w.fill},{normal:{verticalAlign:"middle"}}),s.setTextConfig({position:null,local:!0});var V=s.getTextContent();V&&(V.x=M.x-U,V.y=M.y0+M.y/2),s.useStyle(w),a.setItemGraphicEl(v,s),lt(s,t),gt(s,T.get("focus"),T.get("blurScope"),T.get("disabled"))}else e.remove(R[v])}D.add(O(y,this,"add")).update(O(y,this,"update")).remove(O(y,this,"remove")).execute(),this._layersSeries=i,this._layers=p},o.type="themeRiver",o}(F),yt=function(r){function o(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=o.type,t}return H(o,r),o.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new ut(O(this.getData,this),O(this.getRawData,this))},o.prototype.fixData=function(t){var u=t.length,l={},a=E(t,function(d){return l.hasOwnProperty(d[0]+"")||(l[d[0]+""]=-1),d[2]}),n=[];a.buckets.each(function(d,D){n.push({name:D,dataList:d})});for(var e=n.length,i=0;i<e;++i){for(var c=n[i].name,h=0;h<n[i].dataList.length;++h){var g=n[i].dataList[h][0]+"";l[g]=i}for(var g in l)l.hasOwnProperty(g)&&l[g]!==i&&(l[g]=i,t[u]=[g,0,c],u++)}return t},o.prototype.getInitialData=function(t,u){for(var l=this.getReferringComponents("singleAxis",K).models[0].get("type"),a=X(t.data,function(D){return D[2]!==void 0}),n=this.fixData(a||[]),e=[],i=this.nameMap=Z(),c=0,h=0;h<n.length;++h)e.push(n[h][2]),i.get(n[h][2])||(i.set(n[h][2],c),c++);var g=q(n,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:J(l)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,d=new Y(g,this);return d.initData(n),d},o.prototype.getLayerSeries=function(){for(var t=this.getData(),u=t.count(),l=[],a=0;a<u;++a)l[a]=a;var n=t.mapDimension("single"),e=E(l,function(c){return t.get("name",c)}),i=[];return e.buckets.each(function(c,h){c.sort(function(g,d){return t.get(n,g)-t.get(n,d)}),i.push({name:h,indices:c})}),i},o.prototype.getAxisTooltipData=function(t,u,l){$(t)||(t=t?[t]:[]);for(var a,n=this.getData(),e=this.getLayerSeries(),i=[],c=e.length,h=0;h<c;++h){for(var g=Number.MAX_VALUE,d=-1,D=e[h].indices.length,p=0;p<D;++p){var y=n.get(t[0],e[h].indices[p]),f=Math.abs(y-u);f<=g&&(a=y,g=f,d=e[h].indices[p])}i.push(d)}return{dataIndices:i,nestestValue:a}},o.prototype.formatTooltip=function(t,u,l){var a=this.getData(),n=a.getName(t),e=a.get(a.mapDimension("value"),t);return tt("nameValue",{name:n,value:e})},o.type="series.themeRiver",o.dependencies=["singleAxis"],o.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},o}(et);function ft(r,o){r.eachSeriesByType("themeRiver",function(t){var u=t.getData(),l=t.coordinateSystem,a={},n=l.getRect();a.rect=n;var e=t.get("boundaryGap"),i=l.getAxis();a.boundaryGap=e,i.orient==="horizontal"?(e[0]=P(e[0],n.height),e[1]=P(e[1],n.height),G(u,t,n.height-e[0]-e[1])):(e[0]=P(e[0],n.width),e[1]=P(e[1],n.width),G(u,t,n.width-e[0]-e[1])),u.setLayout("layoutInfo",a)})}function G(r,o,t){if(r.count())for(var u,l=o.coordinateSystem,a=o.getLayerSeries(),n=r.mapDimension("single"),e=r.mapDimension("value"),i=N(a,function(f){return N(f.indices,function(v){var L=l.dataToPoint(r.get(n,v));return L[1]=r.get(e,v),L})}),c=function(f){for(var v=f.length,L=f[0].length,R=[],w=[],s=0,S=0;S<L;++S){for(var x=0,b=0;b<v;++b)x+=f[b][S][1];x>s&&(s=x),R.push(x)}for(var m=0;m<L;++m)w[m]=(s-R[m])/2;s=0;for(var I=0;I<L;++I){var C=R[I]+w[I];C>s&&(s=C)}return{y0:w,max:s}}(i),h=c.y0,g=t/c.max,d=a.length,D=a[0].indices.length,p=0;p<D;++p){u=h[p]*g,r.setItemLayout(a[0].indices[p],{layerIndex:0,x:i[0][p][0],y0:u,y:i[0][p][1]*g});for(var y=1;y<d;++y)u+=i[y-1][p][1]*g,r.setItemLayout(a[y].indices[p],{layerIndex:y,x:i[y][p][0],y0:u,y:i[y][p][1]*g})}}function Lt(r){r.registerChartView(ct),r.registerSeriesModel(yt),r.registerLayout(ft),r.registerProcessor(dt("themeRiver"))}export{Lt as install};
