import{e as q,i as he,bV as pe,cs as ce,bP as ue,b as fe,aP as ge,bJ as ye,ab as O,dq as me,a8 as ve,de as xe,I as Ne,bU as _e,c7 as Ie,dC as Le,dh as Se,d9 as H,A as we,Z as Te,D as De}from"./index-B7p1rSoh.js";import{b as be}from"./Symbol-BJr7B5u5.js";import{f as Ee,p as Me,h as Ce,T as Re}from"./roamHelper-CzJXTZNH.js";import{f as Ae}from"./RoamController-DWRlbbTW.js";import{e as Pe}from"./cursorHelper-IgNoiH07.js";import{f as Be,p as Ye}from"./Tree-DTynipKO.js";import"./interactionMutex-BZTRNC-D.js";import"./linkSeriesData-DMzrFD1S.js";import"./labelHelper-CNBk1q-x.js";function Ge(t,o){var e=t.isExpand?t.children:[],n=t.parentNode.children,l=t.hierNode.i?n[t.hierNode.i-1]:null;if(e.length){(function(r){for(var a=r.children,p=a.length,i=0,d=0;--p>=0;){var h=a[p];h.hierNode.prelim+=i,h.hierNode.modifier+=i,d+=h.hierNode.change,i+=h.hierNode.shift+d}})(t);var s=(e[0].hierNode.prelim+e[e.length-1].hierNode.prelim)/2;l?(t.hierNode.prelim=l.hierNode.prelim+o(t,l),t.hierNode.modifier=t.hierNode.prelim-s):t.hierNode.prelim=s}else l&&(t.hierNode.prelim=l.hierNode.prelim+o(t,l));t.parentNode.hierNode.defaultAncestor=function(r,a,p,i){if(a){for(var d=r,h=r,c=h.parentNode.children[0],u=a,y=d.hierNode.modifier,g=h.hierNode.modifier,_=c.hierNode.modifier,v=u.hierNode.modifier;u=V(u),h=Z(h),u&&h;){d=V(d),c=Z(c),d.hierNode.ancestor=r;var m=u.hierNode.prelim+v-h.hierNode.prelim-g+i(u,h);m>0&&(ze(ke(u,r,p),r,m),g+=m,y+=m),v+=u.hierNode.modifier,g+=h.hierNode.modifier,y+=d.hierNode.modifier,_+=c.hierNode.modifier}u&&!V(d)&&(d.hierNode.thread=u,d.hierNode.modifier+=v-y),h&&!Z(c)&&(c.hierNode.thread=h,c.hierNode.modifier+=g-_,p=r)}return p}(t,l,t.parentNode.hierNode.defaultAncestor||n[0],o)}function Xe(t){var o=t.hierNode.prelim+t.parentNode.hierNode.modifier;t.setLayout({x:o},!0),t.hierNode.modifier+=t.parentNode.hierNode.modifier}function ee(t){return arguments.length?t:Oe}function B(t,o){return t-=Math.PI/2,{x:o*Math.cos(t),y:o*Math.sin(t)}}function V(t){var o=t.children;return o.length&&t.isExpand?o[o.length-1]:t.hierNode.thread}function Z(t){var o=t.children;return o.length&&t.isExpand?o[0]:t.hierNode.thread}function ke(t,o,e){return t.hierNode.ancestor.parentNode===o.parentNode?t.hierNode.ancestor:e}function ze(t,o,e){var n=e/(o.hierNode.i-t.hierNode.i);o.hierNode.change-=n,o.hierNode.shift+=e,o.hierNode.modifier+=e,o.hierNode.prelim+=e,t.hierNode.change+=n}function Oe(t,o){return t.parentNode===o.parentNode?1:2}var Ve=function(){this.parentPoint=[],this.childPoints=[]},Ze=function(t){function o(e){return t.call(this,e)||this}return q(o,t),o.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},o.prototype.getDefaultShape=function(){return new Ve},o.prototype.buildPath=function(e,n){var l=n.childPoints,s=l.length,r=n.parentPoint,a=l[0],p=l[s-1];if(s===1)return e.moveTo(r[0],r[1]),void e.lineTo(a[0],a[1]);var i=n.orient,d=i==="TB"||i==="BT"?0:1,h=1-d,c=he(n.forkPosition,1),u=[];u[d]=r[d],u[h]=r[h]+(p[h]-r[h])*c,e.moveTo(r[0],r[1]),e.lineTo(u[0],u[1]),e.moveTo(a[0],a[1]),u[d]=a[d],e.lineTo(u[0],u[1]),u[d]=p[d],e.lineTo(u[0],u[1]),e.lineTo(p[0],p[1]);for(var y=1;y<s-1;y++){var g=l[y];e.moveTo(g[0],g[1]),u[d]=g[d],e.lineTo(u[0],u[1])}},o}(pe);function te(t,o){var e=t.getItemLayout(o);return e&&!isNaN(e.x)&&!isNaN(e.y)}function oe(t,o,e,n,l){var s=!e,r=t.tree.getNodeByDataIndex(o),a=r.getModel(),p=r.getVisual("style").fill,i=r.isExpand===!1&&r.children.length!==0?p:"#fff",d=t.tree.root,h=r.parentNode===d?r:r.parentNode||r,c=t.getItemGraphicEl(h.dataIndex),u=h.getLayout(),y=c?{x:c.__oldX,y:c.__oldY,rawX:c.__radialOldRawX,rawY:c.__radialOldRawY}:u,g=r.getLayout();s?((e=new be(t,o,null,{symbolInnerColor:i,useNameLabel:!0})).x=y.x,e.y=y.y):e.updateData(t,o,null,{symbolInnerColor:i,useNameLabel:!0}),e.__radialOldRawX=e.__radialRawX,e.__radialOldRawY=e.__radialRawY,e.__radialRawX=g.rawX,e.__radialRawY=g.rawY,n.add(e),t.setItemGraphicEl(o,e),e.__oldX=e.x,e.__oldY=e.y,O(e,{x:g.x,y:g.y},l);var _=e.getSymbolPath();if(l.get("layout")==="radial"){var v=d.children[0],m=v.getLayout(),D=v.children.length,x=void 0,S=void 0;if(g.x===m.x&&r.isExpand===!0&&v.children.length){var f={x:(v.children[0].getLayout().x+v.children[D-1].getLayout().x)/2,y:(v.children[0].getLayout().y+v.children[D-1].getLayout().y)/2};(x=Math.atan2(f.y-m.y,f.x-m.x))<0&&(x=2*Math.PI+x),(S=f.x<m.x)&&(x-=Math.PI)}else(x=Math.atan2(g.y-m.y,g.x-m.x))<0&&(x=2*Math.PI+x),r.children.length===0||r.children.length!==0&&r.isExpand===!1?(S=g.x<m.x)&&(x-=Math.PI):(S=g.x>m.x)||(x-=Math.PI);var N=S?"left":"right",M=a.getModel("label"),I=M.get("rotate"),C=I*(Math.PI/180),b=_.getTextContent();b&&(_.setTextConfig({position:M.get("position")||N,rotation:I==null?-x:C,origin:"center"}),b.setStyle("verticalAlign","middle"))}var w=a.get(["emphasis","focus"]),A=w==="relative"?me(r.getAncestorsIndices(),r.getDescendantIndices()):w==="ancestor"?r.getAncestorsIndices():w==="descendant"?r.getDescendantIndices():null;A&&(ve(e).focus=A),function(E,L,F,Y,W,ie,R,de){var J=L.getModel(),G=E.get("edgeShape"),X=E.get("layout"),k=E.getOrient(),j=E.get(["lineStyle","curveness"]),le=E.get("edgeForkPosition"),se=J.getModel("lineStyle").getLineStyle(),T=Y.__edge;if(G==="curve")L.parentNode&&L.parentNode!==F&&(T||(T=Y.__edge=new xe({shape:U(X,k,j,W,W)})),O(T,{shape:U(X,k,j,ie,R)},E));else if(G==="polyline"&&X==="orthogonal"&&L!==F&&L.children&&L.children.length!==0&&L.isExpand===!0){for(var Q=L.children,K=[],z=0;z<Q.length;z++){var $=Q[z].getLayout();K.push([$.x,$.y])}T||(T=Y.__edge=new Ze({shape:{parentPoint:[R.x,R.y],childPoints:[[R.x,R.y]],orient:k,forkPosition:le}})),O(T,{shape:{parentPoint:[R.x,R.y],childPoints:K}},E)}T&&(G!=="polyline"||L.isExpand)&&(T.useStyle(Ne({strokeNoScale:!0,fill:null},se)),_e(T,J,"lineStyle"),Ie(T),de.add(T))}(l,r,d,e,y,u,g,n),e.__edge&&(e.onHoverStateChange=function(E){if(E!=="blur"){var L=r.parentNode&&t.getItemGraphicEl(r.parentNode.dataIndex);L&&L.hoverState===Le||Se(e.__edge,E)}})}function re(t,o,e,n,l){var s=ne(o.tree.root,t),r=s.source,a=s.sourceLayout,p=o.getItemGraphicEl(t.dataIndex);if(p){var i=o.getItemGraphicEl(r.dataIndex).__edge,d=p.__edge||(r.isExpand===!1||r.children.length===1?i:void 0),h=n.get("edgeShape"),c=n.get("layout"),u=n.get("orient"),y=n.get(["lineStyle","curveness"]);d&&(h==="curve"?H(d,{shape:U(c,u,y,a,a),style:{opacity:0}},n,{cb:function(){e.remove(d)},removeOpt:l}):h==="polyline"&&n.get("layout")==="orthogonal"&&H(d,{shape:{parentPoint:[a.x,a.y],childPoints:[[a.x,a.y]]},style:{opacity:0}},n,{cb:function(){e.remove(d)},removeOpt:l}))}}function ne(t,o){for(var e,n=o.parentNode===t?o:o.parentNode||o;(e=n.getLayout())==null;)n=n.parentNode===t?n:n.parentNode||n;return{source:n,sourceLayout:e}}function ae(t,o,e,n,l){var s=t.tree.getNodeByDataIndex(o),r=ne(t.tree.root,s).sourceLayout,a={duration:l.get("animationDurationUpdate"),easing:l.get("animationEasingUpdate")};H(e,{x:r.x+1,y:r.y+1},l,{cb:function(){n.remove(e),t.setItemGraphicEl(o,null)},removeOpt:a}),e.fadeOut(null,t.hostModel,{fadeLabel:!0,animation:a}),s.children.forEach(function(p){re(p,t,n,l,a)}),re(s,t,n,l,a)}function U(t,o,e,n,l){var s,r,a,p,i,d,h,c;if(t==="radial"){i=n.rawX,h=n.rawY,d=l.rawX,c=l.rawY;var u=B(i,h),y=B(i,h+(c-h)*e),g=B(d,c+(h-c)*e),_=B(d,c);return{x1:u.x||0,y1:u.y||0,x2:_.x||0,y2:_.y||0,cpx1:y.x||0,cpy1:y.y||0,cpx2:g.x||0,cpy2:g.y||0}}return i=n.x,h=n.y,d=l.x,c=l.y,o!=="LR"&&o!=="RL"||(s=i+(d-i)*e,r=h,a=d+(i-d)*e,p=c),o!=="TB"&&o!=="BT"||(s=i,r=h+(c-h)*e,a=d,p=c+(h-c)*e),{x1:i,y1:h,x2:d,y2:c,cpx1:s,cpy1:r,cpx2:a,cpy2:p}}var He=function(t){function o(){var e=t!==null&&t.apply(this,arguments)||this;return e.type=o.type,e._mainGroup=new we,e}return q(o,t),o.prototype.init=function(e,n){this._controller=new Ae(n.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},o.prototype.render=function(e,n,l){var s=e.getData(),r=e.layoutInfo,a=this._mainGroup;e.get("layout")==="radial"?(a.x=r.x+r.width/2,a.y=r.y+r.height/2):(a.x=r.x,a.y=r.y),this._updateViewCoordSys(e,l),this._updateController(e,n,l);var p=this._data;s.diff(p).add(function(i){te(s,i)&&oe(s,i,null,a,e)}).update(function(i,d){var h=p.getItemGraphicEl(d);te(s,i)?oe(s,i,h,a,e):h&&ae(p,d,h,a,e)}).remove(function(i){var d=p.getItemGraphicEl(i);d&&ae(p,i,d,a,e)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),e.get("expandAndCollapse")===!0&&s.eachItemGraphicEl(function(i,d){i.off("click").on("click",function(){l.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:d})})}),this._data=s},o.prototype._updateViewCoordSys=function(e,n){var l=e.getData(),s=[];l.each(function(h){var c=l.getItemLayout(h);!c||isNaN(c.x)||isNaN(c.y)||s.push([+c.x,+c.y])});var r=[],a=[];ce(s,r,a);var p=this._min,i=this._max;a[0]-r[0]==0&&(r[0]=p?p[0]:r[0]-1,a[0]=i?i[0]:a[0]+1),a[1]-r[1]==0&&(r[1]=p?p[1]:r[1]-1,a[1]=i?i[1]:a[1]+1);var d=e.coordinateSystem=new Ee;d.zoomLimit=e.get("scaleLimit"),d.setBoundingRect(r[0],r[1],a[0]-r[0],a[1]-r[1]),d.setCenter(e.get("center"),n),d.setZoom(e.get("zoom")),this.group.attr({x:d.x,y:d.y,scaleX:d.scaleX,scaleY:d.scaleY}),this._min=r,this._max=a},o.prototype._updateController=function(e,n,l){var s=this,r=this._controller,a=this._controllerHost,p=this.group;r.setPointerChecker(function(i,d,h){var c=p.getBoundingRect();return c.applyTransform(p.transform),c.contain(d,h)&&!Pe(i,l,e)}),r.enable(e.get("roam")),a.zoomLimit=e.get("scaleLimit"),a.zoom=e.coordinateSystem.getZoom(),r.off("pan").off("zoom").on("pan",function(i){Me(a,i.dx,i.dy),l.dispatchAction({seriesId:e.id,type:"treeRoam",dx:i.dx,dy:i.dy})}).on("zoom",function(i){Ce(a,i.scale,i.originX,i.originY),l.dispatchAction({seriesId:e.id,type:"treeRoam",zoom:i.scale,originX:i.originX,originY:i.originY}),s._updateNodeAndLinkScale(e),l.updateLabelLayout()})},o.prototype._updateNodeAndLinkScale=function(e){var n=e.getData(),l=this._getNodeGlobalScale(e);n.eachItemGraphicEl(function(s,r){s.setSymbolScale(l)})},o.prototype._getNodeGlobalScale=function(e){var n=e.coordinateSystem;if(n.type!=="view")return 1;var l=this._nodeScaleRatio,s=n.scaleX||1;return((n.getZoom()-1)*l+1)/s},o.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},o.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},o.type="tree",o}(ue),Ue=function(t){function o(){var e=t!==null&&t.apply(this,arguments)||this;return e.hasSymbolVisual=!0,e.ignoreStyleOnData=!0,e}return q(o,t),o.prototype.getInitialData=function(e){var n={name:e.name,children:e.data},l=e.leaves||{},s=new fe(l,this,this.ecModel),r=Be.createTree(n,this,function(i){i.wrapMethod("getItemModel",function(d,h){var c=r.getNodeByDataIndex(h);return c&&c.children.length&&c.isExpand||(d.parentModel=s),d})}),a=0;r.eachNode("preorder",function(i){i.depth>a&&(a=i.depth)});var p=e.expandAndCollapse&&e.initialTreeDepth>=0?e.initialTreeDepth:a;return r.root.eachNode("preorder",function(i){var d=i.hostTree.data.getRawDataItem(i.dataIndex);i.isExpand=d&&d.collapsed!=null?!d.collapsed:i.depth<=p}),r.data},o.prototype.getOrient=function(){var e=this.get("orient");return e==="horizontal"?e="LR":e==="vertical"&&(e="TB"),e},o.prototype.setZoom=function(e){this.option.zoom=e},o.prototype.setCenter=function(e){this.option.center=e},o.prototype.formatTooltip=function(e,n,l){for(var s=this.getData().tree,r=s.root.children[0],a=s.getNodeByDataIndex(e),p=a.getValue(),i=a.name;a&&a!==r;)i=a.parentNode.name+"."+i,a=a.parentNode;return ge("nameValue",{name:i,value:p,noValue:isNaN(p)||p==null})},o.prototype.getDataParams=function(e){var n=t.prototype.getDataParams.apply(this,arguments),l=this.getData().tree.getNodeByDataIndex(e);return n.treeAncestors=Ye(l,this),n.collapsed=!l.isExpand,n},o.type="series.tree",o.layoutMode="box",o.defaultOption={z:2,coordinateSystem:"view",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:"#ccc",width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},o}(ye);function P(t,o){for(var e,n=[t];e=n.pop();)if(o(e),e.isExpand){var l=e.children;if(l.length)for(var s=l.length-1;s>=0;s--)n.push(l[s])}}function qe(t,o){t.eachSeriesByType("tree",function(e){(function(n,l){var s=function(f,N){return Te(f.getBoxLayoutParams(),{width:N.getWidth(),height:N.getHeight()})}(n,l);n.layoutInfo=s;var r=n.get("layout"),a=0,p=0,i=null;r==="radial"?(a=2*Math.PI,p=Math.min(s.height,s.width)/2,i=ee(function(f,N){return(f.parentNode===N.parentNode?1:2)/f.depth})):(a=s.width,p=s.height,i=ee());var d=n.getData().tree.root,h=d.children[0];if(h){(function(f){var N=f;N.hierNode={defaultAncestor:null,ancestor:N,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var M,I,C=[N];M=C.pop();)if(I=M.children,M.isExpand&&I.length)for(var b=I.length-1;b>=0;b--){var w=I[b];w.hierNode={defaultAncestor:null,ancestor:w,prelim:0,modifier:0,change:0,shift:0,i:b,thread:null},C.push(w)}})(d),function(f,N,M){for(var I,C=[f],b=[];I=C.pop();)if(b.push(I),I.isExpand){var w=I.children;if(w.length)for(var A=0;A<w.length;A++)C.push(w[A])}for(;I=b.pop();)N(I,M)}(h,Ge,i),d.hierNode.modifier=-h.hierNode.prelim,P(h,Xe);var c=h,u=h,y=h;P(h,function(f){var N=f.getLayout().x;N<c.getLayout().x&&(c=f),N>u.getLayout().x&&(u=f),f.depth>y.depth&&(y=f)});var g=c===u?1:i(c,u)/2,_=g-c.getLayout().x,v=0,m=0,D=0,x=0;if(r==="radial")v=a/(u.getLayout().x+g+_),m=p/(y.depth-1||1),P(h,function(f){D=(f.getLayout().x+_)*v,x=(f.depth-1)*m;var N=B(D,x);f.setLayout({x:N.x,y:N.y,rawX:D,rawY:x},!0)});else{var S=n.getOrient();S==="RL"||S==="LR"?(m=p/(u.getLayout().x+g+_),v=a/(y.depth-1||1),P(h,function(f){x=(f.getLayout().x+_)*m,D=S==="LR"?(f.depth-1)*v:a-(f.depth-1)*v,f.setLayout({x:D,y:x},!0)})):S!=="TB"&&S!=="BT"||(v=a/(u.getLayout().x+g+_),m=p/(y.depth-1||1),P(h,function(f){D=(f.getLayout().x+_)*v,x=S==="TB"?(f.depth-1)*m:p-(f.depth-1)*m,f.setLayout({x:D,y:x},!0)}))}}})(e,o)})}function Fe(t){t.eachSeriesByType("tree",function(o){var e=o.getData();e.tree.eachNode(function(n){var l=n.getModel().getModel("itemStyle").getItemStyle(),s=e.ensureUniqueItemVisual(n.dataIndex,"style");De(s,l)})})}function rt(t){t.registerChartView(He),t.registerSeriesModel(Ue),t.registerLayout(qe),t.registerVisual(Fe),function(o){o.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(e,n){n.eachComponent({mainType:"series",subType:"tree",query:e},function(l){var s=e.dataIndex,r=l.getData().tree.getNodeByDataIndex(s);r.isExpand=!r.isExpand})}),o.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(e,n,l){n.eachComponent({mainType:"series",subType:"tree",query:e},function(s){var r=s.coordinateSystem,a=Re(r,e,void 0,l);s.setCenter&&s.setCenter(a.center),s.setZoom&&s.setZoom(a.zoom)})})}(t)}export{rt as install};
