import{f as ft,p as Qe,d as _e,u as je,h as vt}from"./Tree-HKvtTjAA.js";import{e as et,_ as We,N as U,E as yt,b as ye,aO as mt,D as le,g as xt,bI as wt,db as bt,R as tt,O as It,aW as _t,a1 as ot,y as pe,H as me,z as ge,aq as ke,c_ as Mt,aV as St,bO as Tt,x as Ct,j as he,dC as Ee,bA as de,dD as Ge,a7 as Ie,c6 as ze,a5 as it,ak as Rt,bQ as Lt,dE as Dt,ae as Nt,U as He,aE as Vt,cN as rt,cO as At,Z as Wt,h as Ze,dF as Oe,a4 as kt,a9 as Et,dG as Gt,A as zt,I as Ht,d as Zt,w as qe,dr as fe,bS as Ot,aK as qt,c as Bt}from"./index-B3HKDY-B.js";import{a as Ut}from"./enableAriaDecalForTree-D7WJkrgz.js";import{f as Ft}from"./RoamController-rbEyhm6E.js";import{D as Pt}from"./VisualMapping-DFmadKjM.js";import"./linkSeriesData-CBqbv7hX.js";import"./interactionMutex-Bs7cRZ9p.js";var Be=["treemapZoomToNode","treemapRender","treemapMove"];function at(i){var t=0;U(i.children,function(o){at(o);var r=o.value;he(r)&&(r=r[0]),t+=r});var e=i.value;he(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),he(i.value)?i.value[0]=e:i.value=e}var Xt=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventUsingHoverLayer=!0,e}return et(t,i),t.prototype.getInitialData=function(e,o){var r={name:e.name,children:e.data};at(r);var a=e.levels||[],n=this.designatedVisualItemStyle={},l=new ye({itemStyle:n},this,o);a=e.levels=function(c,x){var M,u,g=We(x.get("color")),d=We(x.get(["aria","decal","decals"]));if(g){c=c||[],U(c,function(v){var w=new ye(v),f=w.get("color"),y=w.get("decal");(w.get(["itemStyle","color"])||f&&f!=="none")&&(M=!0),(w.get(["itemStyle","decal"])||y&&y!=="none")&&(u=!0)});var p=c[0]||(c[0]={});return M||(p.color=g.slice()),!u&&d&&(p.decal=d.slice()),c}}(a,o);var s=yt(a||[],function(c){return new ye(c,l,o)},this),h=ft.createTree(r,this,function(c){c.wrapMethod("getItemModel",function(x,M){var u=h.getNodeByDataIndex(M),g=u?s[u.depth]:null;return x.parentModel=g||l,x})});return h.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.formatTooltip=function(e,o,r){var a=this.getData(),n=this.getRawValue(e),l=a.getName(e);return mt("nameValue",{name:l,value:n})},t.prototype.getDataParams=function(e){var o=i.prototype.getDataParams.apply(this,arguments),r=this.getData().tree.getNodeByDataIndex(e);return o.treeAncestors=Qe(r,this),o.treePathInfo=o.treeAncestors,o},t.prototype.setLayoutInfo=function(e){this.layoutInfo=this.layoutInfo||{},le(this.layoutInfo,e)},t.prototype.mapIdToIndex=function(e){var o=this._idIndexMap;o||(o=this._idIndexMap=xt(),this._idIndexMapCount=0);var r=o.get(e);return r==null&&o.set(e,r=this._idIndexMapCount++),r},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var o=this.getRawData().tree.root;e&&(e===o||o.contains(e))||(this._viewRoot=o)},t.prototype.enableAriaDecal=function(){Ut(this)},t.type="series.treemap",t.layoutMode="box",t.defaultOption={progressive:0,left:"center",top:"middle",width:"80%",height:"80%",sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"â–¶",zoomToNodeRatio:.1024,roam:!0,nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{color:"rgba(0,0,0,0.7)",textStyle:{color:"#fff"}},emphasis:{itemStyle:{color:"rgba(0,0,0,0.9)"}}},label:{show:!0,distance:0,padding:5,position:"inside",color:"#fff",overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],overflow:"truncate",verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},t}(wt);function Yt(i,t,e,o,r,a){var n=[[r?i:i-5,t],[i+e,t],[i+e,t+o],[r?i:i-5,t+o]];return!a&&n.splice(2,0,[i+e+5,t+o/2]),!r&&n.push([i,t+o/2]),n}function $t(i,t,e){Ie(i).eventData={componentType:"series",componentSubType:"treemap",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:e&&e.dataIndex,name:e&&e.name},treePathInfo:e&&Qe(e,t)}}var Jt=function(){function i(t){this.group=new pe,t.add(this.group)}return i.prototype.render=function(t,e,o,r){var a=t.getModel("breadcrumb"),n=this.group;if(n.removeAll(),a.get("show")&&o){var l=a.getModel("itemStyle"),s=a.getModel("emphasis"),h=l.getModel("textStyle"),c=s.getModel(["itemStyle","textStyle"]),x={pos:{left:a.get("left"),right:a.get("right"),top:a.get("top"),bottom:a.get("bottom")},box:{width:e.getWidth(),height:e.getHeight()},emptyItemWidth:a.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(o,x,h),this._renderContent(t,x,l,s,h,c,r),Et(n,x.pos,x.box)}},i.prototype._prepare=function(t,e,o){for(var r=t;r;r=r.parentNode){var a=it(r.getModel().get("name"),""),n=o.getTextRect(a),l=Math.max(n.width+16,e.emptyItemWidth);e.totalWidth+=l+8,e.renderList.push({node:r,text:a,width:l})}},i.prototype._renderContent=function(t,e,o,r,a,n,l){for(var s=0,h=e.emptyItemWidth,c=t.get(["breadcrumb","height"]),x=Gt(e.pos,e.box),M=e.totalWidth,u=e.renderList,g=r.getModel("itemStyle").getItemStyle(),d=u.length-1;d>=0;d--){var p=u[d],v=p.node,w=p.width,f=p.text;M>x.width&&(M-=w-h,w=h,f=null);var y=new zt({shape:{points:Yt(s,0,w,c,d===u.length-1,d===0)},style:Ht(o.getItemStyle(),{lineJoin:"bevel"}),textContent:new Zt({style:qe(a,{text:f})}),textConfig:{position:"inside"},z2:1e4*fe,onclick:ot(l,v)});y.disableLabelAnimation=!0,y.getTextContent().ensureState("emphasis").style=qe(n,{text:f}),y.ensureState("emphasis").style=g,Ot(y,r.get("focus"),r.get("blurScope"),r.get("disabled")),this.group.add(y),$t(y,t,v),s+=w+8}},i.prototype.remove=function(){this.group.removeAll()},i}(),Kt=function(){function i(){this._storage=[],this._elExistsMap={}}return i.prototype.add=function(t,e,o,r,a){return!this._elExistsMap[t.id]&&(this._elExistsMap[t.id]=!0,this._storage.push({el:t,target:e,duration:o,delay:r,easing:a}),!0)},i.prototype.finished=function(t){return this._finishedCallback=t,this},i.prototype.start=function(){for(var t=this,e=this._storage.length,o=function(){--e<=0&&(t._storage.length=0,t._elExistsMap={},t._finishedCallback&&t._finishedCallback())},r=0,a=this._storage.length;r<a;r++){var n=this._storage[r];n.el.animateTo(n.target,{duration:n.duration,delay:n.delay,easing:n.easing,setToFinal:!0,done:o,aborted:o})}return this},i}(),xe=pe,Ue=Bt,Fe="label",Pe="upperLabel",Qt=10*fe,jt=2*fe,eo=3*fe,re=bt([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),Xe=function(i){var t=re(i);return t.stroke=t.fill=t.lineWidth=null,t},ue=tt(),to=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._state="ready",e._storage={nodeGroup:[],background:[],content:[]},e}return et(t,i),t.prototype.render=function(e,o,r,a){var n=o.findComponents({mainType:"series",subType:"treemap",query:a});if(!(It(n,e)<0)){this.seriesModel=e,this.api=r,this.ecModel=o;var l=_e(a,["treemapZoomToNode","treemapRootToNode"],e),s=a&&a.type,h=e.layoutInfo,c=!this._oldTree,x=this._storage,M=s==="treemapRootToNode"&&l&&x?{rootNodeGroup:x.nodeGroup[l.node.getRawIndex()],direction:a.direction}:null,u=this._giveContainerGroup(h),g=e.get("animation"),d=this._doRender(u,e,M);!g||c||s&&s!=="treemapZoomToNode"&&s!=="treemapRootToNode"?d.renderFinally():this._doAnimation(u,d,e,M),this._resetController(r),this._renderBreadcrumb(e,r,l)}},t.prototype._giveContainerGroup=function(e){var o=this._containerGroup;return o||(o=this._containerGroup=new xe,this._initEvents(o),this.group.add(o)),o.x=e.x,o.y=e.y,o},t.prototype._doRender=function(e,o,r){var a=o.getData().tree,n=this._oldTree,l={nodeGroup:[],background:[],content:[]},s={nodeGroup:[],background:[],content:[]},h=this._storage,c=[];function x(u,g,d,p){return function(v,w,f,y,S,T,b,R,C,N){if(!b)return;var I=b.getLayout(),O=v.getData(),E=b.getModel();if(O.setItemGraphicEl(b.dataIndex,null),!I||!I.isInView)return;var F=I.width,A=I.height,H=I.borderWidth,ee=I.invisible,$=b.getRawIndex(),J=R&&R.getRawIndex(),ie=b.viewChildren,oe=I.upperHeight,X=ie&&ie.length,G=E.getModel("itemStyle"),Z=E.getModel(["emphasis","itemStyle"]),q=E.getModel(["blur","itemStyle"]),B=E.getModel(["select","itemStyle"]),ae=G.get("borderRadius")||0,_=ve("nodeGroup",xe);if(!_)return;if(C.add(_),_.x=I.x||0,_.y=I.y||0,_.markRedraw(),ue(_).nodeWidth=F,ue(_).nodeHeight=A,I.isAboveViewRoot)return _;var z=ve("background",Ue,N,jt);z&&ht(_,z,X&&I.upperLabelHeight);var K=E.getModel("emphasis"),Q=K.get("focus"),Se=K.get("blurScope"),Te=K.get("disabled"),Ce=Q==="ancestor"?b.getAncestorsIndices():Q==="descendant"?b.getDescendantIndices():Q;if(X)Ee(_)&&de(_,!1),z&&(de(z,!Te),O.setItemGraphicEl(b.dataIndex,z),Ge(z,Ce,Se));else{var Re=ve("content",Ue,N,eo);Re&&pt(_,Re),z.disableMorphing=!0,z&&Ee(z)&&de(z,!1),de(_,!Te),O.setItemGraphicEl(b.dataIndex,_),Ge(_,Ce,Se)}return _;function ht(L,m,W){var D=Ie(m);if(D.dataIndex=b.dataIndex,D.seriesIndex=v.seriesIndex,m.setShape({x:0,y:0,width:F,height:A,r:ae}),ee)Le(m);else{m.invisible=!1;var k=b.getVisual("style"),P=k.stroke,Y=Xe(G);Y.fill=P;var V=re(Z);V.fill=Z.get("borderColor");var j=re(q);j.fill=q.get("borderColor");var te=re(B);if(te.fill=B.get("borderColor"),W){var ne=F-2*H;De(m,P,k.opacity,{x:H,y:0,width:ne,height:oe})}else m.removeTextContent();m.setStyle(Y),m.ensureState("emphasis").style=V,m.ensureState("blur").style=j,m.ensureState("select").style=te,ze(m)}L.add(m)}function pt(L,m){var W=Ie(m);W.dataIndex=b.dataIndex,W.seriesIndex=v.seriesIndex;var D=Math.max(F-2*H,0),k=Math.max(A-2*H,0);if(m.culling=!0,m.setShape({x:H,y:H,width:D,height:k,r:ae}),ee)Le(m);else{m.invisible=!1;var P=b.getVisual("style"),Y=P.fill,V=Xe(G);V.fill=Y,V.decal=P.decal;var j=re(Z),te=re(q),ne=re(B);De(m,Y,P.opacity,null),m.setStyle(V),m.ensureState("emphasis").style=j,m.ensureState("blur").style=te,m.ensureState("select").style=ne,ze(m)}L.add(m)}function Le(L){!L.invisible&&T.push(L)}function De(L,m,W,D){var k=E.getModel(D?Pe:Fe),P=it(E.get("name"),null),Y=k.getShallow("show");Rt(L,Lt(E,D?Pe:Fe),{defaultText:Y?P:null,inheritColor:m,defaultOpacity:W,labelFetcher:v,labelDataIndex:b.dataIndex});var V=L.getTextContent();if(V){var j=V.style,te=Dt(j.padding||0);D&&(L.setTextConfig({layoutRect:D}),V.disableLabelLayout=!0),V.beforeUpdate=function(){var Ve=Math.max((D?D.width:L.shape.width)-te[1]-te[3],0),Ae=Math.max((D?D.height:L.shape.height)-te[0]-te[2],0);j.width===Ve&&j.height===Ae||V.setStyle({width:Ve,height:Ae})},j.truncateMinChar=2,j.lineOverflow="truncate",Ne(j,D,I);var ne=V.getState("emphasis");Ne(ne?ne.style:null,D,I)}}function Ne(L,m,W){var D=L?L.text:null;if(!m&&W.isLeafRoot&&D!=null){var k=v.get("drillDownIcon",!0);L.text=k?k+" "+D:D}}function ve(L,m,W,D){var k=J!=null&&f[L][J],P=S[L];return k?(f[L][J]=null,gt(P,k)):ee||((k=new m)instanceof Nt&&(k.z2=function(Y,V){return Y*Qt+V}(W,D)),ct(P,k)),w[L][$]=k}function gt(L,m){var W=L[$]={};m instanceof xe?(W.oldX=m.x,W.oldY=m.y):W.oldShape=le({},m.shape)}function ct(L,m){var W=L[$]={},D=b.parentNode,k=m instanceof pe;if(D&&(!y||y.direction==="drillDown")){var P=0,Y=0,V=S.background[D.getRawIndex()];!y&&V&&V.oldShape&&(P=V.oldShape.width,Y=V.oldShape.height),k?(W.oldX=0,W.oldY=Y):W.oldShape={x:P,y:Y,width:0,height:0}}W.fadein=!k}}(o,s,h,r,l,c,u,g,d,p)}(function u(g,d,p,v,w){v?(d=g,U(g,function(S,T){!S.isRemoved()&&y(T,T)})):new _t(d,g,f,f).add(y).update(y).remove(ot(y,null)).execute();function f(S){return S.getId()}function y(S,T){var b=S!=null?g[S]:null,R=T!=null?d[T]:null,C=x(b,R,p,w);C&&u(b&&b.viewChildren||[],R&&R.viewChildren||[],C,v,w+1)}})(a.root?[a.root]:[],n&&n.root?[n.root]:[],e,a===n||!n,0);var M=function(u){var g={nodeGroup:[],background:[],content:[]};return u&&U(u,function(d,p){var v=g[p];U(d,function(w){w&&(v.push(w),ue(w).willDelete=!0)})}),g}(h);return this._oldTree=a,this._storage=s,{lastsForAnimation:l,willDeleteEls:M,renderFinally:function(){U(M,function(u){U(u,function(g){g.parent&&g.parent.remove(g)})}),U(c,function(u){u.invisible=!0,u.dirty()})}}},t.prototype._doAnimation=function(e,o,r,a){var n=r.get("animationDurationUpdate"),l=r.get("animationEasing"),s=(He(n)?0:n)||0,h=(He(l)?null:l)||"cubicOut",c=new Kt;U(o.willDeleteEls,function(x,M){U(x,function(u,g){if(!u.invisible){var d,p=u.parent,v=ue(p);if(a&&a.direction==="drillDown")d=p===a.rootNodeGroup?{shape:{x:0,y:0,width:v.nodeWidth,height:v.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var w=0,f=0;v.willDelete||(w=v.nodeWidth/2,f=v.nodeHeight/2),d=M==="nodeGroup"?{x:w,y:f,style:{opacity:0}}:{shape:{x:w,y:f,width:0,height:0},style:{opacity:0}}}d&&c.add(u,d,s,0,h)}})}),U(this._storage,function(x,M){U(x,function(u,g){var d=o.lastsForAnimation[M][g],p={};d&&(u instanceof pe?d.oldX!=null&&(p.x=u.x,p.y=u.y,u.x=d.oldX,u.y=d.oldY):(d.oldShape&&(p.shape=le({},u.shape),u.setShape(d.oldShape)),d.fadein?(u.setStyle("opacity",0),p.style={opacity:1}):u.style.opacity!==1&&(p.style={opacity:1})),c.add(u,p,s,0,h))})},this),this._state="animating",c.finished(me(function(){this._state="ready",o.renderFinally()},this)).start()},t.prototype._resetController=function(e){var o=this._controller;o||((o=this._controller=new Ft(e.getZr())).enable(this.seriesModel.get("roam")),o.on("pan",me(this._onPan,this)),o.on("zoom",me(this._onZoom,this)));var r=new ge(0,0,e.getWidth(),e.getHeight());o.setPointerChecker(function(a,n,l){return r.contain(n,l)})},t.prototype._clearController=function(){var e=this._controller;e&&(e.dispose(),e=null)},t.prototype._onPan=function(e){if(this._state!=="animating"&&(Math.abs(e.dx)>3||Math.abs(e.dy)>3)){var o=this.seriesModel.getData().tree.root;if(!o)return;var r=o.getLayout();if(!r)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:r.x+e.dx,y:r.y+e.dy,width:r.width,height:r.height}})}},t.prototype._onZoom=function(e){var o=e.originX,r=e.originY;if(this._state!=="animating"){var a=this.seriesModel.getData().tree.root;if(!a)return;var n=a.getLayout();if(!n)return;var l=new ge(n.x,n.y,n.width,n.height),s=this.seriesModel.layoutInfo;o-=s.x,r-=s.y;var h=Vt();ke(h,h,[-o,-r]),Mt(h,h,[e.scale,e.scale]),ke(h,h,[o,r]),l.applyTransform(h),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:l.x,y:l.y,width:l.width,height:l.height}})}},t.prototype._initEvents=function(e){var o=this;e.on("click",function(r){if(o._state==="ready"){var a=o.seriesModel.get("nodeClick",!0);if(a){var n=o.findTarget(r.offsetX,r.offsetY);if(n){var l=n.node;if(l.getLayout().isLeafRoot)o._rootToNode(n);else if(a==="zoomToNode")o._zoomToNode(n);else if(a==="link"){var s=l.hostTree.data.getItemModel(l.dataIndex),h=s.get("link",!0),c=s.get("target",!0)||"blank";h&&St(h,c)}}}}},this)},t.prototype._renderBreadcrumb=function(e,o,r){var a=this;r||(r=e.get("leafDepth",!0)!=null?{node:e.getViewRoot()}:this.findTarget(o.getWidth()/2,o.getHeight()/2))||(r={node:e.getData().tree.root}),(this._breadcrumb||(this._breadcrumb=new Jt(this.group))).render(e,o,r.node,function(n){a._state!=="animating"&&(je(e.getViewRoot(),n)?a._rootToNode({node:n}):a._zoomToNode({node:n}))})},t.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage={nodeGroup:[],background:[],content:[]},this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},t.prototype.dispose=function(){this._clearController()},t.prototype._zoomToNode=function(e){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype._rootToNode=function(e){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype.findTarget=function(e,o){var r;return this.seriesModel.getViewRoot().eachNode({attr:"viewChildren",order:"preorder"},function(a){var n=this._storage.background[a.getRawIndex()];if(n){var l=n.transformCoordToLocal(e,o),s=n.shape;if(!(s.x<=l[0]&&l[0]<=s.x+s.width&&s.y<=l[1]&&l[1]<=s.y+s.height))return!1;r={node:a,offsetX:l[0],offsetY:l[1]}}},this),r},t.type="treemap",t}(Tt),Ye=tt(),oo={seriesType:"treemap",reset:function(i){var t=i.getData().tree.root;t.isRemoved()||nt(t,{},i.getViewRoot().getAncestors(),i)}};function nt(i,t,e,o){var r=i.getModel(),a=i.getLayout(),n=i.hostTree.data;if(a&&!a.invisible&&a.isInView){var l,s=r.getModel("itemStyle"),h=function(d,p,v){var w=le({},p),f=v.designatedVisualItemStyle;return U(["color","colorAlpha","colorSaturation"],function(y){f[y]=p[y];var S=d.get(y);f[y]=null,S!=null&&(w[y]=S)}),w}(s,t,o),c=n.ensureUniqueItemVisual(i.dataIndex,"style"),x=s.get("borderColor"),M=s.get("borderColorSaturation");M!=null&&(x=function(d,p){return p!=null?rt(p,null,null,d):null}(M,l=$e(h))),c.stroke=x;var u=i.viewChildren;if(u&&u.length){var g=function(d,p,v,w,f,y){if(!(!y||!y.length)){var S=be(p,"color")||f.color!=null&&f.color!=="none"&&(be(p,"colorAlpha")||be(p,"colorSaturation"));if(S){var T=p.get("visualMin"),b=p.get("visualMax"),R=v.dataExtent.slice();T!=null&&T<R[0]&&(R[0]=T),b!=null&&b>R[1]&&(R[1]=b);var C=p.get("colorMappingBy"),N={type:S.name,dataExtent:R,visual:S.range};N.type!=="color"||C!=="index"&&C!=="id"?N.mappingMethod="linear":(N.mappingMethod="category",N.loop=!0);var I=new Pt(N);return Ye(I).drColorMappingBy=C,I}}}(0,r,a,0,h,u);U(u,function(d,p){if(d.depth>=e.length||d===e[d.depth]){var v=function(w,f,y,S,T,b){var R=le({},f);if(T){var C=T.type,N=C==="color"&&Ye(T).drColorMappingBy,I=N==="index"?S:N==="id"?b.mapIdToIndex(y.getId()):y.getValue(w.get("visualDimension"));R[C]=T.mapValueToVisual(I)}return R}(r,h,d,p,g,o);nt(d,v,e,o)}})}else l=$e(h),c.fill=l}}function $e(i){var t=we(i,"color");if(t){var e=we(i,"colorAlpha"),o=we(i,"colorSaturation");return o&&(t=rt(t,null,null,o)),e&&(t=At(t,e)),t}}function we(i,t){var e=i[t];if(e!=null&&e!=="none")return e}function be(i,t){var e=i.get(t);return he(e)&&e.length?{name:t,range:e}:null}var se=Math.max,ce=Math.min,Je=qt,Me=U,lt=["itemStyle","borderWidth"],io=["itemStyle","gapWidth"],ro=["upperLabel","show"],ao=["upperLabel","height"],no={seriesType:"treemap",reset:function(i,t,e,o){var r=e.getWidth(),a=e.getHeight(),n=i.option,l=Wt(i.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()}),s=n.size||[],h=Ze(Je(l.width,s[0]),r),c=Ze(Je(l.height,s[1]),a),x=o&&o.type,M=_e(o,["treemapZoomToNode","treemapRootToNode"],i),u=x==="treemapRender"||x==="treemapMove"?o.rootRect:null,g=i.getViewRoot(),d=vt(g);if(x!=="treemapMove"){var p=x==="treemapZoomToNode"?function(S,T,b,R,C){var N,I=(T||{}).node,O=[R,C];if(!I||I===b)return O;for(var E=R*C,F=E*S.option.zoomToNodeRatio;N=I.parentNode;){for(var A=0,H=N.children,ee=0,$=H.length;ee<$;ee++)A+=H[ee].getValue();var J=I.getValue();if(J===0)return O;F*=A/J;var ie=N.getModel(),oe=ie.get(lt);(F+=4*oe*oe+(3*oe+Math.max(oe,ut(ie)))*Math.pow(F,.5))>Oe&&(F=Oe),I=N}F<E&&(F=E);var X=Math.pow(F/E,.5);return[R*X,C*X]}(i,M,g,h,c):u?[u.width,u.height]:[h,c],v=n.sort;v&&v!=="asc"&&v!=="desc"&&(v="desc");var w={squareRatio:n.squareRatio,sort:v,leafDepth:n.leafDepth};g.hostTree.clearLayouts();var f={x:0,y:0,width:p[0],height:p[1],area:p[0]*p[1]};g.setLayout(f),st(g,w,!1,0),f=g.getLayout(),Me(d,function(S,T){var b=(d[T+1]||g).getValue();S.setLayout(le({dataExtent:[b,b],borderWidth:0,upperHeight:0},f))})}var y=i.getData().tree.root;y.setLayout(function(S,T,b){if(T)return{x:T.x,y:T.y};var R={x:0,y:0};if(!b)return R;var C=b.node,N=C.getLayout();if(!N)return R;for(var I=[N.width/2,N.height/2],O=C;O;){var E=O.getLayout();I[0]+=E.x,I[1]+=E.y,O=O.parentNode}return{x:S.width/2-I[0],y:S.height/2-I[1]}}(l,u,M),!0),i.setLayoutInfo(l),dt(y,new ge(-l.x,-l.y,r,a),d,g,0)}};function st(i,t,e,o){var r,a;if(!i.isRemoved()){var n=i.getLayout();r=n.width,a=n.height;var l=i.getModel(),s=l.get(lt),h=l.get(io)/2,c=ut(l),x=Math.max(s,c),M=s-h,u=x-h;i.setLayout({borderWidth:s,upperHeight:x,upperLabelHeight:c},!0);var g=(r=se(r-2*M,0))*(a=se(a-M-u,0)),d=function(C,N,I,O,E,F){var A=C.children||[],H=O.sort;H!=="asc"&&H!=="desc"&&(H=null);var ee=O.leafDepth!=null&&O.leafDepth<=F;if(E&&!ee)return C.viewChildren=[];A=kt(A,function(X){return!X.isRemoved()}),function(X,G){G&&X.sort(function(Z,q){var B=G==="asc"?Z.getValue()-q.getValue():q.getValue()-Z.getValue();return B===0?G==="asc"?Z.dataIndex-q.dataIndex:q.dataIndex-Z.dataIndex:B})}(A,H);var $=function(X,G,Z){for(var q=0,B=0,ae=G.length;B<ae;B++)q+=G[B].getValue();var _,z=X.get("visualDimension");return G&&G.length?z==="value"&&Z?(_=[G[G.length-1].getValue(),G[0].getValue()],Z==="asc"&&_.reverse()):(_=[1/0,-1/0],Me(G,function(K){var Q=K.getValue(z);Q<_[0]&&(_[0]=Q),Q>_[1]&&(_[1]=Q)})):_=[NaN,NaN],{sum:q,dataExtent:_}}(N,A,H);if($.sum===0)return C.viewChildren=[];if($.sum=function(X,G,Z,q,B){if(!q)return Z;for(var ae=X.get("visibleMin"),_=B.length,z=_,K=_-1;K>=0;K--){var Q=B[q==="asc"?_-K-1:K].getValue();Q/Z*G<ae&&(z=K,Z-=Q)}return q==="asc"?B.splice(0,_-z):B.splice(z,_-z),Z}(N,I,$.sum,H,A),$.sum===0)return C.viewChildren=[];for(var J=0,ie=A.length;J<ie;J++){var oe=A[J].getValue()/$.sum*I;A[J].setLayout({area:oe})}return ee&&(A.length&&C.setLayout({isLeafRoot:!0},!0),A.length=0),C.viewChildren=A,C.setLayout({dataExtent:$.dataExtent},!0),A}(i,l,g,t,e,o);if(d.length){var p={x:M,y:u,width:r,height:a},v=ce(r,a),w=1/0,f=[];f.area=0;for(var y=0,S=d.length;y<S;){var T=d[y];f.push(T),f.area+=T.getLayout().area;var b=lo(f,v,t.squareRatio);b<=w?(y++,w=b):(f.area-=f.pop().getLayout().area,Ke(f,v,p,h,!1),v=ce(p.width,p.height),f.length=f.area=0,w=1/0)}if(f.length&&Ke(f,v,p,h,!0),!e){var R=l.get("childrenVisibleMin");R!=null&&g<R&&(e=!0)}for(y=0,S=d.length;y<S;y++)st(d[y],t,e,o+1)}}}function lo(i,t,e){for(var o=0,r=1/0,a=0,n=void 0,l=i.length;a<l;a++)(n=i[a].getLayout().area)&&(n<r&&(r=n),n>o&&(o=n));var s=i.area*i.area,h=t*t*e;return s?se(h*o/s,s/(h*r)):1/0}function Ke(i,t,e,o,r){var a=t===e.width?0:1,n=1-a,l=["x","y"],s=["width","height"],h=e[l[a]],c=t?i.area/t:0;(r||c>e[s[n]])&&(c=e[s[n]]);for(var x=0,M=i.length;x<M;x++){var u=i[x],g={},d=c?u.getLayout().area/c:0,p=g[s[n]]=se(c-2*o,0),v=e[l[a]]+e[s[a]]-h,w=x===M-1||v<d?v:d,f=g[s[a]]=se(w-2*o,0);g[l[n]]=e[l[n]]+ce(o,p/2),g[l[a]]=h+ce(o,f/2),h+=w,u.setLayout(g,!0)}e[l[n]]+=c,e[s[n]]-=c}function dt(i,t,e,o,r){var a=i.getLayout(),n=e[r],l=n&&n===i;if(!(n&&!l||r===e.length&&i!==o)){i.setLayout({isInView:!0,invisible:!l&&!t.intersect(a),isAboveViewRoot:l},!0);var s=new ge(t.x-a.x,t.y-a.y,t.width,t.height);Me(i.viewChildren||[],function(h){dt(h,s,e,o,r+1)})}}function ut(i){return i.get(ro)?i.get(ao):0}function vo(i){i.registerSeriesModel(Xt),i.registerChartView(to),i.registerVisual(oo),i.registerLayout(no),function(t){for(var e=0;e<Be.length;e++)t.registerAction({type:Be[e],update:"updateView"},Ct);t.registerAction({type:"treemapRootToNode",update:"updateView"},function(o,r){r.eachComponent({mainType:"series",subType:"treemap",query:o},function(a,n){var l=_e(o,["treemapZoomToNode","treemapRootToNode"],a);if(l){var s=a.getViewRoot();s&&(o.direction=je(s,l.node)?"rollUp":"drillDown"),a.resetViewRoot(l.node)}})})}(i)}export{vo as install};
