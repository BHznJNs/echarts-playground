import{v as ae,x as G,P as oe,g as re,y as se}from"./AxisView-DFBExtUn.js";import{R as L,a2 as O,A as le,ax as de,f as ue,ao as pe,Q as ce,j as R,p as he,y as ge,ab as fe,aB as N,N as P,bb as xe,aw as ve,w as me,bh as ye,G as Ie,U as _e,aq as be,ar as Ae,S as Pe,e as V,o as Te,b0 as J,$ as we,bt as De,E as Me,T as Se,H as ee,aF as Ce,D as Ee}from"./index-B7p1rSoh.js";import{C as Oe}from"./AxisBuilder-DO5pSo3v.js";import"./labelLayoutHelper-BB_RXLLn.js";var C=L(),$=Se,k=ee,Be=function(){function i(){this._dragging=!1,this.animationThreshold=15}return i.prototype.render=function(t,e,n,o){var a=e.get("value"),r=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=n,o||this._lastValue!==a||this._lastStatus!==r){this._lastValue=a,this._lastStatus=r;var s=this._group,l=this._handle;if(!r||r==="hide")return s&&s.hide(),void(l&&l.hide());s&&s.show(),l&&l.show();var u={};this.makeElOption(u,a,t,e,n);var d=u.graphicKey;d!==this._lastGraphicKey&&this.clear(n),this._lastGraphicKey=d;var p=this._moveAnimation=this.determineAnimation(t,e);if(s){var g=O(W,e,p);this.updatePointerEl(s,u,g),this.updateLabelEl(s,u,g,e)}else s=this._group=new le,this.createPointerEl(s,u,t,e),this.createLabelEl(s,u,t,e),n.getZr().add(s);Z(s,e,!0),this._renderHandle(a)}},i.prototype.remove=function(t){this.clear(t)},i.prototype.dispose=function(t){this.clear(t)},i.prototype.determineAnimation=function(t,e){var n=e.get("animation"),o=t.axis,a=o.type==="category",r=e.get("snap");if(!r&&!a)return!1;if(n==="auto"||n==null){var s=this.animationThreshold;if(a&&o.getBandWidth()>s)return!0;if(r){var l=ae(t).seriesDataCount,u=o.getExtent();return Math.abs(u[0]-u[1])/l>s}return!1}return n===!0},i.prototype.makeElOption=function(t,e,n,o,a){},i.prototype.createPointerEl=function(t,e,n,o){var a=e.pointer;if(a){var r=C(t).pointerEl=new de[a.type]($(e.pointer));t.add(r)}},i.prototype.createLabelEl=function(t,e,n,o){if(e.label){var a=C(t).labelEl=new ue($(e.label));t.add(a),Y(a,o)}},i.prototype.updatePointerEl=function(t,e,n){var o=C(t).pointerEl;o&&e.pointer&&(o.setStyle(e.pointer.style),n(o,{shape:e.pointer.shape}))},i.prototype.updateLabelEl=function(t,e,n,o){var a=C(t).labelEl;a&&(a.setStyle(e.label.style),n(a,{x:e.label.x,y:e.label.y}),Y(a,o))},i.prototype._renderHandle=function(t){if(!this._dragging&&this.updateHandleTransform){var e,n=this._axisPointerModel,o=this._api.getZr(),a=this._handle,r=n.getModel("handle"),s=n.get("status");if(!r.get("show")||!s||s==="hide")return a&&o.remove(a),void(this._handle=null);this._handle||(e=!0,a=this._handle=pe(r.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(u){ce(u.event)},onmousedown:k(this._onHandleDragMove,this,0,0),drift:k(this._onHandleDragMove,this),ondragend:k(this._onHandleDragEnd,this)}),o.add(a)),Z(a,n,!1),a.setStyle(r.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var l=r.get("size");R(l)||(l=[l,l]),a.scaleX=l[0]/2,a.scaleY=l[1]/2,he(this,"_doDispatchAxisPointer",r.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,e)}},i.prototype._moveHandleToValue=function(t,e){W(this._axisPointerModel,!e&&this._moveAnimation,this._handle,z(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},i.prototype._onHandleDragMove=function(t,e){var n=this._handle;if(n){this._dragging=!0;var o=this.updateHandleTransform(z(n),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=o,n.stopAnimation(),n.attr(z(o)),C(n).lastProp=null,this._doDispatchAxisPointer()}},i.prototype._doDispatchAxisPointer=function(){if(this._handle){var t=this._payloadInfo,e=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:e.axis.dim,axisIndex:e.componentIndex}]})}},i.prototype._onHandleDragEnd=function(){if(this._dragging=!1,this._handle){var t=this._axisPointerModel.get("value");this._moveHandleToValue(t),this._api.dispatchAction({type:"hideTip"})}},i.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),n=this._group,o=this._handle;e&&n&&(this._lastGraphicKey=null,n&&e.remove(n),o&&e.remove(o),this._group=null,this._handle=null,this._payloadInfo=null),ge(this,"_doDispatchAxisPointer")},i.prototype.doClear=function(){},i.prototype.buildLabel=function(t,e,n){return{x:t[n=n||0],y:t[1-n],width:e[n],height:e[1-n]}},i}();function W(i,t,e,n){te(C(e).lastProp,n)||(C(e).lastProp=n,t?fe(e,n,i):(e.stopAnimation(),e.attr(n)))}function te(i,t){if(N(i)&&N(t)){var e=!0;return P(t,function(n,o){e=e&&te(i[o],n)}),!!e}return i===t}function Y(i,t){i[t.get(["label","show"])?"show":"hide"]()}function z(i){return{x:i.x||0,y:i.y||0,rotation:i.rotation||0}}function Z(i,t,e){var n=t.get("z"),o=t.get("zlevel");i&&i.traverse(function(a){a.type!=="group"&&(n!=null&&(a.z=n),o!=null&&(a.zlevel=o),a.silent=e)})}var He=Be;function ke(i){var t,e=i.get("type"),n=i.getModel(e+"Style");return e==="line"?(t=n.getLineStyle()).fill=null:e==="shadow"&&((t=n.getAreaStyle()).stroke=null),t}function ze(i,t,e,n,o){var a=Le(e.get("value"),t.axis,t.ecModel,e.get("seriesDataIndices"),{precision:e.get(["label","precision"]),formatter:e.get(["label","formatter"])}),r=e.getModel("label"),s=xe(r.get("padding")||0),l=r.getFont(),u=ve(a,l),d=o.position,p=u.width+s[1]+s[3],g=u.height+s[0]+s[2],c=o.align;c==="right"&&(d[0]-=p),c==="center"&&(d[0]-=p/2);var m=o.verticalAlign;m==="bottom"&&(d[1]-=g),m==="middle"&&(d[1]-=g/2),function(_,h,b,f){var y=f.getWidth(),I=f.getHeight();_[0]=Math.min(_[0]+h,y)-h,_[1]=Math.min(_[1]+b,I)-b,_[0]=Math.max(_[0],0),_[1]=Math.max(_[1],0)}(d,p,g,n);var x=r.get("backgroundColor");x&&x!=="auto"||(x=t.get(["axisLine","lineStyle","color"])),i.label={x:d[0],y:d[1],style:me(r,{text:a,font:l,fill:r.getTextColor(),padding:s,backgroundColor:x}),z2:10}}function Le(i,t,e,n,o){i=t.scale.parse(i);var a=t.scale.getLabel({value:i},{precision:o.precision}),r=o.formatter;if(r){var s={value:ye(t,{value:i}),axisDimension:t.dim,axisIndex:t.index,seriesData:[]};P(n,function(l){var u=e.getSeriesByIndex(l.seriesIndex),d=l.dataIndexInside,p=u&&u.getDataParams(d);p&&s.seriesData.push(p)}),Ie(r)?a=r.replace("{value}",a):_e(r)&&(a=r(s))}return a}function ie(i,t,e){var n=Ce();return be(n,n,e.rotation),Ae(n,n,e.position),Pe([i.dataToCoord(t),(e.labelOffset||0)+(e.labelDirection||1)*(e.labelMargin||0)],n)}function Re(i,t,e,n,o,a){var r=Oe.innerTextLayout(e.rotation,0,e.labelDirection);e.labelMargin=o.get(["label","margin"]),ze(t,n,o,a,{position:ie(n.axis,i,e),align:r.textAlign,verticalAlign:r.textVerticalAlign})}function Ve(i,t,e){return{x1:i[e=e||0],y1:i[1-e],x2:t[e],y2:t[1-e]}}function Ge(i,t,e){return{x:i[e=e||0],y:i[1-e],width:t[e],height:t[1-e]}}function at(i,t,e,n,o,a){return{cx:i,cy:t,r0:e,r:n,startAngle:o,endAngle:a,clockwise:!0}}var Ne=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return V(t,i),t.prototype.makeElOption=function(e,n,o,a,r){var s=o.axis,l=s.grid,u=a.get("type"),d=K(l,s).getOtherAxis(s).getGlobalExtent(),p=s.toGlobalCoord(s.dataToCoord(n,!0));if(u&&u!=="none"){var g=ke(a),c=$e[u](s,p,d);c.style=g,e.graphicKey=c.type,e.pointer=c}Re(n,e,G(l.model,o),o,a,r)},t.prototype.getHandleTransform=function(e,n,o){var a=G(n.axis.grid.model,n,{labelInside:!1});a.labelMargin=o.get(["handle","margin"]);var r=ie(n.axis,e,a);return{x:r[0],y:r[1],rotation:a.rotation+(a.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,n,o,a){var r=o.axis,s=r.grid,l=r.getGlobalExtent(!0),u=K(s,r).getOtherAxis(r).getGlobalExtent(),d=r.dim==="x"?0:1,p=[e.x,e.y];p[d]+=n[d],p[d]=Math.min(l[1],p[d]),p[d]=Math.max(l[0],p[d]);var g=(u[1]+u[0])/2,c=[g,g];return c[d]=p[d],{x:p[0],y:p[1],rotation:e.rotation,cursorPoint:c,tooltipOption:[{verticalAlign:"middle"},{align:"center"}][d]}},t}(He);function K(i,t){var e={};return e[t.dim+"AxisIndex"]=t.index,i.getCartesian(e)}var $e={line:function(i,t,e){return{type:"Line",subPixelOptimize:!0,shape:Ve([t,e[0]],[t,e[1]],X(i))}},shadow:function(i,t,e){var n=Math.max(1,i.getBandWidth()),o=e[1]-e[0];return{type:"Rect",shape:Ge([t-n/2,e[0]],[n,o],X(i))}}};function X(i){return i.dim==="x"?0:1}var We=Ne,Ye=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return V(t,i),t.type="axisPointer",t.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},t}(Te),M=L(),Ze=P;function Ke(i,t,e){if(!J.node){var n=t.getZr();M(n).records||(M(n).records={}),function(o,a){if(M(o).initialized)return;function r(s,l){o.on(s,function(u){var d=function(p){var g={showTip:[],hideTip:[]},c=function(m){var x=g[m.type];x?x.push(m):(m.dispatchAction=c,p.dispatchAction(m))};return{dispatchAction:c,pendings:g}}(a);Ze(M(o).records,function(p){p&&l(p,u,d.dispatchAction)}),function(p,g){var c,m=p.showTip.length,x=p.hideTip.length;m?c=p.showTip[m-1]:x&&(c=p.hideTip[x-1]),c&&(c.dispatchAction=null,g.dispatchAction(c))}(d.pendings,a)})}M(o).initialized=!0,r("click",O(j,"click")),r("mousemove",O(j,"mousemove")),r("globalout",Xe)}(n,t),(M(n).records[i]||(M(n).records[i]={})).handler=e}}function Xe(i,t,e){i.handler("leave",null,e)}function j(i,t,e,n){t.handler(i,e,n)}function U(i,t){if(!J.node){var e=t.getZr();(M(e).records||{})[i]&&(M(e).records[i]=null)}}var je=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return V(t,i),t.prototype.render=function(e,n,o){var a=n.getComponent("tooltip"),r=e.get("triggerOn")||a&&a.get("triggerOn")||"mousemove|click";Ke("axisPointer",o,function(s,l,u){r!=="none"&&(s==="leave"||r.indexOf(s)>=0)&&u({type:"updateAxisPointer",currTrigger:s,x:l&&l.offsetX,y:l&&l.offsetY})})},t.prototype.remove=function(e,n){U("axisPointer",n)},t.prototype.dispose=function(e,n){U("axisPointer",n)},t.type="axisPointer",t}(we);function Ue(i,t){var e,n=[],o=i.seriesIndex;if(o==null||!(e=t.getSeriesByIndex(o)))return{point:[]};var a=e.getData(),r=De(a,i);if(r==null||r<0||R(r))return{point:[]};var s=a.getItemGraphicEl(r),l=e.coordinateSystem;if(e.getTooltipPosition)n=e.getTooltipPosition(r)||[];else if(l&&l.dataToPoint)if(i.isStacked){var u=l.getBaseAxis(),d=l.getOtherAxis(u).dim,p=u.dim,g=d==="x"||d==="radius"?1:0,c=a.mapDimension(p),m=[];m[g]=a.get(c,r),m[1-g]=a.get(a.getCalculationInfo("stackResultDimension"),r),n=l.dataToPoint(m)||[]}else n=l.dataToPoint(a.getValues(Me(l.dimensions,function(_){return a.mapDimension(_)}),r))||[];else if(s){var x=s.getBoundingRect().clone();x.applyTransform(s.transform),n=[x.x+x.width/2,x.y+x.height/2]}return{point:n,el:s}}var F=L();function Fe(i,t,e){var n=i.currTrigger,o=[i.x,i.y],a=i,r=i.dispatchAction||ee(e.dispatchAction,e),s=t.getComponent("axisPointer").coordSysAxesInfo;if(s){B(o)&&(o=Ue({seriesIndex:a.seriesIndex,dataIndex:a.dataIndex},t).point);var l=B(o),u=a.axesInfo,d=s.axesInfo,p=n==="leave"||B(o),g={},c={},m={list:[],map:{}},x={showPointer:O(qe,c),showTooltip:O(Qe,m)};P(s.coordSysMap,function(h,b){var f=l||h.containPoint(o);P(s.coordSysAxesInfo[b],function(y,I){var T=y.axis,v=function(w,D){for(var S=0;S<(w||[]).length;S++){var E=w[S];if(D.axis.dim===E.axisDim&&D.axis.model.componentIndex===E.axisIndex)return E}}(u,y);if(!p&&f&&(!u||v)){var A=v&&v.value;A!=null||l||(A=T.pointToData(o)),A!=null&&q(y,A,x,!1,g)}})});var _={};return P(d,function(h,b){var f=h.linkGroup;f&&!c[b]&&P(f.axesInfo,function(y,I){var T=c[I];if(y!==h&&T){var v=T.value;f.mapper&&(v=h.axis.scale.parse(f.mapper(v,Q(y),Q(h)))),_[h.key]=v}})}),P(_,function(h,b){q(d[b],h,x,!0,g)}),function(h,b,f){var y=f.axesInfo=[];P(b,function(I,T){var v=I.axisPointerModel.option,A=h[T];A?(!I.useHandle&&(v.status="show"),v.value=A.value,v.seriesDataIndices=(A.payloadBatch||[]).slice()):!I.useHandle&&(v.status="hide"),v.status==="show"&&y.push({axisDim:I.axis.dim,axisIndex:I.axis.model.componentIndex,value:v.value})})}(c,d,g),function(h,b,f,y){if(B(b)||!h.list.length)return void y({type:"hideTip"});var I=((h.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};y({type:"showTip",escapeConnect:!0,x:b[0],y:b[1],tooltipOption:f.tooltipOption,position:f.position,dataIndexInside:I.dataIndexInside,dataIndex:I.dataIndex,seriesIndex:I.seriesIndex,dataByCoordSys:h.list})}(m,o,i,r),function(h,b,f){var y=f.getZr(),I="axisPointerLastHighlights",T=F(y)[I]||{},v=F(y)[I]={};P(h,function(D,S){var E=D.axisPointerModel.option;E.status==="show"&&D.triggerEmphasis&&P(E.seriesDataIndices,function(H){var ne=H.seriesIndex+" | "+H.dataIndex;v[ne]=H})});var A=[],w=[];P(T,function(D,S){!v[S]&&w.push(D)}),P(v,function(D,S){!T[S]&&A.push(D)}),w.length&&f.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:w}),A.length&&f.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:A})}(d,0,e),g}}function q(i,t,e,n,o){var a=i.axis;if(!a.scale.isBlank()&&a.containData(t))if(i.involveSeries){var r=function(u,d){var p=d.axis,g=p.dim,c=u,m=[],x=Number.MAX_VALUE,_=-1;return P(d.seriesModels,function(h,b){var f,y,I=h.getData().mapDimensionsAll(g);if(h.getAxisTooltipData){var T=h.getAxisTooltipData(I,u,p);y=T.dataIndices,f=T.nestestValue}else{if(!(y=h.getData().indicesOfNearest(I[0],u,p.type==="category"?.5:null)).length)return;f=h.getData().get(I[0],y[0])}if(f!=null&&isFinite(f)){var v=u-f,A=Math.abs(v);A<=x&&((A<x||v>=0&&_<0)&&(x=A,_=v,c=f,m.length=0),P(y,function(w){m.push({seriesIndex:h.seriesIndex,dataIndexInside:w,dataIndex:h.getData().getRawIndex(w)})}))}}),{payloadBatch:m,snapToValue:c}}(t,i),s=r.payloadBatch,l=r.snapToValue;s[0]&&o.seriesIndex==null&&Ee(o,s[0]),!n&&i.snap&&a.containData(l)&&l!=null&&(t=l),e.showPointer(i,t,s),e.showTooltip(i,r,l)}else e.showPointer(i,t)}function qe(i,t,e,n){i[t.key]={value:e,payloadBatch:n}}function Qe(i,t,e,n){var o=e.payloadBatch,a=t.axis,r=a.model,s=t.axisPointerModel;if(t.triggerTooltip&&o.length){var l=t.coordSys.model,u=se(l),d=i.map[u];d||(d=i.map[u]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},i.list.push(d)),d.dataByAxis.push({axisDim:a.dim,axisIndex:r.componentIndex,axisType:r.type,axisId:r.id,value:n,valueLabelOpt:{precision:s.get(["label","precision"]),formatter:s.get(["label","formatter"])},seriesDataIndices:o.slice()})}}function Q(i){var t=i.axis.model,e={},n=e.axisDim=i.axis.dim;return e.axisIndex=e[n+"AxisIndex"]=t.componentIndex,e.axisName=e[n+"AxisName"]=t.name,e.axisId=e[n+"AxisId"]=t.id,e}function B(i){return!i||i[0]==null||isNaN(i[0])||i[1]==null||isNaN(i[1])}function Je(i){oe.registerAxisPointerClass("CartesianAxisPointer",We),i.registerComponentModel(Ye),i.registerComponentView(je),i.registerPreprocessor(function(t){if(t){(!t.axisPointer||t.axisPointer.length===0)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!R(e)&&(t.axisPointer.link=[e])}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=re(t,e)}),i.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},Fe)}var ot=Object.freeze({__proto__:null,install:Je});export{He as B,ze as a,ke as b,at as c,Re as d,Ge as e,Ue as f,ie as g,Le as h,Je as i,ot as j,Ve as m,Ke as r,U as u};
