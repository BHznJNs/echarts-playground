import{e as N,t as R,o as A,c as F,r as H,G as M,F as B,U as E,d as x,w as S,f as I,D as k,E as P,h as J,$ as Y,j as v,i as U,J as Z,k as j,N as W,Z as G}from"./index-B3HKDY-B.js";function T(l,i){var e,t=l.cellSize;(e=v(t)?t:l.cellSize=[t,t]).length===1&&(e[1]=e[0]);var o=P([0,1],function(n){return U(i,n)&&(e[n]="auto"),e[n]!=null&&e[n]!=="auto"});Z(l,i,{type:"box",ignoreSize:o})}var V=function(l){function i(){var e=l!==null&&l.apply(this,arguments)||this;return e.type=i.type,e}return N(i,l),i.prototype.init=function(e,t,o){var n=R(e);l.prototype.init.apply(this,arguments),T(e,n)},i.prototype.mergeOption=function(e){l.prototype.mergeOption.apply(this,arguments),T(this.option,e)},i.prototype.getCellSize=function(){return this.option.cellSize},i.type="calendar",i.defaultOption={z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{color:"#fff",borderWidth:1,borderColor:"#ccc"},dayLabel:{show:!0,firstDay:0,position:"start",margin:"50%",color:"#000"},monthLabel:{show:!0,position:"start",margin:5,align:"center",formatter:null,color:"#000"},yearLabel:{show:!0,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},i}(A),q=function(l){function i(){var e=l!==null&&l.apply(this,arguments)||this;return e.type=i.type,e}return N(i,l),i.prototype.render=function(e,t,o){var n=this.group;n.removeAll();var r=e.coordinateSystem,a=r.getRangeInfo(),s=r.getOrient(),h=t.getLocaleModel();this._renderDayRect(e,a,n),this._renderLines(e,a,s,n),this._renderYearText(e,a,s,n),this._renderMonthText(e,h,s,n),this._renderWeekText(e,h,a,s,n)},i.prototype._renderDayRect=function(e,t,o){for(var n=e.coordinateSystem,r=e.getModel("itemStyle").getItemStyle(),a=n.getCellWidth(),s=n.getCellHeight(),h=t.start.time;h<=t.end.time;h=n.getNextNDay(h,1).time){var g=n.dataToRect([h],!1).tl,p=new F({shape:{x:g[0],y:g[1],width:a,height:s},cursor:"default",style:r});o.add(p)}},i.prototype._renderLines=function(e,t,o,n){var r=this,a=e.coordinateSystem,s=e.getModel(["splitLine","lineStyle"]).getLineStyle(),h=e.get(["splitLine","show"]),g=s.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var p=t.start,d=0;p.time<=t.end.time;d++){y(p.formatedDate),d===0&&(p=a.getDateInfo(t.start.y+"-"+t.start.m));var c=p.date;c.setMonth(c.getMonth()+1),p=a.getDateInfo(c)}function y(f){r._firstDayOfMonth.push(a.getDateInfo(f)),r._firstDayPoints.push(a.dataToRect([f],!1).tl);var m=r._getLinePointsOfOneWeek(e,f,o);r._tlpoints.push(m[0]),r._blpoints.push(m[m.length-1]),h&&r._drawSplitline(m,s,n)}y(a.getNextNDay(t.end.time,1).formatedDate),h&&this._drawSplitline(r._getEdgesPoints(r._tlpoints,g,o),s,n),h&&this._drawSplitline(r._getEdgesPoints(r._blpoints,g,o),s,n)},i.prototype._getEdgesPoints=function(e,t,o){var n=[e[0].slice(),e[e.length-1].slice()],r=o==="horizontal"?0:1;return n[0][r]=n[0][r]-t/2,n[1][r]=n[1][r]+t/2,n},i.prototype._drawSplitline=function(e,t,o){var n=new H({z2:20,shape:{points:e},style:t});o.add(n)},i.prototype._getLinePointsOfOneWeek=function(e,t,o){for(var n=e.coordinateSystem,r=n.getDateInfo(t),a=[],s=0;s<7;s++){var h=n.getNextNDay(r.time,s),g=n.dataToRect([h.time],!1);a[2*h.day]=g.tl,a[2*h.day+1]=g[o==="horizontal"?"bl":"tr"]}return a},i.prototype._formatterLabel=function(e,t){return M(e)&&e?B(e,t):E(e)?e(t):t.nameMap},i.prototype._yearTextPositionControl=function(e,t,o,n,r){var a=t[0],s=t[1],h=["center","bottom"];n==="bottom"?(s+=r,h=["center","top"]):n==="left"?a-=r:n==="right"?(a+=r,h=["center","top"]):s-=r;var g=0;return n!=="left"&&n!=="right"||(g=Math.PI/2),{rotation:g,x:a,y:s,style:{align:h[0],verticalAlign:h[1]}}},i.prototype._renderYearText=function(e,t,o,n){var r=e.getModel("yearLabel");if(r.get("show")){var a=r.get("margin"),s=r.get("position");s||(s=o!=="horizontal"?"top":"left");var h=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],g=(h[0][0]+h[1][0])/2,p=(h[0][1]+h[1][1])/2,d=o==="horizontal"?0:1,c={top:[g,h[d][1]],bottom:[g,h[1-d][1]],left:[h[1-d][0],p],right:[h[d][0],p]},y=t.start.y;+t.end.y>+t.start.y&&(y=y+"-"+t.end.y);var f=r.get("formatter"),m={start:t.start.y,end:t.end.y,nameMap:y},u=this._formatterLabel(f,m),_=new x({z2:30,style:S(r,{text:u})});_.attr(this._yearTextPositionControl(_,c[s],o,s,a)),n.add(_)}},i.prototype._monthTextPositionControl=function(e,t,o,n,r){var a="left",s="top",h=e[0],g=e[1];return o==="horizontal"?(g+=r,t&&(a="center"),n==="start"&&(s="bottom")):(h+=r,t&&(s="middle"),n==="start"&&(a="right")),{x:h,y:g,align:a,verticalAlign:s}},i.prototype._renderMonthText=function(e,t,o,n){var r=e.getModel("monthLabel");if(r.get("show")){var a=r.get("nameMap"),s=r.get("margin"),h=r.get("position"),g=r.get("align"),p=[this._tlpoints,this._blpoints];a&&!M(a)||(a&&(t=I(a)||t),a=t.get(["time","monthAbbr"])||[]);var d=h==="start"?0:1,c=o==="horizontal"?0:1;s=h==="start"?-s:s;for(var y=g==="center",f=0;f<p[d].length-1;f++){var m=p[d][f].slice(),u=this._firstDayOfMonth[f];if(y){var _=this._firstDayPoints[f];m[c]=(_[c]+p[0][f+1][c])/2}var D=r.get("formatter"),w=a[+u.m-1],O={yyyy:u.y,yy:(u.y+"").slice(2),MM:u.m,M:+u.m,nameMap:w},L=this._formatterLabel(D,O),C=new x({z2:30,style:k(S(r,{text:L}),this._monthTextPositionControl(m,y,o,h,s))});n.add(C)}}},i.prototype._weekTextPositionControl=function(e,t,o,n,r){var a="center",s="middle",h=e[0],g=e[1],p=o==="start";return t==="horizontal"?(h=h+n+(p?1:-1)*r[0]/2,a=p?"right":"left"):(g=g+n+(p?1:-1)*r[1]/2,s=p?"bottom":"top"),{x:h,y:g,align:a,verticalAlign:s}},i.prototype._renderWeekText=function(e,t,o,n,r){var a=e.getModel("dayLabel");if(a.get("show")){var s=e.coordinateSystem,h=a.get("position"),g=a.get("nameMap"),p=a.get("margin"),d=s.getFirstDayOfWeek();(!g||M(g))&&(g&&(t=I(g)||t),g=t.get(["time","dayOfWeekShort"])||P(t.get(["time","dayOfWeekAbbr"]),function(w){return w[0]}));var c=s.getNextNDay(o.end.time,7-o.lweek).time,y=[s.getCellWidth(),s.getCellHeight()];p=J(p,Math.min(y[1],y[0])),h==="start"&&(c=s.getNextNDay(o.start.time,-(7+o.fweek)).time,p=-p);for(var f=0;f<7;f++){var m,u=s.getNextNDay(c,f),_=s.dataToRect([u.time],!1).center;m=Math.abs((f+d)%7);var D=new x({z2:30,style:k(S(a,{text:g[m]}),this._weekTextPositionControl(_,n,h,p,y))});r.add(D)}}},i.type="calendar",i}(Y),b=864e5;function z(l){var i=l.calendarModel,e=l.seriesModel;return i?i.coordinateSystem:e?e.coordinateSystem:null}var K=function(){function l(i,e,t){this.type="calendar",this.dimensions=l.dimensions,this.getDimensionsInfo=l.getDimensionsInfo,this._model=i}return l.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},l.prototype.getRangeInfo=function(){return this._rangeInfo},l.prototype.getModel=function(){return this._model},l.prototype.getRect=function(){return this._rect},l.prototype.getCellWidth=function(){return this._sw},l.prototype.getCellHeight=function(){return this._sh},l.prototype.getOrient=function(){return this._orient},l.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},l.prototype.getDateInfo=function(i){var e=(i=j(i)).getFullYear(),t=i.getMonth()+1,o=t<10?"0"+t:""+t,n=i.getDate(),r=n<10?"0"+n:""+n,a=i.getDay();return{y:e+"",m:o,d:r,day:a=Math.abs((a+7-this.getFirstDayOfWeek())%7),time:i.getTime(),formatedDate:e+"-"+o+"-"+r,date:i}},l.prototype.getNextNDay=function(i,e){return(e=e||0)===0||(i=new Date(this.getDateInfo(i).time)).setDate(i.getDate()+e),this.getDateInfo(i)},l.prototype.update=function(i,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var t=this._rangeInfo.weeks||1,o=["width","height"],n=this._model.getCellSize().slice(),r=this._model.getBoxLayoutParams(),a=this._orient==="horizontal"?[t,7]:[7,t];W([0,1],function(p){g(n,p)&&(r[o[p]]=n[p]*a[p])});var s={width:e.getWidth(),height:e.getHeight()},h=this._rect=G(r,s);function g(p,d){return p[d]!=null&&p[d]!=="auto"}W([0,1],function(p){g(n,p)||(n[p]=h[o[p]]/a[p])}),this._sw=n[0],this._sh=n[1]},l.prototype.dataToPoint=function(i,e){v(i)&&(i=i[0]),e==null&&(e=!0);var t=this.getDateInfo(i),o=this._rangeInfo,n=t.formatedDate;if(e&&!(t.time>=o.start.time&&t.time<o.end.time+b))return[NaN,NaN];var r=t.day,a=this._getRangeInfo([o.start.time,n]).nthWeek;return this._orient==="vertical"?[this._rect.x+r*this._sw+this._sw/2,this._rect.y+a*this._sh+this._sh/2]:[this._rect.x+a*this._sw+this._sw/2,this._rect.y+r*this._sh+this._sh/2]},l.prototype.pointToData=function(i){var e=this.pointToDate(i);return e&&e.time},l.prototype.dataToRect=function(i,e){var t=this.dataToPoint(i,e);return{contentShape:{x:t[0]-(this._sw-this._lineWidth)/2,y:t[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:t,tl:[t[0]-this._sw/2,t[1]-this._sh/2],tr:[t[0]+this._sw/2,t[1]-this._sh/2],br:[t[0]+this._sw/2,t[1]+this._sh/2],bl:[t[0]-this._sw/2,t[1]+this._sh/2]}},l.prototype.pointToDate=function(i){var e=Math.floor((i[0]-this._rect.x)/this._sw)+1,t=Math.floor((i[1]-this._rect.y)/this._sh)+1,o=this._rangeInfo.range;return this._orient==="vertical"?this._getDateByWeeksAndDay(t,e-1,o):this._getDateByWeeksAndDay(e,t-1,o)},l.prototype.convertToPixel=function(i,e,t){var o=z(e);return o===this?o.dataToPoint(t):null},l.prototype.convertFromPixel=function(i,e,t){var o=z(e);return o===this?o.pointToData(t):null},l.prototype.containPoint=function(i){return console.warn("Not implemented."),!1},l.prototype._initRangeOption=function(){var i,e=this._model.get("range");if(v(e)&&e.length===1&&(e=e[0]),v(e))i=e;else{var t=e.toString();if(/^\d{4}$/.test(t)&&(i=[t+"-01-01",t+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(t)){var o=this.getDateInfo(t),n=o.date;n.setMonth(n.getMonth()+1);var r=this.getNextNDay(n,-1);i=[o.formatedDate,r.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(t)&&(i=[t,t])}if(!i)return e;var a=this._getRangeInfo(i);return a.start.time>a.end.time&&i.reverse(),i},l.prototype._getRangeInfo=function(i){var e,t=[this.getDateInfo(i[0]),this.getDateInfo(i[1])];t[0].time>t[1].time&&(e=!0,t.reverse());var o=Math.floor(t[1].time/b)-Math.floor(t[0].time/b)+1,n=new Date(t[0].time),r=n.getDate(),a=t[1].date.getDate();n.setDate(r+o-1);var s=n.getDate();if(s!==a)for(var h=n.getTime()-t[1].time>0?1:-1;(s=n.getDate())!==a&&(n.getTime()-t[1].time)*h>0;)o-=h,n.setDate(s-h);var g=Math.floor((o+t[0].day+6)/7),p=e?1-g:g-1;return e&&t.reverse(),{range:[t[0].formatedDate,t[1].formatedDate],start:t[0],end:t[1],allDay:o,weeks:g,nthWeek:p,fweek:t[0].day,lweek:t[1].day}},l.prototype._getDateByWeeksAndDay=function(i,e,t){var o=this._getRangeInfo(t);if(i>o.weeks||i===0&&e<o.fweek||i===o.weeks&&e>o.lweek)return null;var n=7*(i-1)-o.fweek+e,r=new Date(o.start.time);return r.setDate(+o.start.d+n),this.getDateInfo(r)},l.create=function(i,e){var t=[];return i.eachComponent("calendar",function(o){var n=new l(o);t.push(n),o.coordinateSystem=n}),i.eachSeries(function(o){o.get("coordinateSystem")==="calendar"&&(o.coordinateSystem=t[o.get("calendarIndex")||0])}),t},l.dimensions=["time","value"],l}();function X(l){l.registerComponentModel(V),l.registerComponentView(q),l.registerCoordinateSystem("calendar",K)}export{X as install};
