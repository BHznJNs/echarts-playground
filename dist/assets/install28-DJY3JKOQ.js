import{af as Fe,g as S,R as Ve,aa as Ue,N as y,y as G,A as Ge,r as Ae,ae as oe,c6 as Te,D as U,al as Be,ak as Je,bQ as Xe,a7 as Z,a8 as ze,bS as Ye,cQ as Ee,e as Q,z as K,G as Y,ar as je,as as $e,cd as He,c7 as Ze,b as ie,U as We,o as qe,be as Qe,$ as Ke,aX as et,cR as tt,ad as nt,cS as ot,cL as it,c as W,ab as P,cT as rt,cU as at,E as B,cV as st,aK as lt,cW as pt,aD as ut,ay as ct,cX as gt,ag as ht,cY as dt,bB as ft,cZ as vt,I as mt,cF as re,ap as yt,c_ as _t,aq as St,bf as wt,h as j,Z as bt,aE as xt,c$ as Mt,d0 as Ft}from"./index-B3HKDY-B.js";import{p as Gt,h as At,f as Re,T as Tt}from"./roamHelper-DN6TLDPQ.js";import{f as Rt}from"./RoamController-rbEyhm6E.js";import{e as Ct}from"./cursorHelper-IgNoiH07.js";import"./interactionMutex-Bs7cRZ9p.js";function Ce(a){Y(a)&&(a=new DOMParser().parseFromString(a,"text/xml"));var e=a;for(e.nodeType===9&&(e=e.firstChild);e.nodeName.toLowerCase()!=="svg"||e.nodeType!==1;)e=e.nextSibling;return e}var $,J={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},ae=Fe(J),X={"alignment-baseline":"textBaseline","stop-color":"stopColor"},se=Fe(X),Nt=function(){function a(){this._defs={},this._root=null}return a.prototype.parse=function(e,t){t=t||{};var n=Ce(e);this._defsUsePending=[];var o=new G;this._root=o;var i=[],r=n.getAttribute("viewBox")||"",s=parseFloat(n.getAttribute("width")||t.width),l=parseFloat(n.getAttribute("height")||t.height);isNaN(s)&&(s=null),isNaN(l)&&(l=null),w(n,o,null,!0,!1);for(var p,h,g=n.firstChild;g;)this._parseNode(g,o,i,null,!1,!1),g=g.nextSibling;if(function(d,v){for(var f=0;f<v.length;f++){var m=v[f];m[0].style[m[1]]=d[m[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],r){var c=z(r);c.length>=4&&(p={x:parseFloat(c[0]||0),y:parseFloat(c[1]||0),width:parseFloat(c[2]),height:parseFloat(c[3])})}if(p&&s!=null&&l!=null&&(h=De(p,{x:0,y:0,width:s,height:l}),!t.ignoreViewBox)){var u=o;(o=new G).add(u),u.scaleX=u.scaleY=h.scale,u.x=h.x,u.y=h.y}return t.ignoreRootClip||s==null||l==null||o.setClipPath(new W({shape:{x:0,y:0,width:s,height:l}})),{root:o,width:s,height:l,viewBoxRect:p,viewBoxTransform:h,named:i}},a.prototype._parseNode=function(e,t,n,o,i,r){var s,l=e.nodeName.toLowerCase(),p=o;if(l==="defs"&&(i=!0),l==="text"&&(r=!0),l==="defs"||l==="switch")s=t;else{if(!i){var h=$[l];if(h&&P($,l)){s=h.call(this,e,t);var g=e.getAttribute("name");if(g){var c={name:g,namedFrom:null,svgNodeTagLower:l,el:s};n.push(c),l==="g"&&(p=c)}else o&&n.push({name:o.name,namedFrom:o,svgNodeTagLower:l,el:s});t.add(s)}}var u=le[l];if(u&&P(le,l)){var d=u.call(this,e),v=e.getAttribute("id");v&&(this._defs[v]=d)}}if(s&&s.isGroup)for(var f=e.firstChild;f;)f.nodeType===1?this._parseNode(f,s,n,p,i,r):f.nodeType===3&&r&&this._parseText(f,s),f=f.nextSibling},a.prototype._parseText=function(e,t){var n=new pt({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0});x(t,n),w(e,n,this._defsUsePending,!1,!1),function(l,p){var h=p.__selfStyle;if(h){var g=h.textBaseline,c=g;g&&g!=="auto"?g==="baseline"?c="alphabetic":g==="before-edge"||g==="text-before-edge"?c="top":g==="after-edge"||g==="text-after-edge"?c="bottom":g!=="central"&&g!=="mathematical"||(c="middle"):c="alphabetic",l.style.textBaseline=c}var u=p.__inheritedStyle;if(u){var d=u.textAlign,v=d;d&&(d==="middle"&&(v="center"),l.style.textAlign=v)}}(n,t);var o=n.style,i=o.fontSize;i&&i<9&&(o.fontSize=9,n.scaleX*=i/9,n.scaleY*=i/9);var r=(o.fontSize||o.fontFamily)&&[o.fontStyle,o.fontWeight,(o.fontSize||12)+"px",o.fontFamily||"sans-serif"].join(" ");o.font=r;var s=n.getBoundingRect();return this._textX+=s.width,t.add(n),n},a.internalField=void($={g:function(e,t){var n=new G;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n},rect:function(e,t){var n=new W;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),n.silent=!0,n},circle:function(e,t){var n=new ut;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),n.silent=!0,n},line:function(e,t){var n=new ct;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),n.silent=!0,n},ellipse:function(e,t){var n=new gt;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),n.silent=!0,n},polygon:function(e,t){var n,o=e.getAttribute("points");o&&(n=ce(o));var i=new Ge({shape:{points:n||[]},silent:!0});return x(t,i),w(e,i,this._defsUsePending,!1,!1),i},polyline:function(e,t){var n,o=e.getAttribute("points");o&&(n=ce(o));var i=new Ae({shape:{points:n||[]},silent:!0});return x(t,i),w(e,i,this._defsUsePending,!1,!1),i},image:function(e,t){var n=new ht;return x(t,n),w(e,n,this._defsUsePending,!1,!1),n.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),n.silent=!0,n},text:function(e,t){var n=e.getAttribute("x")||"0",o=e.getAttribute("y")||"0",i=e.getAttribute("dx")||"0",r=e.getAttribute("dy")||"0";this._textX=parseFloat(n)+parseFloat(i),this._textY=parseFloat(o)+parseFloat(r);var s=new G;return x(t,s),w(e,s,this._defsUsePending,!1,!0),s},tspan:function(e,t){var n=e.getAttribute("x"),o=e.getAttribute("y");n!=null&&(this._textX=parseFloat(n)),o!=null&&(this._textY=parseFloat(o));var i=e.getAttribute("dx")||"0",r=e.getAttribute("dy")||"0",s=new G;return x(t,s),w(e,s,this._defsUsePending,!1,!0),this._textX+=parseFloat(i),this._textY+=parseFloat(r),s},path:function(e,t){var n=e.getAttribute("d")||"",o=dt(n);return x(t,o),w(e,o,this._defsUsePending,!1,!1),o.silent=!0,o}}),a}(),le={lineargradient:function(a){var e=parseInt(a.getAttribute("x1")||"0",10),t=parseInt(a.getAttribute("y1")||"0",10),n=parseInt(a.getAttribute("x2")||"10",10),o=parseInt(a.getAttribute("y2")||"0",10),i=new ft(e,t,n,o);return pe(a,i),ue(a,i),i},radialgradient:function(a){var e=parseInt(a.getAttribute("cx")||"0",10),t=parseInt(a.getAttribute("cy")||"0",10),n=parseInt(a.getAttribute("r")||"0",10),o=new vt(e,t,n);return pe(a,o),ue(a,o),o}};function pe(a,e){a.getAttribute("gradientUnits")==="userSpaceOnUse"&&(e.global=!0)}function ue(a,e){for(var t=a.firstChild;t;){if(t.nodeType===1&&t.nodeName.toLocaleLowerCase()==="stop"){var n=t.getAttribute("offset"),o=void 0;o=n&&n.indexOf("%")>0?parseInt(n,10)/100:n?parseFloat(n):0;var i={};Ne(t,i,i);var r=i.stopColor||t.getAttribute("stop-color")||"#000000";e.colorStops.push({offset:o,color:r})}t=t.nextSibling}}function x(a,e){a&&a.__inheritedStyle&&(e.__inheritedStyle||(e.__inheritedStyle={}),mt(e.__inheritedStyle,a.__inheritedStyle))}function ce(a){for(var e=z(a),t=[],n=0;n<e.length;n+=2){var o=parseFloat(e[n]),i=parseFloat(e[n+1]);t.push([o,i])}return t}function w(a,e,t,n,o){var i=e,r=i.__inheritedStyle=i.__inheritedStyle||{},s={};a.nodeType===1&&(function(l,p){var h=l.getAttribute("transform");if(h){h=h.replace(/,/g," ");var g=[],c=null;h.replace(Ot,function(b,A,D){return g.push(A,D),""});for(var u=g.length-1;u>0;u-=2){var d=g[u],v=g[u-1],f=z(d);switch(c=c||xt(),v){case"translate":St(c,c,[parseFloat(f[0]),parseFloat(f[1]||"0")]);break;case"scale":_t(c,c,[parseFloat(f[0]),parseFloat(f[1]||f[0])]);break;case"rotate":yt(c,c,-parseFloat(f[0])*H,[parseFloat(f[1]||"0"),parseFloat(f[2]||"0")]);break;case"skewX":var m=Math.tan(parseFloat(f[0])*H);re(c,[1,0,m,1,0,0],c);break;case"skewY":var _=Math.tan(parseFloat(f[0])*H);re(c,[1,_,0,1,0,0],c);break;case"matrix":c[0]=parseFloat(f[0]),c[1]=parseFloat(f[1]),c[2]=parseFloat(f[2]),c[3]=parseFloat(f[3]),c[4]=parseFloat(f[4]),c[5]=parseFloat(f[5])}}p.setLocalTransform(c)}}(a,e),Ne(a,r,s),n||function(l,p,h){for(var g=0;g<ae.length;g++){var c=ae[g];(u=l.getAttribute(c))!=null&&(p[J[c]]=u)}for(g=0;g<se.length;g++){var u;c=se[g],(u=l.getAttribute(c))!=null&&(h[X[c]]=u)}}(a,r,s)),i.style=i.style||{},r.fill!=null&&(i.style.fill=ge(i,"fill",r.fill,t)),r.stroke!=null&&(i.style.stroke=ge(i,"stroke",r.stroke,t)),y(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(l){r[l]!=null&&(i.style[l]=parseFloat(r[l]))}),y(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(l){r[l]!=null&&(i.style[l]=r[l])}),o&&(i.__selfStyle=s),r.lineDash&&(i.style.lineDash=B(z(r.lineDash),function(l){return parseFloat(l)})),r.visibility!=="hidden"&&r.visibility!=="collapse"||(i.invisible=!0),r.display==="none"&&(i.ignore=!0)}var Dt=/^url\(\s*#(.*?)\)/;function ge(a,e,t,n){var o=t&&t.match(Dt);if(!o)return t==="none"&&(t=null),t;var i=wt(o[1]);n.push([a,e,i])}var It=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function z(a){return a.match(It)||[]}var Ot=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,H=Math.PI/180,he=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Ne(a,e,t){var n,o=a.getAttribute("style");if(o)for(he.lastIndex=0;(n=he.exec(o))!=null;){var i=n[1],r=P(J,i)?J[i]:null;r&&(e[r]=n[2]);var s=P(X,i)?X[i]:null;s&&(t[s]=n[2])}}function De(a,e){var t=e.width/a.width,n=e.height/a.height,o=Math.min(t,n);return{scale:o,x:-(a.x+a.width/2)*o+(e.x+e.width/2),y:-(a.y+a.height/2)*o+(e.y+e.height/2)}}var kt=S(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),Lt=function(){function a(e,t){this.type="geoSVG",this._usedGraphicMap=S(),this._freedGraphics=[],this._mapName=e,this._parsedXML=Ce(t)}return a.prototype.load=function(){var e=this._firstGraphic;if(!e){e=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(e),this._boundingRect=this._firstGraphic.boundingRect.clone();var t=function(i){var r=[],s=S();return y(i,function(l){if(l.namedFrom==null){var p=new ot(l.name,l.el);r.push(p),s.set(l.name,p)}}),{regions:r,regionsMap:s}}(e.named),n=t.regions,o=t.regionsMap;this._regions=n,this._regionsMap=o}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},a.prototype._buildGraphic=function(e){var t,n,o,i;try{n=(t=e&&(o=e,i={ignoreViewBox:!0,ignoreRootClip:!0},new Nt().parse(o,i))||{}).root,it(n!=null)}catch(_){throw new Error(`Invalid svg format
`+_.message)}var r=new G;r.add(n),r.isGeoSVGGraphicRoot=!0;var s=t.width,l=t.height,p=t.viewBoxRect,h=this._boundingRect;if(!h){var g=void 0,c=void 0,u=void 0,d=void 0;if(s!=null?(g=0,u=s):p&&(g=p.x,u=p.width),l!=null?(c=0,d=l):p&&(c=p.y,d=p.height),g==null||c==null){var v=n.getBoundingRect();g==null&&(g=v.x,u=v.width),c==null&&(c=v.y,d=v.height)}h=this._boundingRect=new K(g,c,u,d)}if(p){var f=De(p,h);n.scaleX=n.scaleY=f.scale,n.x=f.x,n.y=f.y}r.setClipPath(new W({shape:h.plain()}));var m=[];return y(t.named,function(_){var b;kt.get(_.svgNodeTagLower)!=null&&(m.push(_),(b=_.el).silent=!1,b.isGroup&&b.traverse(function(A){A.silent=!1}))}),{root:r,boundingRect:h,named:m}},a.prototype.useGraphic=function(e){var t=this._usedGraphicMap,n=t.get(e);return n||(n=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),t.set(e,n),n)},a.prototype.freeGraphic=function(e){var t=this._usedGraphicMap,n=t.get(e);n&&(t.removeKey(e),this._freedGraphics.push(n))},a}();for(var q=[126,25],de="南海诸岛",N=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]],C=0;C<N.length;C++)for(var I=0;I<N[C].length;I++)N[C][I][0]/=10.5,N[C][I][1]/=-14,N[C][I][0]+=q[0],N[C][I][1]+=q[1];var Pt={南海诸岛:[32,80],广东:[0,-10],香港:[10,5],澳门:[-10,10],天津:[5,5]},Vt=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]],Ut=function(){function a(e,t,n){var o;this.type="geoJSON",this._parsedMap=S(),this._mapName=e,this._specialAreas=n,this._geoJSON=Y(o=t)?typeof JSON<"u"&&JSON.parse?JSON.parse(o):new Function("return ("+o+");")():o}return a.prototype.load=function(e,t){t=t||"name";var n=this._parsedMap.get(t);if(!n){var o=this._parseToRegions(t);n=this._parsedMap.set(t,{regions:o,boundingRect:Bt(o)})}var i=S(),r=[];return y(n.regions,function(s){var l=s.name;e&&P(e,l)&&(s=s.cloneShallow(l=e[l])),r.push(s),i.set(l,s)}),{regions:r,boundingRect:n.boundingRect||new K(0,0,0,0),regionsMap:i}},a.prototype._parseToRegions=function(e){var t,n=this._mapName,o=this._geoJSON;try{t=o?rt(o,e):[]}catch(i){throw new Error(`Invalid geoJson format
`+i.message)}return function(i,r){if(i==="china"){for(var s=0;s<r.length;s++)if(r[s].name===de)return;r.push(new at(de,B(N,function(l){return{type:"polygon",exterior:l}}),q))}}(n,t),y(t,function(i){var r=i.name;(function(l,p){if(l==="china"){var h=Pt[p.name];if(h){var g=p.getCenter();g[0]+=h[0]/10.5,g[1]+=-h[1]/14,p.setCenter(g)}}})(n,i),function(l,p){l==="china"&&p.name==="台湾"&&p.geometries.push({type:"polygon",exterior:Vt[0]})}(n,i);var s=this._specialAreas&&this._specialAreas[r];s&&i.transformTo(s.left,s.top,s.width,s.height)},this),t},a.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},a}();function Bt(a){for(var e,t=0;t<a.length;t++){var n=a[t].getBoundingRect();(e=e||n.clone()).union(n)}return e}var L=S(),T={registerMap:function(a,e,t){if(e.svg){var n=new Lt(a,e.svg);L.set(a,n)}else{var o=e.geoJson||e.geoJSON;o&&!e.features?t=e.specialAreas:o=e,n=new Ut(a,o,t),L.set(a,n)}},getGeoResource:function(a){return L.get(a)},getMapForUser:function(a){var e=L.get(a);return e&&e.type==="geoJSON"&&e.getMapForUser()},load:function(a,e,t){var n=L.get(a);if(n)return n.load(e,t)}},ee=["rect","circle","line","ellipse","polygon","polyline","path"],Jt=S(ee),Xt=S(ee.concat(["g"])),zt=S(ee.concat(["g"])),Ie=Ve();function V(a){var e=a.getItemStyle(),t=a.get("areaColor");return t!=null&&(e.fill=t),e}function fe(a){var e=a.style;e&&(e.stroke=e.stroke||e.fill,e.fill=null)}var Yt=function(){function a(e){var t=new G;this.uid=et("ec_map_draw"),this._controller=new Rt(e.getZr()),this._controllerHost={target:t},this.group=t,t.add(this._regionsGroup=new G),t.add(this._svgGroup=new G)}return a.prototype.draw=function(e,t,n,o,i){var r=e.mainType==="geo",s=e.getData&&e.getData();r&&t.eachComponent({mainType:"series",subType:"map"},function(f){s||f.getHostGeoModel()!==e||(s=f.getData())});var l=e.coordinateSystem,p=this._regionsGroup,h=this.group,g=l.getTransformInfo(),c=g.raw,u=g.roam;!p.childAt(0)||i?(h.x=u.x,h.y=u.y,h.scaleX=u.scaleX,h.scaleY=u.scaleY,h.dirty()):Ue(h,u,e);var d=s&&s.getVisual("visualMeta")&&s.getVisual("visualMeta").length>0,v={api:n,geo:l,mapOrGeoModel:e,data:s,isVisualEncodedByVisualMap:d,isGeo:r,transformInfoRaw:c};l.resourceType==="geoJSON"?this._buildGeoJSON(v):l.resourceType==="geoSVG"&&this._buildSVG(v),this._updateController(e,t,n),this._updateMapSelectHandler(e,p,n,o)},a.prototype._buildGeoJSON=function(e){var t=this._regionsGroupByName=S(),n=S(),o=this._regionsGroup,i=e.transformInfoRaw,r=e.mapOrGeoModel,s=e.data,l=e.geo.projection,p=l&&l.stream;function h(u,d){return d&&(u=d(u)),u&&[u[0]*i.scaleX+i.x,u[1]*i.scaleY+i.y]}function g(u){for(var d=[],v=!p&&l&&l.project,f=0;f<u.length;++f){var m=h(u[f],v);m&&d.push(m)}return d}function c(u){return{shape:{points:g(u)}}}o.removeAll(),y(e.geo.regions,function(u){var d=u.name,v=t.get(d),f=n.get(d)||{},m=f.dataIdx,_=f.regionModel;v||(v=t.set(d,new G),o.add(v),m=s?s.indexOfName(d):null,_=e.isGeo?r.getRegionModel(d):s?s.getItemModel(m):null,n.set(d,{dataIdx:m,regionModel:_}));var b=[],A=[];y(u.geometries,function(F){if(F.type==="polygon"){var R=[F.exterior].concat(F.interiors||[]);p&&(R=we(R,p)),y(R,function(k){b.push(new Ge(c(k)))})}else{var M=F.points;p&&(M=we(M,p,!0)),y(M,function(k){A.push(new Ae(c(k)))})}});var D=h(u.getCenter(),l&&l.project);function O(F,R){if(F.length){var M=new tt({culling:!0,segmentIgnoreThreshold:1,shape:{paths:F}});v.add(M),ve(e,M,m,_),me(e,M,d,_,r,m,D),R&&(fe(M),y(M.states,fe))}}O(b),O(A,!0)}),t.each(function(u,d){var v=n.get(d),f=v.dataIdx,m=v.regionModel;ye(e,u,d,m,r,f),_e(e,u,d,m,r),Se(e,u,d,m,r)},this)},a.prototype._buildSVG=function(e){var t=e.geo.map,n=e.transformInfoRaw;this._svgGroup.x=n.x,this._svgGroup.y=n.y,this._svgGroup.scaleX=n.scaleX,this._svgGroup.scaleY=n.scaleY,this._svgResourceChanged(t)&&(this._freeSVG(),this._useSVG(t));var o=this._svgDispatcherMap=S(),i=!1;y(this._svgGraphicRecord.named,function(r){var s=r.name,l=e.mapOrGeoModel,p=e.data,h=r.svgNodeTagLower,g=r.el,c=p?p.indexOfName(s):null,u=l.getRegionModel(s);Jt.get(h)!=null&&g instanceof oe&&ve(e,g,c,u),g instanceof oe&&(g.culling=!0),g.z2EmphasisLift=0,r.namedFrom||(zt.get(h)!=null&&me(e,g,s,u,l,c,null),ye(e,g,s,u,l,c),_e(e,g,s,u,l),Xt.get(h)!=null&&(Se(e,g,s,u,l)==="self"&&(i=!0),(o.get(s)||o.set(s,[])).push(g)))},this),this._enableBlurEntireSVG(i,e)},a.prototype._enableBlurEntireSVG=function(e,t){if(e&&t.isGeo){var n=t.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle().opacity;this._svgGraphicRecord.root.traverse(function(o){if(!o.isGroup){Te(o);var i=o.ensureState("blur").style||{};i.opacity==null&&n!=null&&(i.opacity=n),o.ensureState("emphasis")}})}},a.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},a.prototype.findHighDownDispatchers=function(e,t){if(e==null)return[];var n=t.coordinateSystem;if(n.resourceType==="geoJSON"){var o=this._regionsGroupByName;if(o){var i=o.get(e);return i?[i]:[]}}else if(n.resourceType==="geoSVG")return this._svgDispatcherMap&&this._svgDispatcherMap.get(e)||[]},a.prototype._svgResourceChanged=function(e){return this._svgMapName!==e},a.prototype._useSVG=function(e){var t=T.getGeoResource(e);if(t&&t.type==="geoSVG"){var n=t.useGraphic(this.uid);this._svgGroup.add(n.root),this._svgGraphicRecord=n,this._svgMapName=e}},a.prototype._freeSVG=function(){var e=this._svgMapName;if(e!=null){var t=T.getGeoResource(e);t&&t.type==="geoSVG"&&t.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},a.prototype._updateController=function(e,t,n){var o=e.coordinateSystem,i=this._controller,r=this._controllerHost;r.zoomLimit=e.get("scaleLimit"),r.zoom=o.getZoom(),i.enable(e.get("roam")||!1);var s=e.mainType;function l(){var p={type:"geoRoam",componentType:s};return p[s+"Id"]=e.id,p}i.off("pan").on("pan",function(p){this._mouseDownFlag=!1,Gt(r,p.dx,p.dy),n.dispatchAction(U(l(),{dx:p.dx,dy:p.dy,animation:{duration:0}}))},this),i.off("zoom").on("zoom",function(p){this._mouseDownFlag=!1,At(r,p.scale,p.originX,p.originY),n.dispatchAction(U(l(),{zoom:p.scale,originX:p.originX,originY:p.originY,animation:{duration:0}}))},this),i.setPointerChecker(function(p,h,g){return o.containPoint([h,g])&&!Ct(p,n,e)})},a.prototype.resetForLabelLayout=function(){this.group.traverse(function(e){var t=e.getTextContent();t&&(t.ignore=Ie(t).ignore)})},a.prototype._updateMapSelectHandler=function(e,t,n,o){var i=this;t.off("mousedown"),t.off("click"),e.get("selectedMode")&&(t.on("mousedown",function(){i._mouseDownFlag=!0}),t.on("click",function(r){i._mouseDownFlag&&(i._mouseDownFlag=!1)}))},a}();function ve(a,e,t,n){var o=n.getModel("itemStyle"),i=n.getModel(["emphasis","itemStyle"]),r=n.getModel(["blur","itemStyle"]),s=n.getModel(["select","itemStyle"]),l=V(o),p=V(i),h=V(s),g=V(r),c=a.data;if(c){var u=c.getItemVisual(t,"style"),d=c.getItemVisual(t,"decal");a.isVisualEncodedByVisualMap&&u.fill&&(l.fill=u.fill),d&&(l.decal=Be(d,a.api))}e.setStyle(l),e.style.strokeNoScale=!0,e.ensureState("emphasis").style=p,e.ensureState("select").style=h,e.ensureState("blur").style=g,Te(e)}function me(a,e,t,n,o,i,r){var s=a.data,l=a.isGeo,p=s&&isNaN(s.get(s.mapDimension("value"),i)),h=s&&s.getItemLayout(i);if(l||p||h&&h.showLabel){var g=l?t:i,c=void 0;(!s||i>=0)&&(c=o);var u=r?{normal:{align:"center",verticalAlign:"middle"}}:null;Je(e,Xe(n),{labelFetcher:c,labelDataIndex:g,defaultText:t},u);var d=e.getTextContent();if(d&&(Ie(d).ignore=d.ignore,e.textConfig&&r)){var v=e.getBoundingRect().clone();e.textConfig.layoutRect=v,e.textConfig.position=[(r[0]-v.x)/v.width*100+"%",(r[1]-v.y)/v.height*100+"%"]}e.disableLabelAnimation=!0}else e.removeTextContent(),e.removeTextConfig(),e.disableLabelAnimation=null}function ye(a,e,t,n,o,i){a.data?a.data.setItemGraphicEl(i,e):Z(e).eventData={componentType:"geo",componentIndex:o.componentIndex,geoIndex:o.componentIndex,name:t,region:n&&n.option||{}}}function _e(a,e,t,n,o){a.data||ze({el:e,componentModel:o,itemName:t,itemTooltipOption:n.get("tooltip")})}function Se(a,e,t,n,o){e.highDownSilentOnTouch=!!o.get("selectedMode");var i=n.getModel("emphasis"),r=i.get("focus");return Ye(e,r,i.get("blurScope"),i.get("disabled")),a.isGeo&&Ee(e,o,t),r}function we(a,e,t){var n,o=[];function i(){n=[]}function r(){n.length&&(o.push(n),n=[])}var s=e({polygonStart:i,polygonEnd:r,lineStart:i,lineEnd:r,point:function(l,p){isFinite(l)&&isFinite(p)&&n.push([l,p])},sphere:function(){}});return!t&&s.polygonStart(),y(a,function(l){s.lineStart();for(var p=0;p<l.length;p++)s.point(l[p][0],l[p][1]);s.lineEnd()}),!t&&s.polygonEnd(),o}var Et=Yt,jt={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},Oe=["lng","lat"],ke=function(a){function e(t,n,o){var i=a.call(this,t)||this;i.dimensions=Oe,i.type="geo",i._nameCoordMap=S(),i.map=n;var r=o.projection,s=T.load(n,o.nameMap,o.nameProperty),l=T.getGeoResource(n);i.resourceType=l?l.type:null;var p,h=i.regions=s.regions,g=jt[l.type];if(i._regionsMap=s.regionsMap,i.regions=s.regions,i.projection=r,r)for(var c=0;c<h.length;c++){var u=h[c].getBoundingRect(r);(p=p||u.clone()).union(u)}else p=s.boundingRect;return i.setBoundingRect(p.x,p.y,p.width,p.height),i.aspectScale=r?1:nt(o.aspectScale,g.aspectScale),i._invertLongitute=!r&&g.invertLongitute,i}return Q(e,a),e.prototype._transformTo=function(t,n,o,i){var r=this.getBoundingRect(),s=this._invertLongitute;r=r.clone(),s&&(r.y=-r.y-r.height);var l=this._rawTransformable;l.transform=r.calculateTransform(new K(t,n,o,i));var p=l.parent;l.parent=null,l.decomposeTransform(),l.parent=p,s&&(l.scaleY=-l.scaleY),this._updateTransform()},e.prototype.getRegion=function(t){return this._regionsMap.get(t)},e.prototype.getRegionByCoord=function(t){for(var n=this.regions,o=0;o<n.length;o++){var i=n[o];if(i.type==="geoJSON"&&i.contain(t))return n[o]}},e.prototype.addGeoCoord=function(t,n){this._nameCoordMap.set(t,n)},e.prototype.getGeoCoord=function(t){var n=this._regionsMap.get(t);return this._nameCoordMap.get(t)||n&&n.getCenter()},e.prototype.dataToPoint=function(t,n,o){if(Y(t)&&(t=this.getGeoCoord(t)),t){var i=this.projection;return i&&(t=i.project(t)),t&&this.projectedToPoint(t,n,o)}},e.prototype.pointToData=function(t){var n=this.projection;return n&&(t=n.unproject(t)),t&&this.pointToProjected(t)},e.prototype.pointToProjected=function(t){return a.prototype.pointToData.call(this,t)},e.prototype.projectedToPoint=function(t,n,o){return a.prototype.dataToPoint.call(this,t,n,o)},e.prototype.convertToPixel=function(t,n,o){var i=be(n);return i===this?i.dataToPoint(o):null},e.prototype.convertFromPixel=function(t,n,o){var i=be(n);return i===this?i.pointToData(o):null},e}(Re);function be(a){var e=a.geoModel,t=a.seriesModel;return e?e.coordinateSystem:t?t.coordinateSystem||(t.getReferringComponents("geo",je).models[0]||{}).coordinateSystem:null}$e(ke,Re);var xe=ke;function Me(a,e){var t=a.get("boundingCoords");if(t!=null){var n=t[0],o=t[1];if(isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])){var i=this.projection;if(i){var r=n[0],s=n[1],l=o[0],p=o[1];n=[1/0,1/0],o=[-1/0,-1/0];var h=function(O,F,R,M){for(var k=R-O,Pe=M-F,E=0;E<=100;E++){var te=E/100,ne=i.project([O+k*te,F+Pe*te]);Mt(n,n,ne),Ft(o,o,ne)}};h(r,s,l,s),h(l,s,l,p),h(l,p,r,p),h(r,p,l,s)}this.setBoundingRect(n[0],n[1],o[0]-n[0],o[1]-n[1])}}var g,c,u,d=this.getBoundingRect(),v=a.get("layoutCenter"),f=a.get("layoutSize"),m=e.getWidth(),_=e.getHeight(),b=d.width/d.height*this.aspectScale,A=!1;if(v&&f&&(g=[j(v[0],m),j(v[1],_)],c=j(f,Math.min(m,_)),isNaN(g[0])||isNaN(g[1])||isNaN(c)||(A=!0)),A)u={},b>1?(u.width=c,u.height=c/b):(u.height=c,u.width=c*b),u.y=g[1]-u.height/2,u.x=g[0]-u.width/2;else{var D=a.getBoxLayoutParams();D.aspect=b,u=bt(D,{width:m,height:_})}this.setViewRect(u.x,u.y,u.width,u.height),this.setCenter(a.get("center"),e),this.setZoom(a.get("zoom"))}var $t=function(){function a(){this.dimensions=Oe}return a.prototype.create=function(e,t){var n=[];function o(r){return{nameProperty:r.get("nameProperty"),aspectScale:r.get("aspectScale"),projection:r.get("projection")}}e.eachComponent("geo",function(r,s){var l=r.get("map"),p=new xe(l+s,l,U({nameMap:r.get("nameMap")},o(r)));p.zoomLimit=r.get("scaleLimit"),n.push(p),r.coordinateSystem=p,p.model=r,p.resize=Me,p.resize(r,t)}),e.eachSeries(function(r){if(r.get("coordinateSystem")==="geo"){var s=r.get("geoIndex")||0;r.coordinateSystem=n[s]}});var i={};return e.eachSeriesByType("map",function(r){if(!r.getHostGeoModel()){var s=r.getMapType();i[s]=i[s]||[],i[s].push(r)}}),y(i,function(r,s){var l=B(r,function(h){return h.get("nameMap")}),p=new xe(s,s,U({nameMap:st(l)},o(r[0])));p.zoomLimit=lt.apply(null,B(r,function(h){return h.get("scaleLimit")})),n.push(p),p.resize=Me,p.resize(r[0],t),y(r,function(h){h.coordinateSystem=p,function(g,c){y(c.get("geoCoord"),function(u,d){g.addGeoCoord(d,u)})}(p,h)})}),n},a.prototype.getFilledRegions=function(e,t,n,o){for(var i=(e||[]).slice(),r=S(),s=0;s<i.length;s++)r.set(i[s].name,i[s]);var l=T.load(t,n,o);return y(l.regions,function(p){var h=p.name;!r.get(h)&&i.push({name:h})}),i},a}(),Le=new $t,Ht=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return Q(e,a),e.prototype.init=function(t,n,o){var i=T.getGeoResource(t.map);if(i&&i.type==="geoJSON"){var r=t.itemStyle=t.itemStyle||{};"color"in r||(r.color="#eee")}this.mergeDefaultAndTheme(t,o),He(t,"label",["show"])},e.prototype.optionUpdated=function(){var t=this,n=this.option;n.regions=Le.getFilledRegions(n.regions,n.map,n.nameMap,n.nameProperty);var o={};this._optionModelMap=Ze(n.regions||[],function(i,r){var s=r.name;return s&&(i.set(s,new ie(r,t,t.ecModel)),r.selected&&(o[s]=!0)),i},S()),n.selectedMap||(n.selectedMap=o)},e.prototype.getRegionModel=function(t){return this._optionModelMap.get(t)||new ie(null,this,this.ecModel)},e.prototype.getFormattedLabel=function(t,n){var o=this.getRegionModel(t),i=n==="normal"?o.get(["label","formatter"]):o.get(["emphasis","label","formatter"]),r={name:t};return We(i)?(r.status=n,i(r)):Y(i)?i.replace("{a}",t??""):void 0},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.select=function(t){var n=this.option,o=n.selectedMode;o&&(o!=="multiple"&&(n.selectedMap=null),(n.selectedMap||(n.selectedMap={}))[t]=!0)},e.prototype.unSelect=function(t){var n=this.option.selectedMap;n&&(n[t]=!1)},e.prototype.toggleSelected=function(t){this[this.isSelected(t)?"unSelect":"select"](t)},e.prototype.isSelected=function(t){var n=this.option.selectedMap;return!(!n||!n[t])},e.type="geo",e.layoutMode="box",e.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},e}(qe),Zt=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t.focusBlurEnabled=!0,t}return Q(e,a),e.prototype.init=function(t,n){this._api=n},e.prototype.render=function(t,n,o,i){if(this._model=t,!t.get("show"))return this._mapDraw&&this._mapDraw.remove(),void(this._mapDraw=null);this._mapDraw||(this._mapDraw=new Et(o));var r=this._mapDraw;r.draw(t,n,o,this,i),r.group.on("click",this._handleRegionClick,this),r.group.silent=t.get("silent"),this.group.add(r.group),this.updateSelectStatus(t,n,o)},e.prototype._handleRegionClick=function(t){var n;Qe(t.target,function(o){return(n=Z(o).eventData)!=null},!0),n&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:n.name})},e.prototype.updateSelectStatus=function(t,n,o){var i=this;this._mapDraw.group.traverse(function(r){var s=Z(r).eventData;if(s)return i._model.isSelected(s.name)?o.enterSelect(r):o.leaveSelect(r),!0})},e.prototype.findHighDownDispatchers=function(t){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(t,this._model)},e.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},e.type="geo",e}(Ke);function Wt(a,e,t){T.registerMap(a,e,t)}function qt(a){function e(t,n){n.update="geo:updateSelectStatus",a.registerAction(n,function(o,i){var r={},s=[];return i.eachComponent({mainType:"geo",query:o},function(l){l[t](o.name);var p=l.coordinateSystem;y(p.regions,function(g){r[g.name]=l.isSelected(g.name)||!1});var h=[];y(r,function(g,c){r[c]&&h.push(c)}),s.push({geoIndex:l.componentIndex,name:h})}),{selected:r,allSelected:s,name:o.name}})}a.registerCoordinateSystem("geo",Le),a.registerComponentModel(Ht),a.registerComponentView(Zt),a.registerImpl("registerMap",Wt),a.registerImpl("getMap",function(t){return T.getMapForUser(t)}),e("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),e("select",{type:"geoSelect",event:"geoselected"}),e("unSelect",{type:"geoUnSelect",event:"geounselected"}),a.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(t,n,o){var i=t.componentType||"series";n.eachComponent({mainType:i,query:t},function(r){var s=r.coordinateSystem;if(s.type==="geo"){var l=Tt(s,t,r.get("scaleLimit"),o);r.setCenter&&r.setCenter(l.center),r.setZoom&&r.setZoom(l.zoom),i==="series"&&y(r.seriesGroup,function(p){p.setCenter(l.center),p.setZoom(l.zoom)})}})})}var on=Object.freeze({__proto__:null,install:qt});export{Et as M,on as a,T as g,qt as i};
