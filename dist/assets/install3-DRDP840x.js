import{e as E,bK as Z,bL as X,ab as ee,bM as te,bP as re,bV as O,bU as ie,E as Q,bJ as oe,at as ne,b_ as U,D as ae,i as R,ae as z,b$ as se,c0 as W,j as le,N as ue,aB as pe}from"./index-CfHuJ7al.js";import{h as ce}from"./createClipPathFromCoordSys-EzrP_TBP.js";import{r as ge}from"./whiskerBoxCommon-B12IoZYv.js";import"./createSeriesDataSimply-Bg1XfDqc.js";var de=["color","borderColor"],he=function(o){function t(){var e=o!==null&&o.apply(this,arguments)||this;return e.type=t.type,e}return E(t,o),t.prototype.render=function(e,r,i){this.group.removeClipPath(),this._progressiveEls=null,this._updateDrawMode(e),this._isLargeDraw?this._renderLarge(e):this._renderNormal(e)},t.prototype.incrementalPrepareRender=function(e,r,i){this._clear(),this._updateDrawMode(e)},t.prototype.incrementalRender=function(e,r,i,n){this._progressiveEls=[],this._isLargeDraw?this._incrementalRenderLarge(e,r):this._incrementalRenderNormal(e,r)},t.prototype.eachRendered=function(e){Z(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var r=e.pipelineContext.large;this._isLargeDraw!=null&&r===this._isLargeDraw||(this._isLargeDraw=r,this._clear())},t.prototype._renderNormal=function(e){var r=e.getData(),i=this._data,n=this.group,s=r.getLayout("isSimpleBox"),d=e.get("clip",!0),y=e.coordinateSystem,v=y.getArea&&y.getArea();this._data||n.removeAll(),r.diff(i).add(function(u){if(r.hasValue(u)){var p=r.getItemLayout(u);if(d&&F(v,p))return;var l=A(p,u,!0);X(l,{shape:{points:p.ends}},e,u),V(l,r,u,s),n.add(l),r.setItemGraphicEl(u,l)}}).update(function(u,p){var l=i.getItemGraphicEl(p);if(r.hasValue(u)){var a=r.getItemLayout(u);d&&F(v,a)?n.remove(l):(l?(ee(l,{shape:{points:a.ends}},e,u),te(l)):l=A(a),V(l,r,u,s),n.add(l),r.setItemGraphicEl(u,l))}else n.remove(l)}).remove(function(u){var p=i.getItemGraphicEl(u);p&&n.remove(p)}).execute(),this._data=r},t.prototype._renderLarge=function(e){this._clear(),H(e,this.group);var r=e.get("clip",!0)?ce(e.coordinateSystem,!1,e):null;r?this.group.setClipPath(r):this.group.removeClipPath()},t.prototype._incrementalRenderNormal=function(e,r){for(var i,n=r.getData(),s=n.getLayout("isSimpleBox");(i=e.next())!=null;){var d=A(n.getItemLayout(i));V(d,n,i,s),d.incremental=!0,this.group.add(d),this._progressiveEls.push(d)}},t.prototype._incrementalRenderLarge=function(e,r){H(r,this.group,this._progressiveEls,!0)},t.prototype.remove=function(e){this._clear()},t.prototype._clear=function(){this.group.removeAll(),this._data=null},t.type="candlestick",t}(re),me=function(){},fe=function(o){function t(e){var r=o.call(this,e)||this;return r.type="normalCandlestickBox",r}return E(t,o),t.prototype.getDefaultShape=function(){return new me},t.prototype.buildPath=function(e,r){var i=r.points;this.__simpleBox?(e.moveTo(i[4][0],i[4][1]),e.lineTo(i[6][0],i[6][1])):(e.moveTo(i[0][0],i[0][1]),e.lineTo(i[1][0],i[1][1]),e.lineTo(i[2][0],i[2][1]),e.lineTo(i[3][0],i[3][1]),e.closePath(),e.moveTo(i[4][0],i[4][1]),e.lineTo(i[5][0],i[5][1]),e.moveTo(i[6][0],i[6][1]),e.lineTo(i[7][0],i[7][1]))},t}(O);function A(o,t,e){var r=o.ends;return new fe({shape:{points:e?ye(r,o):r},z2:100})}function F(o,t){for(var e=!0,r=0;r<t.ends.length;r++)if(o.contain(t.ends[r][0],t.ends[r][1])){e=!1;break}return e}function V(o,t,e,r){var i=t.getItemModel(e);o.useStyle(t.getItemVisual(e,"style")),o.style.strokeNoScale=!0,o.__simpleBox=r,ie(o,i)}function ye(o,t){return Q(o,function(e){return(e=e.slice())[1]=t.initBaseline,e})}var ve=function(){},j=function(o){function t(e){var r=o.call(this,e)||this;return r.type="largeCandlestickBox",r}return E(t,o),t.prototype.getDefaultShape=function(){return new ve},t.prototype.buildPath=function(e,r){for(var i=r.points,n=0;n<i.length;)if(this.__sign===i[n++]){var s=i[n++];e.moveTo(s,i[n++]),e.lineTo(s,i[n++])}else n+=3},t}(O);function H(o,t,e,r){var i=o.getData().getLayout("largePoints"),n=new j({shape:{points:i},__sign:1,ignoreCoarsePointer:!0});t.add(n);var s=new j({shape:{points:i},__sign:-1,ignoreCoarsePointer:!0});t.add(s);var d=new j({shape:{points:i},__sign:0,ignoreCoarsePointer:!0});t.add(d),$(1,n,o),$(-1,s,o),$(0,d,o),r&&(n.incremental=!0,s.incremental=!0),e&&e.push(n,s)}function $(o,t,e,r){var i=e.get(["itemStyle",o>0?"borderColor":"borderColor0"])||e.get(["itemStyle",o>0?"color":"color0"]);o===0&&(i=e.get(["itemStyle","borderColorDoji"]));var n=e.getModel("itemStyle").getItemStyle(de);t.useStyle(n),t.style.fill=null,t.style.stroke=i}var _e=he,J=function(o){function t(){var e=o!==null&&o.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],e}return E(t,o),t.prototype.getShadowDim=function(){return"open"},t.prototype.brushSelector=function(e,r,i){var n=r.getItemLayout(e);return n&&i.rect(n.brushRect)},t.type="series.candlestick",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderColorDoji:null,borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},t}(oe);ne(J,ge,!0);var be=J;function Se(o){o&&le(o.series)&&ue(o.series,function(t){pe(t)&&t.type==="k"&&(t.type="candlestick")})}var Ne=["itemStyle","borderColor"],xe=["itemStyle","borderColor0"],De=["itemStyle","borderColorDoji"],Le=["itemStyle","color"],Te=["itemStyle","color0"],Ce={seriesType:"candlestick",plan:U(),performRawSeries:!0,reset:function(o,t){function e(i,n){return n.get(i>0?Le:Te)}function r(i,n){return n.get(i===0?De:i>0?Ne:xe)}if(!t.isSeriesFiltered(o))return!o.pipelineContext.large&&{progress:function(i,n){for(var s;(s=i.next())!=null;){var d=n.getItemModel(s),y=n.getItemLayout(s).sign,v=d.getItemStyle();v.fill=e(y,d),v.stroke=r(y,d)||v.fill;var u=n.ensureUniqueItemVisual(s,"style");ae(u,v)}}}}};function q(o,t,e,r,i,n){return e>r?-1:e<r?1:n?0:t>0?o.get(i,t-1)<=r?1:-1:1}var we={seriesType:"candlestick",plan:U(),reset:function(o){var t=o.coordinateSystem,e=o.getData(),r=function(p,l){var a,c=p.getBaseAxis(),g=c.type==="category"?c.getBandWidth():(a=c.getExtent(),Math.abs(a[1]-a[0])/l.count()),h=R(z(p.get("barMaxWidth"),g),g),m=R(z(p.get("barMinWidth"),1),g),S=p.get("barWidth");return S!=null?R(S,g):Math.max(Math.min(g/2,h),m)}(o,e),i=["x","y"],n=e.getDimensionIndex(e.mapDimension(i[0])),s=Q(e.mapDimensionsAll(i[1]),e.getDimensionIndex,e),d=s[0],y=s[1],v=s[2],u=s[3];if(e.setLayout({candleWidth:r,isSimpleBox:r<=1.3}),!(n<0||s.length<4))return{progress:o.pipelineContext.large?function(p,l){for(var a,c,g=se(4*p.count),h=0,m=[],S=[],_=l.getStore(),B=!!o.get(["itemStyle","borderColorDoji"]);(c=p.next())!=null;){var w=_.get(n,c),T=_.get(d,c),C=_.get(y,c),I=_.get(v,c),M=_.get(u,c);isNaN(w)||isNaN(I)||isNaN(M)?(g[h++]=NaN,h+=3):(g[h++]=q(_,c,T,C,y,B),m[0]=w,m[1]=I,a=t.dataToPoint(m,null,S),g[h++]=a?a[0]:NaN,g[h++]=a?a[1]:NaN,m[1]=M,a=t.dataToPoint(m,null,S),g[h++]=a?a[1]:NaN)}l.setLayout("largePoints",g)}:function(p,l){for(var a,c=l.getStore();(a=p.next())!=null;){var g=c.get(n,a),h=c.get(d,a),m=c.get(y,a),S=c.get(v,a),_=c.get(u,a),B=Math.min(h,m),w=Math.max(h,m),T=L(B,g),C=L(w,g),I=L(S,g),M=L(_,g),P=[];G(P,C,0),G(P,T,1),P.push(k(M),k(C),k(I),k(T));var K=!!l.getItemModel(a).get(["itemStyle","borderColorDoji"]);l.setItemLayout(a,{sign:q(c,a,h,m,y,K),initBaseline:h>m?C[1]:T[1],ends:P,brushRect:Y(S,_,g)})}function L(f,x){var N=[];return N[0]=x,N[1]=f,isNaN(x)||isNaN(f)?[NaN,NaN]:t.dataToPoint(N)}function G(f,x,N){var b=x.slice(),D=x.slice();b[0]=W(b[0]+r/2,1,!1),D[0]=W(D[0]-r/2,1,!0),N?f.push(b,D):f.push(D,b)}function Y(f,x,N){var b=L(f,N),D=L(x,N);return b[0]-=r/2,D[0]-=r/2,{x:b[0],y:b[1],width:r,height:D[1]-b[1]}}function k(f){return f[0]=W(f[0],1),f}}}}};function Ee(o){o.registerChartView(_e),o.registerSeriesModel(be),o.registerPreprocessor(Se),o.registerVisual(Ce),o.registerLayout(we)}export{Ee as install};
