import{e as v,N as m,H as I,p as N,y as O,D,$ as M,C as L,a5 as G,o as T,av as R,d6 as X,T as P,P as q,at as Y,au as Z,A as j,aD as F,z as H,E as w,_ as C,aB as V,as as $,g as J,aJ as Q,aI as K,Z as U,aq as tt,ar as et,S as it,cg as at,aF as nt}from"./index-B7CpzWKR.js";import{n as ot}from"./sliderMove-mmwzGRlj.js";import{u as st}from"./axisModelCreator-DzR5bh5I.js";import{C as rt}from"./AxisBuilder-BRJQ1q1N.js";import{h as lt,l as pt,p as ut,g as ht}from"./brushHelper-Du1skZR7.js";import"./axisDefault-Cv7m09NZ.js";import"./interactionMutex-DyFWCbR8.js";import"./labelLayoutHelper-P1A9xGnK.js";import"./cursorHelper-IgNoiH07.js";function dt(a){(function(e){if(!e.parallel){var t=!1;m(e.series,function(i){i&&i.type==="parallel"&&(t=!0)}),t&&(e.parallel=[{}])}})(a),function(e){var t=C(e.parallelAxis);m(t,function(i){if(V(i)){var n=i.parallelIndex||0,o=C(e.parallel)[n];o&&o.parallelAxisDefault&&L(i,o.parallelAxisDefault,!1)}})}(a)}var xt=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return v(e,a),e.prototype.render=function(t,i,n){this._model=t,this._api=n,this._handlers||(this._handlers={},m(ct,function(o,r){n.getZr().on(r,this._handlers[r]=I(o,this))},this)),N(this,"_throttledDispatchExpand",t.get("axisExpandRate"),"fixRate")},e.prototype.dispose=function(t,i){O(this,"_throttledDispatchExpand"),m(this._handlers,function(n,o){i.getZr().off(o,n)}),this._handlers=null},e.prototype._throttledDispatchExpand=function(t){this._dispatchExpand(t)},e.prototype._dispatchExpand=function(t){t&&this._api.dispatchAction(D({type:"parallelAxisExpand"},t))},e.type="parallel",e}(M),ct={mousedown:function(a){E(this,"click")&&(this._mouseDownPoint=[a.offsetX,a.offsetY])},mouseup:function(a){var e=this._mouseDownPoint;if(E(this,"click")&&e){var t=[a.offsetX,a.offsetY];if(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)>5)return;var i=this._model.coordinateSystem.getSlidedAxisExpandWindow([a.offsetX,a.offsetY]);i.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:i.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(a){if(!this._mouseDownPoint&&E(this,"mousemove")){var e=this._model,t=e.coordinateSystem.getSlidedAxisExpandWindow([a.offsetX,a.offsetY]),i=t.behavior;i==="jump"&&this._throttledDispatchExpand.debounceNextCall(e.get("axisExpandDebounce")),this._throttledDispatchExpand(i==="none"?null:{axisExpandWindow:t.axisExpandWindow,animation:i==="jump"?null:{duration:0}})}}};function E(a,e){var t=a._model;return t.get("axisExpandable")&&t.get("axisExpandTriggerOn")===e}var ft=xt,mt=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return v(e,a),e.prototype.init=function(){a.prototype.init.apply(this,arguments),this.mergeOption({})},e.prototype.mergeOption=function(t){var i=this.option;t&&L(i,t,!0),this._initDimensions()},e.prototype.contains=function(t,i){var n=t.get("parallelIndex");return n!=null&&i.getComponent("parallel",n)===this},e.prototype.setAxisExpand=function(t){m(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(i){t.hasOwnProperty(i)&&(this.option[i]=t[i])},this)},e.prototype._initDimensions=function(){var t=this.dimensions=[],i=this.parallelAxisIndex=[],n=G(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(o){return(o.get("parallelIndex")||0)===this.componentIndex},this);m(n,function(o){t.push("dim"+o.get("dim")),i.push(o.componentIndex)})},e.type="parallel",e.dependencies=["parallelAxis"],e.layoutMode="box",e.defaultOption={z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},e}(T),yt=function(a){function e(t,i,n,o,r){var s=a.call(this,t,i,n)||this;return s.type=o||"value",s.axisIndex=r,s}return v(e,a),e.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"},e}(R),A=m,B=Math.min,k=Math.max,b=Math.floor,gt=Math.ceil,S=at,vt=Math.PI,_t=function(){function a(e,t,i){this.type="parallel",this._axesMap=J(),this._axesLayout={},this.dimensions=e.dimensions,this._model=e,this._init(e,t,i)}return a.prototype._init=function(e,t,i){var n=e.dimensions,o=e.parallelAxisIndex;A(n,function(r,s){var l=o[s],h=t.getComponent("parallelAxis",l),p=this._axesMap.set(r,new yt(r,Q(h),[0,0],h.get("type"),l)),u=p.type==="category";p.onBand=u&&h.get("boundaryGap"),p.inverse=h.get("inverse"),h.axis=p,p.model=h,p.coordinateSystem=h.coordinateSystem=this},this)},a.prototype.update=function(e,t){this._updateAxesFromSeries(this._model,e)},a.prototype.containPoint=function(e){var t=this._makeLayoutInfo(),i=t.axisBase,n=t.layoutBase,o=t.pixelDimIndex,r=e[1-o],s=e[o];return r>=i&&r<=i+t.axisLength&&s>=n&&s<=n+t.layoutLength},a.prototype.getModel=function(){return this._model},a.prototype._updateAxesFromSeries=function(e,t){t.eachSeries(function(i){if(e.contains(i,t)){var n=i.getData();A(this.dimensions,function(o){var r=this._axesMap.get(o);r.scale.unionExtentFromData(n,n.mapDimension(o)),K(r.scale,r.model)},this)}},this)},a.prototype.resize=function(e,t){this._rect=U(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),this._layoutAxes()},a.prototype.getRect=function(){return this._rect},a.prototype._makeLayoutInfo=function(){var e,t=this._model,i=this._rect,n=["x","y"],o=["width","height"],r=t.get("layout"),s=r==="horizontal"?0:1,l=i[o[s]],h=[0,l],p=this.dimensions.length,u=_(t.get("axisExpandWidth"),h),c=_(t.get("axisExpandCount")||0,[0,p]),d=t.get("axisExpandable")&&p>3&&p>c&&c>1&&u>0&&l>0,x=t.get("axisExpandWindow");x?(e=_(x[1]-x[0],h),x[1]=x[0]+e):(e=_(u*(c-1),h),(x=[u*(t.get("axisExpandCenter")||b(p/2))-e/2])[1]=x[0]+e);var f=(l-e)/(p-c);f<3&&(f=0);var y=[b(S(x[0]/u,1))+1,gt(S(x[1]/u,1))-1],g=f/u*x[0];return{layout:r,pixelDimIndex:s,layoutBase:i[n[s]],layoutLength:l,axisBase:i[n[1-s]],axisLength:i[o[1-s]],axisExpandable:d,axisExpandWidth:u,axisCollapseWidth:f,axisExpandWindow:x,axisCount:p,winInnerIndices:y,axisExpandWindow0Pos:g}},a.prototype._layoutAxes=function(){var e=this._rect,t=this._axesMap,i=this.dimensions,n=this._makeLayoutInfo(),o=n.layout;t.each(function(r){var s=[0,n.axisLength],l=r.inverse?1:0;r.setExtent(s[l],s[1-l])}),A(i,function(r,s){var l=(n.axisExpandable?At:Et)(s,n),h={horizontal:{x:l.position,y:n.axisLength},vertical:{x:0,y:l.position}},p={horizontal:vt/2,vertical:0},u=[h[o].x+e.x,h[o].y+e.y],c=p[o],d=nt();tt(d,d,c),et(d,d,u),this._axesLayout[r]={position:u,rotation:c,transform:d,axisNameAvailableWidth:l.axisNameAvailableWidth,axisLabelShow:l.axisLabelShow,nameTruncateMaxWidth:l.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)},a.prototype.getAxis=function(e){return this._axesMap.get(e)},a.prototype.dataToPoint=function(e,t){return this.axisCoordToPoint(this._axesMap.get(t).dataToCoord(e),t)},a.prototype.eachActiveState=function(e,t,i,n){i==null&&(i=0),n==null&&(n=e.count());var o=this._axesMap,r=this.dimensions,s=[],l=[];m(r,function(f){s.push(e.mapDimension(f)),l.push(o.get(f).model)});for(var h=this.hasAxisBrushed(),p=i;p<n;p++){var u=void 0;if(h){u="active";for(var c=e.getValues(s,p),d=0,x=r.length;d<x;d++)if(l[d].getActiveState(c[d])==="inactive"){u="inactive";break}}else u="normal";t(u,p)}},a.prototype.hasAxisBrushed=function(){for(var e=this.dimensions,t=this._axesMap,i=!1,n=0,o=e.length;n<o;n++)t.get(e[n]).model.getActiveState()!=="normal"&&(i=!0);return i},a.prototype.axisCoordToPoint=function(e,t){var i=this._axesLayout[t];return it([e,0],i.transform)},a.prototype.getAxisLayout=function(e){return P(this._axesLayout[e])},a.prototype.getSlidedAxisExpandWindow=function(e){var t=this._makeLayoutInfo(),i=t.pixelDimIndex,n=t.axisExpandWindow.slice(),o=n[1]-n[0],r=[0,t.axisExpandWidth*(t.axisCount-1)];if(!this.containPoint(e))return{behavior:"none",axisExpandWindow:n};var s,l=e[i]-t.layoutBase-t.axisExpandWindow0Pos,h="slide",p=t.axisCollapseWidth,u=this._model.get("axisExpandSlideTriggerArea"),c=u[0]!=null;if(p)c&&p&&l<o*u[0]?(h="jump",s=l-o*u[2]):c&&p&&l>o*(1-u[0])?(h="jump",s=l-o*(1-u[2])):(s=l-o*u[1])>=0&&(s=l-o*(1-u[1]))<=0&&(s=0),(s*=t.axisExpandWidth/p)?ot(s,n,r,"all"):h="none";else{var d=n[1]-n[0];(n=[k(0,r[1]*l/d-d/2)])[1]=B(r[1],n[0]+d),n[0]=n[1]-d}return{axisExpandWindow:n,behavior:h}},a}();function _(a,e){return B(k(a,e[0]),e[1])}function Et(a,e){var t=e.layoutLength/(e.axisCount-1);return{position:t*a,axisNameAvailableWidth:t,axisLabelShow:!0}}function At(a,e){var t,i,n=e.layoutLength,o=e.axisExpandWidth,r=e.axisCount,s=e.axisCollapseWidth,l=e.winInnerIndices,h=s,p=!1;return a<l[0]?(t=a*s,i=s):a<=l[1]?(t=e.axisExpandWindow0Pos+a*o-e.axisExpandWindow[0],h=o,p=!0):(t=n-(r-1-a)*s,i=s),{position:t,axisNameAvailableWidth:h,axisLabelShow:p,nameTruncateMaxWidth:i}}var wt={create:function(a,e){var t=[];return a.eachComponent("parallel",function(i,n){var o=new _t(i,a,e);o.name="parallel_"+n,o.resize(i,e),i.coordinateSystem=o,o.model=i,t.push(o)}),a.eachSeries(function(i){if(i.get("coordinateSystem")==="parallel"){var n=i.getReferringComponents("parallel",$).models[0];i.coordinateSystem=n.coordinateSystem}}),t}},z=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t.activeIntervals=[],t}return v(e,a),e.prototype.getAreaSelectStyle=function(){return X([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},e.prototype.setActiveIntervals=function(t){var i=this.activeIntervals=P(t);if(i)for(var n=i.length-1;n>=0;n--)q(i[n])},e.prototype.getActiveState=function(t){var i=this.activeIntervals;if(!i.length)return"normal";if(t==null||isNaN(+t))return"inactive";if(i.length===1){var n=i[0];if(n[0]<=t&&t<=n[1])return"active"}else for(var o=0,r=i.length;o<r;o++)if(i[o][0]<=t&&t<=i[o][1])return"active";return"inactive"},e}(T);Y(z,Z);var W=z,Ct=["axisLine","axisTickLabel","axisName"],bt=function(a){function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return v(e,a),e.prototype.init=function(t,i){a.prototype.init.apply(this,arguments),(this._brushController=new lt(i.getZr())).on("brush",I(this._onBrush,this))},e.prototype.render=function(t,i,n,o){if(!function(f,y,g){return g&&g.type==="axisAreaSelect"&&y.findComponents({mainType:"parallelAxis",query:g})[0]===f}(t,i,o)){this.axisModel=t,this.api=n,this.group.removeAll();var r=this._axisGroup;if(this._axisGroup=new j,this.group.add(this._axisGroup),t.get("show")){var s=function(f,y){return y.getComponent("parallel",f.get("parallelIndex"))}(t,i),l=s.coordinateSystem,h=t.getAreaSelectStyle(),p=h.width,u=t.axis.dim,c=l.getAxisLayout(u),d=D({strokeContainThreshold:p},c),x=new rt(t,d);m(Ct,x.add,x),this._axisGroup.add(x.getGroup()),this._refreshBrushController(d,h,t,s,p,n),F(r,this._axisGroup,t)}}},e.prototype._refreshBrushController=function(t,i,n,o,r,s){var l=n.axis.getExtent(),h=l[1]-l[0],p=Math.min(30,.1*Math.abs(h)),u=H.create({x:l[0],y:-r/2,width:h,height:r});u.x-=p,u.width+=2*p,this._brushController.mount({enableGlobalPan:!0,rotation:t.rotation,x:t.position[0],y:t.position[1]}).setPanels([{panelId:"pl",clipPath:pt(u),isTargetByCursor:ut(u,s,o),getLinearBrushOtherExtent:ht(u,0)}]).enableBrush({brushType:"lineX",brushStyle:i,removeOnClick:!0}).updateCovers(function(c){var d=c.axis;return w(c.activeIntervals,function(x){return{brushType:"lineX",panelId:"pl",range:[d.dataToCoord(x[0],!0),d.dataToCoord(x[1],!0)]}})}(n))},e.prototype._onBrush=function(t){var i=t.areas,n=this.axisModel,o=n.axis,r=w(i,function(s){return[o.coordToData(s.range[0],!0),o.coordToData(s.range[1],!0)]});(!n.option.realtime===t.isEnd||t.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:r})},e.prototype.dispose=function(){this._brushController.dispose()},e.type="parallelAxis",e}(M),St={type:"axisAreaSelect",event:"axisAreaSelected"},Wt={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function Nt(a){a.registerComponentView(ft),a.registerComponentModel(mt),a.registerCoordinateSystem("parallel",wt),a.registerPreprocessor(dt),a.registerComponentModel(W),a.registerComponentView(bt),st(a,"parallel",W,Wt),function(e){e.registerAction(St,function(t,i){i.eachComponent({mainType:"parallelAxis",query:t},function(n){n.axis.model.setActiveIntervals(t.intervals)})}),e.registerAction("parallelAxisExpand",function(t,i){i.eachComponent({mainType:"parallel",query:t},function(n){n.setAxisExpand(t)})})}(a)}export{Nt as install};
