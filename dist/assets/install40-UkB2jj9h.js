import{g as P,ac as G,bq as u,N as D,bu as _,bv as F,bw as L,bx as A,_ as C,ag as $,by as q,j as R,E,aB as M,bz as T,G as x,bA as Y,ap as j}from"./index-DqzYUymv.js";var I={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},z=function(){function e(r){(this._condVal=x(r)?new RegExp(r):Y(r)?r:null)==null&&u("")}return e.prototype.evaluate=function(r){var n=typeof r;return x(n)?this._condVal.test(r):!!j(n)&&this._condVal.test(r+"")},e}(),B=function(){function e(){}return e.prototype.evaluate=function(){return this.value},e}(),J=function(){function e(){}return e.prototype.evaluate=function(){for(var r=this.children,n=0;n<r.length;n++)if(!r[n].evaluate())return!1;return!0},e}(),N=function(){function e(){}return e.prototype.evaluate=function(){for(var r=this.children,n=0;n<r.length;n++)if(r[n].evaluate())return!0;return!1},e}(),X=function(){function e(){}return e.prototype.evaluate=function(){return!this.child.evaluate()},e}(),k=function(){function e(){}return e.prototype.evaluate=function(){for(var r=!!this.valueParser,n=(0,this.getValue)(this.valueGetterParam),t=r?this.valueParser(n):null,a=0;a<this.subCondList.length;a++)if(!this.subCondList[a].evaluate(r?t:n))return!1;return!0},e}();function b(e,r){if(e===!0||e===!1){var n=new B;return n.value=e,n}return y(e)||u(""),e.and?w("and",e,r):e.or?w("or",e,r):e.not?function(t,a){var s=t.not,d="";y(s)||u(d);var i=new X;return i.child=b(s,a),i.child||u(d),i}(e,r):function(t,a){for(var s="",d=a.prepareGetValue(t),i=[],m=$(t),p=t.parser,f=p?_(p):null,c=0;c<m.length;c++){var o=m[c];if(o!=="parser"&&!a.valueGetterAttrMap.get(o)){var l=G(I,o)?I[o]:o,v=t[o],h=f?f(v):v,g=q(l,h)||l==="reg"&&new z(h);g||u(s),i.push(g)}}i.length||u(s);var V=new k;return V.valueGetterParam=d,V.valueParser=f,V.getValue=a.getValue,V.subCondList=i,V}(e,r)}function w(e,r,n){var t=r[e];R(t)||u(""),t.length||u("");var a=e==="and"?new J:new N;return a.children=E(t,function(s){return b(s,n)}),a.children.length||u(""),a}function y(e){return M(e)&&!T(e)}var H=function(){function e(r,n){this._cond=b(r,n)}return e.prototype.evaluate=function(){return this._cond.evaluate()},e}(),K={type:"echarts:filter",transform:function(e){for(var r,n,t,a=e.upstream,s=(n=e.config,t={valueGetterAttrMap:P({dimension:!0}),prepareGetValue:function(p){var f=p.dimension;G(p,"dimension")||u("");var c=a.getDimensionInfo(f);return c||u(""),{dimIdx:c.index}},getValue:function(p){return a.retrieveValueFromItem(r,p.dimIdx)}},new H(n,t)),d=[],i=0,m=a.count();i<m;i++)r=a.getRawDataItem(i),s.evaluate()&&d.push(r);return{data:d}}},O={type:"echarts:sort",transform:function(e){var r=e.upstream,n=e.config,t="",a=C(n);a.length||u(t);var s=[];D(a,function(f){var c=f.dimension,o=f.order,l=f.parser,v=f.incomparable;c==null&&u(t),o!=="asc"&&o!=="desc"&&u(t),v&&v!=="min"&&v!=="max"&&u(""),o!=="asc"&&o!=="desc"&&u("");var h=r.getDimensionInfo(c);h||u(t);var g=l?_(l):null;l&&!g&&u(t),s.push({dimIdx:h.index,parser:g,comparator:new F(o,v)})});var d=r.sourceFormat;d!==L&&d!==A&&u(t);for(var i=[],m=0,p=r.count();m<p;m++)i.push(r.getRawDataItem(m));return i.sort(function(f,c){for(var o=0;o<s.length;o++){var l=s[o],v=r.retrieveValueFromItem(f,l.dimIdx),h=r.retrieveValueFromItem(c,l.dimIdx);l.parser&&(v=l.parser(v),h=l.parser(h));var g=l.comparator.evaluate(v,h);if(g!==0)return g}return 0}),{data:i}}};function S(e){e.registerTransform(K),e.registerTransform(O)}export{S as install};
