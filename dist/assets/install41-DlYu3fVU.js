import{e as w,H as x,_ as yt,N as y,j as L,G as mt,U as _t,C as K,T as I,o as St,M as st,X as lt,ba as Mt,c as ut,a9 as xt,$ as bt,d as T,w as O,y as C,aU as X,K as A,P as B,bA as It,ag as Lt,D as Vt,bB as wt,Q as H,Y as E,bC as Tt,be as Ot,a7 as Rt,a0 as Ct,E as ht,bD as U,aK as zt,am as Dt,W as Y,V as pt,Z as kt,A as Ht,aA as ct,bE as Et}from"./index-B3HKDY-B.js";import{D as b}from"./VisualMapping-DFmadKjM.js";import{p as Pt,u as Z,l as At}from"./visualSolution-80RCasw7.js";import{n as Bt}from"./sliderMove-mmwzGRlj.js";var dt=function(h,n,t){var e=I((Gt[h]||{})[n]);return t&&L(e)?e[e.length-1]:e},Gt={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}},j=b.mapVisual,Ft=b.eachVisual,Nt=L,q=y,Wt=st,Kt=pt,z=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t.stateList=["inRange","outOfRange"],t.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],t.layoutMode={type:"box",ignoreSize:!0},t.dataBound=[-1/0,1/0],t.targetVisuals={},t.controllerVisuals={},t}return w(n,h),n.prototype.init=function(t,e,i){this.mergeDefaultAndTheme(t,i)},n.prototype.optionUpdated=function(t,e){var i=this.option;!e&&Pt(i,t,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},n.prototype.resetVisual=function(t){var e=this.stateList;t=x(t,this),this.controllerVisuals=Z(this.option.controller,e,t),this.targetVisuals=Z(this.option.target,e,t)},n.prototype.getItemSymbol=function(){return null},n.prototype.getTargetSeriesIndices=function(){var t=this.option.seriesIndex,e=[];return t==null||t==="all"?this.ecModel.eachSeries(function(i,o){e.push(o)}):e=yt(t),e},n.prototype.eachTargetSeries=function(t,e){y(this.getTargetSeriesIndices(),function(i){var o=this.ecModel.getSeriesByIndex(i);o&&t.call(e,o)},this)},n.prototype.isTargetSeries=function(t){var e=!1;return this.eachTargetSeries(function(i){i===t&&(e=!0)}),e},n.prototype.formatValueText=function(t,e,i){var o,a=this.option,r=a.precision,s=this.dataBound,p=a.formatter;i=i||["<",">"],L(t)&&(t=t.slice(),o=!0);var l=e?t:o?[u(t[0]),u(t[1])]:u(t);return mt(p)?p.replace("{value}",o?l[0]:l).replace("{value2}",o?l[1]:l):_t(p)?o?p(t[0],t[1]):p(t):o?t[0]===s[0]?i[0]+" "+l[1]:t[1]===s[1]?i[1]+" "+l[0]:l[0]+" - "+l[1]:l;function u(d){return d===s[0]?"min":d===s[1]?"max":(+d).toFixed(Math.min(r,20))}},n.prototype.resetExtent=function(){var t=this.option,e=Wt([t.min,t.max]);this._dataExtent=e},n.prototype.getDataDimensionIndex=function(t){var e=this.option.dimension;if(e!=null)return t.getDimensionIndex(e);for(var i=t.dimensions,o=i.length-1;o>=0;o--){var a=i[o],r=t.getDimensionInfo(a);if(!r.isCalculationCoord)return r.storeDimIndex}},n.prototype.getExtent=function(){return this._dataExtent.slice()},n.prototype.completeVisualOption=function(){var t=this.ecModel,e=this.option,i={inRange:e.inRange,outOfRange:e.outOfRange},o=e.target||(e.target={}),a=e.controller||(e.controller={});K(o,i),K(a,i);var r=this.isCategory();function s(p){Nt(e.color)&&!p.inRange&&(p.inRange={color:e.color.slice().reverse()}),p.inRange=p.inRange||{color:t.get("gradientColor")}}s.call(this,o),s.call(this,a),(function(p,l,u){var d=p[l],c=p[u];d&&!c&&(c=p[u]={},q(d,function(g,f){if(b.isValidType(f)){var v=dt(f,"inactive",r);v!=null&&(c[f]=v,f!=="color"||c.hasOwnProperty("opacity")||c.hasOwnProperty("colorAlpha")||(c.opacity=[0,0]))}}))}).call(this,o,"inRange","outOfRange"),(function(p){var l=(p.inRange||{}).symbol||(p.outOfRange||{}).symbol,u=(p.inRange||{}).symbolSize||(p.outOfRange||{}).symbolSize,d=this.get("inactiveColor"),c=this.getItemSymbol()||"roundRect";q(this.stateList,function(g){var f=this.itemSize,v=p[g];v||(v=p[g]={color:r?d:[d]}),v.symbol==null&&(v.symbol=l&&I(l)||(r?c:[c])),v.symbolSize==null&&(v.symbolSize=u&&I(u)||(r?f[0]:[f[0],f[0]])),v.symbol=j(v.symbol,function(_){return _==="none"?c:_});var m=v.symbolSize;if(m!=null){var S=-1/0;Ft(m,function(_){_>S&&(S=_)}),v.symbolSize=j(m,function(_){return Kt(_,[0,S],[0,f[0]],!0)})}},this)}).call(this,a)},n.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},n.prototype.isCategory=function(){return!!this.option.categories},n.prototype.setSelected=function(t){},n.prototype.getSelected=function(){return null},n.prototype.getValueState=function(t){return null},n.prototype.getVisualMeta=function(t){return null},n.type="visualMap",n.dependencies=["series"],n.defaultOption={show:!0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},n}(St),J=[20,140],Xt=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t}return w(n,h),n.prototype.optionUpdated=function(t,e){h.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual(function(i){i.mappingMethod="linear",i.dataExtent=this.getExtent()}),this._resetRange()},n.prototype.resetItemSize=function(){h.prototype.resetItemSize.apply(this,arguments);var t=this.itemSize;(t[0]==null||isNaN(t[0]))&&(t[0]=J[0]),(t[1]==null||isNaN(t[1]))&&(t[1]=J[1])},n.prototype._resetRange=function(){var t=this.getExtent(),e=this.option.range;!e||e.auto?(t.auto=1,this.option.range=t):L(e)&&(e[0]>e[1]&&e.reverse(),e[0]=Math.max(e[0],t[0]),e[1]=Math.min(e[1],t[1]))},n.prototype.completeVisualOption=function(){h.prototype.completeVisualOption.apply(this,arguments),y(this.stateList,function(t){var e=this.option.controller[t].symbolSize;e&&e[0]!==e[1]&&(e[0]=e[1]/3)},this)},n.prototype.setSelected=function(t){this.option.range=t.slice(),this._resetRange()},n.prototype.getSelected=function(){var t=this.getExtent(),e=st((this.get("range")||[]).slice());return e[0]>t[1]&&(e[0]=t[1]),e[1]>t[1]&&(e[1]=t[1]),e[0]<t[0]&&(e[0]=t[0]),e[1]<t[0]&&(e[1]=t[0]),e},n.prototype.getValueState=function(t){var e=this.option.range,i=this.getExtent();return(e[0]<=i[0]||e[0]<=t)&&(e[1]>=i[1]||t<=e[1])?"inRange":"outOfRange"},n.prototype.findTargetDataIndices=function(t){var e=[];return this.eachTargetSeries(function(i){var o=[],a=i.getData();a.each(this.getDataDimensionIndex(a),function(r,s){t[0]<=r&&r<=t[1]&&o.push(s)},this),e.push({seriesId:i.id,dataIndex:o})},this),e},n.prototype.getVisualMeta=function(t){var e=Q(this,"outOfRange",this.getExtent()),i=Q(this,"inRange",this.option.range.slice()),o=[];function a(c,g){o.push({value:c,color:t(c,g)})}for(var r=0,s=0,p=i.length,l=e.length;s<l&&(!i.length||e[s]<=i[0]);s++)e[s]<i[r]&&a(e[s],"outOfRange");for(var u=1;r<p;r++,u=0)u&&o.length&&a(i[r],"outOfRange"),a(i[r],"inRange");for(u=1;s<l;s++)(!i.length||i[i.length-1]<e[s])&&(u&&(o.length&&a(o[o.length-1].value,"outOfRange"),u=0),a(e[s],"outOfRange"));var d=o.length;return{stops:o,outerColors:[d?o[0].color:"transparent",d?o[d-1].color:"transparent"]}},n.type="visualMap.continuous",n.defaultOption=lt(z.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),n}(z);function Q(h,n,t){if(t[0]===t[1])return t.slice();for(var e=(t[1]-t[0])/200,i=t[0],o=[],a=0;a<=200&&i<t[1];a++)o.push(i),i+=e;return o.push(t[1]),o}var Ut=Xt,gt=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t.autoPositionValues={left:1,right:1,top:1,bottom:1},t}return w(n,h),n.prototype.init=function(t,e){this.ecModel=t,this.api=e},n.prototype.render=function(t,e,i,o){this.visualMapModel=t,t.get("show")!==!1?this.doRender(t,e,i,o):this.group.removeAll()},n.prototype.renderBackground=function(t){var e=this.visualMapModel,i=Mt(e.get("padding")||0),o=t.getBoundingRect();t.add(new ut({z2:-1,silent:!0,shape:{x:o.x-i[3],y:o.y-i[0],width:o.width+i[3]+i[1],height:o.height+i[0]+i[2]},style:{fill:e.get("backgroundColor"),stroke:e.get("borderColor"),lineWidth:e.get("borderWidth")}}))},n.prototype.getControllerVisual=function(t,e,i){var o=(i=i||{}).forceState,a=this.visualMapModel,r={};if(e==="color"){var s=a.get("contentColor");r.color=s}function p(c){return r[c]}function l(c,g){r[c]=g}var u=a.controllerVisuals[o||a.getValueState(t)],d=b.prepareVisualTypes(u);return y(d,function(c){var g=u[c];i.convertOpacityToAlpha&&c==="opacity"&&(c="colorAlpha",g=u.__alphaForOpacity),b.dependsOn(c,e)&&g&&g.applyVisual(t,p,l)}),r[e]},n.prototype.positionGroup=function(t){var e=this.visualMapModel,i=this.api;xt(t,e.getBoxLayoutParams(),{width:i.getWidth(),height:i.getHeight()})},n.prototype.doRender=function(t,e,i,o){},n.type="visualMap",n}(bt),$=[["left","right","width"],["top","bottom","height"]];function vt(h,n,t){var e=h.option,i=e.align;if(i!=null&&i!=="auto")return i;for(var o={width:n.getWidth(),height:n.getHeight()},a=e.orient==="horizontal"?1:0,r=$[a],s=[0,null,10],p={},l=0;l<3;l++)p[$[1-a][l]]=s[l],p[r[l]]=l===2?t[0]:e[r[l]];var u=[["x","width",3],["y","height",0]][a],d=kt(p,o,e.padding);return r[(d.margin[u[2]]||0)+d[u[0]]+.5*d[u[1]]<.5*o[u[1]]?0:1]}function R(h,n){return y(h||[],function(t){t.dataIndex!=null&&(t.dataIndexInside=t.dataIndex,t.dataIndex=null),t.highlightKey="visualMap"+(n?n.componentIndex:"")}),h}var M=pt,Yt=y,tt=Math.min,P=Math.max;function et(h,n,t,e){return new Ht({shape:{points:h},draggable:!!t,cursor:n,drift:t,onmousemove:function(i){B(i.event)},ondragend:e})}function it(h){var n=h.get("hoverLinkOnHandle");return!!(n??h.get("realtime"))}function nt(h){return h==="vertical"?"ns-resize":"ew-resize"}var Zt=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t._shapes={},t._dataInterval=[],t._handleEnds=[],t._hoverLinkDataIndices=[],t}return w(n,h),n.prototype.init=function(t,e){h.prototype.init.call(this,t,e),this._hoverLinkFromSeriesMouseOver=x(this._hoverLinkFromSeriesMouseOver,this),this._hideIndicator=x(this._hideIndicator,this)},n.prototype.doRender=function(t,e,i,o){o&&o.type==="selectDataRange"&&o.from===this.uid||this._buildView()},n.prototype._buildView=function(){this.group.removeAll();var t=this.visualMapModel,e=this.group;this._orient=t.get("orient"),this._useHandle=t.get("calculable"),this._resetInterval(),this._renderBar(e);var i=t.get("text");this._renderEndsText(e,i,0),this._renderEndsText(e,i,1),this._updateView(!0),this.renderBackground(e),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(e)},n.prototype._renderEndsText=function(t,e,i){if(e){var o=e[1-i];o=o!=null?o+"":"";var a=this.visualMapModel,r=a.get("textGap"),s=a.itemSize,p=this._shapes.mainGroup,l=this._applyTransform([s[0]/2,i===0?-r:s[1]+r],p),u=this._applyTransform(i===0?"bottom":"top",p),d=this._orient,c=this.visualMapModel.textStyleModel;this.group.add(new T({style:O(c,{x:l[0],y:l[1],verticalAlign:d==="horizontal"?"middle":u,align:d==="horizontal"?u:"center",text:o})}))}},n.prototype._renderBar=function(t){var e=this.visualMapModel,i=this._shapes,o=e.itemSize,a=this._orient,r=this._useHandle,s=vt(e,this.api,o),p=i.mainGroup=this._createBarGroup(s),l=new C;p.add(l),l.add(i.outOfRange=et()),l.add(i.inRange=et(null,r?nt(this._orient):null,x(this._dragHandle,this,"all",!1),x(this._dragHandle,this,"all",!0))),l.setClipPath(new ut({shape:{x:0,y:0,width:o[0],height:o[1],r:3}}));var u=e.textStyleModel.getTextRect("国"),d=P(u.width,u.height);r&&(i.handleThumbs=[],i.handleLabels=[],i.handleLabelPoints=[],this._createHandle(e,p,0,o,d,a),this._createHandle(e,p,1,o,d,a)),this._createIndicator(e,p,o,d,a),t.add(p)},n.prototype._createHandle=function(t,e,i,o,a,r){var s=x(this._dragHandle,this,i,!1),p=x(this._dragHandle,this,i,!0),l=X(t.get("handleSize"),o[0]),u=A(t.get("handleIcon"),-l/2,-l/2,l,l,null,!0),d=nt(this._orient);u.attr({cursor:d,draggable:!0,drift:s,ondragend:p,onmousemove:function(m){B(m.event)}}),u.x=o[0]/2,u.useStyle(t.getModel("handleStyle").getItemStyle()),u.setStyle({strokeNoScale:!0,strokeFirst:!0}),u.style.lineWidth*=2,u.ensureState("emphasis").style=t.getModel(["emphasis","handleStyle"]).getItemStyle(),It(u,!0),e.add(u);var c=this.visualMapModel.textStyleModel,g=new T({cursor:d,draggable:!0,drift:s,onmousemove:function(m){B(m.event)},ondragend:p,style:O(c,{x:0,y:0,text:""})});g.ensureState("blur").style={opacity:.1},g.stateTransition={duration:200},this.group.add(g);var f=[l,0],v=this._shapes;v.handleThumbs[i]=u,v.handleLabelPoints[i]=f,v.handleLabels[i]=g},n.prototype._createIndicator=function(t,e,i,o,a){var r=X(t.get("indicatorSize"),i[0]),s=A(t.get("indicatorIcon"),-r/2,-r/2,r,r,null,!0);s.attr({cursor:"move",invisible:!0,silent:!0,x:i[0]/2});var p=t.getModel("indicatorStyle").getItemStyle();if(s instanceof Lt){var l=s.style;s.useStyle(Vt({image:l.image,x:l.x,y:l.y,width:l.width,height:l.height},p))}else s.useStyle(p);e.add(s);var u=this.visualMapModel.textStyleModel,d=new T({silent:!0,invisible:!0,style:O(u,{x:0,y:0,text:""})});this.group.add(d);var c=[(a==="horizontal"?o/2:6)+i[0]/2,0],g=this._shapes;g.indicator=s,g.indicatorLabel=d,g.indicatorLabelPoint=c,this._firstShowIndicator=!0},n.prototype._dragHandle=function(t,e,i,o){if(this._useHandle){if(this._dragging=!e,!e){var a=this._applyTransform([i,o],this._shapes.mainGroup,!0);this._updateInterval(t,a[1]),this._hideIndicator(),this._updateView()}e===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),e?!this._hovering&&this._clearHoverLinkToSeries():it(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[t],!1)}},n.prototype._resetInterval=function(){var t=this.visualMapModel,e=this._dataInterval=t.getSelected(),i=t.getExtent(),o=[0,t.itemSize[1]];this._handleEnds=[M(e[0],i,o,!0),M(e[1],i,o,!0)]},n.prototype._updateInterval=function(t,e){e=e||0;var i=this.visualMapModel,o=this._handleEnds,a=[0,i.itemSize[1]];Bt(e,o,a,t,0);var r=i.getExtent();this._dataInterval=[M(o[0],a,r,!0),M(o[1],a,r,!0)]},n.prototype._updateView=function(t){var e=this.visualMapModel,i=e.getExtent(),o=this._shapes,a=[0,e.itemSize[1]],r=t?a:this._handleEnds,s=this._createBarVisual(this._dataInterval,i,r,"inRange"),p=this._createBarVisual(i,i,a,"outOfRange");o.inRange.setStyle({fill:s.barColor}).setShape("points",s.barPoints),o.outOfRange.setStyle({fill:p.barColor}).setShape("points",p.barPoints),this._updateHandle(r,s)},n.prototype._createBarVisual=function(t,e,i,o){var a={forceState:o,convertOpacityToAlpha:!0},r=this._makeColorGradient(t,a),s=[this.getControllerVisual(t[0],"symbolSize",a),this.getControllerVisual(t[1],"symbolSize",a)],p=this._createBarPoints(i,s);return{barColor:new wt(0,0,0,1,r),barPoints:p,handlesColor:[r[0].color,r[r.length-1].color]}},n.prototype._makeColorGradient=function(t,e){var i=[],o=(t[1]-t[0])/100;i.push({color:this.getControllerVisual(t[0],"color",e),offset:0});for(var a=1;a<100;a++){var r=t[0]+o*a;if(r>t[1])break;i.push({color:this.getControllerVisual(r,"color",e),offset:a/100})}return i.push({color:this.getControllerVisual(t[1],"color",e),offset:1}),i},n.prototype._createBarPoints=function(t,e){var i=this.visualMapModel.itemSize;return[[i[0]-e[0],t[0]],[i[0],t[0]],[i[0],t[1]],[i[0]-e[1],t[1]]]},n.prototype._createBarGroup=function(t){var e=this._orient,i=this.visualMapModel.get("inverse");return new C(e!=="horizontal"||i?e==="horizontal"&&i?{scaleX:t==="bottom"?-1:1,rotation:-Math.PI/2}:e!=="vertical"||i?{scaleX:t==="left"?1:-1}:{scaleX:t==="left"?1:-1,scaleY:-1}:{scaleX:t==="bottom"?1:-1,rotation:Math.PI/2})},n.prototype._updateHandle=function(t,e){if(this._useHandle){var i=this._shapes,o=this.visualMapModel,a=i.handleThumbs,r=i.handleLabels,s=o.itemSize,p=o.getExtent();Yt([0,1],function(l){var u=a[l];u.setStyle("fill",e.handlesColor[l]),u.y=t[l];var d=M(t[l],[0,s[1]],p,!0),c=this.getControllerVisual(d,"symbolSize");u.scaleX=u.scaleY=c/s[0],u.x=s[0]-c/2;var g=H(i.handleLabelPoints[l],E(u,this.group));r[l].setStyle({x:g[0],y:g[1],text:o.formatValueText(this._dataInterval[l]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",i.mainGroup):"center"})},this)}},n.prototype._showIndicator=function(t,e,i,o){var a=this.visualMapModel,r=a.getExtent(),s=a.itemSize,p=[0,s[1]],l=this._shapes,u=l.indicator;if(u){u.attr("invisible",!1);var d=this.getControllerVisual(t,"color",{convertOpacityToAlpha:!0}),c=this.getControllerVisual(t,"symbolSize"),g=M(t,r,p,!0),f=s[0]-c/2,v={x:u.x,y:u.y};u.y=g,u.x=f;var m=H(l.indicatorLabelPoint,E(u,this.group)),S=l.indicatorLabel;S.attr("invisible",!1);var _=this._applyTransform("left",l.mainGroup),G=this._orient==="horizontal";S.setStyle({text:(i||"")+a.formatValueText(e),verticalAlign:G?_:"middle",align:G?"center":_});var F={x:f,y:g,style:{fill:d}},N={style:{x:m[0],y:m[1]}};if(a.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var W={duration:100,easing:"cubicInOut",additive:!0};u.x=v.x,u.y=v.y,u.animateTo(F,W),S.animateTo(N,W)}else u.attr(F),S.attr(N);this._firstShowIndicator=!1;var D=this._shapes.handleLabels;if(D)for(var k=0;k<D.length;k++)this.api.enterBlur(D[k])}},n.prototype._enableHoverLinkToSeries=function(){var t=this;this._shapes.mainGroup.on("mousemove",function(e){if(t._hovering=!0,!t._dragging){var i=t.visualMapModel.itemSize,o=t._applyTransform([e.offsetX,e.offsetY],t._shapes.mainGroup,!0,!0);o[1]=tt(P(0,o[1]),i[1]),t._doHoverLinkToSeries(o[1],0<=o[0]&&o[0]<=i[0])}}).on("mouseout",function(){t._hovering=!1,!t._dragging&&t._clearHoverLinkToSeries()})},n.prototype._enableHoverLinkFromSeries=function(){var t=this.api.getZr();this.visualMapModel.option.hoverLink?(t.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),t.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},n.prototype._doHoverLinkToSeries=function(t,e){var i=this.visualMapModel,o=i.itemSize;if(i.option.hoverLink){var a=[0,o[1]],r=i.getExtent();t=tt(P(a[0],t),a[1]);var s=function(f,v,m){var S=6,_=f.get("hoverLinkDataSize");return _&&(S=M(_,v,m,!0)/2),S}(i,r,a),p=[t-s,t+s],l=M(t,a,r,!0),u=[M(p[0],a,r,!0),M(p[1],a,r,!0)];p[0]<a[0]&&(u[0]=-1/0),p[1]>a[1]&&(u[1]=1/0),e&&(u[0]===-1/0?this._showIndicator(l,u[1],"< ",s):u[1]===1/0?this._showIndicator(l,u[0],"> ",s):this._showIndicator(l,l,"≈ ",s));var d=this._hoverLinkDataIndices,c=[];(e||it(i))&&(c=this._hoverLinkDataIndices=i.findTargetDataIndices(u));var g=Tt(d,c);this._dispatchHighDown("downplay",R(g[0],i)),this._dispatchHighDown("highlight",R(g[1],i))}},n.prototype._hoverLinkFromSeriesMouseOver=function(t){var e;if(Ot(t.target,function(s){var p=Rt(s);if(p.dataIndex!=null)return e=p,!0},!0),e){var i=this.ecModel.getSeriesByIndex(e.seriesIndex),o=this.visualMapModel;if(o.isTargetSeries(i)){var a=i.getData(e.dataType),r=a.getStore().get(o.getDataDimensionIndex(a),e.dataIndex);isNaN(r)||this._showIndicator(r,r)}}},n.prototype._hideIndicator=function(){var t=this._shapes;t.indicator&&t.indicator.attr("invisible",!0),t.indicatorLabel&&t.indicatorLabel.attr("invisible",!0);var e=this._shapes.handleLabels;if(e)for(var i=0;i<e.length;i++)this.api.leaveBlur(e[i])},n.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var t=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",R(t,this.visualMapModel)),t.length=0},n.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var t=this.api.getZr();t.off("mouseover",this._hoverLinkFromSeriesMouseOver),t.off("mouseout",this._hideIndicator)},n.prototype._applyTransform=function(t,e,i,o){var a=E(e,o?null:this.group);return L(t)?H(t,a,i):Ct(t,a,i)},n.prototype._dispatchHighDown=function(t,e){e&&e.length&&this.api.dispatchAction({type:t,batch:e})},n.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},n.type="visualMap.continuous",n}(gt),jt={type:"selectDataRange",event:"dataRangeSelected",update:"update"},qt=function(h,n){n.eachComponent({mainType:"visualMap",query:h},function(t){t.setSelected(h.selected)})},Jt=[{createOnAllSeries:!0,reset:function(h,n){var t=[];return n.eachComponent("visualMap",function(e){var i=h.pipelineContext;!e.isTargetSeries(h)||i&&i.large||t.push(At(e.stateList,e.targetVisuals,x(e.getValueState,e),e.getDataDimensionIndex(h.getData())))}),t}},{createOnAllSeries:!0,reset:function(h,n){var t=h.getData(),e=[];n.eachComponent("visualMap",function(i){if(i.isTargetSeries(h)){var o=i.getVisualMeta(x(Qt,null,h,i))||{stops:[],outerColors:[]},a=i.getDataDimensionIndex(t);a>=0&&(o.dimension=a,e.push(o))}}),h.getData().setVisual("visualMeta",e)}}];function Qt(h,n,t,e){for(var i=n.targetVisuals[e],o=b.prepareVisualTypes(i),a={color:Et(h.getData(),"color")},r=0,s=o.length;r<s;r++){var p=o[r],l=i[p==="opacity"?"__alphaForOpacity":p];l&&l.applyVisual(t,u,d)}return a.color;function u(c){return a[c]}function d(c,g){a[c]=g}}var ot=y;function $t(h){var n=h&&h.visualMap;L(n)||(n=n?[n]:[]),ot(n,function(t){if(t){V(t,"splitList")&&!V(t,"pieces")&&(t.pieces=t.splitList,delete t.splitList);var e=t.pieces;e&&L(e)&&ot(e,function(i){ct(i)&&(V(i,"start")&&!V(i,"min")&&(i.min=i.start),V(i,"end")&&!V(i,"max")&&(i.max=i.end))})}})}function V(h,n){return h&&h.hasOwnProperty&&h.hasOwnProperty(n)}var at=!1;function ft(h){at||(at=!0,h.registerSubTypeDefaulter("visualMap",function(n){return n.categories||(n.pieces?n.pieces.length>0:n.splitNumber>0)&&!n.calculable?"piecewise":"continuous"}),h.registerAction(jt,qt),y(Jt,function(n){h.registerVisual(h.PRIORITY.VISUAL.COMPONENT,n)}),h.registerPreprocessor($t))}function te(h){h.registerComponentModel(Ut),h.registerComponentView(Zt),ft(h)}var ee=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t._pieceList=[],t}return w(n,h),n.prototype.optionUpdated=function(t,e){h.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var i=this._mode=this._determineMode();this._pieceList=[],ie[this._mode].call(this,this._pieceList),this._resetSelected(t,e);var o=this.option.categories;this.resetVisual(function(a,r){i==="categories"?(a.mappingMethod="category",a.categories=I(o)):(a.dataExtent=this.getExtent(),a.mappingMethod="piecewise",a.pieceList=ht(this._pieceList,function(s){return s=I(s),r!=="inRange"&&(s.visual=null),s}))})},n.prototype.completeVisualOption=function(){var t=this.option,e={},i=b.listVisualTypes(),o=this.isCategory();function a(r,s,p){return r&&r[s]&&r[s].hasOwnProperty(p)}y(t.pieces,function(r){y(i,function(s){r.hasOwnProperty(s)&&(e[s]=1)})}),y(e,function(r,s){var p=!1;y(this.stateList,function(l){p=p||a(t,l,s)||a(t.target,l,s)},this),!p&&y(this.stateList,function(l){(t[l]||(t[l]={}))[s]=dt(s,l==="inRange"?"active":"inactive",o)})},this),h.prototype.completeVisualOption.apply(this,arguments)},n.prototype._resetSelected=function(t,e){var i=this.option,o=this._pieceList,a=(e?i:t).selected||{};if(i.selected=a,y(o,function(s,p){var l=this.getSelectedMapKey(s);a.hasOwnProperty(l)||(a[l]=!0)},this),i.selectedMode==="single"){var r=!1;y(o,function(s,p){var l=this.getSelectedMapKey(s);a[l]&&(r?a[l]=!1:r=!0)},this)}},n.prototype.getItemSymbol=function(){return this.get("itemSymbol")},n.prototype.getSelectedMapKey=function(t){return this._mode==="categories"?t.value+"":t.index+""},n.prototype.getPieceList=function(){return this._pieceList},n.prototype._determineMode=function(){var t=this.option;return t.pieces&&t.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},n.prototype.setSelected=function(t){this.option.selected=I(t)},n.prototype.getValueState=function(t){var e=b.findPieceIndex(t,this._pieceList);return e!=null&&this.option.selected[this.getSelectedMapKey(this._pieceList[e])]?"inRange":"outOfRange"},n.prototype.findTargetDataIndices=function(t){var e=[],i=this._pieceList;return this.eachTargetSeries(function(o){var a=[],r=o.getData();r.each(this.getDataDimensionIndex(r),function(s,p){b.findPieceIndex(s,i)===t&&a.push(p)},this),e.push({seriesId:o.id,dataIndex:a})},this),e},n.prototype.getRepresentValue=function(t){var e;if(this.isCategory())e=t.value;else if(t.value!=null)e=t.value;else{var i=t.interval||[];e=i[0]===-1/0&&i[1]===1/0?0:(i[0]+i[1])/2}return e},n.prototype.getVisualMeta=function(t){if(!this.isCategory()){var e=[],i=["",""],o=this,a=this._pieceList.slice();if(a.length){var r=a[0].interval[0];r!==-1/0&&a.unshift({interval:[-1/0,r]}),(r=a[a.length-1].interval[1])!==1/0&&a.push({interval:[r,1/0]})}else a.push({interval:[-1/0,1/0]});var s=-1/0;return y(a,function(l){var u=l.interval;u&&(u[0]>s&&p([s,u[0]],"outOfRange"),p(u.slice()),s=u[1])},this),{stops:e,outerColors:i}}function p(l,u){var d=o.getRepresentValue({interval:l});u||(u=o.getValueState(d));var c=t(d,u);l[0]===-1/0?i[0]=c:l[1]===1/0?i[1]=c:e.push({value:l[0],color:c},{value:l[1],color:c})}},n.type="visualMap.piecewise",n.defaultOption=lt(z.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),n}(z),ie={splitNumber:function(h){var n=this.option,t=Math.min(n.precision,20),e=this.getExtent(),i=n.splitNumber;i=Math.max(parseInt(i,10),1),n.splitNumber=i;for(var o=(e[1]-e[0])/i;+o.toFixed(t)!==o&&t<5;)t++;n.precision=t,o=+o.toFixed(t),n.minOpen&&h.push({interval:[-1/0,e[0]],close:[0,0]});for(var a=0,r=e[0];a<i;r+=o,a++){var s=a===i-1?e[1]:r+o;h.push({interval:[r,s],close:[1,1]})}n.maxOpen&&h.push({interval:[e[1],1/0],close:[0,0]}),U(h),y(h,function(p,l){p.index=l,p.text=this.formatValueText(p.interval)},this)},categories:function(h){var n=this.option;y(n.categories,function(t){h.push({text:this.formatValueText(t,!0),value:t})},this),rt(n,h)},pieces:function(h){var n=this.option;y(n.pieces,function(t,e){ct(t)||(t={value:t});var i={text:"",index:e};if(t.label!=null&&(i.text=t.label),t.hasOwnProperty("value")){var o=i.value=t.value;i.interval=[o,o],i.close=[1,1]}else{for(var a=i.interval=[],r=i.close=[0,0],s=[1,0,1],p=[-1/0,1/0],l=[],u=0;u<2;u++){for(var d=[["gte","gt","min"],["lte","lt","max"]][u],c=0;c<3&&a[u]==null;c++)a[u]=t[d[c]],r[u]=s[c],l[u]=c===2;a[u]==null&&(a[u]=p[u])}l[0]&&a[1]===1/0&&(r[0]=0),l[1]&&a[0]===-1/0&&(r[1]=0),a[0]===a[1]&&r[0]&&r[1]&&(i.value=a[0])}i.visual=b.retrieveVisuals(t),h.push(i)},this),rt(n,h),U(h),y(h,function(t){var e=t.close,i=[["<","≤"][e[1]],[">","≥"][e[0]]];t.text=t.text||this.formatValueText(t.value!=null?t.value:t.interval,!1,i)},this)}};function rt(h,n){var t=h.inverse;(h.orient==="vertical"?!t:t)&&n.reverse()}var ne=ee,oe=function(h){function n(){var t=h!==null&&h.apply(this,arguments)||this;return t.type=n.type,t}return w(n,h),n.prototype.doRender=function(){var t=this.group;t.removeAll();var e=this.visualMapModel,i=e.get("textGap"),o=e.textStyleModel,a=o.getFont(),r=o.getTextColor(),s=this._getItemAlign(),p=e.itemSize,l=this._getViewData(),u=l.endsText,d=zt(e.get("showLabel",!0),!u);u&&this._renderEndsText(t,u[0],p,d,s),y(l.viewPieceList,function(c){var g=c.piece,f=new C;f.onclick=x(this._onItemClick,this,g),this._enableHoverLink(f,c.indexInModelPieceList);var v=e.getRepresentValue(g);if(this._createItemSymbol(f,v,[0,0,p[0],p[1]]),d){var m=this.visualMapModel.getValueState(v);f.add(new T({style:{x:s==="right"?-i:p[0]+i,y:p[1]/2,text:g.text,verticalAlign:"middle",align:s,font:a,fill:r,opacity:m==="outOfRange"?.5:1}}))}t.add(f)},this),u&&this._renderEndsText(t,u[1],p,d,s),Dt(e.get("orient"),t,e.get("itemGap")),this.renderBackground(t),this.positionGroup(t)},n.prototype._enableHoverLink=function(t,e){var i=this;t.on("mouseover",function(){return o("highlight")}).on("mouseout",function(){return o("downplay")});var o=function(a){var r=i.visualMapModel;r.option.hoverLink&&i.api.dispatchAction({type:a,batch:R(r.findTargetDataIndices(e),r)})}},n.prototype._getItemAlign=function(){var t=this.visualMapModel,e=t.option;if(e.orient==="vertical")return vt(t,this.api,t.itemSize);var i=e.align;return i&&i!=="auto"||(i="left"),i},n.prototype._renderEndsText=function(t,e,i,o,a){if(e){var r=new C,s=this.visualMapModel.textStyleModel;r.add(new T({style:O(s,{x:o?a==="right"?i[0]:0:i[0]/2,y:i[1]/2,verticalAlign:"middle",align:o?a:"center",text:e})})),t.add(r)}},n.prototype._getViewData=function(){var t=this.visualMapModel,e=ht(t.getPieceList(),function(r,s){return{piece:r,indexInModelPieceList:s}}),i=t.get("text"),o=t.get("orient"),a=t.get("inverse");return(o==="horizontal"?a:!a)?e.reverse():i&&(i=i.slice().reverse()),{viewPieceList:e,endsText:i}},n.prototype._createItemSymbol=function(t,e,i){t.add(A(this.getControllerVisual(e,"symbol"),i[0],i[1],i[2],i[3],this.getControllerVisual(e,"color")))},n.prototype._onItemClick=function(t){var e=this.visualMapModel,i=e.option,o=i.selectedMode;if(o){var a=I(i.selected),r=e.getSelectedMapKey(t);o==="single"||o===!0?(a[r]=!0,y(a,function(s,p){a[p]=p===r})):a[r]=!a[r],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:a})}},n.type="visualMap.piecewise",n}(gt);function ae(h){h.registerComponentModel(ne),h.registerComponentView(oe),ft(h)}function he(h){Y(te),Y(ae)}export{he as install};
