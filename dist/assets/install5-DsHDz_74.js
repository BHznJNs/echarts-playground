import{e as y,L as E,a_ as w,a$ as A,aT as T,aU as _,bT as C,A as g,cc as D,bP as z,bI as I,bJ as O}from"./index-CfHuJ7al.js";import{u as V}from"./SymbolDraw-lUJgwBAn.js";import{b as L}from"./Symbol-YsEBrKGn.js";import{i as b}from"./points-D-pnJTqd.js";import"./labelHelper-CoUP5mfK.js";function v(n,e){var t=e.rippleEffectColor||e.color;n.eachChild(function(r){r.attr({z:e.z,zlevel:e.zlevel,style:{stroke:e.brushType==="stroke"?t:null,fill:e.brushType==="fill"?t:null}})})}var M=function(n){function e(t,r){var a=n.call(this)||this,s=new L(t,r),o=new g;return a.add(s),a.add(o),a.updateData(t,r),a}return y(e,n),e.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},e.prototype.startEffectAnimation=function(t){for(var r=t.symbolType,a=t.color,s=t.rippleNumber,o=this.childAt(1),l=0;l<s;l++){var p=E(r,-1,-1,2,2,a);p.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var f=-l/s*t.period+t.effectOffset;p.animate("",!0).when(t.period,{scaleX:t.rippleScale/2,scaleY:t.rippleScale/2}).delay(f).start(),p.animateStyle(!0).when(t.period,{opacity:0}).delay(f).start(),o.add(p)}v(o,t)},e.prototype.updateEffectAnimation=function(t){for(var r=this._effectCfg,a=this.childAt(1),s=["symbolType","period","rippleScale","rippleNumber"],o=0;o<s.length;o++){var l=s[o];if(r[l]!==t[l])return this.stopEffectAnimation(),void this.startEffectAnimation(t)}v(a,t)},e.prototype.highlight=function(){w(this)},e.prototype.downplay=function(){A(this)},e.prototype.getSymbolType=function(){var t=this.childAt(0);return t&&t.getSymbolType()},e.prototype.updateData=function(t,r){var a=this,s=t.hostModel;this.childAt(0).updateData(t,r);var o=this.childAt(1),l=t.getItemModel(r),p=t.getItemVisual(r,"symbol"),f=T(t.getItemVisual(r,"symbolSize")),m=t.getItemVisual(r,"style"),d=m&&m.fill,u=l.getModel("emphasis");o.setScale(f),o.traverse(function(c){c.setStyle("fill",d)});var h=_(t.getItemVisual(r,"symbolOffset"),f);h&&(o.x=h[0],o.y=h[1]);var S=t.getItemVisual(r,"symbolRotate");o.rotation=(S||0)*Math.PI/180||0;var i={};i.showEffectOn=s.get("showEffectOn"),i.rippleScale=l.get(["rippleEffect","scale"]),i.brushType=l.get(["rippleEffect","brushType"]),i.period=1e3*l.get(["rippleEffect","period"]),i.effectOffset=r/t.count(),i.z=s.getShallow("z")||0,i.zlevel=s.getShallow("zlevel")||0,i.symbolType=p,i.color=d,i.rippleEffectColor=l.get(["rippleEffect","color"]),i.rippleNumber=l.get(["rippleEffect","number"]),i.showEffectOn==="render"?(this._effectCfg?this.updateEffectAnimation(i):this.startEffectAnimation(i),this._effectCfg=i):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(c){c==="emphasis"?i.showEffectOn!=="render"&&a.startEffectAnimation(i):c==="normal"&&i.showEffectOn!=="render"&&a.stopEffectAnimation()}),this._effectCfg=i,C(this,u.get("focus"),u.get("blurScope"),u.get("disabled"))},e.prototype.fadeOut=function(t){t&&t()},e}(g),k=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return y(e,n),e.prototype.init=function(){this._symbolDraw=new V(M)},e.prototype.render=function(t,r,a){var s=t.getData(),o=this._symbolDraw;o.updateData(s,{clipShape:this._getClipShape(t)}),this.group.add(o.group)},e.prototype._getClipShape=function(t){var r=t.coordinateSystem,a=r&&r.getArea&&r.getArea();return t.get("clip",!0)?a:null},e.prototype.updateTransform=function(t,r,a){var s=t.getData();this.group.dirty();var o=b("").reset(t,r,a);o.progress&&o.progress({start:0,end:s.count(),count:s.count()},s),this._symbolDraw.updateLayout()},e.prototype._updateGroupTransform=function(t){var r=t.coordinateSystem;r&&r.getRoamTransform&&(this.group.transform=D(r.getRoamTransform()),this.group.decomposeTransform())},e.prototype.remove=function(t,r){this._symbolDraw&&this._symbolDraw.remove(!0)},e.type="effectScatter",e}(z),N=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return y(e,n),e.prototype.getInitialData=function(t,r){return I(null,this,{useEncodeDefaulter:!0})},e.prototype.brushSelector=function(t,r,a){return a.point(r.getItemLayout(t))},e.type="series.effectScatter",e.dependencies=["grid","polar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill",number:3},universalTransition:{divideShape:"clone"},symbolSize:10},e}(O);function Y(n){n.registerChartView(k),n.registerSeriesModel(N),n.registerLayout(b("effectScatter"))}export{Y as install};
