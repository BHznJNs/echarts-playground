import{e as Z,bL as q,bK as $,aa as X,bT as ee,bS as te,ak as ie,bQ as ne,S as oe,A as ae,bN as re,bO as le,H as Y,a1 as se,cc as he,cd as ue,bI as ge,r as pe,d as ce,Z as de,U as fe,h as G,V as j}from"./index-B3HKDY-B.js";import{A as me,b as ve}from"./labelGuideHelper-GZXSKxXE.js";import{s as ye}from"./createSeriesDataSimply-BtvIqVi0.js";import{t as be}from"./LegendVisualProvider-B8AjwPa5.js";import{e as Le}from"./dataFilter-_M4AusE-.js";var xe=["itemStyle","opacity"],ze=function(d){function l(e,i){var s=d.call(this)||this,o=s,p=new pe,v=new ce;return o.setTextContent(v),s.setTextGuideLine(p),s.updateData(e,i,!0),s}return Z(l,d),l.prototype.updateData=function(e,i,s){var o=this,p=e.hostModel,v=e.getItemModel(i),u=e.getItemLayout(i),n=v.getModel("emphasis"),f=v.get(xe);f=f??1,s||q(o),o.useStyle(e.getItemVisual(i,"style")),o.style.lineJoin="round",s?(o.setShape({points:u.points}),o.style.opacity=0,$(o,{style:{opacity:f}},p,i)):X(o,{style:{opacity:f},shape:{points:u.points}},p,i),ee(o,v),this._updateLabel(e,i),te(this,n.get("focus"),n.get("blurScope"),n.get("disabled"))},l.prototype._updateLabel=function(e,i){var s=this,o=this.getTextGuideLine(),p=s.getTextContent(),v=e.hostModel,u=e.getItemModel(i),n=e.getItemLayout(i).label,f=e.getItemVisual(i,"style"),z=f.fill;ie(p,ne(u),{labelFetcher:e.hostModel,labelDataIndex:i,defaultOpacity:f.opacity,defaultText:e.getName(i)},{normal:{align:n.textAlign,verticalAlign:n.verticalAlign}}),s.setTextConfig({local:!0,inside:!!n.inside,insideStroke:z,outsideFill:z});var x=n.linePoints;o.setShape({points:x}),s.textGuideLineConfig={anchor:x?new oe(x[0][0],x[0][1]):null},X(p,{style:{x:n.x,y:n.y}},v,i),p.attr({rotation:n.rotation,originX:n.x,originY:n.y,z2:10}),me(s,ve(u),{stroke:z})},l}(ae),we=function(d){function l(){var e=d!==null&&d.apply(this,arguments)||this;return e.type=l.type,e.ignoreLabelLineUpdate=!0,e}return Z(l,d),l.prototype.render=function(e,i,s){var o=e.getData(),p=this._data,v=this.group;o.diff(p).add(function(u){var n=new ze(o,u);o.setItemGraphicEl(u,n),v.add(n)}).update(function(u,n){var f=p.getItemGraphicEl(n);f.updateData(o,u),v.add(f),o.setItemGraphicEl(u,f)}).remove(function(u){var n=p.getItemGraphicEl(u);re(n,e,u)}).execute(),this._data=o},l.prototype.remove=function(){this.group.removeAll(),this._data=null},l.prototype.dispose=function(){},l.type="funnel",l}(le),Se=function(d){function l(){var e=d!==null&&d.apply(this,arguments)||this;return e.type=l.type,e}return Z(l,d),l.prototype.init=function(e){d.prototype.init.apply(this,arguments),this.legendVisualProvider=new be(Y(this.getData,this),Y(this.getRawData,this)),this._defaultLabelLine(e)},l.prototype.getInitialData=function(e,i){return ye(this,{coordDimensions:["value"],encodeDefaulter:se(he,this)})},l.prototype._defaultLabelLine=function(e){ue(e,"labelLine",["show"]);var i=e.labelLine,s=e.emphasis.labelLine;i.show=i.show&&e.label.show,s.show=s.show&&e.emphasis.label.show},l.prototype.getDataParams=function(e){var i=this.getData(),s=d.prototype.getDataParams.call(this,e),o=i.mapDimension("value"),p=i.getSum(o);return s.percent=p?+(i.get(o,e)/p*100).toFixed(2):0,s.$vars.push("percent"),s},l.type="series.funnel",l.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},l}(ge);function Ie(d,l){d.eachSeriesByType("funnel",function(e){var i=e.getData(),s=i.mapDimension("value"),o=e.get("sort"),p=function(L,h){return de(L.getBoxLayoutParams(),{width:h.getWidth(),height:h.getHeight()})}(e,l),v=e.get("orient"),u=p.width,n=p.height,f=function(L,h){for(var T=L.mapDimension("value"),a=L.mapArray(T,function(c){return c}),r=[],g=h==="ascending",w=0,A=L.count();w<A;w++)r[w]=w;return fe(h)?r.sort(h):h!=="none"&&r.sort(function(c,R){return g?a[c]-a[R]:a[R]-a[c]}),r}(i,o),z=p.x,x=p.y,k=v==="horizontal"?[G(e.get("minSize"),n),G(e.get("maxSize"),n)]:[G(e.get("minSize"),u),G(e.get("maxSize"),u)],N=i.getDataExtent(s),V=e.get("min"),B=e.get("max");V==null&&(V=Math.min(N[0],0)),B==null&&(B=N[1]);var Q=e.get("funnelAlign"),P=e.get("gap"),E=((v==="horizontal"?u:n)-P*(i.count()-1))/i.count(),F=function(L,h){if(v==="horizontal"){var T=i.get(s,L)||0,a=j(T,[V,B],k,!0),r=void 0;switch(Q){case"top":r=x;break;case"center":r=x+(n-a)/2;break;case"bottom":r=x+(n-a)}return[[h,r],[h,r+a]]}var g,w=i.get(s,L)||0,A=j(w,[V,B],k,!0);switch(Q){case"left":g=z;break;case"center":g=z+(u-A)/2;break;case"right":g=z+u-A}return[[g,h],[g+A,h]]};o==="ascending"&&(E=-E,P=-P,v==="horizontal"?z+=u:x+=n,f=f.reverse());for(var H=0;H<f.length;H++){var _=f[H],U=f[H+1],C=i.getItemModel(_);if(v==="horizontal"){var D=C.get(["itemStyle","width"]);D==null?D=E:(D=G(D,u),o==="ascending"&&(D=-D));var O=F(_,z),W=F(U,z+D);z+=D+P,i.setItemLayout(_,{points:O.concat(W.slice().reverse())})}else{var M=C.get(["itemStyle","height"]);M==null?M=E:(M=G(M,n),o==="ascending"&&(M=-M)),O=F(_,x),W=F(U,x+M),x+=M+P,i.setItemLayout(_,{points:O.concat(W.slice().reverse())})}}(function(L){var h=L.hostModel.get("orient");L.each(function(T){var a,r,g,w,A=L.getItemModel(T),c=A.getModel("label").get("position"),R=A.getModel("labelLine"),J=L.getItemLayout(T),t=J.points,K=c==="inner"||c==="inside"||c==="center"||c==="insideLeft"||c==="insideRight";if(K)c==="insideLeft"?(r=(t[0][0]+t[3][0])/2+5,g=(t[0][1]+t[3][1])/2,a="left"):c==="insideRight"?(r=(t[1][0]+t[2][0])/2-5,g=(t[1][1]+t[2][1])/2,a="right"):(r=(t[0][0]+t[1][0]+t[2][0]+t[3][0])/4,g=(t[0][1]+t[1][1]+t[2][1]+t[3][1])/4,a="center"),w=[[r,g],[r,g]];else{var m=void 0,y=void 0,S=void 0,I=void 0,b=R.get("length");c==="left"?(m=(t[3][0]+t[0][0])/2,y=(t[3][1]+t[0][1])/2,r=(S=m-b)-5,a="right"):c==="right"?(m=(t[1][0]+t[2][0])/2,y=(t[1][1]+t[2][1])/2,r=(S=m+b)+5,a="left"):c==="top"?(m=(t[3][0]+t[0][0])/2,g=(I=(y=(t[3][1]+t[0][1])/2)-b)-5,a="center"):c==="bottom"?(m=(t[1][0]+t[2][0])/2,g=(I=(y=(t[1][1]+t[2][1])/2)+b)+5,a="center"):c==="rightTop"?(m=h==="horizontal"?t[3][0]:t[1][0],y=h==="horizontal"?t[3][1]:t[1][1],h==="horizontal"?(g=(I=y-b)-5,a="center"):(r=(S=m+b)+5,a="top")):c==="rightBottom"?(m=t[2][0],y=t[2][1],h==="horizontal"?(g=(I=y+b)+5,a="center"):(r=(S=m+b)+5,a="bottom")):c==="leftTop"?(m=t[0][0],y=h==="horizontal"?t[0][1]:t[1][1],h==="horizontal"?(g=(I=y-b)-5,a="center"):(r=(S=m-b)-5,a="right")):c==="leftBottom"?(m=h==="horizontal"?t[1][0]:t[3][0],y=h==="horizontal"?t[1][1]:t[2][1],h==="horizontal"?(g=(I=y+b)+5,a="center"):(r=(S=m-b)-5,a="right")):(m=(t[1][0]+t[2][0])/2,y=(t[1][1]+t[2][1])/2,h==="horizontal"?(g=(I=y+b)+5,a="center"):(r=(S=m+b)+5,a="left")),h==="horizontal"?r=S=m:g=I=y,w=[[m,y],[S,I]]}J.label={linePoints:w,x:r,y:g,verticalAlign:"middle",textAlign:a,inside:K}})})(i)})}function Pe(d){d.registerChartView(we),d.registerSeriesModel(Se),d.registerLayout(Ie),d.registerProcessor(Le("funnel"))}export{Pe as install};
