import{e as H,bJ as Q,bQ as L,c as V,ak as U,bS as j,E as q,ag as F,bO as J,bH as X,cw as Z,bI as K,cx as W}from"./index-B3HKDY-B.js";import{t as Y}from"./CoordinateSystem-JCzg9rRI.js";var A=function(){function p(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=W.createCanvas();this.canvas=t}return p.prototype.update=function(t,e,i,a,s,r){var m=this._getBrush(),b=this._getGradient(s,"inRange"),S=this._getGradient(s,"outOfRange"),y=this.pointSize+this.blurSize,u=this.canvas,O=u.getContext("2d"),I=t.length;u.width=e,u.height=i;for(var R=0;R<I;++R){var M=t[R],o=M[0],z=M[1],f=a(M[2]);O.globalAlpha=f,O.drawImage(m,o-y,z-y)}if(!u.width||!u.height)return u;for(var E=O.getImageData(0,0,u.width,u.height),x=E.data,C=0,N=x.length,h=this.minOpacity,c=this.maxOpacity-h;C<N;){f=x[C+3]/256;var v=4*Math.floor(255*f);if(f>0){var n=r(f)?b:S;f>0&&(f=f*c+h),x[C++]=n[v],x[C++]=n[v+1],x[C++]=n[v+2],x[C++]=n[v+3]*f*256}else C+=4}return O.putImageData(E,0,0),u},p.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=W.createCanvas()),e=this.pointSize+this.blurSize,i=2*e;t.width=i,t.height=i;var a=t.getContext("2d");return a.clearRect(0,0,i,i),a.shadowOffsetX=i,a.shadowBlur=this.blurSize,a.shadowColor="#000",a.beginPath(),a.arc(-e,e,this.pointSize,0,2*Math.PI,!0),a.closePath(),a.fill(),t},p.prototype._getGradient=function(t,e){for(var i=this._gradientPixels,a=i[e]||(i[e]=new Uint8ClampedArray(1024)),s=[0,0,0,0],r=0,m=0;m<256;m++)t[e](m/255,!0,s),a[r++]=s[0],a[r++]=s[1],a[r++]=s[2],a[r++]=s[3];return a},p}();function G(p){var t=p.dimensions;return t[0]==="lng"&&t[1]==="lat"}var $=function(p){function t(){var e=p!==null&&p.apply(this,arguments)||this;return e.type=t.type,e}return H(t,p),t.prototype.render=function(e,i,a){var s;i.eachComponent("visualMap",function(m){m.eachTargetSeries(function(b){b===e&&(s=m)})}),this._progressiveEls=null,this.group.removeAll();var r=e.coordinateSystem;r.type==="cartesian2d"||r.type==="calendar"?this._renderOnCartesianAndCalendar(e,a,0,e.getData().count()):G(r)&&this._renderOnGeo(r,e,s,a)},t.prototype.incrementalPrepareRender=function(e,i,a){this.group.removeAll()},t.prototype.incrementalRender=function(e,i,a,s){var r=i.coordinateSystem;r&&(G(r)?this.render(i,a,s):(this._progressiveEls=[],this._renderOnCartesianAndCalendar(i,s,e.start,e.end,!0)))},t.prototype.eachRendered=function(e){Q(this._progressiveEls||this.group,e)},t.prototype._renderOnCartesianAndCalendar=function(e,i,a,s,r){var m,b,S,y,u=e.coordinateSystem,O=Y(u,"cartesian2d");if(O){var I=u.getAxis("x"),R=u.getAxis("y");m=I.getBandWidth()+.5,b=R.getBandWidth()+.5,S=I.scale.getExtent(),y=R.scale.getExtent()}for(var M=this.group,o=e.getData(),z=e.getModel(["emphasis","itemStyle"]).getItemStyle(),f=e.getModel(["blur","itemStyle"]).getItemStyle(),E=e.getModel(["select","itemStyle"]).getItemStyle(),x=e.get(["itemStyle","borderRadius"]),C=L(e),N=e.getModel("emphasis"),h=N.get("focus"),c=N.get("blurScope"),v=N.get("disabled"),n=O?[o.mapDimension("x"),o.mapDimension("y"),o.mapDimension("value")]:[o.mapDimension("time"),o.mapDimension("value")],d=a;d<s;d++){var g=void 0,w=o.getItemVisual(d,"style");if(O){var l=o.get(n[0],d),_=o.get(n[1],d);if(isNaN(o.get(n[2],d))||isNaN(l)||isNaN(_)||l<S[0]||l>S[1]||_<y[0]||_>y[1])continue;var k=u.dataToPoint([l,_]);g=new V({shape:{x:k[0]-m/2,y:k[1]-b/2,width:m,height:b},style:w})}else{if(isNaN(o.get(n[1],d)))continue;g=new V({z2:1,shape:u.dataToRect([o.get(n[0],d)]).contentShape,style:w})}if(o.hasItemOption){var P=o.getItemModel(d),T=P.getModel("emphasis");z=T.getModel("itemStyle").getItemStyle(),f=P.getModel(["blur","itemStyle"]).getItemStyle(),E=P.getModel(["select","itemStyle"]).getItemStyle(),x=P.get(["itemStyle","borderRadius"]),h=T.get("focus"),c=T.get("blurScope"),v=T.get("disabled"),C=L(P)}g.shape.r=x;var D=e.getRawValue(d),B="-";D&&D[2]!=null&&(B=D[2]+""),U(g,C,{labelFetcher:e,labelDataIndex:d,defaultOpacity:w.opacity,defaultText:B}),g.ensureState("emphasis").style=z,g.ensureState("blur").style=f,g.ensureState("select").style=E,j(g,h,c,v),g.incremental=r,r&&(g.states.emphasis.hoverLayer=!0),M.add(g),o.setItemGraphicEl(d,g),this._progressiveEls&&this._progressiveEls.push(g)}},t.prototype._renderOnGeo=function(e,i,a,s){var r=a.targetVisuals.inRange,m=a.targetVisuals.outOfRange,b=i.getData(),S=this._hmLayer||this._hmLayer||new A;S.blurSize=i.get("blurSize"),S.pointSize=i.get("pointSize"),S.minOpacity=i.get("minOpacity"),S.maxOpacity=i.get("maxOpacity");var y=e.getViewRect().clone(),u=e.getRoamTransform();y.applyTransform(u);var O=Math.max(y.x,0),I=Math.max(y.y,0),R=Math.min(y.width+y.x,s.getWidth()),M=Math.min(y.height+y.y,s.getHeight()),o=R-O,z=M-I,f=[b.mapDimension("lng"),b.mapDimension("lat"),b.mapDimension("value")],E=b.mapArray(f,function(h,c,v){var n=e.dataToPoint([h,c]);return n[0]-=O,n[1]-=I,n.push(v),n}),x=a.getExtent(),C=a.type==="visualMap.continuous"?function(h,c){var v=h[1]-h[0];return c=[(c[0]-h[0])/v,(c[1]-h[0])/v],function(n){return n>=c[0]&&n<=c[1]}}(x,a.option.range):function(h,c,v){var n=h[1]-h[0],d=(c=q(c,function(w){return{interval:[(w.interval[0]-h[0])/n,(w.interval[1]-h[0])/n]}})).length,g=0;return function(w){var l;for(l=g;l<d;l++)if((_=c[l].interval)[0]<=w&&w<=_[1]){g=l;break}if(l===d)for(l=g-1;l>=0;l--){var _;if((_=c[l].interval)[0]<=w&&w<=_[1]){g=l;break}}return l>=0&&l<d&&v[l]}}(x,a.getPieceList(),a.option.selected);S.update(E,o,z,r.color.getNormalizer(),{inRange:r.color.getColorMapper(),outOfRange:m.color.getColorMapper()},C);var N=new F({style:{width:o,height:z,x:O,y:I,image:S.canvas},silent:!0});this.group.add(N)},t.type="heatmap",t}(J),ee=function(p){function t(){var e=p!==null&&p.apply(this,arguments)||this;return e.type=t.type,e}return H(t,p),t.prototype.getInitialData=function(e,i){return X(null,this,{generateCoord:"value"})},t.prototype.preventIncremental=function(){var e=Z.get(this.get("coordinateSystem"));if(e&&e.dimensions)return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"},t.type="series.heatmap",t.dependencies=["grid","geo","calendar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},t}(K);function ie(p){p.registerChartView($),p.registerSeriesModel(ee)}export{ie as install};
