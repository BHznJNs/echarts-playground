import{e as U,bK as j,bR as V,d as W,al as q,bT as F,E as H,ah as J,bP as K,bI as Q,df as X,bJ as Z,dg as k}from"./index-CfHuJ7al.js";import{t as Y}from"./CoordinateSystem-JCzg9rRI.js";var A=function(){function p(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=k.createCanvas();this.canvas=t}return p.prototype.update=function(t,e,i,a,s,r){var m=this._getBrush(),b=this._getGradient(s,"inRange"),S=this._getGradient(s,"outOfRange"),y=this.pointSize+this.blurSize,h=this.canvas,O=h.getContext("2d"),I=t.length;h.width=e,h.height=i;for(var R=0;R<I;++R){var M=t[R],o=M[0],z=M[1],f=a(M[2]);O.globalAlpha=f,O.drawImage(m,o-y,z-y)}if(!h.width||!h.height)return h;for(var E=O.getImageData(0,0,h.width,h.height),x=E.data,C=0,P=x.length,u=this.minOpacity,d=this.maxOpacity-u;C<P;){f=x[C+3]/256;var v=4*Math.floor(255*f);if(f>0){var n=r(f)?b:S;f>0&&(f=f*d+u),x[C++]=n[v],x[C++]=n[v+1],x[C++]=n[v+2],x[C++]=n[v+3]*f*256}else C+=4}return O.putImageData(E,0,0),h},p.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=k.createCanvas()),e=this.pointSize+this.blurSize,i=2*e;t.width=i,t.height=i;var a=t.getContext("2d");return a.clearRect(0,0,i,i),a.shadowOffsetX=i,a.shadowBlur=this.blurSize,a.shadowColor="#000",a.beginPath(),a.arc(-e,e,this.pointSize,0,2*Math.PI,!0),a.closePath(),a.fill(),t},p.prototype._getGradient=function(t,e){for(var i=this._gradientPixels,a=i[e]||(i[e]=new Uint8ClampedArray(1024)),s=[0,0,0,0],r=0,m=0;m<256;m++)t[e](m/255,!0,s),a[r++]=s[0],a[r++]=s[1],a[r++]=s[2],a[r++]=s[3];return a},p}();function G(p){var t=p.dimensions;return t[0]==="lng"&&t[1]==="lat"}var $=function(p){function t(){var e=p!==null&&p.apply(this,arguments)||this;return e.type=t.type,e}return U(t,p),t.prototype.render=function(e,i,a){var s;i.eachComponent("visualMap",function(m){m.eachTargetSeries(function(b){b===e&&(s=m)})}),this._progressiveEls=null,this.group.removeAll();var r=e.coordinateSystem;r.type==="cartesian2d"||r.type==="calendar"?this._renderOnCartesianAndCalendar(e,a,0,e.getData().count()):G(r)&&this._renderOnGeo(r,e,s,a)},t.prototype.incrementalPrepareRender=function(e,i,a){this.group.removeAll()},t.prototype.incrementalRender=function(e,i,a,s){var r=i.coordinateSystem;r&&(G(r)?this.render(i,a,s):(this._progressiveEls=[],this._renderOnCartesianAndCalendar(i,s,e.start,e.end,!0)))},t.prototype.eachRendered=function(e){j(this._progressiveEls||this.group,e)},t.prototype._renderOnCartesianAndCalendar=function(e,i,a,s,r){var m,b,S,y,h=e.coordinateSystem,O=Y(h,"cartesian2d");if(O){var I=h.getAxis("x"),R=h.getAxis("y");m=I.getBandWidth()+.5,b=R.getBandWidth()+.5,S=I.scale.getExtent(),y=R.scale.getExtent()}for(var M=this.group,o=e.getData(),z=e.getModel(["emphasis","itemStyle"]).getItemStyle(),f=e.getModel(["blur","itemStyle"]).getItemStyle(),E=e.getModel(["select","itemStyle"]).getItemStyle(),x=e.get(["itemStyle","borderRadius"]),C=V(e),P=e.getModel("emphasis"),u=P.get("focus"),d=P.get("blurScope"),v=P.get("disabled"),n=O?[o.mapDimension("x"),o.mapDimension("y"),o.mapDimension("value")]:[o.mapDimension("time"),o.mapDimension("value")],c=a;c<s;c++){var g=void 0,_=o.getItemVisual(c,"style");if(O){var l=o.get(n[0],c),w=o.get(n[1],c);if(isNaN(o.get(n[2],c))||isNaN(l)||isNaN(w)||l<S[0]||l>S[1]||w<y[0]||w>y[1])continue;var B=h.dataToPoint([l,w]);g=new W({shape:{x:B[0]-m/2,y:B[1]-b/2,width:m,height:b},style:_})}else{if(isNaN(o.get(n[1],c)))continue;g=new W({z2:1,shape:h.dataToRect([o.get(n[0],c)]).contentShape,style:_})}if(o.hasItemOption){var T=o.getItemModel(c),N=T.getModel("emphasis");z=N.getModel("itemStyle").getItemStyle(),f=T.getModel(["blur","itemStyle"]).getItemStyle(),E=T.getModel(["select","itemStyle"]).getItemStyle(),x=T.get(["itemStyle","borderRadius"]),u=N.get("focus"),d=N.get("blurScope"),v=N.get("disabled"),C=V(T)}g.shape.r=x;var D=e.getRawValue(c),L="-";D&&D[2]!=null&&(L=D[2]+""),q(g,C,{labelFetcher:e,labelDataIndex:c,defaultOpacity:_.opacity,defaultText:L}),g.ensureState("emphasis").style=z,g.ensureState("blur").style=f,g.ensureState("select").style=E,F(g,u,d,v),g.incremental=r,r&&(g.states.emphasis.hoverLayer=!0),M.add(g),o.setItemGraphicEl(c,g),this._progressiveEls&&this._progressiveEls.push(g)}},t.prototype._renderOnGeo=function(e,i,a,s){var r=a.targetVisuals.inRange,m=a.targetVisuals.outOfRange,b=i.getData(),S=this._hmLayer||this._hmLayer||new A;S.blurSize=i.get("blurSize"),S.pointSize=i.get("pointSize"),S.minOpacity=i.get("minOpacity"),S.maxOpacity=i.get("maxOpacity");var y=e.getViewRect().clone(),h=e.getRoamTransform();y.applyTransform(h);var O=Math.max(y.x,0),I=Math.max(y.y,0),R=Math.min(y.width+y.x,s.getWidth()),M=Math.min(y.height+y.y,s.getHeight()),o=R-O,z=M-I,f=[b.mapDimension("lng"),b.mapDimension("lat"),b.mapDimension("value")],E=b.mapArray(f,function(u,d,v){var n=e.dataToPoint([u,d]);return n[0]-=O,n[1]-=I,n.push(v),n}),x=a.getExtent(),C=a.type==="visualMap.continuous"?function(u,d){var v=u[1]-u[0];return d=[(d[0]-u[0])/v,(d[1]-u[0])/v],function(n){return n>=d[0]&&n<=d[1]}}(x,a.option.range):function(u,d,v){var n=u[1]-u[0],c=(d=H(d,function(_){return{interval:[(_.interval[0]-u[0])/n,(_.interval[1]-u[0])/n]}})).length,g=0;return function(_){var l;for(l=g;l<c;l++)if((w=d[l].interval)[0]<=_&&_<=w[1]){g=l;break}if(l===c)for(l=g-1;l>=0;l--){var w;if((w=d[l].interval)[0]<=_&&_<=w[1]){g=l;break}}return l>=0&&l<c&&v[l]}}(x,a.getPieceList(),a.option.selected);S.update(E,o,z,r.color.getNormalizer(),{inRange:r.color.getColorMapper(),outOfRange:m.color.getColorMapper()},C);var P=new J({style:{width:o,height:z,x:O,y:I,image:S.canvas},silent:!0});this.group.add(P)},t.type="heatmap",t}(K),ee=function(p){function t(){var e=p!==null&&p.apply(this,arguments)||this;return e.type=t.type,e}return U(t,p),t.prototype.getInitialData=function(e,i){return Q(null,this,{generateCoord:"value"})},t.prototype.preventIncremental=function(){var e=X.get(this.get("coordinateSystem"));if(e&&e.dimensions)return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"},t.type="series.heatmap",t.dependencies=["grid","geo","calendar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},t}(Z);function ie(p){p.registerChartView($),p.registerSeriesModel(ee)}export{ie as install};
