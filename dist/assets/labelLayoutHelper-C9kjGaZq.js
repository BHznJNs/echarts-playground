import{cD as O,z as j}from"./index-DqzYUymv.js";function E(m){for(var b=[],c=0;c<m.length;c++){var l=m[c];if(!l.defaultAttr.ignore){var a=l.label,r=a.getComputedTransform(),s=a.getBoundingRect(),M=!r||r[1]<1e-5&&r[2]<1e-5,g=a.style.margin||0,f=s.clone();f.applyTransform(r),f.x-=g/2,f.y-=g/2,f.width+=g,f.height+=g;var t=M?new O(s,r):null;b.push({label:a,labelLine:l.labelLine,rect:f,localRect:s,obb:t,priority:l.priority,defaultAttr:l.defaultAttr,layoutOption:l.computedLayoutOption,axisAligned:M,transform:r})}}return b}function F(m,b,c,l){return function(a,r,s,M,g,f){var t=a.length;if(!(t<2)){a.sort(function(n,v){return n.rect[r]-v.rect[r]});for(var d,w=0,y=!1,u=0,h=0;h<t;h++){var p=a[h],R=p.rect;(d=R[r]-w)<0&&(R[r]-=d,p.label[r]-=d,y=!0),u+=Math.max(-d,0),w=R[r]+R[s]}u>0&&f&&L(-u/t,0,t);var x,A,S=a[0],T=a[t-1];return z(),x<0&&k(-x,.8),A<0&&k(A,.8),z(),B(x,A,1),B(A,x,-1),z(),x<0&&C(-x),A<0&&C(A),y}function z(){x=S.rect[r]-M,A=g-T.rect[r]-T.rect[s]}function B(n,v,o){if(n<0){var i=Math.min(v,-n);if(i>0){L(i*o,0,t);var e=i+n;e<0&&k(-e*o,1)}else k(-n*o,1)}}function L(n,v,o){n!==0&&(y=!0);for(var i=v;i<o;i++){var e=a[i];e.rect[r]+=n,e.label[r]+=n}}function k(n,v){for(var o=[],i=0,e=1;e<t;e++){var D=a[e-1].rect,G=Math.max(a[e].rect[r]-D[r]-D[s],0);o.push(G),i+=G}if(i){var I=Math.min(Math.abs(n)/i,v);if(n>0)for(e=0;e<t-1;e++)L(o[e]*I,0,e+1);else for(e=t-1;e>0;e--)L(-o[e-1]*I,e,t)}}function C(n){var v=n<0?-1:1;n=Math.abs(n);for(var o=Math.ceil(n/(t-1)),i=0;i<t-1;i++)if(v>0?L(o,0,i+1):L(-o,t-i-1,t),(n-=o)<=0)return}}(m,"y","height",b,c,l)}function H(m){var b=[];m.sort(function(h,p){return p.priority-h.priority});var c=new j(0,0,0,0);function l(h){if(!h.ignore){var p=h.ensureState("emphasis");p.ignore==null&&(p.ignore=!1)}h.ignore=!0}for(var a=0;a<m.length;a++){var r=m[a],s=r.axisAligned,M=r.localRect,g=r.transform,f=r.label,t=r.labelLine;c.copy(r.rect),c.width-=.1,c.height-=.1,c.x+=.05,c.y+=.05;for(var d=r.obb,w=!1,y=0;y<b.length;y++){var u=b[y];if(c.intersect(u.rect)){if(s&&u.axisAligned){w=!0;break}if(u.obb||(u.obb=new O(u.localRect,u.transform)),d||(d=new O(M,g)),d.intersect(u.obb)){w=!0;break}}}w?(l(f),t&&l(t)):(f.attr("ignore",r.defaultAttr.ignore),t&&t.attr("ignore",r.defaultAttr.labelGuideIgnore),b.push(r))}}export{F as a,E as e,H as n};
