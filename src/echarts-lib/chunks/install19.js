import{_ as e,a3 as t,W as a,G as i,u as n,s as r,k as s,j as o,p as u,o as h,C as l,R as d,f as g,bh as p,bo as m,bg as y,b4 as c,bf as f,T as v,aJ as x,d as D,aH as b,S as w,D as L,m as S}from"./index.js";import{a as I}from"./poly.js";import{L as A}from"./LegendVisualProvider.js";import{d as P}from"./dataFilter.js";var C=function(l){function p(){var e=null!==l&&l.apply(this,arguments)||this;return e.type=p.type,e._layers=[],e}return e(p,l),p.prototype.render=function(e,l,p){var m=e.getData(),y=this,c=this.group,f=e.getLayerSeries(),v=m.getLayout("layoutInfo"),x=v.rect,D=v.boundaryGap;function b(e){return e.name}c.x=0,c.y=x.y+D[0];var w=new t(this._layersSeries||[],f,b,b),L=[];function S(t,a,l){var p=y._layers;if("remove"!==t){for(var v,x,D=[],b=[],w=f[a].indices,S=0;S<w.length;S++){var A=m.getItemLayout(w[S]),P=A.x,C=A.y0,R=A.y;D.push(P,C),b.push(P,C+R),v=m.getItemVisual(w[S],"style")}var T=m.getItemLayout(w[0]),V=e.getModel("label").get("margin"),_=e.getModel("emphasis");if("add"===t){var k=L[a]=new i;x=new I({shape:{points:D,stackedOnPoints:b,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),k.add(x),c.add(k),e.isAnimationEnabled()&&x.setClipPath(function(e,t,a){var i=new d({shape:{x:e.x-10,y:e.y-10,width:0,height:e.height+20}});return g(i,{shape:{x:e.x-50,width:e.width+100,height:e.height+20}},t,a),i}(x.getBoundingRect(),e,(function(){x.removeClipPath()})))}else{k=p[l];x=k.childAt(0),c.add(k),L[a]=k,n(x,{shape:{points:D,stackedOnPoints:b}},e),r(x)}s(x,o(e),{labelDataIndex:w[S-1],defaultText:m.getName(w[S-1]),inheritColor:v.fill},{normal:{verticalAlign:"middle"}}),x.setTextConfig({position:null,local:!0});var G=x.getTextContent();G&&(G.x=T.x-V,G.y=T.y0+T.y/2),x.useStyle(v),m.setItemGraphicEl(a,x),u(x,e),h(x,_.get("focus"),_.get("blurScope"),_.get("disabled"))}else c.remove(p[a])}w.add(a(S,this,"add")).update(a(S,this,"update")).remove(a(S,this,"remove")).execute(),this._layersSeries=f,this._layers=L},p.type="themeRiver",p}(l),R=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=i.type,e}return e(i,t),i.prototype.init=function(e){t.prototype.init.apply(this,arguments),this.legendVisualProvider=new A(a(this.getData,this),a(this.getRawData,this))},i.prototype.fixData=function(e){var t=e.length,a={},i=p(e,(function(e){return a.hasOwnProperty(e[0]+"")||(a[e[0]+""]=-1),e[2]})),n=[];i.buckets.each((function(e,t){n.push({name:t,dataList:e})}));for(var r=n.length,s=0;s<r;++s){for(var o=n[s].name,u=0;u<n[s].dataList.length;++u){var h=n[s].dataList[u][0]+"";a[h]=s}for(var h in a)a.hasOwnProperty(h)&&a[h]!==s&&(a[h]=s,e[t]=[h,0,o],t++)}return e},i.prototype.getInitialData=function(e,t){for(var a=this.getReferringComponents("singleAxis",m).models[0].get("type"),i=y(e.data,(function(e){return void 0!==e[2]})),n=this.fixData(i||[]),r=[],s=this.nameMap=c(),o=0,u=0;u<n.length;++u)r.push(n[u][2]),s.get(n[u][2])||(s.set(n[u][2],o),o++);var h=f(n,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:v(a)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,l=new x(h,this);return l.initData(n),l},i.prototype.getLayerSeries=function(){for(var e=this.getData(),t=e.count(),a=[],i=0;i<t;++i)a[i]=i;var n=e.mapDimension("single"),r=p(a,(function(t){return e.get("name",t)})),s=[];return r.buckets.each((function(t,a){t.sort((function(t,a){return e.get(n,t)-e.get(n,a)})),s.push({name:a,indices:t})})),s},i.prototype.getAxisTooltipData=function(e,t,a){D(e)||(e=e?[e]:[]);for(var i,n=this.getData(),r=this.getLayerSeries(),s=[],o=r.length,u=0;u<o;++u){for(var h=Number.MAX_VALUE,l=-1,d=r[u].indices.length,g=0;g<d;++g){var p=n.get(e[0],r[u].indices[g]),m=Math.abs(p-t);m<=h&&(i=p,h=m,l=r[u].indices[g])}s.push(l)}return{dataIndices:s,nestestValue:i}},i.prototype.formatTooltip=function(e,t,a){var i=this.getData(),n=i.getName(e),r=i.get(i.mapDimension("value"),e);return b("nameValue",{name:n,value:r})},i.type="series.themeRiver",i.dependencies=["singleAxis"],i.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},i}(w);function T(e,t){e.eachSeriesByType("themeRiver",(function(e){var t=e.getData(),a=e.coordinateSystem,i={},n=a.getRect();i.rect=n;var r=e.get("boundaryGap"),s=a.getAxis();(i.boundaryGap=r,"horizontal"===s.orient)?(r[0]=L(r[0],n.height),r[1]=L(r[1],n.height),V(t,e,n.height-r[0]-r[1])):(r[0]=L(r[0],n.width),r[1]=L(r[1],n.width),V(t,e,n.width-r[0]-r[1]));t.setLayout("layoutInfo",i)}))}function V(e,t,a){if(e.count())for(var i,n=t.coordinateSystem,r=t.getLayerSeries(),s=e.mapDimension("single"),o=e.mapDimension("value"),u=S(r,(function(t){return S(t.indices,(function(t){var a=n.dataToPoint(e.get(s,t));return a[1]=e.get(o,t),a}))})),h=function(e){for(var t=e.length,a=e[0].length,i=[],n=[],r=0,s=0;s<a;++s){for(var o=0,u=0;u<t;++u)o+=e[u][s][1];o>r&&(r=o),i.push(o)}for(var h=0;h<a;++h)n[h]=(r-i[h])/2;r=0;for(var l=0;l<a;++l){var d=i[l]+n[l];d>r&&(r=d)}return{y0:n,max:r}}(u),l=h.y0,d=a/h.max,g=r.length,p=r[0].indices.length,m=0;m<p;++m){i=l[m]*d,e.setItemLayout(r[0].indices[m],{layerIndex:0,x:u[0][m][0],y0:i,y:u[0][m][1]*d});for(var y=1;y<g;++y)i+=u[y-1][m][1]*d,e.setItemLayout(r[y].indices[m],{layerIndex:y,x:u[y][m][0],y0:i,y:u[y][m][1]*d})}}function _(e){e.registerChartView(C),e.registerSeriesModel(R),e.registerLayout(T),e.registerProcessor(P("themeRiver"))}export{_ as install};
