import{I as e,bL as t,G as n,R as o,a0 as i,c6 as r,b2 as a,ap as s,c7 as l,aj as p,ah as u,a5 as c,c8 as g,aS as h,c9 as d,X as f,e as m,m as v,ca as y,cb as _,cc as b,bA as S,bz as w,bB as x,b4 as M,bK as G,a_ as F,cd as A,ce as C,cf as T,V as R,cg as N,u as D,aa as I,a9 as L,h as O,a8 as k,k as P,j as V,g as B,ch as z,o as j,ci as J,cj as U,_ as X,Q as Y,z as E,bo as H,b0 as W,aV as Z,D as q,am as K,ck as Q,cl as $,al as ee,cm as te,aG as ne,H as oe,bR as ie,cn as re,bQ as ae}from"./index.js";import{u as se,a as le,V as pe,b as ue}from"./roamHelper.js";import{R as ce}from"./RoamController.js";import{o as ge}from"./cursorHelper.js";function he(t){e(t)&&(t=(new DOMParser).parseFromString(t,"text/xml"));var n=t;for(9===n.nodeType&&(n=n.firstChild);"svg"!==n.nodeName.toLowerCase()||1!==n.nodeType;)n=n.nextSibling;return n}var de,fe={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},me=t(fe),ve={"alignment-baseline":"textBaseline","stop-color":"stopColor"},ye=t(ve),_e=function(){function e(){this._defs={},this._root=null}return e.prototype.parse=function(e,t){t=t||{};var i=he(e);this._defsUsePending=[];var r=new n;this._root=r;var a=[],s=i.getAttribute("viewBox")||"",l=parseFloat(i.getAttribute("width")||t.width),p=parseFloat(i.getAttribute("height")||t.height);isNaN(l)&&(l=null),isNaN(p)&&(p=null),Ge(i,r,null,!0,!1);for(var u,c,g=i.firstChild;g;)this._parseNode(g,r,a,null,!1,!1),g=g.nextSibling;if(function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o[0].style[o[1]]=e[o[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],s){var h=Te(s);h.length>=4&&(u={x:parseFloat(h[0]||0),y:parseFloat(h[1]||0),width:parseFloat(h[2]),height:parseFloat(h[3])})}if(u&&null!=l&&null!=p&&(c=Le(u,{x:0,y:0,width:l,height:p}),!t.ignoreViewBox)){var d=r;(r=new n).add(d),d.scaleX=d.scaleY=c.scale,d.x=c.x,d.y=c.y}return t.ignoreRootClip||null==l||null==p||r.setClipPath(new o({shape:{x:0,y:0,width:l,height:p}})),{root:r,width:l,height:p,viewBoxRect:u,viewBoxTransform:c,named:a}},e.prototype._parseNode=function(e,t,n,o,r,a){var s,l=e.nodeName.toLowerCase(),p=o;if("defs"===l&&(r=!0),"text"===l&&(a=!0),"defs"===l||"switch"===l)s=t;else{if(!r){var u=de[l];if(u&&i(de,l)){s=u.call(this,e,t);var c=e.getAttribute("name");if(c){var g={name:c,namedFrom:null,svgNodeTagLower:l,el:s};n.push(g),"g"===l&&(p=g)}else o&&n.push({name:o.name,namedFrom:o,svgNodeTagLower:l,el:s});t.add(s)}}var h=be[l];if(h&&i(be,l)){var d=h.call(this,e),f=e.getAttribute("id");f&&(this._defs[f]=d)}}if(s&&s.isGroup)for(var m=e.firstChild;m;)1===m.nodeType?this._parseNode(m,s,n,p,r,a):3===m.nodeType&&a&&this._parseText(m,s),m=m.nextSibling},e.prototype._parseText=function(e,t){var n=new r({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0});xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),function(e,t){var n=t.__selfStyle;if(n){var o=n.textBaseline,i=o;o&&"auto"!==o?"baseline"===o?i="alphabetic":"before-edge"===o||"text-before-edge"===o?i="top":"after-edge"===o||"text-after-edge"===o?i="bottom":"central"!==o&&"mathematical"!==o||(i="middle"):i="alphabetic",e.style.textBaseline=i}var r=t.__inheritedStyle;if(r){var a=r.textAlign,s=a;a&&("middle"===a&&(s="center"),e.style.textAlign=s)}}(n,t);var o=n.style,i=o.fontSize;i&&i<9&&(o.fontSize=9,n.scaleX*=i/9,n.scaleY*=i/9);var a=(o.fontSize||o.fontFamily)&&[o.fontStyle,o.fontWeight,(o.fontSize||12)+"px",o.fontFamily||"sans-serif"].join(" ");o.font=a;var s=n.getBoundingRect();return this._textX+=s.width,t.add(n),n},e.internalField=void(de={g:function(e,t){var o=new n;return xe(t,o),Ge(e,o,this._defsUsePending,!1,!1),o},rect:function(e,t){var n=new o;return xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),n.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),n.silent=!0,n},circle:function(e,t){var n=new a;return xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),n.silent=!0,n},line:function(e,t){var n=new s;return xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),n.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),n.silent=!0,n},ellipse:function(e,t){var n=new l;return xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),n.silent=!0,n},polygon:function(e,t){var n,o=e.getAttribute("points");o&&(n=Me(o));var i=new p({shape:{points:n||[]},silent:!0});return xe(t,i),Ge(e,i,this._defsUsePending,!1,!1),i},polyline:function(e,t){var n,o=e.getAttribute("points");o&&(n=Me(o));var i=new u({shape:{points:n||[]},silent:!0});return xe(t,i),Ge(e,i,this._defsUsePending,!1,!1),i},image:function(e,t){var n=new c;return xe(t,n),Ge(e,n,this._defsUsePending,!1,!1),n.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),n.silent=!0,n},text:function(e,t){var o=e.getAttribute("x")||"0",i=e.getAttribute("y")||"0",r=e.getAttribute("dx")||"0",a=e.getAttribute("dy")||"0";this._textX=parseFloat(o)+parseFloat(r),this._textY=parseFloat(i)+parseFloat(a);var s=new n;return xe(t,s),Ge(e,s,this._defsUsePending,!1,!0),s},tspan:function(e,t){var o=e.getAttribute("x"),i=e.getAttribute("y");null!=o&&(this._textX=parseFloat(o)),null!=i&&(this._textY=parseFloat(i));var r=e.getAttribute("dx")||"0",a=e.getAttribute("dy")||"0",s=new n;return xe(t,s),Ge(e,s,this._defsUsePending,!1,!0),this._textX+=parseFloat(r),this._textY+=parseFloat(a),s},path:function(e,t){var n=e.getAttribute("d")||"",o=g(n);return xe(t,o),Ge(e,o,this._defsUsePending,!1,!1),o.silent=!0,o}}),e}(),be={lineargradient:function(e){var t=parseInt(e.getAttribute("x1")||"0",10),n=parseInt(e.getAttribute("y1")||"0",10),o=parseInt(e.getAttribute("x2")||"10",10),i=parseInt(e.getAttribute("y2")||"0",10),r=new h(t,n,o,i);return Se(e,r),we(e,r),r},radialgradient:function(e){var t=parseInt(e.getAttribute("cx")||"0",10),n=parseInt(e.getAttribute("cy")||"0",10),o=parseInt(e.getAttribute("r")||"0",10),i=new d(t,n,o);return Se(e,i),we(e,i),i}};function Se(e,t){"userSpaceOnUse"===e.getAttribute("gradientUnits")&&(t.global=!0)}function we(e,t){for(var n=e.firstChild;n;){if(1===n.nodeType&&"stop"===n.nodeName.toLocaleLowerCase()){var o=n.getAttribute("offset"),i=void 0;i=o&&o.indexOf("%")>0?parseInt(o,10)/100:o?parseFloat(o):0;var r={};Ie(n,r,r);var a=r.stopColor||n.getAttribute("stop-color")||"#000000";t.colorStops.push({offset:i,color:a})}n=n.nextSibling}}function xe(e,t){e&&e.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),f(t.__inheritedStyle,e.__inheritedStyle))}function Me(e){for(var t=Te(e),n=[],o=0;o<t.length;o+=2){var i=parseFloat(t[o]),r=parseFloat(t[o+1]);n.push([i,r])}return n}function Ge(e,t,n,o,i){var r=t,a=r.__inheritedStyle=r.__inheritedStyle||{},s={};1===e.nodeType&&(function(e,t){var n=e.getAttribute("transform");if(n){n=n.replace(/,/g," ");var o=[],i=null;n.replace(Re,(function(e,t,n){return o.push(t,n),""}));for(var r=o.length-1;r>0;r-=2){var a=o[r],s=o[r-1],l=Te(a);switch(i=i||x(),s){case"translate":w(i,i,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":S(i,i,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":b(i,i,-parseFloat(l[0])*Ne,[parseFloat(l[1]||"0"),parseFloat(l[2]||"0")]);break;case"skewX":var p=Math.tan(parseFloat(l[0])*Ne);_(i,[1,0,p,1,0,0],i);break;case"skewY":var u=Math.tan(parseFloat(l[0])*Ne);_(i,[1,u,0,1,0,0],i);break;case"matrix":i[0]=parseFloat(l[0]),i[1]=parseFloat(l[1]),i[2]=parseFloat(l[2]),i[3]=parseFloat(l[3]),i[4]=parseFloat(l[4]),i[5]=parseFloat(l[5])}}t.setLocalTransform(i)}}(e,t),Ie(e,a,s),o||function(e,t,n){for(var o=0;o<me.length;o++){var i=me[o];null!=(r=e.getAttribute(i))&&(t[fe[i]]=r)}for(o=0;o<ye.length;o++){var r;i=ye[o];null!=(r=e.getAttribute(i))&&(n[ve[i]]=r)}}(e,a,s)),r.style=r.style||{},null!=a.fill&&(r.style.fill=Ae(r,"fill",a.fill,n)),null!=a.stroke&&(r.style.stroke=Ae(r,"stroke",a.stroke,n)),m(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],(function(e){null!=a[e]&&(r.style[e]=parseFloat(a[e]))})),m(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],(function(e){null!=a[e]&&(r.style[e]=a[e])})),i&&(r.__selfStyle=s),a.lineDash&&(r.style.lineDash=v(Te(a.lineDash),(function(e){return parseFloat(e)}))),"hidden"!==a.visibility&&"collapse"!==a.visibility||(r.invisible=!0),"none"===a.display&&(r.ignore=!0)}var Fe=/^url\(\s*#(.*?)\)/;function Ae(e,t,n,o){var i=n&&n.match(Fe);if(!i)return"none"===n&&(n=null),n;var r=y(i[1]);o.push([e,t,r])}var Ce=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function Te(e){return e.match(Ce)||[]}var Re=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,Ne=Math.PI/180;var De=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Ie(e,t,n){var o,r=e.getAttribute("style");if(r)for(De.lastIndex=0;null!=(o=De.exec(r));){var a=o[1],s=i(fe,a)?fe[a]:null;s&&(t[s]=o[2]);var l=i(ve,a)?ve[a]:null;l&&(n[l]=o[2])}}function Le(e,t){var n=t.width/e.width,o=t.height/e.height,i=Math.min(n,o);return{scale:i,x:-(e.x+e.width/2)*i+(t.x+t.width/2),y:-(e.y+e.height/2)*i+(t.y+t.height/2)}}var Oe=M(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),ke=function(){function e(e,t){this.type="geoSVG",this._usedGraphicMap=M(),this._freedGraphics=[],this._mapName=e,this._parsedXML=he(t)}return e.prototype.load=function(){var e=this._firstGraphic;if(!e){e=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(e),this._boundingRect=this._firstGraphic.boundingRect.clone();var t=function(e){var t=[],n=M();return m(e,(function(e){if(null==e.namedFrom){var o=new A(e.name,e.el);t.push(o),n.set(e.name,o)}})),{regions:t,regionsMap:n}}(e.named),n=t.regions,o=t.regionsMap;this._regions=n,this._regionsMap=o}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},e.prototype._buildGraphic=function(e){var t,i,r,a;try{i=(t=e&&(r=e,a={ignoreViewBox:!0,ignoreRootClip:!0},(new _e).parse(r,a))||{}).root,G(null!=i)}catch(e){throw new Error("Invalid svg format\n"+e.message)}var s=new n;s.add(i),s.isGeoSVGGraphicRoot=!0;var l=t.width,p=t.height,u=t.viewBoxRect,c=this._boundingRect;if(!c){var g=void 0,h=void 0,d=void 0,f=void 0;if(null!=l?(g=0,d=l):u&&(g=u.x,d=u.width),null!=p?(h=0,f=p):u&&(h=u.y,f=u.height),null==g||null==h){var v=i.getBoundingRect();null==g&&(g=v.x,d=v.width),null==h&&(h=v.y,f=v.height)}c=this._boundingRect=new F(g,h,d,f)}if(u){var y=Le(u,c);i.scaleX=i.scaleY=y.scale,i.x=y.x,i.y=y.y}s.setClipPath(new o({shape:c.plain()}));var _=[];return m(t.named,(function(e){var t;null!=Oe.get(e.svgNodeTagLower)&&(_.push(e),(t=e.el).silent=!1,t.isGroup&&t.traverse((function(e){e.silent=!1})))})),{root:s,boundingRect:c,named:_}},e.prototype.useGraphic=function(e){var t=this._usedGraphicMap,n=t.get(e);return n||(n=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),t.set(e,n),n)},e.prototype.freeGraphic=function(e){var t=this._usedGraphicMap,n=t.get(e);n&&(t.removeKey(e),this._freedGraphics.push(n))},e}();for(var Pe=[126,25],Ve="南海诸岛",Be=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]],ze=0;ze<Be.length;ze++)for(var je=0;je<Be[ze].length;je++)Be[ze][je][0]/=10.5,Be[ze][je][1]/=-14,Be[ze][je][0]+=Pe[0],Be[ze][je][1]+=Pe[1];var Je={"南海诸岛":[32,80],"广东":[0,-10],"香港":[10,5],"澳门":[-10,10],"天津":[5,5]};var Ue=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];var Xe=function(){function t(t,n,o){var i;this.type="geoJSON",this._parsedMap=M(),this._mapName=t,this._specialAreas=o,this._geoJSON=e(i=n)?"undefined"!=typeof JSON&&JSON.parse?JSON.parse(i):new Function("return ("+i+");")():i}return t.prototype.load=function(e,t){t=t||"name";var n=this._parsedMap.get(t);if(!n){var o=this._parseToRegions(t);n=this._parsedMap.set(t,{regions:o,boundingRect:Ye(o)})}var r=M(),a=[];return m(n.regions,(function(t){var n=t.name;e&&i(e,n)&&(t=t.cloneShallow(n=e[n])),a.push(t),r.set(n,t)})),{regions:a,boundingRect:n.boundingRect||new F(0,0,0,0),regionsMap:r}},t.prototype._parseToRegions=function(e){var t,n=this._mapName,o=this._geoJSON;try{t=o?T(o,e):[]}catch(e){throw new Error("Invalid geoJson format\n"+e.message)}return function(e,t){if("china"===e){for(var n=0;n<t.length;n++)if(t[n].name===Ve)return;t.push(new C(Ve,v(Be,(function(e){return{type:"polygon",exterior:e}})),Pe))}}(n,t),m(t,(function(e){var t=e.name;!function(e,t){if("china"===e){var n=Je[t.name];if(n){var o=t.getCenter();o[0]+=n[0]/10.5,o[1]+=-n[1]/14,t.setCenter(o)}}}(n,e),function(e,t){"china"===e&&"台湾"===t.name&&t.geometries.push({type:"polygon",exterior:Ue[0]})}(n,e);var o=this._specialAreas&&this._specialAreas[t];o&&e.transformTo(o.left,o.top,o.width,o.height)}),this),t},t.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},t}();function Ye(e){for(var t,n=0;n<e.length;n++){var o=e[n].getBoundingRect();(t=t||o.clone()).union(o)}return t}var Ee=M(),He={registerMap:function(e,t,n){if(t.svg){var o=new ke(e,t.svg);Ee.set(e,o)}else{var i=t.geoJson||t.geoJSON;i&&!t.features?n=t.specialAreas:i=t;o=new Xe(e,i,n);Ee.set(e,o)}},getGeoResource:function(e){return Ee.get(e)},getMapForUser:function(e){var t=Ee.get(e);return t&&"geoJSON"===t.type&&t.getMapForUser()},load:function(e,t,n){var o=Ee.get(e);if(o)return o.load(t,n)}},We=["rect","circle","line","ellipse","polygon","polyline","path"],Ze=M(We),qe=M(We.concat(["g"])),Ke=M(We.concat(["g"])),Qe=R();function $e(e){var t=e.getItemStyle(),n=e.get("areaColor");return null!=n&&(t.fill=n),t}function et(e){var t=e.style;t&&(t.stroke=t.stroke||t.fill,t.fill=null)}var tt=function(){function e(e){var t=new n;this.uid=N("ec_map_draw"),this._controller=new ce(e.getZr()),this._controllerHost={target:t},this.group=t,t.add(this._regionsGroup=new n),t.add(this._svgGroup=new n)}return e.prototype.draw=function(e,t,n,o,i){var r="geo"===e.mainType,a=e.getData&&e.getData();r&&t.eachComponent({mainType:"series",subType:"map"},(function(t){a||t.getHostGeoModel()!==e||(a=t.getData())}));var s=e.coordinateSystem,l=this._regionsGroup,p=this.group,u=s.getTransformInfo(),c=u.raw,g=u.roam;!l.childAt(0)||i?(p.x=g.x,p.y=g.y,p.scaleX=g.scaleX,p.scaleY=g.scaleY,p.dirty()):D(p,g,e);var h=a&&a.getVisual("visualMeta")&&a.getVisual("visualMeta").length>0,d={api:n,geo:s,mapOrGeoModel:e,data:a,isVisualEncodedByVisualMap:h,isGeo:r,transformInfoRaw:c};"geoJSON"===s.resourceType?this._buildGeoJSON(d):"geoSVG"===s.resourceType&&this._buildSVG(d),this._updateController(e,t,n),this._updateMapSelectHandler(e,l,n,o)},e.prototype._buildGeoJSON=function(e){var t=this._regionsGroupByName=M(),o=M(),i=this._regionsGroup,r=e.transformInfoRaw,a=e.mapOrGeoModel,s=e.data,l=e.geo.projection,c=l&&l.stream;function g(e,t){return t&&(e=t(e)),e&&[e[0]*r.scaleX+r.x,e[1]*r.scaleY+r.y]}function h(e){for(var t=[],n=!c&&l&&l.project,o=0;o<e.length;++o){var i=g(e[o],n);i&&t.push(i)}return t}function d(e){return{shape:{points:h(e)}}}i.removeAll(),m(e.geo.regions,(function(r){var h=r.name,f=t.get(h),v=o.get(h)||{},y=v.dataIdx,_=v.regionModel;f||(f=t.set(h,new n),i.add(f),y=s?s.indexOfName(h):null,_=e.isGeo?a.getRegionModel(h):s?s.getItemModel(y):null,o.set(h,{dataIdx:y,regionModel:_}));var b=[],S=[];m(r.geometries,(function(e){if("polygon"===e.type){var t=[e.exterior].concat(e.interiors||[]);c&&(t=st(t,c)),m(t,(function(e){b.push(new p(d(e)))}))}else{var n=e.points;c&&(n=st(n,c,!0)),m(n,(function(e){S.push(new u(d(e)))}))}}));var w=g(r.getCenter(),l&&l.project);function x(t,n){if(t.length){var o=new U({culling:!0,segmentIgnoreThreshold:1,shape:{paths:t}});f.add(o),nt(e,o,y,_),ot(e,o,h,_,a,y,w),n&&(et(o),m(o.states,et))}}x(b),x(S,!0)})),t.each((function(t,n){var i=o.get(n),r=i.dataIdx,s=i.regionModel;it(e,t,n,s,a,r),rt(e,t,n,s,a),at(e,t,n,s,a)}),this)},e.prototype._buildSVG=function(e){var t=e.geo.map,n=e.transformInfoRaw;this._svgGroup.x=n.x,this._svgGroup.y=n.y,this._svgGroup.scaleX=n.scaleX,this._svgGroup.scaleY=n.scaleY,this._svgResourceChanged(t)&&(this._freeSVG(),this._useSVG(t));var o=this._svgDispatcherMap=M(),i=!1;m(this._svgGraphicRecord.named,(function(t){var n=t.name,r=e.mapOrGeoModel,a=e.data,s=t.svgNodeTagLower,l=t.el,p=a?a.indexOfName(n):null,u=r.getRegionModel(n);(null!=Ze.get(s)&&l instanceof I&&nt(e,l,p,u),l instanceof I&&(l.culling=!0),l.z2EmphasisLift=0,t.namedFrom)||(null!=Ke.get(s)&&ot(e,l,n,u,r,p,null),it(e,l,n,u,r,p),rt(e,l,n,u,r),null!=qe.get(s)&&("self"===at(e,l,n,u,r)&&(i=!0),(o.get(n)||o.set(n,[])).push(l)))}),this),this._enableBlurEntireSVG(i,e)},e.prototype._enableBlurEntireSVG=function(e,t){if(e&&t.isGeo){var n=t.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle().opacity;this._svgGraphicRecord.root.traverse((function(e){if(!e.isGroup){L(e);var t=e.ensureState("blur").style||{};null==t.opacity&&null!=n&&(t.opacity=n),e.ensureState("emphasis")}}))}},e.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},e.prototype.findHighDownDispatchers=function(e,t){if(null==e)return[];var n=t.coordinateSystem;if("geoJSON"===n.resourceType){var o=this._regionsGroupByName;if(o){var i=o.get(e);return i?[i]:[]}}else if("geoSVG"===n.resourceType)return this._svgDispatcherMap&&this._svgDispatcherMap.get(e)||[]},e.prototype._svgResourceChanged=function(e){return this._svgMapName!==e},e.prototype._useSVG=function(e){var t=He.getGeoResource(e);if(t&&"geoSVG"===t.type){var n=t.useGraphic(this.uid);this._svgGroup.add(n.root),this._svgGraphicRecord=n,this._svgMapName=e}},e.prototype._freeSVG=function(){var e=this._svgMapName;if(null!=e){var t=He.getGeoResource(e);t&&"geoSVG"===t.type&&t.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},e.prototype._updateController=function(e,t,n){var o=e.coordinateSystem,i=this._controller,r=this._controllerHost;r.zoomLimit=e.get("scaleLimit"),r.zoom=o.getZoom(),i.enable(e.get("roam")||!1);var a=e.mainType;function s(){var t={type:"geoRoam",componentType:a};return t[a+"Id"]=e.id,t}i.off("pan").on("pan",(function(e){this._mouseDownFlag=!1,se(r,e.dx,e.dy),n.dispatchAction(O(s(),{dx:e.dx,dy:e.dy,animation:{duration:0}}))}),this),i.off("zoom").on("zoom",(function(e){this._mouseDownFlag=!1,le(r,e.scale,e.originX,e.originY),n.dispatchAction(O(s(),{zoom:e.scale,originX:e.originX,originY:e.originY,animation:{duration:0}}))}),this),i.setPointerChecker((function(t,i,r){return o.containPoint([i,r])&&!ge(t,n,e)}))},e.prototype.resetForLabelLayout=function(){this.group.traverse((function(e){var t=e.getTextContent();t&&(t.ignore=Qe(t).ignore)}))},e.prototype._updateMapSelectHandler=function(e,t,n,o){var i=this;t.off("mousedown"),t.off("click"),e.get("selectedMode")&&(t.on("mousedown",(function(){i._mouseDownFlag=!0})),t.on("click",(function(e){i._mouseDownFlag&&(i._mouseDownFlag=!1)})))},e}();function nt(e,t,n,o){var i=o.getModel("itemStyle"),r=o.getModel(["emphasis","itemStyle"]),a=o.getModel(["blur","itemStyle"]),s=o.getModel(["select","itemStyle"]),l=$e(i),p=$e(r),u=$e(s),c=$e(a),g=e.data;if(g){var h=g.getItemVisual(n,"style"),d=g.getItemVisual(n,"decal");e.isVisualEncodedByVisualMap&&h.fill&&(l.fill=h.fill),d&&(l.decal=k(d,e.api))}t.setStyle(l),t.style.strokeNoScale=!0,t.ensureState("emphasis").style=p,t.ensureState("select").style=u,t.ensureState("blur").style=c,L(t)}function ot(e,t,n,o,i,r,a){var s=e.data,l=e.isGeo,p=s&&isNaN(s.get(s.mapDimension("value"),r)),u=s&&s.getItemLayout(r);if(l||p||u&&u.showLabel){var c=l?n:r,g=void 0;(!s||r>=0)&&(g=i);var h=a?{normal:{align:"center",verticalAlign:"middle"}}:null;P(t,V(o),{labelFetcher:g,labelDataIndex:c,defaultText:n},h);var d=t.getTextContent();if(d&&(Qe(d).ignore=d.ignore,t.textConfig&&a)){var f=t.getBoundingRect().clone();t.textConfig.layoutRect=f,t.textConfig.position=[(a[0]-f.x)/f.width*100+"%",(a[1]-f.y)/f.height*100+"%"]}t.disableLabelAnimation=!0}else t.removeTextContent(),t.removeTextConfig(),t.disableLabelAnimation=null}function it(e,t,n,o,i,r){e.data?e.data.setItemGraphicEl(r,t):B(t).eventData={componentType:"geo",componentIndex:i.componentIndex,geoIndex:i.componentIndex,name:n,region:o&&o.option||{}}}function rt(e,t,n,o,i){e.data||z({el:t,componentModel:i,itemName:n,itemTooltipOption:o.get("tooltip")})}function at(e,t,n,o,i){t.highDownSilentOnTouch=!!i.get("selectedMode");var r=o.getModel("emphasis"),a=r.get("focus");return j(t,a,r.get("blurScope"),r.get("disabled")),e.isGeo&&J(t,i,n),a}function st(e,t,n){var o,i=[];function r(){o=[]}function a(){o.length&&(i.push(o),o=[])}var s=t({polygonStart:r,polygonEnd:a,lineStart:r,lineEnd:a,point:function(e,t){isFinite(e)&&isFinite(t)&&o.push([e,t])},sphere:function(){}});return!n&&s.polygonStart(),m(e,(function(e){s.lineStart();for(var t=0;t<e.length;t++)s.point(e[t][0],e[t][1]);s.lineEnd()})),!n&&s.polygonEnd(),i}var lt=tt,pt={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},ut=["lng","lat"],ct=function(t){function n(e,n,o){var i=t.call(this,e)||this;i.dimensions=ut,i.type="geo",i._nameCoordMap=M(),i.map=n;var r=o.projection,a=He.load(n,o.nameMap,o.nameProperty),s=He.getGeoResource(n);i.resourceType=s?s.type:null;var l,p=i.regions=a.regions,u=pt[s.type];if(i._regionsMap=a.regionsMap,i.regions=a.regions,i.projection=r,r)for(var c=0;c<p.length;c++){var g=p[c].getBoundingRect(r);(l=l||g.clone()).union(g)}else l=a.boundingRect;return i.setBoundingRect(l.x,l.y,l.width,l.height),i.aspectScale=r?1:Y(o.aspectScale,u.aspectScale),i._invertLongitute=!r&&u.invertLongitute,i}return X(n,t),n.prototype._transformTo=function(e,t,n,o){var i=this.getBoundingRect(),r=this._invertLongitute;i=i.clone(),r&&(i.y=-i.y-i.height);var a=this._rawTransformable;a.transform=i.calculateTransform(new F(e,t,n,o));var s=a.parent;a.parent=null,a.decomposeTransform(),a.parent=s,r&&(a.scaleY=-a.scaleY),this._updateTransform()},n.prototype.getRegion=function(e){return this._regionsMap.get(e)},n.prototype.getRegionByCoord=function(e){for(var t=this.regions,n=0;n<t.length;n++){var o=t[n];if("geoJSON"===o.type&&o.contain(e))return t[n]}},n.prototype.addGeoCoord=function(e,t){this._nameCoordMap.set(e,t)},n.prototype.getGeoCoord=function(e){var t=this._regionsMap.get(e);return this._nameCoordMap.get(e)||t&&t.getCenter()},n.prototype.dataToPoint=function(t,n,o){if(e(t)&&(t=this.getGeoCoord(t)),t){var i=this.projection;return i&&(t=i.project(t)),t&&this.projectedToPoint(t,n,o)}},n.prototype.pointToData=function(e){var t=this.projection;return t&&(e=t.unproject(e)),e&&this.pointToProjected(e)},n.prototype.pointToProjected=function(e){return t.prototype.pointToData.call(this,e)},n.prototype.projectedToPoint=function(e,n,o){return t.prototype.dataToPoint.call(this,e,n,o)},n.prototype.convertToPixel=function(e,t,n){var o=gt(t);return o===this?o.dataToPoint(n):null},n.prototype.convertFromPixel=function(e,t,n){var o=gt(t);return o===this?o.pointToData(n):null},n}(pe);function gt(e){var t=e.geoModel,n=e.seriesModel;return t?t.coordinateSystem:n?n.coordinateSystem||(n.getReferringComponents("geo",H).models[0]||{}).coordinateSystem:null}E(ct,pe);var ht=ct;function dt(e,t){var n=e.get("boundingCoords");if(null!=n){var o=n[0],i=n[1];if(isFinite(o[0])&&isFinite(o[1])&&isFinite(i[0])&&isFinite(i[1])){var r=this.projection;if(r){var a=o[0],s=o[1],l=i[0],p=i[1];o=[1/0,1/0],i=[-1/0,-1/0];var u=function(e,t,n,a){for(var s=n-e,l=a-t,p=0;p<=100;p++){var u=p/100,c=r.project([e+s*u,t+l*u]);Q(o,o,c),$(i,i,c)}};u(a,s,l,s),u(l,s,l,p),u(l,p,a,p),u(a,p,l,s)}this.setBoundingRect(o[0],o[1],i[0]-o[0],i[1]-o[1])}else;}var c,g,h,d=this.getBoundingRect(),f=e.get("layoutCenter"),m=e.get("layoutSize"),v=t.getWidth(),y=t.getHeight(),_=d.width/d.height*this.aspectScale,b=!1;if(f&&m&&(c=[q(f[0],v),q(f[1],y)],g=q(m,Math.min(v,y)),isNaN(c[0])||isNaN(c[1])||isNaN(g)||(b=!0)),b)h={},_>1?(h.width=g,h.height=g/_):(h.height=g,h.width=g*_),h.y=c[1]-h.height/2,h.x=c[0]-h.width/2;else{var S=e.getBoxLayoutParams();S.aspect=_,h=K(S,{width:v,height:y})}this.setViewRect(h.x,h.y,h.width,h.height),this.setCenter(e.get("center"),t),this.setZoom(e.get("zoom"))}var ft=function(){function e(){this.dimensions=ut}return e.prototype.create=function(e,t){var n=[];function o(e){return{nameProperty:e.get("nameProperty"),aspectScale:e.get("aspectScale"),projection:e.get("projection")}}e.eachComponent("geo",(function(e,i){var r=e.get("map"),a=new ht(r+i,r,O({nameMap:e.get("nameMap")},o(e)));a.zoomLimit=e.get("scaleLimit"),n.push(a),e.coordinateSystem=a,a.model=e,a.resize=dt,a.resize(e,t)})),e.eachSeries((function(e){if("geo"===e.get("coordinateSystem")){var t=e.get("geoIndex")||0;e.coordinateSystem=n[t]}}));var i={};return e.eachSeriesByType("map",(function(e){if(!e.getHostGeoModel()){var t=e.getMapType();i[t]=i[t]||[],i[t].push(e)}})),m(i,(function(e,i){var r=v(e,(function(e){return e.get("nameMap")})),a=new ht(i,i,O({nameMap:W(r)},o(e[0])));a.zoomLimit=Z.apply(null,v(e,(function(e){return e.get("scaleLimit")}))),n.push(a),a.resize=dt,a.resize(e[0],t),m(e,(function(e){e.coordinateSystem=a,function(e,t){m(t.get("geoCoord"),(function(t,n){e.addGeoCoord(n,t)}))}(a,e)}))})),n},e.prototype.getFilledRegions=function(e,t,n,o){for(var i=(e||[]).slice(),r=M(),a=0;a<i.length;a++)r.set(i[a].name,i[a]);var s=He.load(t,n,o);return m(s.regions,(function(e){var t=e.name;!r.get(t)&&i.push({name:t})})),i},e}(),mt=new ft,vt=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=n.type,e}return X(n,t),n.prototype.init=function(e,t,n){var o=He.getGeoResource(e.map);if(o&&"geoJSON"===o.type){var i=e.itemStyle=e.itemStyle||{};"color"in i||(i.color="#eee")}this.mergeDefaultAndTheme(e,n),ee(e,"label",["show"])},n.prototype.optionUpdated=function(){var e=this,t=this.option;t.regions=mt.getFilledRegions(t.regions,t.map,t.nameMap,t.nameProperty);var n={};this._optionModelMap=te(t.regions||[],(function(t,o){var i=o.name;return i&&(t.set(i,new ne(o,e,e.ecModel)),o.selected&&(n[i]=!0)),t}),M()),t.selectedMap||(t.selectedMap=n)},n.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new ne(null,this,this.ecModel)},n.prototype.getFormattedLabel=function(t,n){var o=this.getRegionModel(t),i="normal"===n?o.get(["label","formatter"]):o.get(["emphasis","label","formatter"]),r={name:t};return oe(i)?(r.status=n,i(r)):e(i)?i.replace("{a}",null!=t?t:""):void 0},n.prototype.setZoom=function(e){this.option.zoom=e},n.prototype.setCenter=function(e){this.option.center=e},n.prototype.select=function(e){var t=this.option,n=t.selectedMode;n&&("multiple"!==n&&(t.selectedMap=null),(t.selectedMap||(t.selectedMap={}))[e]=!0)},n.prototype.unSelect=function(e){var t=this.option.selectedMap;t&&(t[e]=!1)},n.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)},n.prototype.isSelected=function(e){var t=this.option.selectedMap;return!(!t||!t[e])},n.type="geo",n.layoutMode="box",n.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},n}(ie),yt=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.type=t.type,n.focusBlurEnabled=!0,n}return X(t,e),t.prototype.init=function(e,t){this._api=t},t.prototype.render=function(e,t,n,o){if(this._model=e,!e.get("show"))return this._mapDraw&&this._mapDraw.remove(),void(this._mapDraw=null);this._mapDraw||(this._mapDraw=new lt(n));var i=this._mapDraw;i.draw(e,t,n,this,o),i.group.on("click",this._handleRegionClick,this),i.group.silent=e.get("silent"),this.group.add(i.group),this.updateSelectStatus(e,t,n)},t.prototype._handleRegionClick=function(e){var t;re(e.target,(function(e){return null!=(t=B(e).eventData)}),!0),t&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:t.name})},t.prototype.updateSelectStatus=function(e,t,n){var o=this;this._mapDraw.group.traverse((function(e){var t=B(e).eventData;if(t)return o._model.isSelected(t.name)?n.enterSelect(e):n.leaveSelect(e),!0}))},t.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},t.type="geo",t}(ae);function _t(e,t,n){He.registerMap(e,t,n)}function bt(e){function t(t,n){n.update="geo:updateSelectStatus",e.registerAction(n,(function(e,n){var o={},i=[];return n.eachComponent({mainType:"geo",query:e},(function(n){n[t](e.name);var r=n.coordinateSystem;m(r.regions,(function(e){o[e.name]=n.isSelected(e.name)||!1}));var a=[];m(o,(function(e,t){o[t]&&a.push(t)})),i.push({geoIndex:n.componentIndex,name:a})})),{selected:o,allSelected:i,name:e.name}}))}e.registerCoordinateSystem("geo",mt),e.registerComponentModel(vt),e.registerComponentView(yt),e.registerImpl("registerMap",_t),e.registerImpl("getMap",(function(e){return He.getMapForUser(e)})),t("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),t("select",{type:"geoSelect",event:"geoselected"}),t("unSelect",{type:"geoUnSelect",event:"geounselected"}),e.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},(function(e,t,n){var o=e.componentType||"series";t.eachComponent({mainType:o,query:e},(function(t){var i=t.coordinateSystem;if("geo"===i.type){var r=ue(i,e,t.get("scaleLimit"),n);t.setCenter&&t.setCenter(r.center),t.setZoom&&t.setZoom(r.zoom),"series"===o&&m(t.seriesGroup,(function(e){e.setCenter(r.center),e.setZoom(r.zoom)}))}}))}))}var St=Object.freeze({__proto__:null,install:bt});export{lt as M,St as a,He as g,bt as i};
