import{_ as t,ah as e,a6 as i,s as a,f as n,u as o,p as r,o as l,k as s,j as h,ai as u,aj as g,r as p,C as c,W as d,w as f,ak as m,al as y,S as v,D as b,am as L,H as x,an as w}from"./index.js";import{s as z,g as S}from"./labelGuideHelper.js";import{c as D}from"./createSeriesDataSimply.js";import{L as I}from"./LegendVisualProvider.js";import{d as M}from"./dataFilter.js";var k=["itemStyle","opacity"],A=function(g){function p(t,a){var n=g.call(this)||this,o=n,r=new e,l=new i;return o.setTextContent(l),n.setTextGuideLine(r),n.updateData(t,a,!0),n}return t(p,g),p.prototype.updateData=function(t,e,i){var s=this,h=t.hostModel,u=t.getItemModel(e),g=t.getItemLayout(e),p=u.getModel("emphasis"),c=u.get(k);c=null==c?1:c,i||a(s),s.useStyle(t.getItemVisual(e,"style")),s.style.lineJoin="round",i?(s.setShape({points:g.points}),s.style.opacity=0,n(s,{style:{opacity:c}},h,e)):o(s,{style:{opacity:c},shape:{points:g.points}},h,e),r(s,u),this._updateLabel(t,e),l(this,p.get("focus"),p.get("blurScope"),p.get("disabled"))},p.prototype._updateLabel=function(t,e){var i=this,a=this.getTextGuideLine(),n=i.getTextContent(),r=t.hostModel,l=t.getItemModel(e),g=t.getItemLayout(e).label,p=t.getItemVisual(e,"style"),c=p.fill;s(n,h(l),{labelFetcher:t.hostModel,labelDataIndex:e,defaultOpacity:p.opacity,defaultText:t.getName(e)},{normal:{align:g.textAlign,verticalAlign:g.verticalAlign}}),i.setTextConfig({local:!0,inside:!!g.inside,insideStroke:c,outsideFill:c});var d=g.linePoints;a.setShape({points:d}),i.textGuideLineConfig={anchor:d?new u(d[0][0],d[0][1]):null},o(n,{style:{x:g.x,y:g.y}},r,e),n.attr({rotation:g.rotation,originX:g.x,originY:g.y,z2:10}),z(i,S(l),{stroke:c})},p}(g),T=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.type,t.ignoreLabelLineUpdate=!0,t}return t(i,e),i.prototype.render=function(t,e,i){var a=t.getData(),n=this._data,o=this.group;a.diff(n).add((function(t){var e=new A(a,t);a.setItemGraphicEl(t,e),o.add(e)})).update((function(t,e){var i=n.getItemGraphicEl(e);i.updateData(a,t),o.add(i),a.setItemGraphicEl(t,i)})).remove((function(e){var i=n.getItemGraphicEl(e);p(i,t,e)})).execute(),this._data=a},i.prototype.remove=function(){this.group.removeAll(),this._data=null},i.prototype.dispose=function(){},i.type="funnel",i}(c),C=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.type,t}return t(i,e),i.prototype.init=function(t){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new I(d(this.getData,this),d(this.getRawData,this)),this._defaultLabelLine(t)},i.prototype.getInitialData=function(t,e){return D(this,{coordDimensions:["value"],encodeDefaulter:f(m,this)})},i.prototype._defaultLabelLine=function(t){y(t,"labelLine",["show"]);var e=t.labelLine,i=t.emphasis.labelLine;e.show=e.show&&t.label.show,i.show=i.show&&t.emphasis.label.show},i.prototype.getDataParams=function(t){var i=this.getData(),a=e.prototype.getDataParams.call(this,t),n=i.mapDimension("value"),o=i.getSum(n);return a.percent=o?+(i.get(n,t)/o*100).toFixed(2):0,a.$vars.push("percent"),a},i.type="series.funnel",i.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},i}(v);function G(t,e){t.eachSeriesByType("funnel",(function(t){var i=t.getData(),a=i.mapDimension("value"),n=t.get("sort"),o=function(t,e){return L(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,e),r=t.get("orient"),l=o.width,s=o.height,h=function(t,e){for(var i=t.mapDimension("value"),a=t.mapArray(i,(function(t){return t})),n=[],o="ascending"===e,r=0,l=t.count();r<l;r++)n[r]=r;return x(e)?n.sort(e):"none"!==e&&n.sort((function(t,e){return o?a[t]-a[e]:a[e]-a[t]})),n}(i,n),u=o.x,g=o.y,p="horizontal"===r?[b(t.get("minSize"),s),b(t.get("maxSize"),s)]:[b(t.get("minSize"),l),b(t.get("maxSize"),l)],c=i.getDataExtent(a),d=t.get("min"),f=t.get("max");null==d&&(d=Math.min(c[0],0)),null==f&&(f=c[1]);var m=t.get("funnelAlign"),y=t.get("gap"),v=(("horizontal"===r?l:s)-y*(i.count()-1))/i.count(),z=function(t,e){if("horizontal"===r){var n=i.get(a,t)||0,o=w(n,[d,f],p,!0),h=void 0;switch(m){case"top":h=g;break;case"center":h=g+(s-o)/2;break;case"bottom":h=g+(s-o)}return[[e,h],[e,h+o]]}var c,y=i.get(a,t)||0,v=w(y,[d,f],p,!0);switch(m){case"left":c=u;break;case"center":c=u+(l-v)/2;break;case"right":c=u+l-v}return[[c,e],[c+v,e]]};"ascending"===n&&(v=-v,y=-y,"horizontal"===r?u+=l:g+=s,h=h.reverse());for(var S=0;S<h.length;S++){var D=h[S],I=h[S+1],M=i.getItemModel(D);if("horizontal"===r){var k=M.get(["itemStyle","width"]);null==k?k=v:(k=b(k,l),"ascending"===n&&(k=-k));var A=z(D,u),T=z(I,u+k);u+=k+y,i.setItemLayout(D,{points:A.concat(T.slice().reverse())})}else{var C=M.get(["itemStyle","height"]);null==C?C=v:(C=b(C,s),"ascending"===n&&(C=-C));A=z(D,g),T=z(I,g+C);g+=C+y,i.setItemLayout(D,{points:A.concat(T.slice().reverse())})}}!function(t){var e=t.hostModel.get("orient");t.each((function(i){var a,n,o,r,l=t.getItemModel(i),s=l.getModel("label").get("position"),h=l.getModel("labelLine"),u=t.getItemLayout(i),g=u.points,p="inner"===s||"inside"===s||"center"===s||"insideLeft"===s||"insideRight"===s;if(p)"insideLeft"===s?(n=(g[0][0]+g[3][0])/2+5,o=(g[0][1]+g[3][1])/2,a="left"):"insideRight"===s?(n=(g[1][0]+g[2][0])/2-5,o=(g[1][1]+g[2][1])/2,a="right"):(n=(g[0][0]+g[1][0]+g[2][0]+g[3][0])/4,o=(g[0][1]+g[1][1]+g[2][1]+g[3][1])/4,a="center"),r=[[n,o],[n,o]];else{var c=void 0,d=void 0,f=void 0,m=void 0,y=h.get("length");"left"===s?(c=(g[3][0]+g[0][0])/2,d=(g[3][1]+g[0][1])/2,n=(f=c-y)-5,a="right"):"right"===s?(c=(g[1][0]+g[2][0])/2,d=(g[1][1]+g[2][1])/2,n=(f=c+y)+5,a="left"):"top"===s?(c=(g[3][0]+g[0][0])/2,o=(m=(d=(g[3][1]+g[0][1])/2)-y)-5,a="center"):"bottom"===s?(c=(g[1][0]+g[2][0])/2,o=(m=(d=(g[1][1]+g[2][1])/2)+y)+5,a="center"):"rightTop"===s?(c="horizontal"===e?g[3][0]:g[1][0],d="horizontal"===e?g[3][1]:g[1][1],"horizontal"===e?(o=(m=d-y)-5,a="center"):(n=(f=c+y)+5,a="top")):"rightBottom"===s?(c=g[2][0],d=g[2][1],"horizontal"===e?(o=(m=d+y)+5,a="center"):(n=(f=c+y)+5,a="bottom")):"leftTop"===s?(c=g[0][0],d="horizontal"===e?g[0][1]:g[1][1],"horizontal"===e?(o=(m=d-y)-5,a="center"):(n=(f=c-y)-5,a="right")):"leftBottom"===s?(c="horizontal"===e?g[1][0]:g[3][0],d="horizontal"===e?g[1][1]:g[2][1],"horizontal"===e?(o=(m=d+y)+5,a="center"):(n=(f=c-y)-5,a="right")):(c=(g[1][0]+g[2][0])/2,d=(g[1][1]+g[2][1])/2,"horizontal"===e?(o=(m=d+y)+5,a="center"):(n=(f=c+y)+5,a="left")),"horizontal"===e?n=f=c:o=m=d,r=[[c,d],[f,m]]}u.label={linePoints:r,x:n,y:o,verticalAlign:"middle",textAlign:a,inside:p}}))}(i)}))}function P(t){t.registerChartView(T),t.registerSeriesModel(C),t.registerLayout(G),t.registerProcessor(M("funnel"))}export{P as install};
