import{b4 as t,B as e,_ as n,bM as i,e as o,da as a,bo as r,bR as s,bQ as u,bd as d,an as p,m as l,db as c,dc as f,dd as h,E as g}from"./index.js";import{s as x}from"./sliderMove.js";var m=["x","y","radius","angle","single"],v=["cartesian2d","polar","singleAxis"];function y(t){return t+"Axis"}function _(e,n){var i,o=t(),a=[],r=t();e.eachComponent({mainType:"dataZoom",query:n},(function(t){r.get(t.uid)||u(t)}));do{i=!1,e.eachComponent("dataZoom",s)}while(i);function s(t){!r.get(t.uid)&&function(t){var e=!1;return t.eachTargetAxis((function(t,n){var i=o.get(t);i&&i[n]&&(e=!0)})),e}(t)&&(u(t),i=!0)}function u(t){r.set(t.uid,!0),a.push(t),t.eachTargetAxis((function(t,e){(o.get(t)||o.set(t,[]))[e]=!0}))}return a}function M(e){var n=e.ecModel,i={infoList:[],infoMap:t()};return e.eachTargetAxis((function(t,e){var o=n.getComponent(y(t),e);if(o){var a=o.getCoordSysModel();if(a){var r=a.uid,s=i.infoMap.get(r);s||(s={model:a,axisModels:[]},i.infoList.push(s),i.infoMap.set(r,s)),s.axisModels.push(o)}}})),i}var A=function(){function t(){this.indexList=[],this.indexMap=[]}return t.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},t}(),T=function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=s.type,t._autoThrottle=!0,t._noTarget=!0,t._rangePropMode=["percent","percent"],t}return n(s,e),s.prototype.init=function(t,e,n){var i=w(t);this.settledOption=i,this.mergeDefaultAndTheme(t,n),this._doInit(i)},s.prototype.mergeOption=function(t){var e=w(t);i(this.option,t,!0),i(this.settledOption,e,!0),this._doInit(e)},s.prototype._doInit=function(t){var e=this.option;this._setDefaultThrottle(t),this._updateRangeUse(t);var n=this.settledOption;o([["start","startValue"],["end","endValue"]],(function(t,i){"value"===this._rangePropMode[i]&&(e[t[0]]=n[t[0]]=null)}),this),this._resetTarget()},s.prototype._resetTarget=function(){var e=this.get("orient",!0),n=this._targetAxisInfoMap=t();this._fillSpecifiedTargetAxis(n)?this._orient=e||this._makeAutoOrientByTargetAxis():(this._orient=e||"horizontal",this._fillAutoTargetAxisByOrient(n,this._orient)),this._noTarget=!0,n.each((function(t){t.indexList.length&&(this._noTarget=!1)}),this)},s.prototype._fillSpecifiedTargetAxis=function(t){var e=!1;return o(m,(function(n){var i=this.getReferringComponents(y(n),a);if(i.specified){e=!0;var r=new A;o(i.models,(function(t){r.add(t.componentIndex)})),t.set(n,r)}}),this),e},s.prototype._fillAutoTargetAxisByOrient=function(t,e){var n=this.ecModel,i=!0;if(i){var a="vertical"===e?"y":"x";s(n.findComponents({mainType:a+"Axis"}),a)}i&&s(n.findComponents({mainType:"singleAxis",filter:function(t){return t.get("orient",!0)===e}}),"single");function s(e,n){var a=e[0];if(a){var s=new A;if(s.add(a.componentIndex),t.set(n,s),i=!1,"x"===n||"y"===n){var u=a.getReferringComponents("grid",r).models[0];u&&o(e,(function(t){a.componentIndex!==t.componentIndex&&u===t.getReferringComponents("grid",r).models[0]&&s.add(t.componentIndex)}))}}}i&&o(m,(function(e){if(i){var o=n.findComponents({mainType:y(e),filter:function(t){return"category"===t.get("type",!0)}});if(o[0]){var a=new A;a.add(o[0].componentIndex),t.set(e,a),i=!1}}}),this)},s.prototype._makeAutoOrientByTargetAxis=function(){var t;return this.eachTargetAxis((function(e){!t&&(t=e)}),this),"y"===t?"vertical":"horizontal"},s.prototype._setDefaultThrottle=function(t){if(t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var e=this.ecModel.option;this.option.throttle=e.animation&&e.animationDurationUpdate>0?100:20}},s.prototype._updateRangeUse=function(t){var e=this._rangePropMode,n=this.get("rangeMode");o([["start","startValue"],["end","endValue"]],(function(i,o){var a=null!=t[i[0]],r=null!=t[i[1]];a&&!r?e[o]="percent":!a&&r?e[o]="value":n?e[o]=n[o]:a&&(e[o]="percent")}))},s.prototype.noTarget=function(){return this._noTarget},s.prototype.getFirstTargetAxisModel=function(){var t;return this.eachTargetAxis((function(e,n){null==t&&(t=this.ecModel.getComponent(y(e),n))}),this),t},s.prototype.eachTargetAxis=function(t,e){this._targetAxisInfoMap.each((function(n,i){o(n.indexList,(function(n){t.call(e,i,n)}))}))},s.prototype.getAxisProxy=function(t,e){var n=this.getAxisModel(t,e);if(n)return n.__dzAxisProxy},s.prototype.getAxisModel=function(t,e){var n=this._targetAxisInfoMap.get(t);if(n&&n.indexMap[e])return this.ecModel.getComponent(y(t),e)},s.prototype.setRawRange=function(t){var e=this.option,n=this.settledOption;o([["start","startValue"],["end","endValue"]],(function(i){null==t[i[0]]&&null==t[i[1]]||(e[i[0]]=n[i[0]]=t[i[0]],e[i[1]]=n[i[1]]=t[i[1]])}),this),this._updateRangeUse(t)},s.prototype.setCalculatedRange=function(t){var e=this.option;o(["start","startValue","end","endValue"],(function(n){e[n]=t[n]}))},s.prototype.getPercentRange=function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},s.prototype.getValueRange=function(t,e){if(null!=t||null!=e)return this.getAxisProxy(t,e).getDataValueWindow();var n=this.findRepresentativeAxisProxy();return n?n.getDataValueWindow():void 0},s.prototype.findRepresentativeAxisProxy=function(t){if(t)return t.__dzAxisProxy;for(var e,n=this._targetAxisInfoMap.keys(),i=0;i<n.length;i++)for(var o=n[i],a=this._targetAxisInfoMap.get(o),r=0;r<a.indexList.length;r++){var s=this.getAxisProxy(o,a.indexList[r]);if(s.hostedBy(this))return s;e||(e=s)}return e},s.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},s.prototype.getOrient=function(){return this._orient},s.type="dataZoom",s.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],s.defaultOption={z:4,filterMode:"filter",start:0,end:100},s}(s);function w(t){var e={};return o(["start","end","startValue","endValue","throttle"],(function(n){t.hasOwnProperty(n)&&(e[n]=t[n])})),e}var P=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.type=e.type,n}return n(e,t),e.prototype.render=function(t,e,n,i){this.dataZoomModel=t,this.ecModel=e,this.api=n},e.type="dataZoom",e}(u),R=o,S=g,V=function(){function t(t,e,n,i){this._dimName=t,this._axisIndex=e,this.ecModel=i,this._dataZoomModel=n}return t.prototype.hostedBy=function(t){return this._dataZoomModel===t},t.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},t.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},t.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries((function(n){if(function(t){var n=t.get("coordinateSystem");return e(v,n)>=0}(n)){var i=y(this._dimName),o=n.getReferringComponents(i,r).models[0];o&&this._axisIndex===o.componentIndex&&t.push(n)}}),this),t},t.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},t.prototype.getMinMaxSpan=function(){return d(this._minMaxSpan)},t.prototype.calculateDataWindow=function(t){var e,n=this._dataExtent,i=this.getAxisModel().axis.scale,o=this._dataZoomModel.getRangePropMode(),a=[0,100],r=[],s=[];R(["start","end"],(function(u,d){var l=t[u],c=t[u+"Value"];"percent"===o[d]?(null==l&&(l=a[d]),c=i.parse(p(l,a,n))):(e=!0,c=null==c?n[d]:i.parse(c),l=p(c,n,a)),s[d]=null==c||isNaN(c)?n[d]:c,r[d]=null==l||isNaN(l)?a[d]:l})),S(s),S(r);var u=this._minMaxSpan;function d(t,e,n,o,a){var r=a?"Span":"ValueSpan";x(0,t,n,"all",u["min"+r],u["max"+r]);for(var s=0;s<2;s++)e[s]=p(t[s],n,o,!0),a&&(e[s]=i.parse(e[s]))}return e?d(s,r,n,a,!1):d(r,s,a,n,!0),{valueWindow:s,percentWindow:r}},t.prototype.reset=function(t){if(t===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=function(t,e,n){var i=[1/0,-1/0];R(n,(function(t){f(i,t.getData(),e)}));var o=t.getAxisModel(),a=h(o.axis.scale,o,i).calculate();return[a.min,a.max]}(this,this._dimName,e),this._updateMinMaxSpan();var n=this.calculateDataWindow(t.settledOption);this._valueWindow=n.valueWindow,this._percentWindow=n.percentWindow,this._setAxisModel()}},t.prototype.filterData=function(t,e){if(t===this._dataZoomModel){var n=this._dimName,i=this.getTargetSeriesModels(),o=t.get("filterMode"),a=this._valueWindow;"none"!==o&&R(i,(function(t){var e=t.getData(),i=e.mapDimensionsAll(n);if(i.length){if("weakFilter"===o){var r=e.getStore(),s=l(i,(function(t){return e.getDimensionIndex(t)}),e);e.filterSelf((function(t){for(var e,n,o,u=0;u<i.length;u++){var d=r.get(s[u],t),p=!isNaN(d),l=d<a[0],c=d>a[1];if(p&&!l&&!c)return!0;p&&(o=!0),l&&(e=!0),c&&(n=!0)}return o&&e&&n}))}else R(i,(function(n){if("empty"===o)t.setData(e=e.map(n,(function(t){return function(t){return t>=a[0]&&t<=a[1]}(t)?t:NaN})));else{var i={};i[n]=a,e.selectRange(i)}}));R(i,(function(t){e.setApproximateExtent(a,t)}))}}))}},t.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,n=this._dataExtent;R(["min","max"],(function(i){var o=e.get(i+"Span"),a=e.get(i+"ValueSpan");null!=a&&(a=this.getAxisModel().axis.scale.parse(a)),null!=a?o=p(n[0]+a,n,[0,100],!0):null!=o&&(a=p(o,[0,100],n,!0)-n[0]),t[i+"Span"]=o,t[i+"ValueSpan"]=a}),this)},t.prototype._setAxisModel=function(){var t=this.getAxisModel(),e=this._percentWindow,n=this._valueWindow;if(e){var i=c(n,[0,500]);i=Math.min(i,20);var o=t.axis.scale.rawExtentInfo;0!==e[0]&&o.setDeterminedMinMax("min",+n[0].toFixed(i)),100!==e[1]&&o.setDeterminedMinMax("max",+n[1].toFixed(i)),o.freeze()}},t}();var D={getTargetSeries:function(e){function n(t){e.eachComponent("dataZoom",(function(n){n.eachTargetAxis((function(i,o){var a=e.getComponent(y(i),o);t(i,o,a,n)}))}))}n((function(t,e,n,i){n.__dzAxisProxy=null}));var i=[];n((function(t,n,o,a){o.__dzAxisProxy||(o.__dzAxisProxy=new V(t,n,a,e),i.push(o.__dzAxisProxy))}));var a=t();return o(i,(function(t){o(t.getTargetSeriesModels(),(function(t){a.set(t.uid,t)}))})),a},overallReset:function(t,e){t.eachComponent("dataZoom",(function(t){t.eachTargetAxis((function(e,n){t.getAxisProxy(e,n).reset(t)})),t.eachTargetAxis((function(n,i){t.getAxisProxy(n,i).filterData(t,e)}))})),t.eachComponent("dataZoom",(function(t){var e=t.findRepresentativeAxisProxy();if(e){var n=e.getDataPercentWindow(),i=e.getDataValueWindow();t.setCalculatedRange({start:n[0],end:n[1],startValue:i[0],endValue:i[1]})}}))}};var I=!1;function C(t){I||(I=!0,t.registerProcessor(t.PRIORITY.PROCESSOR.FILTER,D),function(t){t.registerAction("dataZoom",(function(t,e){var n=_(e,t);o(n,(function(e){e.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})}))}))}(t),t.registerSubTypeDefaulter("dataZoom",(function(){return"slider"})))}export{T as D,P as a,M as c,y as g,C as i};
